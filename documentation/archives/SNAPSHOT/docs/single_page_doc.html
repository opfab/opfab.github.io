<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>OperatorFabric Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>OperatorFabric Documentation</h1>
<div class="details">
<span id="revnumber">version SNAPSHOT,</span>
<span id="revdate">17 May 2024</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_operatorfabric_getting_started">OperatorFabric Getting Started</a>
<ul class="sectlevel1">
<li><a href="#_prerequisites">1. Prerequisites</a></li>
<li><a href="#_install_and_run_server">2. Install and run server</a></li>
<li><a href="#_examples">3. Examples</a>
<ul class="sectlevel2">
<li><a href="#_example_1_send_and_update_a_basic_card">3.1. Example 1: Send and update a basic card</a>
<ul class="sectlevel3">
<li><a href="#_anatomy_of_the_card">3.1.1. Anatomy of the card :</a></li>
<li><a href="#_update_the_card">3.1.2. Update the card</a></li>
<li><a href="#_delete_the_card">3.1.3. Delete the card</a></li>
</ul>
</li>
<li><a href="#_example_2_publish_a_new_bundle">3.2. Example 2: Publish a new bundle</a>
<ul class="sectlevel3">
<li><a href="#_package_your_bundle">3.2.1. Package your bundle</a></li>
<li><a href="#_get_a_token">3.2.2. Get a Token</a></li>
<li><a href="#_send_the_bundle">3.2.3. Send the bundle</a></li>
<li><a href="#_send_a_card">3.2.4. Send a card</a></li>
</ul>
</li>
<li><a href="#_example_3_process_with_state">3.3. Example 3: Process with state</a></li>
<li><a href="#_example_4_time_line">3.4. Example 4: Time Line</a></li>
<li><a href="#_example_5_card_routing_mechanism">3.5. Example 5: Card routing mechanism</a>
<ul class="sectlevel3">
<li><a href="#_card_sent_to_a_group">3.5.1. Card sent to a group</a></li>
<li><a href="#_card_sent_to_an_entity">3.5.2. Card sent to an entity</a></li>
<li><a href="#_card_sent_to_a_group_and_an_entity">3.5.3. Card sent to a group and an entity</a></li>
</ul>
</li>
<li><a href="#_example_6_sending_cards_from_the_ui">3.6. Example 6: Sending cards from the UI</a>
<ul class="sectlevel3">
<li><a href="#_updating_the_perimeter">3.6.1. Updating the perimeter</a></li>
<li><a href="#_creating_the_template_to_send_a_card">3.6.2. Creating the template to send a card</a></li>
<li><a href="#_customize_the_card_sending_template">3.6.3. Customize the card sending template</a></li>
</ul>
</li>
<li><a href="#_example_7_message_card_using_build_in_templates">3.7. Example 7: Message card using "build-in" templates</a></li>
<li><a href="#_example_8_question_card_using_build_in_templates">3.8. Example 8: Question card using "build-in" templates</a></li>
</ul>
</li>
<li><a href="#_demonstration">4. Demonstration</a></li>
<li><a href="#troubleshooting_bundle">5. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_my_bundle_is_not_loaded">5.1. My bundle is not loaded</a>
<ul class="sectlevel3">
<li><a href="#_solution">5.1.1. Solution</a></li>
</ul>
</li>
<li><a href="#_i_cant_upload_my_bundle">5.2. I can&#8217;t upload my bundle</a>
<ul class="sectlevel3">
<li><a href="#_format_verification">5.2.1. Format verification</a>
<ul class="sectlevel4">
<li><a href="#_linux_solution">5.2.1.1. Linux solution</a></li>
</ul>
</li>
<li><a href="#_solution_2">5.2.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_bundle_is_rejected_due_to_internal_structure">5.3. My bundle is rejected due to internal structure</a>
<ul class="sectlevel3">
<li><a href="#_reason">5.3.1. Reason</a></li>
<li><a href="#_solution_3">5.3.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_template_is_not_used">5.4. My template is not used.</a>
<ul class="sectlevel3">
<li><a href="#_solution_4">5.4.1. Solution</a></li>
</ul>
</li>
<li><a href="#_my_value_is_not_displayed_in_the_detail_template">5.5. My value is not displayed in the detail template</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#architecture">OperatorFabric Architecture</a>
<ul class="sectlevel1">
<li><a href="#_introduction">6. Introduction</a></li>
<li><a href="#_business_architecture">7. Business Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components">7.1. Business components</a></li>
<li><a href="#_business_objects">7.2. Business objects</a></li>
</ul>
</li>
<li><a href="#_technical_architecture">8. Technical Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components_2">8.1. Business components</a></li>
<li><a href="#_technical_components">8.2. Technical components</a>
<ul class="sectlevel3">
<li><a href="#_gateway">8.2.1. Gateway</a></li>
<li><a href="#_broker">8.2.2. Broker</a></li>
<li><a href="#_authentication">8.2.3. Authentication</a></li>
<li><a href="#_database">8.2.4. Database</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_architecture">9. Software architecture</a>
<ul class="sectlevel2">
<li><a href="#_back_architecture">9.1. Back Architecture</a></li>
<li><a href="#_front_architecture">9.2. Front Architecture</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security">OperatorFabric Security</a>
<ul class="sectlevel1">
<li><a href="#_code_analysis">10. Code analysis</a></li>
<li><a href="#_security_updates">11. Security Updates</a></li>
<li><a href="#_vulnerability_reporting">12. Vulnerability Reporting</a></li>
<li><a href="#_supply_chain_security">13. Supply Chain Security</a></li>
<li><a href="#_deployment_security">14. Deployment Security</a>
<ul class="sectlevel2">
<li><a href="#_keycloak">14.1. Keycloak</a></li>
<li><a href="#_mongodb">14.2. MongoDB</a></li>
<li><a href="#_tlsssl">14.3. TLS/SSL</a></li>
<li><a href="#_inter_services_communication">14.4. Inter-Services Communication</a></li>
<li><a href="#_access_to_card_publication_without_authentication">14.5. Access to card publication without authentication</a></li>
<li><a href="#_template">14.6. Template</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_reference_documentation">OperatorFabric Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="#_introduction_2">15. Introduction</a></li>
<li><a href="#_sending_cards">16. Sending cards</a>
<ul class="sectlevel2">
<li><a href="#card_structure">16.1. Card Structure</a>
<ul class="sectlevel3">
<li><a href="#_technical_information_of_the_card">16.1.1. Technical Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_mandatory_information">16.1.1.1. Mandatory information</a></li>
<li><a href="#_optional_information">16.1.1.2. Optional information</a></li>
<li><a href="#_business_period">16.1.1.3. Business period</a></li>
<li><a href="#_store_information">16.1.1.4. Store information</a></li>
</ul>
</li>
<li><a href="#_user_destined_information_of_the_card">16.1.2. User destined Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_in_card_format">16.1.2.1. in Card Format</a></li>
<li><a href="#_custom_part">16.1.2.2. Custom part</a></li>
</ul>
</li>
<li><a href="#_presentation_information_of_the_card">16.1.3. Presentation Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_timespans_timespans">16.1.3.1. TimeSpans (<code>timeSpans</code>)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cards_examples">16.2. Cards Examples</a>
<ul class="sectlevel3">
<li><a href="#minimal_card">16.2.1. Minimal Card</a>
<ul class="sectlevel4">
<li><a href="#reception_rules">16.2.1.1. Rules for receiving cards</a></li>
<li><a href="#_send_to_one_user">16.2.1.2. Send to One User</a></li>
<li><a href="#_send_to_several_users">16.2.1.3. Send to several users</a></li>
</ul>
</li>
<li><a href="#_regular_card">16.2.2. Regular Card</a>
<ul class="sectlevel4">
<li><a href="#_full_of_hidden_data">16.2.2.1. Full of Hidden data</a></li>
<li><a href="#_fully_useful">16.2.2.2. Fully useful</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_rendering">17. Card rendering</a>
<ul class="sectlevel2">
<li><a href="#_process_declaration_and_configuration">17.1. Process: Declaration and Configuration</a>
<ul class="sectlevel3">
<li><a href="#_bundle_as_process_declaration">17.1.1. Bundle as Process declaration</a></li>
<li><a href="#_the_config_json_file">17.1.2. The config.json file</a></li>
<li><a href="#_the_i18n_json_file">17.1.3. The i18n.json file</a>
<ul class="sectlevel4">
<li><a href="#_template_folder">17.1.3.1. Template folder</a></li>
<li><a href="#_processes_and_states">17.1.3.2. Processes and States</a></li>
<li><a href="#_upload">17.1.3.3. Upload</a></li>
</ul>
</li>
<li><a href="#_processes_groups">17.1.4. Processes groups</a></li>
</ul>
</li>
<li><a href="#template_description">17.2. Templates</a>
<ul class="sectlevel3">
<li><a href="#_operatorfabric_specific_handlebars_helpers">17.2.1. OperatorFabric specific handlebars helpers</a>
<ul class="sectlevel4">
<li><a href="#arrayContains">17.2.1.1. arrayContains</a></li>
<li><a href="#arrayContainsOneOf">17.2.1.2. arrayContainsOneOf</a></li>
<li><a href="#bool">17.2.1.3. bool</a></li>
<li><a href="#conditionalAttribute">17.2.1.4. conditionalAttribute</a></li>
<li><a href="#replace">17.2.1.5. replace</a></li>
<li><a href="#dateformat">17.2.1.6. dateFormat</a></li>
<li><a href="#json">17.2.1.7. json</a></li>
<li><a href="#_keepspacesandendofline">17.2.1.8. keepSpacesAndEndOfLine</a></li>
<li><a href="#keyValue">17.2.1.9. keyValue</a></li>
<li><a href="#math">17.2.1.10. math</a></li>
<li><a href="#mergeArrays">17.2.1.11. mergeArrays</a></li>
<li><a href="#now">17.2.1.12. now</a></li>
<li><a href="#numberformat">17.2.1.13. numberFormat</a></li>
<li><a href="#padStart">17.2.1.14. padStart</a></li>
<li><a href="#preservespace">17.2.1.15. preserveSpace</a></li>
<li><a href="#slice">17.2.1.16. slice</a></li>
<li><a href="#sort">17.2.1.17. sort</a></li>
<li><a href="#split">17.2.1.18. split</a></li>
<li><a href="#times">17.2.1.19. times</a></li>
<li><a href="#toBreakage">17.2.1.20. toBreakage</a></li>
<li><a href="#objectContainsKey">17.2.1.21. objectContainsKey</a></li>
<li><a href="#findObjectByProperty">17.2.1.22. findObjectByProperty</a></li>
</ul>
</li>
<li><a href="#_naming_convention">17.2.2. Naming convention</a></li>
<li><a href="#opfab_template_style">17.2.3. OperatorFabric css styles</a>
<ul class="sectlevel4">
<li><a href="#_opfab_input">17.2.3.1. opfab-input</a></li>
<li><a href="#_opfab_textarea">17.2.3.2. opfab-textarea</a></li>
<li><a href="#_opfab_select">17.2.3.3. opfab-select</a></li>
<li><a href="#_opfab_radio_button">17.2.3.4. opfab-radio-button</a></li>
<li><a href="#_opfab_checkbox">17.2.3.5. opfab-checkbox</a></li>
<li><a href="#_opfab_table">17.2.3.6. opfab-table</a></li>
<li><a href="#_opfab_border_box">17.2.3.7. opfab-border-box</a></li>
<li><a href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success">17.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</a></li>
<li><a href="#_opfab_btn_opfab_btn_cancel">17.2.3.9. opfab-btn, opfab-btn-cancel</a></li>
</ul>
</li>
<li><a href="#_tooltip">17.2.4. Tooltip</a></li>
<li><a href="#_multi_select">17.2.5. Multi Select</a></li>
<li><a href="#_rich_text_editor">17.2.6. Rich Text Editor</a></li>
<li><a href="#_charts">17.2.7. Charts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_notification">18. Card notification</a>
<ul class="sectlevel2">
<li><a href="#_notification_configuration">18.1. Notification configuration</a></li>
<li><a href="#_sound_notification">18.2. Sound notification</a></li>
<li><a href="#_card_read">18.3. Card read</a></li>
<li><a href="#_card_acknowledgment">18.4. Card acknowledgment</a>
<ul class="sectlevel3">
<li><a href="#_acknowledgment_done_by_the_user">18.4.1. Acknowledgment done by the user</a></li>
<li><a href="#_acknowledgment_done_by_entityies">18.4.2. Acknowledgment done by entity(ies)</a></li>
<li><a href="#_displaying_the_entities_acknowledgments">18.4.3. Displaying the entities acknowledgments</a></li>
</ul>
</li>
<li><a href="#_pin_cards">18.5. Pin cards</a></li>
<li><a href="#card_reminder">18.6. Card reminder</a>
<ul class="sectlevel3">
<li><a href="#_simple_reminder">18.6.1. Simple reminder</a></li>
<li><a href="#_recurrent_reminder">18.6.2. Recurrent reminder</a>
<ul class="sectlevel4">
<li><a href="#_using_rrule_field">18.6.2.1. Using <code>rRule</code> field :</a></li>
<li><a href="#_using_recurrence_field_in_the_timespan_object_deprecated">18.6.2.2. Using <code>recurrence</code> field in the timespan object (deprecated)</a></li>
</ul>
</li>
<li><a href="#_debugging">18.6.3. Debugging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_email_notifications">19. Email Notifications</a>
<ul class="sectlevel2">
<li><a href="#_configuring_email_notifications">19.1. Configuring Email Notifications</a></li>
<li><a href="#_email_content">19.2. Email Content</a></li>
</ul>
</li>
<li><a href="#response_cards">20. Response cards</a>
<ul class="sectlevel2">
<li><a href="#_steps_needed_to_use_a_response_card">20.1. Steps needed to use a response card</a>
<ul class="sectlevel3">
<li><a href="#define_a_third_party_tool">20.1.1. Define a third party tool</a></li>
<li><a href="#_configure_the_response_in_config_json">20.1.2. Configure the response in config.json</a></li>
<li><a href="#_design_the_question_form_in_the_template">20.1.3. Design the question form in the template</a></li>
<li><a href="#_define_permissions">20.1.4. Define permissions</a></li>
</ul>
</li>
<li><a href="#_send_a_question_card">20.2. Send a question card</a></li>
<li><a href="#_integrate_child_cards">20.3. Integrate child cards</a>
<ul class="sectlevel3">
<li><a href="#_entity_name">20.3.1. Entity name</a></li>
<li><a href="#_example">20.3.2. Example</a></li>
</ul>
</li>
<li><a href="#_lock_mechanism">20.4. Lock mechanism</a></li>
</ul>
</li>
<li><a href="#user_cards">21. User cards</a>
<ul class="sectlevel2">
<li><a href="#_configure_the_bundle">21.1. Configure the bundle</a></li>
<li><a href="#_method_registerfunctiontogetspecificcardinformation">21.2. Method registerFunctionToGetSpecificCardInformation</a></li>
<li><a href="#_define_permissions_2">21.3. Define permissions</a></li>
<li><a href="#restrict_possible_emitters">21.4. Restrict the list of possible emitter entities</a></li>
<li><a href="#set_recipients_via_code">21.5. Set the list of recipients via the template</a></li>
<li><a href="#_card_editing">21.6. Card editing</a></li>
<li><a href="#_card_copy">21.7. Card copy</a></li>
<li><a href="#_card_delete">21.8. Card delete</a></li>
<li><a href="#_send_response_automatically_experimental_feature">21.9. Send response automatically (experimental feature)</a></li>
<li><a href="#_misc">21.10. Misc</a></li>
</ul>
</li>
<li><a href="#_build_in_templates">22. Build-in templates</a>
<ul class="sectlevel2">
<li><a href="#_message">22.1. Message</a>
<ul class="sectlevel3">
<li><a href="#_card_template">22.1.1. Card template</a></li>
<li><a href="#_user_card_template">22.1.2. User card template</a></li>
</ul>
</li>
<li><a href="#_question">22.2. Question</a>
<ul class="sectlevel3">
<li><a href="#_card_template_2">22.2.1. Card template</a></li>
<li><a href="#_user_card_template_2">22.2.2. User card template</a></li>
</ul>
</li>
<li><a href="#_message_or_question_list">22.3. Message Or Question List</a>
<ul class="sectlevel3">
<li><a href="#_card_template_3">22.3.1. Card template</a></li>
<li><a href="#_user_card_template_3">22.3.2. User card template</a></li>
</ul>
</li>
<li><a href="#build-in_templates_common_usercard_attributes">22.4. Common attributes for user cards build-in templates</a></li>
</ul>
</li>
<li><a href="#business_data">23. Business Data</a>
<ul class="sectlevel2">
<li><a href="#_pushing_data">23.1. Pushing data</a></li>
<li><a href="#_calling_a_resource">23.2. Calling a resource</a></li>
</ul>
</li>
<li><a href="#_frontend_api">24. Frontend API</a>
<ul class="sectlevel2">
<li><a href="#_users_api">24.1. Users API</a>
<ul class="sectlevel3">
<li><a href="#_entities">24.1.1. Entities</a>
<ul class="sectlevel4">
<li><a href="#_function_getentityname">24.1.1.1. Function getEntityName</a></li>
<li><a href="#_function_getentity">24.1.1.2. Function getEntity</a></li>
<li><a href="#_function_getallentities">24.1.1.3. Function getAllEntities</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_navigate_api">24.2. Navigate API</a>
<ul class="sectlevel3">
<li><a href="#_function_redirecttobusinessmenu">24.2.1. Function redirectToBusinessMenu</a></li>
<li><a href="#_function_showcarddetail">24.2.2. Function showCardDetail</a></li>
</ul>
</li>
<li><a href="#_currentcard_api">24.3. CurrentCard API</a>
<ul class="sectlevel3">
<li><a href="#_function_displayloadingspinner">24.3.1. Function displayLoadingSpinner</a></li>
<li><a href="#_function_hideloadingspinner">24.3.2. Function hideLoadingSpinner</a></li>
<li><a href="#_function_getchildcards">24.3.3. Function getChildCards</a></li>
<li><a href="#_function_getcard">24.3.4. Function getCard()</a></li>
<li><a href="#_function_getdisplaycontext">24.3.5. Function getDisplayContext</a></li>
<li><a href="#_function_getentitiesallowedtorespond">24.3.6. Function getEntitiesAllowedToRespond</a></li>
<li><a href="#_function_getentityusedforuserresponse">24.3.7. Function  getEntityUsedForUserResponse</a></li>
<li><a href="#_function_getentitiesusableforuserresponse">24.3.8. Function  getEntitiesUsableForUserResponse</a></li>
<li><a href="#_function_isresponselocked">24.3.9. Function isResponseLocked</a></li>
<li><a href="#_function_isuserallowedtorespond">24.3.10. Function isUserAllowedToRespond</a></li>
<li><a href="#_function_isusermemberofanentityrequiredtorespond">24.3.11. Function isUserMemberOfAnEntityRequiredToRespond</a></li>
<li><a href="#_function_listentoresponselock">24.3.12. Function listenToResponseLock</a></li>
<li><a href="#_function_listentoresponseunlock">24.3.13. Function listenToResponseUnlock</a></li>
<li><a href="#_function_listentochildcards">24.3.14. Function listenToChildCards</a></li>
<li><a href="#_function_listentolttdexpired">24.3.15. Function listenToLttdExpired</a></li>
<li><a href="#_function_listentostylechange">24.3.16. Function listenToStyleChange</a></li>
<li><a href="#_function_listentoscreensize">24.3.17. Function listenToScreenSize</a></li>
<li><a href="#_function_listentotemplaterenderingcomplete">24.3.18. Function listenToTemplateRenderingComplete</a></li>
<li><a href="#_function_registerfunctiontogetuserresponse">24.3.19. Function registerFunctionToGetUserResponse</a></li>
</ul>
</li>
<li><a href="#_currentusercard_api">24.4. CurrentUserCard API</a>
<ul class="sectlevel3">
<li><a href="#_function_geteditionmode">24.4.1. Function getEditionMode</a></li>
<li><a href="#_function_getenddate">24.4.2. Function getEndDate</a></li>
<li><a href="#_function_getexpirationdate">24.4.3. Function getExpirationDate</a></li>
<li><a href="#_function_getlttd">24.4.4. Function getLttd</a></li>
<li><a href="#_function_getprocessid">24.4.5. Function getProcessId</a></li>
<li><a href="#_function_getselectedentityrecipients">24.4.6. Function getSelectedEntityRecipients</a></li>
<li><a href="#_function_getselectedentityforinformationrecipients">24.4.7. Function getSelectedEntityForInformationRecipients</a></li>
<li><a href="#_function_getstartdate">24.4.8. Function getStartDate</a></li>
<li><a href="#_function_getstate">24.4.9. Function getState</a></li>
<li><a href="#_function_getuserentitychildcard">24.4.10. Function getUserEntityChildCard</a></li>
<li><a href="#_function_listentoentityusedforsendingcard">24.4.11. Function listenToEntityUsedForSendingCard</a></li>
<li><a href="#_function_registerfunctiontogetspecificcardinformation">24.4.12. Function registerFunctionToGetSpecificCardInformation</a></li>
<li><a href="#_function_setdropdownentityrecipientlist">24.4.13. Function setDropdownEntityRecipientList</a></li>
<li><a href="#_function_setdropdownentityrecipientforinformationlist">24.4.14. Function setDropdownEntityRecipientForInformationList</a></li>
<li><a href="#_function_setinitialenddate">24.4.15. Function setInitialEndDate</a></li>
<li><a href="#_function_setinitialexpirationdate">24.4.16. Function setInitialExpirationDate</a></li>
<li><a href="#_function_setinitiallttd">24.4.17. Function setInitialLttd</a></li>
<li><a href="#_function_setinitialselectedrecipients">24.4.18. Function setInitialSelectedRecipients</a></li>
<li><a href="#_function_setinitialselectedrecipientsforinformation">24.4.19. Function setInitialSelectedRecipientsForInformation</a></li>
<li><a href="#_function_setselectedrecipients">24.4.20. Function setSelectedRecipients</a></li>
<li><a href="#_function_setselectedrecipientsforinformation">24.4.21. Function setSelectedRecipientsForInformation</a></li>
<li><a href="#_function_setinitialseverity">24.4.22. Function setInitialSeverity</a></li>
<li><a href="#_function_setinitialstartdate">24.4.23. Function setInitialStartDate</a></li>
</ul>
</li>
<li><a href="#_utils_api">24.5. Utils API</a>
<ul class="sectlevel3">
<li><a href="#_function_escapehtml">24.5.1. Function escapeHtml</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_archived_cards">25. Archived Cards</a>
<ul class="sectlevel2">
<li><a href="#_key_concepts">25.1. Key concepts</a></li>
<li><a href="#_archives_screen_in_the_ui">25.2. Archives screen in the UI</a></li>
</ul>
</li>
<li><a href="#geomap">26. Geographical map</a></li>
<li><a href="#_monitoring">27. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_export_configuration">27.1. Export configuration</a></li>
<li><a href="#_process_monitoring">27.2. Process monitoring</a></li>
</ul>
</li>
<li><a href="#users_management">28. User management</a>
<ul class="sectlevel2">
<li><a href="#_users_groups_entities_and_perimeters">28.1. Users, groups, entities and perimeters</a>
<ul class="sectlevel3">
<li><a href="#_users">28.1.1. Users</a>
<ul class="sectlevel4">
<li><a href="#_automated_user_creation">28.1.1.1. Automated user creation</a></li>
</ul>
</li>
<li><a href="#_entities_2">28.1.2. Entities</a></li>
<li><a href="#_permissions">28.1.3. Permissions</a></li>
<li><a href="#_groups">28.1.4. Groups</a></li>
<li><a href="#_perimeters">28.1.5. Perimeters</a></li>
<li><a href="#_alternative_way_to_manage_groups_and_entities">28.1.6. Alternative way to manage groups and entities</a></li>
</ul>
</li>
<li><a href="#_currently_connected_users">28.2. Currently connected users</a></li>
<li><a href="#_real_time_users">28.3. Real time users</a></li>
<li><a href="#_activity_area">28.4. Activity area</a></li>
<li><a href="#_user_actions_logs">28.5. User actions logs</a></li>
</ul>
</li>
<li><a href="#_ui_customization">29. UI Customization</a>
<ul class="sectlevel2">
<li><a href="#_ui_configuration">29.1. UI configuration</a></li>
<li><a href="#menu_entries">29.2. Menu Entries</a>
<ul class="sectlevel3">
<li><a href="#core_menu_config">29.2.1. Core menus</a></li>
<li><a href="#_custom_business_menus">29.2.2. Custom business menus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_supervisor">30. Supervisor</a>
<ul class="sectlevel2">
<li><a href="#_entities_connection">30.1. Entities connection</a></li>
<li><a href="#_card_acknowledgement">30.2. Card acknowledgement</a></li>
</ul>
</li>
<li><a href="#_external_devices_service">31. External Devices Service</a>
<ul class="sectlevel2">
<li><a href="#_specification">31.1. Specification</a></li>
<li><a href="#_implementation">31.2. Implementation</a>
<ul class="sectlevel3">
<li><a href="#_architecture">31.2.1. Architecture</a></li>
<li><a href="#_configuration_2">31.2.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_configuration_3">31.3. Configuration</a></li>
<li><a href="#_connection_management">31.4. Connection Management</a></li>
<li><a href="#_configuration_management">31.5. Configuration Management</a></li>
<li><a href="#_drivers">31.6. Drivers</a>
<ul class="sectlevel3">
<li><a href="#_modbus_driver">31.6.1. Modbus Driver</a></li>
<li><a href="#_adding_new_drivers">31.6.2. Adding new drivers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_external_applications_integration">32. External Applications Integration</a></li>
</ul>
</li>
<li><a href="#_deployment_and_administration_of_operatorfabric">Deployment and Administration of OperatorFabric</a>
<ul class="sectlevel1">
<li><a href="#_deployment">33. Deployment</a></li>
<li><a href="#_user_computer">34. User computer</a></li>
<li><a href="#_configuration_4">35. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_business_service_configuration">35.1. Business service configuration</a>
<ul class="sectlevel3">
<li><a href="#_shared_service_configuration">35.1.1. Shared service configuration</a>
<ul class="sectlevel4">
<li><a href="#_mongo_configuration">35.1.1.1. Mongo configuration</a></li>
</ul>
</li>
<li><a href="#_rabbitmq">35.1.2. RabbitMQ</a>
<ul class="sectlevel4">
<li><a href="#_internal_account">35.1.2.1. Internal account</a></li>
<li><a href="#_optional_configuration_values">35.1.2.2. Optional configuration values</a></li>
</ul>
</li>
<li><a href="#_service_specific_configurations">35.1.3. Service specific configurations</a>
<ul class="sectlevel4">
<li><a href="#_businessconfig_service">35.1.3.1. Businessconfig service</a></li>
<li><a href="#_users_service">35.1.3.2. Users service</a></li>
<li><a href="#cards-pub-conf">35.1.3.3. Cards-publication service</a></li>
<li><a href="#_cards_consultation_service">35.1.3.4. Cards-consultation service</a></li>
<li><a href="#external-devices-conf">35.1.3.5. External devices service</a></li>
<li><a href="#cards-external-diffusion-conf">35.1.3.6. Cards external diffusion service</a></li>
<li><a href="#cards-reminder-conf">35.1.3.7. Cards reminder service</a></li>
<li><a href="#supervisor-conf">35.1.3.8. Supervisor service</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_web_ui_configuration">35.2. Web UI Configuration</a>
<ul class="sectlevel3">
<li><a href="#_nginx_configuration">35.2.1. NGINX configuration</a></li>
<li><a href="#ui_properties">35.2.2. UI properties</a></li>
</ul>
</li>
<li><a href="#opfab_spec_conf">35.3. Security Configuration</a>
<ul class="sectlevel3">
<li><a href="#_authentication_configuration">35.3.1. Authentication configuration</a>
<ul class="sectlevel4">
<li><a href="#_nginx_configuration_2">35.3.1.1. Nginx Configuration</a></li>
<li><a href="#_configuration_file_common_yml">35.3.1.2. Configuration file common.yml</a></li>
<li><a href="#_configuration_file_web_ui_json">35.3.1.3. Configuration file web-ui.json</a></li>
<li><a href="#_oauth2_password_or_code_flows">35.3.1.4. OAuth2 PASSWORD or CODE Flows</a></li>
<li><a href="#_oauth2_implicit_flow">35.3.1.5. OAuth2 IMPLICIT Flow</a></li>
<li><a href="#_none_flow">35.3.1.6. NONE Flow</a></li>
</ul>
</li>
<li><a href="#_user_creation">35.3.2. User creation</a></li>
<li><a href="#jwt_mode">35.3.3. Alternative way to manage groups (and/or entities)</a></li>
<li><a href="#custom_certificates">35.3.4. Adding certification authorities or certificates to the Java keystore</a></li>
<li><a href="#_ip_address_control">35.3.5. IP address control</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_monitoring_2">36. Monitoring</a></li>
<li><a href="#_logging_administration">37. Logging Administration</a>
<ul class="sectlevel2">
<li><a href="#_logging_configuration">37.1. Logging configuration</a></li>
<li><a href="#_runtime_configuration">37.2. Runtime configuration</a>
<ul class="sectlevel3">
<li><a href="#_java_services">37.2.1. Java services</a></li>
<li><a href="#_node_services">37.2.2. Node Services</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_users_groups_and_entities_administration">38. Users, Groups and Entities Administration</a>
<ul class="sectlevel2">
<li><a href="#_users_2">38.1. Users</a>
<ul class="sectlevel3">
<li><a href="#_list_all_users">38.1.1. List all users</a></li>
<li><a href="#_create_a_new_user">38.1.2. Create a new User</a></li>
<li><a href="#_fetch_user_details">38.1.3. Fetch user details</a></li>
<li><a href="#_update_user_details">38.1.4. Update user details</a></li>
</ul>
</li>
<li><a href="#_groupsentities">38.2. Groups/Entities</a>
<ul class="sectlevel3">
<li><a href="#_list_groups_or_entities">38.2.1. List groups (or entities)</a></li>
<li><a href="#_create_a_new_group_or_entity">38.2.2. Create a new group (or entity)</a></li>
<li><a href="#_fetch_details_of_a_given_group_or_entity">38.2.3. Fetch details of a given group (or entity)</a></li>
<li><a href="#_update_details_of_a_group_or_entity">38.2.4. Update details of a group (or entity)</a></li>
<li><a href="#_add_a_user_to_a_group_or_entity">38.2.5. Add a user to a group (or entity)</a></li>
<li><a href="#_remove_a_user_from_a_group_or_entity">38.2.6. Remove a user from a group (or entity)</a></li>
<li><a href="#_entity_parents">38.2.7. Entity parents</a>
<ul class="sectlevel4">
<li><a href="#_add_a_new_entity_without_a_cycle_in_the_parent_declaration">38.2.7.1. Add a new Entity without a cycle in the parent declaration</a></li>
<li><a href="#_add_a_new_entity_with_a_cycle">38.2.7.2. Add a new Entity with a cycle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_service_port_table">39. Service port table</a></li>
<li><a href="#_rate_limiter_for_card_sending">40. Rate limiter for card sending</a></li>
<li><a href="#_restricted_operations_administration">41. Restricted operations (administration)</a></li>
</ul>
</li>
<li><a href="#dev_env">Development environment</a>
<ul class="sectlevel1">
<li><a href="#_requirements">42. Requirements</a></li>
<li><a href="#setup_dev_env">43. Setting up your development environment</a>
<ul class="sectlevel2">
<li><a href="#_clone_repository">43.1. Clone repository</a></li>
<li><a href="#_install_sdkman_and_nvm">43.2. Install sdkman and  nvm</a></li>
<li><a href="#_setting_up_your_proxy_configuration">43.3. Setting up your proxy configuration</a>
<ul class="sectlevel3">
<li><a href="#_docker">43.3.1. Docker</a></li>
<li><a href="#_gradle">43.3.2. Gradle</a></li>
<li><a href="#_npm">43.3.3. Npm</a></li>
</ul>
</li>
<li><a href="#_deploy_needed_docker_containers">43.4. Deploy needed docker containers</a></li>
<li><a href="#_build_operatorfabric_with_gradle">43.5. Build OperatorFabric with Gradle</a>
<ul class="sectlevel3">
<li><a href="#_only_compile_and_package_the_jars">43.5.1. Only compile and package the jars</a></li>
<li><a href="#_only_launch_the_unit_test_compile_and_package_the_jars">43.5.2. Only launch the Unit Test, compile and package the jars</a></li>
</ul>
</li>
<li><a href="#_run_operatorfabric_services_using_the_run_all_sh_script">43.6. Run OperatorFabric Services using the <code>run_all.sh</code> script</a></li>
<li><a href="#_log_into_the_ui">43.7. Log into the UI</a></li>
<li><a href="#_push_cards_to_the_feed">43.8. Push cards to the feed</a></li>
<li><a href="#_enabling_local_quality_report_generation">43.9. Enabling local quality report generation</a></li>
</ul>
</li>
<li><a href="#_user_interface">44. User Interface</a>
<ul class="sectlevel2">
<li><a href="#_build">44.1. Build</a></li>
<li><a href="#_test">44.2. Test</a>
<ul class="sectlevel3">
<li><a href="#_standalone_tests">44.2.1. Standalone tests</a></li>
<li><a href="#_test_during_ui_development">44.2.2. Test during UI development</a>
<ul class="sectlevel4">
<li><a href="#_troubleshooting">44.2.2.1. Troubleshooting :</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_environment_variables">45. Environment variables</a></li>
<li><a href="#_project_structure">46. Project Structure</a>
<ul class="sectlevel2">
<li><a href="#_conventions_regarding_project_structure_and_configuration">46.1. Conventions regarding project structure and configuration</a>
<ul class="sectlevel3">
<li><a href="#_java">46.1.1. Java</a></li>
<li><a href="#_modeling">46.1.2. Modeling</a></li>
<li><a href="#_docker_2">46.1.3. Docker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_development_tools">47. Development tools</a>
<ul class="sectlevel2">
<li><a href="#_scripts_bin_and_cicd">47.1. Scripts (bin and CICD)</a>
<ul class="sectlevel3">
<li><a href="#_run_all_sh">47.1.1. run_all.sh</a></li>
</ul>
</li>
<li><a href="#gradle_tasks">47.2. Gradle Tasks</a>
<ul class="sectlevel3">
<li><a href="#_services">47.2.1. Services</a>
<ul class="sectlevel4">
<li><a href="#_common_tasks_for_all_sub_projects">47.2.1.1. Common tasks for all sub-projects</a></li>
<li><a href="#_businessconfig_service_2">47.2.1.2. Businessconfig Service</a></li>
<li><a href="#_toolsgeneric">47.2.1.3. tools/generic</a></li>
</ul>
</li>
<li><a href="#_client_library">47.2.2. Client Library</a>
<ul class="sectlevel4">
<li><a href="#client_lib_pub_conf">47.2.2.1. Configuration</a></li>
<li><a href="#_relevant_tasks">47.2.2.2. Relevant tasks</a></li>
</ul>
</li>
<li><a href="#_gradle_plugins">47.2.3. Gradle Plugins</a></li>
</ul>
</li>
<li><a href="#_api_testing_with_karate_dsl">47.3. API testing with Karate DSL</a>
<ul class="sectlevel3">
<li><a href="#_run_a_feature">47.3.1. Run a feature</a></li>
<li><a href="#_non_regression_tests">47.3.2. Non regression tests</a></li>
</ul>
</li>
<li><a href="#_cypress_tests">47.4. Cypress Tests</a>
<ul class="sectlevel3">
<li><a href="#_installation">47.4.1. Installation</a></li>
<li><a href="#_cypress_file_structure">47.4.2. Cypress file structure</a></li>
<li><a href="#_launching_the_opfab_instance_to_test">47.4.3. Launching the OpFab instance to test</a>
<ul class="sectlevel4">
<li><a href="#_commands">47.4.3.1. Commands</a></li>
<li><a href="#_explanation">47.4.3.2. Explanation</a></li>
</ul>
</li>
<li><a href="#_running_existing_tests">47.4.4. Running existing tests</a></li>
<li><a href="#_running_tests_on_4200_ng_serve">47.4.5. Running tests on 4200 (ng serve)</a></li>
<li><a href="#_running_tests_with_gradle">47.4.6. Running tests with Gradle</a></li>
<li><a href="#_clearing_mongodb">47.4.7. Clearing MongoDB</a></li>
<li><a href="#_current_status_of_tests">47.4.8. Current status of tests</a></li>
<li><a href="#_creating_new_tests">47.4.9. Creating new tests</a>
<ul class="sectlevel4">
<li><a href="#_useful_documentation">47.4.9.1. Useful documentation</a></li>
<li><a href="#_guidelines_and_tips">47.4.9.2. Guidelines and tips</a></li>
</ul>
</li>
<li><a href="#_configuration_5">47.4.10. Configuration</a></li>
</ul>
</li>
<li><a href="#_load_testing_with_gatling">47.5. Load testing with Gatling</a>
<ul class="sectlevel3">
<li><a href="#_run_a_test">47.5.1. Run a test</a></li>
</ul>
</li>
<li><a href="#_node_services_2">47.6. Node services</a>
<ul class="sectlevel3">
<li><a href="#_other_useful_commands">47.6.1. Other useful commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_useful_recipes">48. Useful recipes</a>
<ul class="sectlevel2">
<li><a href="#_running_sub_project_from_jar_file">48.1. Running sub-project from jar file</a></li>
<li><a href="#_overriding_properties_when_running_from_jar_file">48.2. Overriding properties when running from jar file</a></li>
<li><a href="#_generating_docker_images">48.3. Generating docker images</a></li>
<li><a href="#_generating_documentation_from_asciidoc_sources">48.4. Generating documentation (from AsciiDoc sources)</a></li>
<li><a href="#_generating_api_documentation">48.5. Generating API documentation</a></li>
</ul>
</li>
<li><a href="#troubleshooting">49. Troubleshooting</a></li>
<li><a href="#_keycloak_configuration">50. Keycloak Configuration</a>
<ul class="sectlevel2">
<li><a href="#_add_realm">50.1. Add Realm</a></li>
<li><a href="#_setup_at_least_one_client_or_best_one_per_service">50.2. Setup at least one client (or best one per service)</a>
<ul class="sectlevel3">
<li><a href="#_create_client">50.2.1. Create client</a></li>
</ul>
</li>
<li><a href="#_create_users">50.3. Create Users</a>
<ul class="sectlevel3">
<li><a href="#_development_specific_configuration">50.3.1. Development-specific configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_using_oauth2_token_with_the_cli">51. Using OAuth2 token with the CLI</a>
<ul class="sectlevel2">
<li><a href="#_get_a_token_2">51.1. Get a token</a>
<ul class="sectlevel3">
<li><a href="#_curl">51.1.1. Curl</a></li>
<li><a href="#_httpie">51.1.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token">51.2. Extract token</a>
<ul class="sectlevel3">
<li><a href="#_curl_2">51.2.1. Curl</a></li>
<li><a href="#_httpie_2">51.2.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_check_a_token">51.3. Check a token</a>
<ul class="sectlevel3">
<li><a href="#_curl_3">51.3.1. Curl</a></li>
<li><a href="#_httpie_3">51.3.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token_2">51.4. Extract token</a></li>
</ul>
</li>
<li><a href="#_kafka_implementation">52. Kafka Implementation</a>
<ul class="sectlevel2">
<li><a href="#_setup_kafka_environment">52.1. Setup Kafka environment</a></li>
<li><a href="#_enabling_kafka">52.2. Enabling Kafka</a></li>
<li><a href="#_operatorfabric_kafka_source_code">52.3. OperatorFabric Kafka source code</a></li>
<li><a href="#_listener_deserializer">52.4. Listener / deserializer</a>
<ul class="sectlevel3">
<li><a href="#_kafka_operatorfabric_avro_schema">52.4.1. Kafka OperatorFabric AVRO schema</a></li>
</ul>
</li>
<li><a href="#_configure_kafka">52.5. Configure Kafka</a>
<ul class="sectlevel3">
<li><a href="#_setting_a_new_deserializer">52.5.1. Setting a new deserializer</a></li>
<li><a href="#_configuring_a_broker">52.5.2. Configuring a broker</a></li>
</ul>
</li>
<li><a href="#_kafka_card_producer">52.6. Kafka card producer</a></li>
<li><a href="#_response_cards">52.7. Response Cards</a></li>
</ul>
</li>
<li><a href="#_mailhog_smtp_server">53. MailHog SMTP server</a>
<ul class="sectlevel2">
<li><a href="#_mailhog_docker_container">53.1. MailHog docker container</a></li>
</ul>
</li>
<li><a href="#_dependency_analysis">54. Dependency analysis</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_community">OperatorFabric Community</a>
<ul class="sectlevel1">
<li><a href="#license_and_DCO">55. License and Developer Certificate of Origin</a></li>
<li><a href="#_reporting_bugs_or_vulnerabilities_and_suggesting_enhancements">56. Reporting Bugs or Vulnerabilities and Suggesting Enhancements</a></li>
<li><a href="#_contributing_code_or_documentation">57. Contributing Code or Documentation</a>
<ul class="sectlevel2">
<li><a href="#_contribution_workflow">57.1. Contribution Workflow</a>
<ul class="sectlevel3">
<li><a href="#_principles">57.1.1. Principles</a>
<ul class="sectlevel4">
<li><a href="#_release_names">57.1.1.1. Release names</a></li>
<li><a href="#_develop_branch">57.1.1.2. <code>develop</code> branch</a></li>
<li><a href="#_x_x_release_branch">57.1.1.3. <code>X.X.release</code> branch</a></li>
<li><a href="#_feature_branches">57.1.1.4. Feature branches</a></li>
</ul>
</li>
<li><a href="#_examples_and_commands">57.1.2. Examples and commands</a>
<ul class="sectlevel4">
<li><a href="#_starting_work_on_a_new_feature_for_the_next_version">57.1.2.1. Starting work on a new feature for the next version</a></li>
<li><a href="#_submitting_a_pull_request_to_develop">57.1.2.2. Submitting a pull request to develop</a></li>
<li><a href="#working_on_fix">57.1.2.3. Working on a fix for a previous version</a></li>
<li><a href="#_reviewing_a_pull_request">57.1.2.4. Reviewing a Pull Request</a></li>
<li><a href="#_merging_a_pull_request">57.1.2.5. Merging a Pull Request</a></li>
<li><a href="#_creating_a_release">57.1.2.6. Creating a release</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_code_guidelines">57.2. Code Guidelines</a>
<ul class="sectlevel3">
<li><a href="#_angulartypescript_development_caution_and_guidelines">57.2.1. Angular/TypeScript development caution and guidelines</a></li>
<li><a href="#_back_development">57.2.2. Back development</a></li>
<li><a href="#_unit_test">57.2.3. Unit test</a></li>
</ul>
</li>
<li><a href="#_documentation_guidelines">57.3. Documentation Guidelines</a>
<ul class="sectlevel3">
<li><a href="#_structure">57.3.1. Structure</a></li>
<li><a href="#_conventions">57.3.2. Conventions</a></li>
</ul>
</li>
<li><a href="#_copyright_headers">57.4. Copyright Headers</a>
<ul class="sectlevel3">
<li><a href="#_header_templates">57.4.1. Header templates</a></li>
<li><a href="#_examples_3">57.4.2. Examples</a>
<ul class="sectlevel4">
<li><a href="#_creating_a_new_file">57.4.2.1. Creating a new file</a></li>
<li><a href="#_updating_a_file">57.4.2.2. Updating a file</a></li>
<li><a href="#_multiple_contributors">57.4.2.3. Multiple contributors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_releases">58. Software releases</a>
<ul class="sectlevel2">
<li><a href="#_manual_testing">58.1. Manual testing</a></li>
</ul>
</li>
<li><a href="#_project_governance">59. Project Governance</a>
<ul class="sectlevel2">
<li><a href="#_project_owner">59.1. Project Owner</a></li>
<li><a href="#_committers">59.2. Committers</a></li>
<li><a href="#_technical_steering_committee">59.3. Technical Steering Committee</a></li>
<li><a href="#_contributors">59.4. Contributors</a></li>
</ul>
</li>
<li><a href="#_communication_channels">60. Communication channels</a>
<ul class="sectlevel2">
<li><a href="#_slack_channel">60.1. Slack channel</a></li>
<li><a href="#_lf_energy_mailing_lists">60.2. LF Energy Mailing Lists</a></li>
</ul>
</li>
<li><a href="#code_of_conduct">61. Code of Conduct</a>
<ul class="sectlevel2">
<li><a href="#_our_pledge">61.1. Our Pledge</a></li>
<li><a href="#_our_standards">61.2. Our Standards</a></li>
<li><a href="#_enforcement_responsibilities">61.3. Enforcement Responsibilities</a></li>
<li><a href="#_scope">61.4. Scope</a></li>
<li><a href="#_enforcement">61.5. Enforcement</a></li>
<li><a href="#_attribution">61.6. Attribution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#CICD">OperatorFabric CICD</a>
<ul class="sectlevel1">
<li><a href="#_pipeline_configuration">62. Pipeline Configuration</a>
<ul class="sectlevel2">
<li><a href="#_cicd_pipeline">62.1. CICD Pipeline</a>
<ul class="sectlevel3">
<li><a href="#_github_actions">62.1.1. Github Actions</a></li>
<li><a href="#_sonarcloud">62.1.2. SonarCloud</a></li>
<li><a href="#_github_documentation">62.1.3. GitHub (documentation)</a></li>
<li><a href="#_dockerhub">62.1.4. DockerHub</a></li>
<li><a href="#_sonatype">62.1.5. Sonatype</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#release_process">63. Release process</a>
<ul class="sectlevel2">
<li><a href="#_version_numbers">63.1. Version numbers</a></li>
<li><a href="#_releasing_a_release_candidate">63.2. Releasing a Release Candidate</a>
<ul class="sectlevel3">
<li><a href="#_creating_a_release_branch_and_preparing_the_release_candidate">63.2.1. Creating a release branch and preparing the release candidate</a></li>
<li><a href="#_publish_the_release_candidate_on_docker_hub_and_documentation">63.2.2. Publish the release candidate on docker hub and documentation</a></li>
<li><a href="#publishing_client_lib_release">63.2.3. Publishing the jars for the client library to Maven Central</a></li>
<li><a href="#_publishing_the_release_on_github">63.2.4. Publishing the release on GitHub</a></li>
<li><a href="#_updating_the_version_list_on_the_website">63.2.5. Updating the version list on the website</a></li>
<li><a href="#_advertising_the_new_release">63.2.6. Advertising the new release</a></li>
</ul>
</li>
<li><a href="#_releasing_a_major_or_minor_version">63.3. Releasing a Major or Minor Version</a>
<ul class="sectlevel3">
<li><a href="#_move_release_candidate_to_release">63.3.1. Move Release Candidate to Release</a></li>
<li><a href="#publish_release_on_docker_hub_and_documentation">63.3.2. Publish the release on docker hub and documentation</a></li>
<li><a href="#update_version_list_on_website">63.3.3. Updating the version list on the website</a></li>
<li><a href="#checking_docker_compose">63.3.4. Checking the docker-compose files</a></li>
<li><a href="#_publishing_the_jars_for_the_client_library_to_maven_central">63.3.5. Publishing the jars for the client library to Maven Central</a></li>
<li><a href="#publishing_release_on_github">63.3.6. Publishing the release on GitHub</a></li>
<li><a href="#supported_versions">63.3.7. Update supported versions</a></li>
<li><a href="#advertising_new_release">63.3.8. Advertising the new release</a></li>
<li><a href="#_preparing_the_next_version">63.3.9. Preparing the next version</a></li>
</ul>
</li>
<li><a href="#_releasing_a_patch_version">63.4. Releasing a Patch Version</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_resources">Resources</a>
<ul class="sectlevel1">
<li><a href="#_appendix_b_publication_of_the_client_library_jars_to_maven_central">64. Appendix B: Publication of the client library jars to Maven Central</a>
<ul class="sectlevel2">
<li><a href="#_claiming_the_org_opfab_namespace_on_maven_central">64.1. Claiming the org.opfab namespace on Maven Central</a></li>
<li><a href="#_creating_a_gpg_key_pair">64.2. Creating a GPG key pair</a></li>
<li><a href="#_sharing_the_signing_key">64.3. Sharing the signing key</a></li>
<li><a href="#_publishing_the_public_key">64.4. Publishing the public key</a></li>
<li><a href="#_setting_up_the_signing_and_publication_in_gradle">64.5. Setting up the signing and publication in Gradle</a></li>
<li><a href="#_useful_links">64.6. Useful links</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_1_4_0_to_release_1_5_0">65. Migration Guide from release 1.4.0 to release 1.5.0</a>
<ul class="sectlevel2">
<li><a href="#_refactoring_of_configuration_management">65.1. Refactoring of configuration management</a>
<ul class="sectlevel3">
<li><a href="#_motivation_for_the_change">65.1.1. Motivation for the change</a></li>
<li><a href="#_changes_to_the_model">65.1.2. Changes to the model</a>
<ul class="sectlevel4">
<li><a href="#_on_the_businessconfig_model">65.1.2.1. On the Businessconfig model</a></li>
<li><a href="#_on_the_cards_model">65.1.2.2. On the Cards model</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_change_on_the_web_ui_json">65.2. Change on the web-ui.json</a></li>
<li><a href="#_changes_on_bundle_config_json">65.3. Changes on bundle config.json</a></li>
<li><a href="#_component_name">65.4. Component name</a></li>
<li><a href="#_changes_to_the_endpoints">65.5. Changes to the endpoints</a></li>
<li><a href="#_migration_steps">65.6. Migration steps</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_1_7_0_to_release_1_8_0">66. Migration Guide from release 1.7.0 to release 1.8.0</a>
<ul class="sectlevel2">
<li><a href="#_card_detail_definition_in_business_configuration">66.1. Card detail definition in business configuration</a></li>
<li><a href="#_business_menu_definition">66.2. Business menu definition</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_1_8_0_to_release_2_0_0">67. Migration Guide from release 1.8.0 to release 2.0.0</a>
<ul class="sectlevel2">
<li><a href="#_acknowledgmentallowed_field_in_business_configuration">67.1. AcknowledgmentAllowed field in business configuration</a></li>
<li><a href="#_response_card_templategateway_applychild">67.2. Response card : templateGateway.applyChild()</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_2_0_to_release_2_3_0">68. Migration Guide from release 2.2.0 to release 2.3.0</a>
<ul class="sectlevel2">
<li><a href="#_communication_between_template_and_opfab">68.1. Communication between template and opfab</a>
<ul class="sectlevel3">
<li><a href="#_getting_response_data_from_template">68.1.1. Getting response data from template</a></li>
<li><a href="#_getting_the_information_if_the_user_can_respond">68.1.2. Getting the information if the user can respond</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_3_0_to_release_2_4_0">69. Migration Guide from release 2.3.0 to release 2.4.0</a>
<ul class="sectlevel2">
<li><a href="#_send_card">69.1. Send card</a></li>
<li><a href="#_package_name_change">69.2. Package name change</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_4_0_to_release_2_5_0">70. Migration Guide from release 2.4.0 to release 2.5.0</a>
<ul class="sectlevel2">
<li><a href="#_send_card_2">70.1. Send card</a></li>
<li><a href="#_card_recipients">70.2. Card recipients</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_5_0_to_release_2_6_0">71. Migration Guide from release 2.5.0 to release 2.6.0</a>
<ul class="sectlevel2">
<li><a href="#_inter_service_communication_ribbon">71.1. Inter-service communication - Ribbon</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_6_0_to_release_2_7_0">72. Migration Guide from release 2.6.0 to release 2.7.0</a>
<ul class="sectlevel2">
<li><a href="#_send_card_3">72.1. Send card</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_7_0_to_release_2_8_0">73. Migration Guide from release 2.7.0 to release 2.8.0</a>
<ul class="sectlevel2">
<li><a href="#_ui_configuration_management">73.1. UI Configuration Management</a></li>
<li><a href="#_management_of_visible_menus">73.2. Management of visible menus</a></li>
<li><a href="#_simplification_mongodb_configuration">73.3. Simplification MongoDB Configuration</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_10_0_to_release_2_11_0">74. Migration Guide from release 2.10.0 to release 2.11.0</a>
<ul class="sectlevel2">
<li><a href="#_logging_screen_filter_with_tags_list">74.1. Logging screen : Filter with tags list</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_2_11_0_to_release_3_0_0">75. Migration Guide from release 2.11.0 to release 3.0.0</a>
<ul class="sectlevel2">
<li><a href="#_changes_in_configuration_due_to_business_translation_mechanism_removal">75.1. Changes in configuration due to business translation mechanism removal</a>
<ul class="sectlevel3">
<li><a href="#_template_directory">75.1.1. Template directory</a></li>
<li><a href="#_changes_in_config_json">75.1.2. Changes in config.json</a></li>
<li><a href="#_new_file_i18n_json">75.1.3. New file i18n.json</a></li>
<li><a href="#_i18n_folder">75.1.4. i18n folder</a></li>
<li><a href="#_processes_groups_2">75.1.5. Processes groups</a></li>
<li><a href="#_script_to_migrate_an_existing_database">75.1.6. Script to migrate an existing database</a></li>
</ul>
</li>
<li><a href="#_configuration_file_web_ui_json_2">75.2. Configuration file <code>web-ui.json</code></a></li>
<li><a href="#_configuration_file_common_docker_yml">75.3. Configuration file common-docker.yml</a></li>
<li><a href="#_nginx_conf_template_file">75.4. Nginx.conf.template file</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_0_0_to_release_3_1_0">76. Migration Guide from release 3.0.0 to release 3.1.0</a>
<ul class="sectlevel2">
<li><a href="#_kafka_date_format">76.1. Kafka date format</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_1_0_to_release_3_2_0">77. Migration Guide from release 3.1.0 to release 3.2.0</a>
<ul class="sectlevel2">
<li><a href="#_cache_configuration_for_i18n_files">77.1. Cache configuration for i18n files</a></li>
<li><a href="#_tag_feed_filter_removal">77.2. Tag feed filter removal</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_4_0_to_release_3_5_0">78. Migration Guide from release 3.4.0 to release 3.5.0</a>
<ul class="sectlevel2">
<li><a href="#_timezone_management_removal">78.1. Timezone management removal</a></li>
<li><a href="#_kafka_card_format_changes">78.2. Kafka card format changes</a>
<ul class="sectlevel3">
<li><a href="#_redirect_to_business_application_from_a_card">78.2.1. Redirect to business application from a card</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_5_0_to_release_3_6_0">79. Migration Guide from release 3.5.0 to release 3.6.0</a>
<ul class="sectlevel2">
<li><a href="#_template_rendering">79.1. Template rendering</a></li>
<li><a href="#_mongo_data_migration_steps">79.2. Mongo data migration steps</a></li>
<li><a href="#_about_screen">79.3. About screen</a></li>
<li><a href="#_deprecated_feature">79.4. Deprecated feature</a>
<ul class="sectlevel3">
<li><a href="#_method_templategateway_getspecificcardinformation">79.4.1. Method templateGateway.getSpecificCardInformation()</a></li>
<li><a href="#_restrict_recipient_dropdown_list_for_user">79.4.2. Restrict recipient dropdown list for user</a></li>
<li><a href="#_set_the_list_of_recipients">79.4.3. Set the list of recipients</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_6_0_to_release_3_7_0">80. Migration Guide from release 3.6.0 to release 3.7.0</a>
<ul class="sectlevel2">
<li><a href="#_docker_images_names_changed">80.1. Docker images names changed</a></li>
<li><a href="#_third_parties_configuration">80.2. Third parties configuration</a></li>
<li><a href="#_rename_attribute_externaldeviceid">80.3. Rename attribute externalDeviceId</a>
<ul class="sectlevel3">
<li><a href="#_in_the_configuration_file">80.3.1. In the configuration file</a></li>
<li><a href="#_changes_in_the_mongo_data_base">80.3.2. Changes in the Mongo data base</a>
<ul class="sectlevel4">
<li><a href="#_before_the_migration">80.3.2.1. Before the migration</a></li>
<li><a href="#_once_the_migration_is_done">80.3.2.2. Once the migration is done</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_deprecated_feature_2">80.4. Deprecated feature</a>
<ul class="sectlevel3">
<li><a href="#_field_recurrence">80.4.1. Field recurrence</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_7_0_to_release_3_8_0">81. Migration Guide from release 3.7.0 to release 3.8.0</a>
<ul class="sectlevel2">
<li><a href="#_kafka_card_format_changes_2">81.1. Kafka card format changes</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_8_x_to_release_3_9_0">82. Migration Guide from release 3.8.x to release 3.9.0</a>
<ul class="sectlevel2">
<li><a href="#_web_ui_json_config_file">82.1. <code>web-ui.json</code> config file</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_9_x_to_release_3_10_0">83. Migration Guide from release 3.9.x to release 3.10.0</a>
<ul class="sectlevel2">
<li><a href="#_card_publication_with_not_existent_process_or_state">83.1. Card publication with not existent process or state</a></li>
<li><a href="#_web_ui_json_config_file_2">83.2. <code>web-ui.json</code> config file</a>
<ul class="sectlevel3">
<li><a href="#_settings_about_section">83.2.1. <code>settings.about</code> section</a></li>
<li><a href="#_settings_infos_hide_section">83.2.2. <code>settings.infos.hide</code> section</a></li>
<li><a href="#_feed_filtering_and_sorting">83.2.3. Feed filtering and sorting</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_10_x_to_release_3_11_0">84. Migration Guide from release 3.10.x to release 3.11.0</a>
<ul class="sectlevel2">
<li><a href="#_card_publication">84.1. Card publication</a></li>
<li><a href="#_templategateway_onstylechange_method">84.2. templateGateway <code>onStyleChange()</code> method</a></li>
<li><a href="#_nginx_configuration_3">84.3. Nginx configuration</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_11_x_to_release_3_12_0">85. Migration Guide from release 3.11.x to release 3.12.0</a>
<ul class="sectlevel2">
<li><a href="#_java_17">85.1. Java 17</a></li>
<li><a href="#_expiration_date">85.2. Expiration date</a></li>
<li><a href="#_remove_deprecated_method_templategateway_getspecificcardinformation">85.3. Remove deprecated method templateGateway.getSpecificCardInformation()</a></li>
<li><a href="#_nginx_configuration_4">85.4. Nginx configuration</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_12_0_to_release_3_13_0">86. Migration Guide from release 3.12.0 to release 3.13.0</a>
<ul class="sectlevel2">
<li><a href="#_trailing_slash">86.1. Trailing slash</a></li>
<li><a href="#_viewcardinagenda_parameter_renamed">86.2. viewCardInAgenda Parameter renamed</a></li>
<li><a href="#_default_value_set_to_false_for_lttdvisible_and_expirationdatevisible">86.3. Default value set to false for lttdVisible and expirationDateVisible</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_13_0_to_release_3_14_0">87. Migration Guide from release 3.13.0 to release 3.14.0</a>
<ul class="sectlevel2">
<li><a href="#_bundles_folder">87.1. Bundles folder</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_14_0_to_release_3_15_0">88. Migration Guide from release 3.14.0 to release 3.15.0</a>
<ul class="sectlevel2">
<li><a href="#_crossorigin_for_geojson">88.1. CrossOrigin for GeoJSON</a></li>
<li><a href="#_remove_deprecated_field_from_state_definition">88.2. Remove deprecated field from state definition</a></li>
<li><a href="#_remove_use_of_groups_column_in_realtime_screen">88.3. Remove use of groups column in realtime screen</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_3_15_0_to_release_4_0_0">89. Migration Guide from release 3.15.0 to release 4.0.0</a>
<ul class="sectlevel2">
<li><a href="#_management_of_core_menus_and_custom_menus">89.1. Management of core menus and custom menus</a></li>
<li><a href="#_ui_configuration_2">89.2. UI Configuration</a></li>
<li><a href="#_opfabapi">89.3. OpfabAPI</a></li>
<li><a href="#_write_right_for_user_rightsenum_write">89.4. Write right for user (RightsEnum.Write)</a></li>
<li><a href="#_cards_reminder">89.5. Cards reminder</a></li>
<li><a href="#_internal_technical_account">89.6. Internal technical account</a></li>
<li><a href="#_port_mapping">89.7. Port mapping</a></li>
<li><a href="#_rabbitmq_2">89.8. RabbitMQ</a></li>
<li><a href="#_configuration_6">89.9. Configuration</a></li>
<li><a href="#_normalization_of_some_configuration_parameters">89.10. Normalization of some configuration parameters</a></li>
<li><a href="#_mongodb_uri">89.11. Mongodb uri</a></li>
<li><a href="#_rate_limiter_for_card_sendings">89.12. Rate limiter for card sendings</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_4_0_0_to_release_4_1_0">90. Migration Guide from release 4.0.0 to release 4.1.0</a>
<ul class="sectlevel2">
<li><a href="#_optimizing_nginx_configuration_for_latency_reduction">90.1. Optimizing Nginx Configuration for Latency Reduction</a></li>
<li><a href="#_updating_the_file_size_limit">90.2. Updating the file size limit</a></li>
<li><a href="#_nginx_configuration_for_entity_supervision_administration">90.3. Nginx Configuration for entity supervision administration</a></li>
<li><a href="#_supervisor_configuration_change">90.4. Supervisor configuration change</a></li>
<li><a href="#_log_directories_in_docker">90.5. Log directories in docker</a></li>
<li><a href="#_opfabapi_2">90.6. OpfabAPI</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_4_1_0_to_release_4_2_0">91. Migration Guide from release 4.1.0 to release 4.2.0</a>
<ul class="sectlevel2">
<li><a href="#_deletion_of_parameter_displayconnectioncirclesinpreview">91.1. Deletion of parameter displayConnectionCirclesInPreview</a></li>
<li><a href="#_configuration_files_of_the_realtime_users_screen">91.2. Configuration files of the realtime users screen</a></li>
<li><a href="#_updating_the_entity_roles_in_the_database">91.3. Updating the entity roles in the database</a></li>
<li><a href="#_deletion_of_deprecated_functions_in_templategatewayusercardtemplategateway">91.4. Deletion of deprecated functions in templateGateway/usercardTemplateGateway</a></li>
<li><a href="#_card_keepchildcards">91.5. Card keepChildCards</a></li>
<li><a href="#_feed_process_and_state_filter">91.6. Feed process and state filter</a></li>
<li><a href="#_user_settings">91.7. User settings</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_4_2_0_to_release_4_3_0">92. Migration Guide from release 4.2.0 to release 4.3.0</a>
<ul class="sectlevel2">
<li><a href="#_admin_group">92.1. ADMIN group</a></li>
<li><a href="#_map_multiple_geojson_layers">92.2. Map multiple GeoJSON layers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_operatorfabric_getting_started" class="sect0"><a class="anchor" href="#_operatorfabric_getting_started"></a>OperatorFabric Getting Started</h1>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>1. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use OperatorFabric, you need a linux OS with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker install with 4Gb of space</p>
</li>
<li>
<p>4Gb of free RAM</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_run_server"><a class="anchor" href="#_install_and_run_server"></a>2. Install and run server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start OperatorFabric, you first need to clone the getting started git</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/opfab/operatorfabric-getting-started.git</pre>
</div>
</div>
<div class="paragraph">
<p>Launch the <code>startserver.sh</code> in the server directory. You need to wait for all the services to start (it usually takes one minute to start), it is done when the console prompt is available again.</p>
</div>
<div class="paragraph">
<p>Test the connection to the UI: to connect to OperatorFabric, open in a browser the following page: <a href="http://localhost:2002/" class="bare">localhost:2002/</a> and use <code>operator1_fr</code> as login and <code>test</code> as password.</p>
</div>
<div class="paragraph">
<p>After connection, you should see the following screen</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/empty-opfab-page.png" alt="empty opfab screenshot">
</div>
</div>
<div class="paragraph">
<p>To stop the server (if you started it in background), use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker-compose down &amp;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>3. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each example, relevant files and scripts are in the directory <code>client/exampleX</code>.</p>
</div>
<div class="paragraph">
<p>All examples assume you connect to the server from <code>localhost</code> (otherwise change the provided scripts)</p>
</div>
<div class="sect2">
<h3 id="_example_1_send_and_update_a_basic_card"><a class="anchor" href="#_example_1_send_and_update_a_basic_card"></a>3.1. Example 1: Send and update a basic card</h3>
<div class="paragraph">
<p>Go in the directory <code>client/example1</code>.</p>
</div>
<div class="paragraph">
<p>To receive the test cards it is necessary to configure a perimeter which you will have a closer look at in Example 5.</p>
</div>
<div class="paragraph">
<p>Configure the required perimeter by executing the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./setupPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>Send a card, using the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status.</p>
</div>
<div class="paragraph">
<p>See the result in the UI, you should see a card, if you click on it you&#8217;ll see the detail</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/formated-card-details.png" alt="detail card screenshot">
</div>
</div>
<div class="sect3">
<h4 id="_anatomy_of_the_card"><a class="anchor" href="#_anatomy_of_the_card"></a>3.1.1. Anatomy of the card :</h4>
<div class="paragraph">
<p>A card is containing information regarding the publisher, the recipients, the process, the data to show&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>More information can be found in the
<a href="#card_structure">Card Structure</a>
section of the reference documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! That's my first message</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you open the json file of the card, you will see '${current_date_in_milliseconds_from_epoch}' for the field 'startDate'.
      We have used this so that the date of the card is the current day (or the next day in some other examples). Indeed, in the shell script
      that sends the card, you will see that we create an environment variable with the current date which is then injected
      into the json file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_update_the_card"><a class="anchor" href="#_update_the_card"></a>3.1.2. Update the card</h4>
<div class="paragraph">
<p>We can send a new version of the card (updateCard.json):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>change the message, field data.message in the JSON File</p>
</li>
<li>
<p>the severity , field severity in the JSON File</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">:That's my second message</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can send the updated card with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="paragraph">
<p>The card should be updated on the UI.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_the_card"><a class="anchor" href="#_delete_the_card"></a>3.1.3. Delete the card</h4>
<div class="paragraph">
<p>You can delete the card using DELETE HTTP code with reference to publisher and processInstanceId</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X DELETE http://localhost:2102/cards/defaultProcess.hello-world-1</pre>
</div>
</div>
<div class="paragraph">
<p>or use provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./deleteCard.sh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_2_publish_a_new_bundle"><a class="anchor" href="#_example_2_publish_a_new_bundle"></a>3.2. Example 2: Publish a new bundle</h3>
<div class="paragraph">
<p>The way the card is displayed on the UI is defined by a Bundle containing templates and a process description.</p>
</div>
<div class="paragraph">
<p>The bundle structure is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> css : stylesheets files
 template : handlebar templates for detail card rendering
config.json : process description and global configuration
i18n.json : internationalization file</pre>
</div>
</div>
<div class="paragraph">
<p>The bundle is provided in the bundle directory of example2. It contains a new version of the bundle used in example1.</p>
</div>
<div class="paragraph">
<p>We just change the template and the stylesheet instead of displaying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Message :  The message</pre>
</div>
</div>
<div class="paragraph">
<p>we display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>You received the following message

The message</pre>
</div>
</div>
<div class="paragraph">
<p>If you look at the template file (template/template.handlebars):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">&lt;h2&gt; You received the following message &lt;/h2&gt;

{{card.data.message}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the stylesheet css/style.css we just change the color value to red (#ff0000):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">h2</span>{
        <span class="key">color</span>:<span class="color">#ff0000</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The global configuration is defined in config.json :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ]
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To keep the old bundle, we create a new version by setting version to 2.</p>
</div>
<div class="sect3">
<h4 id="_package_your_bundle"><a class="anchor" href="#_package_your_bundle"></a>3.2.1. Package your bundle</h4>
<div class="paragraph">
<p>Your bundle needs to be packaged in a tar.gz file, a script is available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>A file name bundle.tar.gz will be created.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_token"><a class="anchor" href="#_get_a_token"></a>3.2.2. Get a Token</h4>
<div class="paragraph">
<p>To send the bundle you need to be authenticated. To get a token you can <strong>source</strong> the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>source ../getToken.sh</pre>
</div>
</div>
<div class="paragraph">
<p>This will run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d "username=admin&amp;password=test&amp;grant_type=password&amp;client_id=opfab-client" http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>This should return a JSON a response like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJSbXFOVTNLN0x4ck5SRmtIVTJxcTZZcTEya1RDaXNtRkw5U2NwbkNPeDBjIn0.eyJqdGkiOiIzZDhlODY3MS1jMDhjLTQ3NDktOTQyOC1hZTdhOTE5OWRmNjIiLCJleHAiOjE1NzU1ODQ0NTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiYTNhM2IxYTYtMWVlYi00NDI5LWE2OGItNWQ1YWI1YjNhMTI5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJlbWFpbCBwcm9maWxlIiwic3ViIjoiYWRtaW4iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6ImFkbWluIn0.XMLjdOJV-A-iZrtq7sobcvU9XtJVmKKv9Tnv921PjtvJ85CnHP-qXp2hYf5D8TXnn32lILVD3g8F9iXs0otMAbpA9j9Re2QPadwRnGNLIzmD5pLzjJ7c18PWZUVscbaqdP5PfVFA67-j-YmQBwxiys8psF8keJFvmg-ExOGh66lCayClceQaUUdxpeuKFDxOSkFVEJcVxdelFtrEbpoq0KNPtYk7vtoG74zO3KjNGrzLkSE_e4wR6MHVFrZVJwG9cEPd_dLGS-GmkYjB6lorXPyJJ9WYvig56CKDaFry3Vn8AjX_SFSgTB28WkWHYZknTwm9EKeRCsBQlU6MLe4Sng</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">36000</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">1800</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzZjdkZTM0OC05N2Q5LTRiOTUtYjViNi04MjExYTI3YjdlNzYifQ.eyJqdGkiOiJhZDY4ODQ4NS1hZGE0LTQwNWEtYjQ4MS1hNmNkMTM2YWY0YWYiLCJleHAiOjE1NzU1NTAyNTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJzdWIiOiJhM2EzYjFhNi0xZWViLTQ0MjktYTY4Yi01ZDVhYjViM2ExMjkiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6ImVtYWlsIHByb2ZpbGUifQ.sHskPtatqlU9Z8Sfq6yvzUP_L6y-Rv26oPpykyPgzmk</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">bearer</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">not-before-policy</span><span class="delimiter">&quot;</span></span>:<span class="integer">0</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">session_state</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">87776c99-b050-46d1-89b6-49cc2154200a</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">scope</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">email profile</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your token is the <code>access_token</code> value in the JSON, which the script will export to a <code>$token</code> environment variable.</p>
</div>
<div class="paragraph">
<p>The sendBundle.sh script below will use this variable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The token will be valid for 10 hours, after that you will need to ask for a new one.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_send_the_bundle"><a class="anchor" href="#_send_the_bundle"></a>3.2.3. Send the bundle</h4>
<div class="paragraph">
<p>Executing the sendBundle.sh script will send the bundle.</p>
</div>
<div class="paragraph">
<p>You can now execute the script, it will send the bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should receive the following JSON in response, describing your bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">process.name</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">responseData</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Always</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">showDetailCardHeader</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">userCard</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span>],<span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">uiVisibility</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_send_a_card"><a class="anchor" href="#_send_a_card"></a>3.2.4. Send a card</h4>
<div class="paragraph">
<p>You can send the following card to test your new bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world in new version</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the new bundle, we set processVersion to "2"</p>
</div>
<div class="paragraph">
<p>To send the card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should see in the UI the detail card with the new template.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_3_process_with_state"><a class="anchor" href="#_example_3_process_with_state"></a>3.3. Example 3: Process with state</h3>
<div class="paragraph">
<p>For this example, we will set the following process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: A critical situation arises on the High Voltage grid</p>
</li>
<li>
<p>Step 2: The critical situation evolve</p>
</li>
<li>
<p>Step 3: The critical situation ends</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To model this process in OperatorFabric, we will use a "Process" with "States", we will model this in the <code>config.json</code>
of the bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Critical situation process</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ],
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Always</span><span class="delimiter">&quot;</span></span>
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-update</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ],
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Always</span><span class="delimiter">&quot;</span></span>
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-end</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">endCriticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ],
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Always</span><span class="delimiter">&quot;</span></span>
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see in the JSON we define a process name "criticalSituation" with 3 states: criticalSituation-begin,
criticalSituation-update and criticalSituation-end. For each state we define a title for the card, and the template
of stylesheet to use.</p>
</div>
<div class="paragraph">
<p>The title is a key which refers to the i18n.json file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ON THE GRID , SEE DETAIL FOR INSTRUCTION</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-update</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION - UPDATE</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ON THE GRID , SEE DETAIL FOR INSTRUCTION</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-end</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION - END</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ENDED</span><span class="delimiter">&quot;</span></span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The templates can be found in the template directory.</p>
</div>
<div class="paragraph">
<p>Before sending cards it is necessary to configure the required perimeter by executing the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./setupPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>We can now send cards and simulate the process, first we send a card at the beginning of the critical situation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">alert-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">alert1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">instruction</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Critical situation on the grid : stop immediatly all maintenance on the grid</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The card refers to the process "criticalSituation" as defined in the config.json, the state attribute is put to
"criticalSituation-begin" which is the first step of the process, again as defined in the config.json. The card can be sent via the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>Two other cards have been provided to continue the process</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardUpdate.json: the state is criticalSituation-update</p>
</li>
<li>
<p>cardEnd.json: the state is criticalSituation-end and severity set to "compliant"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can send these cards:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardEnd.json</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_4_time_line"><a class="anchor" href="#_example_4_time_line"></a>3.4. Example 4: Time Line</h3>
<div class="paragraph">
<p>To view the card in the time line, you need to set times in the card using timeSpans attributes as in the following card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON"> {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">scheduledMaintenance-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenance-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">planned</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationDescription</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Maintenance operation on the International France England (IFA) High Voltage line </span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationResponsible</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">RTE</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">contactPoint</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">By Phone : +33 1 23 45 67 89 </span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationStartingTime</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Wed 11 dec 2019 8pm</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationEndTime</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Thu 12 dec 2019 10am</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">comment</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation has no impact on service</span><span class="delimiter">&quot;</span></span>
                },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">timeSpans</span><span class="delimiter">&quot;</span></span> : [
        {<span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : <span class="integer">1576080876779</span>},
        {<span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : <span class="integer">1576104912066</span>}
            ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, we use a new publisher called "scheduledMaintenance-publisher". You won&#8217;t need to post the
corresponding bundle to the businessconfig service as it has been loaded in advance to be available out of the box (only for the
getting started). If you want to take a look at its content you can find it under
server/businessconfig-storage/scheduledMaintenance-publisher/1.</p>
</div>
<div class="paragraph">
<p>Before sending the provided cards, you need to set the correct time values as
<a href="https://en.wikipedia.org/wiki/Epoch_(computing)">epoch</a> (ms) in the json. For each value you set, you will have a
dot on the timeline. In our example, the first dot represents the beginning of the maintenance operation, and the
second the end of the maintenance operation.</p>
</div>
<div class="paragraph">
<p>For example cards the dates are calculated automatically in the provided <code>sendCard.sh</code> script.</p>
</div>
<div class="paragraph">
<p>It is possible to change dates values by editing the card&#8217;s json file. To get the dates in Epoch, you can use the following commands:</p>
</div>
<div class="paragraph">
<p>For the first date:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 60 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>And for the second</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 120 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>Before sending cards it is necessary to configure the required perimeter by executing the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./setupPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>To send the card use the provided script in example4 directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>A second card (card2.json) is provided as example, as before you can eventually change times values in the json file and then send it</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card2.json</pre>
</div>
</div>
<div class="paragraph">
<p>This time the severity of the card is ALERT, you should see the dot in red on the timeline</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example4.png" alt="example 4 screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_5_card_routing_mechanism"><a class="anchor" href="#_example_5_card_routing_mechanism"></a>3.5. Example 5: Card routing mechanism</h3>
<div class="sect3">
<h4 id="_card_sent_to_a_group"><a class="anchor" href="#_card_sent_to_a_group"></a>3.5.1. Card sent to a group</h4>
<div class="paragraph">
<p>As we saw previously, if a card is sent to a group, then you need to be a member of the group and have the process / state of the card within the group&#8217;s perimeter to receive it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_card_sent_to_an_entity"><a class="anchor" href="#_card_sent_to_an_entity"></a>3.5.2. Card sent to an entity</h4>
<div class="paragraph">
<p>If a card is sent to an entity, then you must be a member of this entity and have the process / state of the card within the user&#8217;s perimeter. As the perimeters are attached to groups, the user must therefore be a member of a group attached to this perimeter.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s send this card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1_FR</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntity.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status.</p>
</div>
<div class="paragraph">
<p>Look at the result in the UI, you should not be able to see the card.</p>
</div>
<div class="paragraph">
<p>To receive the card you need to create a perimeter and to do it you need to be authenticated. To get a token you can <strong>source</strong> the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>source ../getToken.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s create this perimeter :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">getting-startedPerimeter</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">stateRights</span><span class="delimiter">&quot;</span></span> : [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Receive</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/perimeters -H "Content-type:application/json" -H "Authorization:Bearer $token" --data @perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./createPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">getting-startedPerimeter</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">stateRights</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Receive</span><span class="delimiter">&quot;</span></span>}]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s attach this perimeter to the Dispatcher group.
You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/perimeters/getting-startedPerimeter/groups -H "Content-type:application/json" -H "Authorization:Bearer $token" --data "[\"Dispatcher\"]"</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./putPerimeterForGroup.sh</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 200 Http status.</p>
</div>
<div class="paragraph">
<p>Now, if you refresh the UI or send again the card, you should see the card.</p>
</div>
</div>
<div class="sect3">
<h4 id="_card_sent_to_a_group_and_an_entity"><a class="anchor" href="#_card_sent_to_a_group_and_an_entity"></a>3.5.3. Card sent to a group and an entity</h4>
<div class="paragraph">
<p>If a card is sent to a group and an entity, then to receive the card the user must be both a member of this entity and a member of this group and have the process / state of the card within the group&#8217;s perimeter.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s send this card (for ENTITY1_FR and Dispatcher group with process/state not in user&#8217;s perimeter) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5_1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1_FR and group Dispatcher - process/state not in operator1_fr perimeter </span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntityAndGroup_1.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status.</p>
</div>
<div class="paragraph">
<p>Look at the result in the UI, you should not be able to see the card.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s send this card (for ENTITY1_FR and Dispatcher group with process/state in user&#8217;s perimeter) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5_2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1_FR and group Planner - process/state in operator1_fr perimeter </span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntityAndGroup_2.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status.</p>
</div>
<div class="paragraph">
<p>Look at the result in the UI, you should be able to see the card.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_6_sending_cards_from_the_ui"><a class="anchor" href="#_example_6_sending_cards_from_the_ui"></a>3.6. Example 6: Sending cards from the UI</h3>
<div class="sect3">
<h4 id="_updating_the_perimeter"><a class="anchor" href="#_updating_the_perimeter"></a>3.6.1. Updating the perimeter</h4>
<div class="paragraph">
<p>In the top right corner, left to your username, there is the button to send a new card.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example6_button.png" alt="example 6 screen shot">
</div>
</div>
<div class="paragraph">
<p>If you click on it now, you shouldn&#8217;t be able to send a card because none of the groups you&#8217;re part of has the right to send a card. So first we need to set up a new perimeter with the correct rights and associate it to one of your group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">example6-Perimeter</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">stateRights</span><span class="delimiter">&quot;</span></span> : [
                {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ReceiveAndWrite</span><span class="delimiter">&quot;</span></span>
                }
        ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./setupPerimeter.sh perimeter.json</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_the_template_to_send_a_card"><a class="anchor" href="#_creating_the_template_to_send_a_card"></a>3.6.2. Creating the template to send a card</h4>
<div class="paragraph">
<p>Now you need to update the bundle to include a template for the card sending screen. In the <strong>config.json</strong> file of the bundle, it is necessary to define the userCard object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Message process</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">userCard</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">usercard_message</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDateVisible</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">endDateVisible</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">lttdVisible</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">expirationDateVisible</span><span class="delimiter">&quot;</span></span> : <span class="value">false</span>
                  },
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bundle folder now contains usercard_message.handlebars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">&lt;div class=&quot;opfab-textarea&quot;&gt;
        &lt;label&gt; MESSAGE &lt;/label&gt;
        &lt;textarea id=&quot;message&quot; name=&quot;message&quot; placeholder=&quot;Write something..&quot;
                style=&quot;width:100%&quot;&gt;{{card.data.message}}&lt;/textarea&gt;
&lt;/div&gt;


&lt;script&gt;
    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const card = {
        summary : {key : &quot;message.summary&quot;},
                title : {key : &quot;message.title&quot;},
        data : {message: message},
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }

&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can package it and send it to the server with the provided scripts :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh | ./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Now if you reload the page, you should be able to send a card. Don&#8217;t forget to send it to an entity you&#8217;re a part of to receive it. For instance <strong>Control Center FR North</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example6_card_send.png" alt="example 6 screen shot #2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customize_the_card_sending_template"><a class="anchor" href="#_customize_the_card_sending_template"></a>3.6.3. Customize the card sending template</h4>
<div class="paragraph">
<p>To go further you can check out the folder named <strong>bundle_updated</strong> to see a template where it is possible to add an object to the message similar to e-mails.</p>
</div>
<div class="paragraph">
<p>You can see the updated UI using this command line and refreshing the page to update the bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle_updated.sh | ./sendBundle.sh</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example6_card_send_updated.png" alt="example 6 screen shot #3">
</div>
</div>
<div class="paragraph">
<p>The object attribute is defined in the userCard template in the <strong>usercard_message.handlebars</strong> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">        &lt;div class=&quot;opfab-textarea&quot;&gt;
            &lt;label&gt; Object &lt;/label&gt;
            &lt;textarea id=&quot;object&quot; name=&quot;object&quot; placeholder=&quot;Write something..&quot;
                style=&quot;width:100%&quot;&gt;{{card.data.object}}&lt;/textarea&gt;
        &lt;/div&gt;
        &lt;br/&gt;

        &lt;div class=&quot;opfab-textarea&quot;&gt;
            &lt;label&gt; MESSAGE &lt;/label&gt;
            &lt;textarea id=&quot;message&quot; name=&quot;message&quot; placeholder=&quot;Write something..&quot;
                style=&quot;width:100%&quot;&gt;{{card.data.message}}&lt;/textarea&gt;
        &lt;/div&gt;

&lt;script&gt;
    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const object = document.getElementById('object').value;
        const card = {
        summary : {key : &quot;message.summary&quot;},
                title : {key : &quot;message.title&quot;},
        data : {message: message, object: object},
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }

&lt;/script&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you look at the <strong>message.handlebars</strong> file in the bundle, you will see how the template was changed to take the object attribute into account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">&lt;h2&gt;&lt;b&gt;Object:&lt;/b&gt; {{card.data.object}}&lt;/h2&gt;

{{card.data.message}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="https://opfab.github.io/documentation/current/reference_doc/#user_cards">card documentation</a> for further
information on cards.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_7_message_card_using_build_in_templates"><a class="anchor" href="#_example_7_message_card_using_build_in_templates"></a>3.7. Example 7: Message card using "build-in" templates</h3>
<div class="paragraph">
<p>Instead of coding your own templates for message cards or user cards, you can use opfab build-in templates if it suits your needs.
In the following example, we are going to modify the templates of the previous bundle (the message card).</p>
</div>
<div class="paragraph">
<p>If you want to show only a simple message, you can use the message build-in template, to achieve this, first you have to
put in your handlebar file <code>message.handlebars</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The build-in template supposes the message is stored in the card in field <code>data.message</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you have to put in your handlebar file <code>message_usercard.handlebars</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-usercard&gt; &lt;/opfab-message-usercard&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The message will be stored in the field <code>data.message</code> of the card.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can package the bundle and send it to the server with the provided scripts :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh | ./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Now if you reload the page, you should be able to create a card using build-in template.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example7_card_send.png" alt="example 7 screen shot #1">
</div>
</div>
<div class="paragraph">
<p>You can change the text header by providing the message-header attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card  message-header=&quot;a new header&quot;&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
&lt;&lt;'build-in_templates_common_usercard_attributes,common attributes for user cards'&gt;&gt;</p>
</div>
<div class="paragraph">
<p>You can see the updated UI using this command line and refreshing the page to update the bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle_updated.sh | ./sendBundle.sh</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example7_card_send_updated.png" alt="example 7 screen shot #2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_8_question_card_using_build_in_templates"><a class="anchor" href="#_example_8_question_card_using_build_in_templates"></a>3.8. Example 8: Question card using "build-in" templates</h3>
<div class="paragraph">
<p>Another example of templating is a question/response use case. Opfab allows you to send a response which will be attached
to the card. This mechanism can be illustrated via the build-in template for question card.</p>
</div>
<div class="paragraph">
<p>To show a question and see user responses, first you have to put in your handlebar file <code>question.handlebars</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-card&gt; &lt;/opfab-question-card&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The build-in template supposes the question is stored in the card in the field <code>data.question</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you have to put in your handlebar file <code>question_usercard.handlebars</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-usercard&gt; &lt;/opfab-question-usercard&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The question will be stored in the field <code>data.question</code> of the card.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like the message build-in template, you can set default attributes :
&lt;&lt;'build-in_templates_common_usercard_attributes,common attributes for user cards'&gt;&gt;</p>
</div>
<div class="paragraph">
<p>Use the provided script to add rights to send question card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./setupPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>You can package the bundle and send it to the server with the provided scripts :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh | ./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Example for using a question card with the previous build-in template :</p>
</div>
<div class="paragraph">
<p>First, operator1_fr log in and create the question card :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example8_create_card.png" alt="example 8 screen shot #1">
</div>
</div>
<div class="paragraph">
<p>Then, operator3_fr log in, read the question card and answer to it :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example8_answer_to_card.png" alt="example 8 screen shot #2">
</div>
</div>
<div class="paragraph">
<p>Finally, operator1_fr sees the answer of operator3_fr :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example8_answer_received.png" alt="example 8 screen shot #3">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demonstration"><a class="anchor" href="#_demonstration"></a>4. Demonstration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For demonstration purposes, a "demo" folder containing examples is included.
In this folder, bundles of generic cards are included as well as scripts to load the configuration.
The bundles include 4 built-in templates :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>message</p>
</li>
<li>
<p>message_or_question_list</p>
</li>
<li>
<p>question</p>
</li>
<li>
<p>task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The scripts allow to create or delete the bundles, businessData, perimeters or realTimeScreens as necessary. While inside the "client/demo" folder, the script</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./loadDemoConf.sh</pre>
</div>
</div>
<div class="paragraph">
<p>is available to set it all up.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting_bundle"><a class="anchor" href="#troubleshooting_bundle"></a>5. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_my_bundle_is_not_loaded"><a class="anchor" href="#_my_bundle_is_not_loaded"></a>5.1. My bundle is not loaded</h3>
<div class="paragraph">
<p>The server send a <code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Error detected parsing the header"]}</code>, despite correct http
headers.</p>
</div>
<div class="paragraph">
<p>The uploaded bundle is corrupted. Test your bundle in a terminal (Linux
solution).</p>
</div>
<div class="paragraph">
<p>Example for a bundle archive named <code>MyBundleToTest.tar.gz</code> giving the
mentioned error when uploaded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tar -tzf MyBundleToTest.tar.gz &gt;/dev/null
tar: This does not look like a tar archive
tar: Skipping to next header
tar: Exiting with failure status due to previous errors</pre>
</div>
</div>
<div class="sect3">
<h4 id="_solution"><a class="anchor" href="#_solution"></a>5.1.1. Solution</h4>
<div class="paragraph">
<p>Extract content if possible and compress it to a correct compressed archive
format.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i_cant_upload_my_bundle"><a class="anchor" href="#_i_cant_upload_my_bundle"></a>5.2. I can&#8217;t upload my bundle</h3>
<div class="paragraph">
<p>The server responds with a message like the following:
<code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Input is not in the .gz format"]}</code></p>
</div>
<div class="paragraph">
<p>The bundle has been compressed using an unmanaged format.</p>
</div>
<div class="sect3">
<h4 id="_format_verification"><a class="anchor" href="#_format_verification"></a>5.2.1. Format verification</h4>
<div class="sect4">
<h5 id="_linux_solution"><a class="anchor" href="#_linux_solution"></a>5.2.1.1. Linux solution</h5>
<div class="paragraph">
<p>Command line example to verify the format of a bundle archive named
<code>MyBundleToTest.tar.gz</code>(which gives the mentioned error when uploaded):</p>
</div>
<div class="literalblock">
<div class="content">
<pre> tar -tzf MyBundleToTest.tar.gz &gt;/dev/null</pre>
</div>
</div>
<div class="paragraph">
<p>which should return in such case the following messages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2"><a class="anchor" href="#_solution_2"></a>5.2.2. Solution</h4>
<div class="paragraph">
<p>Use <code>tar.gz</code> format for the archive compression. Shell command is <code>tar -czvf
MyBundleToTest.tar.gz config.json i18n.json template/ css/</code> for a bundle containing
templates and css files.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_bundle_is_rejected_due_to_internal_structure"><a class="anchor" href="#_my_bundle_is_rejected_due_to_internal_structure"></a>5.3. My bundle is rejected due to internal structure</h3>
<div class="paragraph">
<p>The server sends <code>{"status":"BAD_REQUEST","message":"Incorrect inner file
structure","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/d91ba68c-de6b-4635-a8e8-b58
fff77dfd2/config.json (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="paragraph">
<p>Where <code>$OPERATOR_FABRIC_INSTANCE_PATH</code> is the folder where businessconfig files are
stored server side.</p>
</div>
<div class="sect3">
<h4 id="_reason"><a class="anchor" href="#_reason"></a>5.3.1. Reason</h4>
<div class="paragraph">
<p>The internal file structure of your bundle is incorrect. <code>config.json</code> file and
folders need to be at the first level.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3"><a class="anchor" href="#_solution_3"></a>5.3.2. Solution</h4>
<div class="paragraph">
<p>Add or organize the files and folders of the bundle to fit the Businessconfig bundle
requirements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_template_is_not_used"><a class="anchor" href="#_my_template_is_not_used"></a>5.4. My template is not used.</h3>
<div class="paragraph">
<p>It need to be declared in the config.json of the bundle.</p>
</div>
<div class="sect3">
<h4 id="_solution_4"><a class="anchor" href="#_solution_4"></a>5.4.1. Solution</h4>
<div class="paragraph">
<p>Add or verify the name of the templates declared in the <code>config.json</code> file of
the bundle.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_value_is_not_displayed_in_the_detail_template"><a class="anchor" href="#_my_value_is_not_displayed_in_the_detail_template"></a>5.5. My value is not displayed in the detail template</h3>
<div class="paragraph">
<p>There are several possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the path of the data used in the template is incorrect;</p>
</li>
<li>
<p>number of pair of <code>{</code> and <code>}</code> must be 2 (example : <code>{{card.data.myValue}}</code>)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="architecture" class="sect0"><a class="anchor" href="#architecture"></a>OperatorFabric Architecture</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>6. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to describe the architecture of the solution, first by defining the business concepts it
deals with and then showing how this translates into the technical architecture.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_business_architecture"><a class="anchor" href="#_business_architecture"></a>7. Business Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is based on the concept of <strong>cards</strong>, which contain data regarding events that are relevant for the
operator.
A third party tool publishes cards and the cards are received on the screen of the operators. Depending on the type
of the cards, the operator can send back information to the third party via a "response card".</p>
</div>
<div class="sect2">
<h3 id="_business_components"><a class="anchor" href="#_business_components"></a>7.1. Business components</h3>
<div class="imageblock">
<div class="content">
<img src="../images/FunctionalDiagram.png" alt="functional diagram">
</div>
</div>
<div class="paragraph">
<p>To do the job, the following business components are defined :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Card Publication : this component receives the cards from third-party tools or users</p>
</li>
<li>
<p>Card Consultation : this component delivers the cards to the operators and provide access to all cards exchanged (archives)</p>
</li>
<li>
<p>Card rendering and process definition : this component stores the information for the card rendering (templates, internationalization, &#8230;&#8203;) and a light description of the process associate (states, response card, &#8230;&#8203;). This configuration data can be provided either by an administrator or by a third party tool.</p>
</li>
<li>
<p>User Management : this component is used to manage users, groups, entities and perimeters.</p>
</li>
<li>
<p>External devices : this optional component permit to send alarm to an external device instead of playing a sound on the user computer. For now, only one driver exists using modbus protocol.</p>
</li>
<li>
<p>Cards Reminder : this component is used to handle cards reminders.</p>
</li>
<li>
<p>Cards External Diffusion : this optional component allows to send cards notifications via email</p>
</li>
<li>
<p>Supervisor : this optional component allows to monitor users connections and card acknowledgements.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_business_objects"><a class="anchor" href="#_business_objects"></a>7.2. Business objects</h3>
<div class="paragraph">
<p>The business objects can be represented as follows :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/BusinessObjects.jpg" alt="business objects diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Card : the core business object which contains the data to show to the user(or operator)</p>
</li>
<li>
<p>Publisher : the emitter of the card (be it a third-party tool or an entity)</p>
</li>
<li>
<p>User : the operator receiving cards and responding via response cards</p>
</li>
<li>
<p>Entity : an entity (containing a list of users) , it can be used to model organizations (examples : control center, company , department&#8230;&#8203; ) . An entity can be part of another entity or even of several entities.</p>
</li>
<li>
<p>Group : a group (containing a list of users) , it can be used to model roles in organizations setting the group type to 'ROLE' (examples : supervisor, dispatcher &#8230;&#8203; ) and it can be used to define the rights on business processes by setting the group type to 'PERMISSION' (example:  GROUP_ALLOWED_TO_SEND_CARD_PROCESS_X)</p>
</li>
<li>
<p>Process : the process the card is about</p>
</li>
<li>
<p>Process Group : a way to group processes on the user interface</p>
</li>
<li>
<p>State : the step in the process</p>
</li>
<li>
<p>Perimeter : for a defined group the visibility of a card for a specific process and state</p>
</li>
<li>
<p>Card Rendering : data for card rendering</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A card can have a parent card, in this case the card can be named child card.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_architecture"><a class="anchor" href="#_technical_architecture"></a>8. Technical Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The architecture is based on independent modules. All business services are accessible via REST API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/LogicalDiagram.png" alt="functional diagram">
</div>
</div>
<div class="sect2">
<h3 id="_business_components_2"><a class="anchor" href="#_business_components_2"></a>8.1. Business components</h3>
<div class="paragraph">
<p>We find here the business component seen before:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We have a "UI" component which stores the static pages and the UI code that is downloaded by the browser. The UI is based an <a href="https://angular.io/">Angular</a> and  <a href="https://handlebarsjs.com/">Handlebars</a> for the card templating.</p>
</li>
<li>
<p>The business component named  "Card rendering and process definition" is at the technical level known as "Businessconfig service". This service receive card rendering and process definition as a bundle. The bundle is a tar.gz file containing</p>
<div class="ulist">
<ul>
<li>
<p>json process configuration file (containing states &amp; actions)</p>
</li>
<li>
<p>templates for rendering</p>
</li>
<li>
<p>stylesheets</p>
</li>
<li>
<p>internationalization information</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Business components are based on <a href="https://spring.io/projects/spring-boot">SpringBoot</a> or <a href="https://nodejs.or">Node.js</a> and are packaged via <a href="https://www.docker.com/">Docker</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a> is used to provide the card in a fluid way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_components"><a class="anchor" href="#_technical_components"></a>8.2. Technical components</h3>
<div class="sect3">
<h4 id="_gateway"><a class="anchor" href="#_gateway"></a>8.2.1. Gateway</h4>
<div class="paragraph">
<p>It provides a filtered view of the APIS and static served pages for external access through browsers or other http
compliant accesses. It provides the rooting for accessing the services from outside. It is a nginx server package with docker, this component contains the angular UI component.</p>
</div>
</div>
<div class="sect3">
<h4 id="_broker"><a class="anchor" href="#_broker"></a>8.2.2. Broker</h4>
<div class="paragraph">
<p>The broker is used to share information asynchronously across the whole services. It is implemented via <a href="https://www.rabbitmq.com/">RabbitMQ</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication"><a class="anchor" href="#_authentication"></a>8.2.3. Authentication</h4>
<div class="paragraph">
<p>The architecture provides a default authentication service via <a href="https://www.keycloak.org/">KeyCloak</a> but it can delegate it to an external provider. Authentication is done through the use of  Oauth2, three flows are supported : implicit, authorization code and password.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database"><a class="anchor" href="#_database"></a>8.2.4. Database</h4>
<div class="paragraph">
<p>The cards are stored in a <a href="https://www.mongodb.com/">MongoDb</a> database. The bundles are stored in a file system.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_architecture"><a class="anchor" href="#_software_architecture"></a>9. Software architecture</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The current software does not yet fully follow the architecture described here, it is a work in progress.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_back_architecture"><a class="anchor" href="#_back_architecture"></a>9.1. Back Architecture</h3>
<div class="paragraph">
<p>The main idea is to make the business code as technology independent as possible. This means that the business code should be independent of the Spring Framework or Node.js for example. Inspired by the hexagonal architecture, this leads to the following simplified view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/SoftwareArchitecture-Back.png" alt="back software architecture diagram">
</div>
</div>
<div class="paragraph">
<p>Unit testing consists in testing the business code and using mock objects to simulate the servers (mongoDB, rabbit &#8230;&#8203;)</p>
</div>
</div>
<div class="sect2">
<h3 id="_front_architecture"><a class="anchor" href="#_front_architecture"></a>9.2. Front Architecture</h3>
<div class="paragraph">
<p>The main idea is to make the business code as technology independent as possible. This means that the business code should be independent of the Angular Framework for example. Inspired by the hexagonal architecture, this leads to the following simplified view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/SoftwareArchitecture-UI.jpg" alt="back software architecture diagram">
</div>
</div>
<div class="paragraph">
<p>The UI component shall contain as little as possible business code.</p>
</div>
<div class="paragraph">
<p>Unit testing consists in testing the business code and using mock objects to simulate the servers (in app/tests/mocks)</p>
</div>
</div>
</div>
</div>
<h1 id="security" class="sect0"><a class="anchor" href="#security"></a>OperatorFabric Security</h1>
<div class="openblock partintro">
<div class="content">
Cyber security is a major concern for the OperatorFabric. The security is ensured by the following measures:
</div>
</div>
<div class="sect1">
<h2 id="_code_analysis"><a class="anchor" href="#_code_analysis"></a>10. Code analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The code is analyzed at each commit by a static code analyzer (Sonar Cloud). The code is also regularly reviewed by the development team or by external security experts.</p>
</div>
<div class="paragraph">
<p>Each modification is done via a pull request and is reviewed by at least one other developer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_updates"><a class="anchor" href="#_security_updates"></a>11. Security Updates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is regularly updated to integrate the latest security patches. To achieve this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mend Bolt for GitHub is used to monitor OperatorFabric&#8217;s dependencies and to receive notifications about any security updates.</p>
</li>
<li>
<p>GitHub Dependabot is used to check for vulnerabilities in OperatorFabric&#8217;s dependencies.</p>
</li>
<li>
<p>GitHub Code Scanning is used to check for vulnerabilities in the Docker images.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vulnerability_reporting"><a class="anchor" href="#_vulnerability_reporting"></a>12. Vulnerability Reporting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GitHub&#8217;s "Private Security Advisories" feature is used to report vulnerabilities in OperatorFabric.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supply_chain_security"><a class="anchor" href="#_supply_chain_security"></a>13. Supply Chain Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OperatorFabric code is maintained in a public repository on GitHub, ensuring transparency and collaboration.</p>
</div>
<div class="paragraph">
<p>To maintain the security of the supply chain, the following measures are implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Regular review of the list of users with access to the repository.</p>
</li>
<li>
<p>Only a restricted number of users have the necessary permissions to:</p>
<div class="ulist">
<ul>
<li>
<p>Merge code into the main branch.</p>
</li>
<li>
<p>Push Docker images to the DockerHub registry.</p>
</li>
<li>
<p>Push libraries to Maven Central.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure code quality and security, the following practices are enforced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All modifications to the main branch are done through pull requests.</p>
</li>
<li>
<p>Each pull request is reviewed by at least one other developer.</p>
</li>
<li>
<p>Each commit pushed to a feature branch must be signed by the developer.</p>
</li>
<li>
<p>Release tags on GitHub are signed for authenticity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the OpenSSF Scorecard tool (<a href="https://github.com/ossf/scorecard" class="bare">github.com/ossf/scorecard</a>) is used to monitor the security of the supply chain configuration in GitHub.</p>
</div>
<div class="paragraph">
<p>These measures help maintain the integrity and security of the OperatorFabric supply chain.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deployment_security"><a class="anchor" href="#_deployment_security"></a>14. Deployment Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The tool is to be used in a production environment, to do so the software shall be deployed by end user in a secure way.</p>
</div>
<div class="sect2">
<h3 id="_keycloak"><a class="anchor" href="#_keycloak"></a>14.1. Keycloak</h3>
<div class="paragraph">
<p>Keycloak is used to manage the authentication for the OperatorFabric reference installation. The configuration provided by OperatorFabric is intended for demonstration or development purposes only. The production configuration of Keycloak MUST be handled by the end user. Users can also choose another solution to manage authentication, as OperatorFabric is designed to be compatible with any OIDC provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mongodb"><a class="anchor" href="#_mongodb"></a>14.2. MongoDB</h3>
<div class="paragraph">
<p>MongoDB is used to store OperatorFabric&#8217;s data. The configuration provided by OperatorFabric is intended for demonstration or development purposes only. The production configuration of MongoDB MUST be handled by the end user.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tlsssl"><a class="anchor" href="#_tlsssl"></a>14.3. TLS/SSL</h3>
<div class="paragraph">
<p>OperatorFabric is designed to be used with TLS/SSL. However, the default configuration provided by OperatorFabric does not implement it, as it is intended for demonstration or development purposes only. The implementation of TLS/SSL MUST be handled by the end user, either by configuring the web-ui component to implement HTTPS or by using a proxy that implements HTTPS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inter_services_communication"><a class="anchor" href="#_inter_services_communication"></a>14.4. Inter-Services Communication</h3>
<div class="paragraph">
<p>The services within OperatorFabric communicate with each other using HTTP. This communication is not encrypted. The components should not be exposed to the internet and should be deployed in a secure network, either by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a single instance with docker-compose that does not expose the services to the outside world</p>
</li>
<li>
<p>Using a Kubernetes cluster with a private network</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_access_to_card_publication_without_authentication"><a class="anchor" href="#_access_to_card_publication_without_authentication"></a>14.5. Access to card publication without authentication</h3>
<div class="paragraph">
<p>It is possible, by configuration, to bypass authentication for third-party tool card sending. This option is only there for legacy purposes and shall not be used in a production environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_template"><a class="anchor" href="#_template"></a>14.6. Template</h3>
<div class="paragraph">
<p>OperatorFabric is designed to be used with card templates provided by the end user. These templates should be considered as code and reviewed by the end user before being used in a production environment. Failure to do so could lead to security issues.</p>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_reference_documentation" class="sect0"><a class="anchor" href="#_operatorfabric_reference_documentation"></a>OperatorFabric Reference Documentation</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The aim of this document is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explain what OperatorFabric is about and define the concepts it relies on</p>
</li>
<li>
<p>Give a basic tour of its features from a user perspective</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>15. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform their duties, an operator has to interact with multiple applications
(perform actions, watch for alerts, etc.), which can prove difficult if
there are too many of them.</p>
</div>
<div class="paragraph">
<p>The idea is to aggregate all the notifications from all these applications
into a single screen, and to allow the operator to act on them if needed.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/feed_screenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>These notifications are materialized by <strong>cards</strong> sorted in a <strong>feed</strong> according
to their period of relevance and their severity.
When a card is selected in the feed, the right-hand pane displays the <strong>details</strong>
of the card.</p>
</div>
<div class="paragraph">
<p>In addition, the cards will also translate as events displayed on a <strong>timeline</strong>
 at the top of the screen.</p>
</div>
<div class="paragraph">
<p>Part of the value of OperatorFabric is that it makes the integration very
simple on the part of the third-party applications.
To start publishing cards to users in an OperatorFabric instance, all they
have to do is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register as a publisher through the "Businessconfig" service and provide a "bundle"
containing handlebars templates defining how cards should be rendered,
i18n info etc.</p>
</li>
<li>
<p>Publish cards as json containing card data through the card publication API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OperatorFabric will then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dispatch the cards to the appropriate users (by computing the actual users
who should receive the card from the recipients rules defined in the card)</p>
</li>
<li>
<p>Take care of the rendering of the cards</p>
</li>
<li>
<p>Display relevant information from the cards in the timeline</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A card is not only information, it could be question(s) the operator has to answer.
When the operator is responding, a  card is emitted to the sender of the initial card
and the response could be seen by other operators.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>It is also possible for users to directly send card to other users using predefined card templates.</p>
</div>
<div class="paragraph">
<p>OperatorFabric user interface is running on a browser (recent version of chrome, firefox and edge are supported).</p>
</div>
<div class="paragraph">
<p>The supported screen resolutions are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resolutions greater than or equals to 1680x1050.</p>
</li>
<li>
<p>Resolutions with a width between 450-900px and a minimum height of 700px.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_cards"><a class="anchor" href="#_sending_cards"></a>16. Sending cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cards Publication Service exposes a REST API through which third-party applications, or "publishers" can post cards
to OperatorFabric. It then handles those cards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-stamping them with a "publishDate"</p>
</li>
<li>
<p>Sending them to the message broker (RabbitMQ) to be delivered in real time to the appropriate operators</p>
</li>
<li>
<p>Persisting them to the database (MongoDB) for later consultation</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="card_structure"><a class="anchor" href="#card_structure"></a>16.1. Card Structure</h3>
<div class="paragraph">
<p>Cards are represented as <code>Json</code>objects. The technical design of cards is described in
<a href="../api/cards/">the cards api documentation</a>
. A card correspond to the state of a Process in OperatorFabric.</p>
</div>
<div class="sect3">
<h4 id="_technical_information_of_the_card"><a class="anchor" href="#_technical_information_of_the_card"></a>16.1.1. Technical Information of the card</h4>
<div class="paragraph">
<p>Those attributes are used by OperatorFabric to manage how cards are stored, to whom and when they&#8217;re sent.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_information"><a class="anchor" href="#_mandatory_information"></a>16.1.1.1. Mandatory information</h5>
<div class="paragraph">
<p>Below, the <code>json</code> technical key is in the '()' following the title.</p>
</div>
<div class="sect5">
<h6 id="_publisher_publisher"><a class="anchor" href="#_publisher_publisher"></a>Publisher (<code>publisher</code>)</h6>
<div class="paragraph">
<p>The publisher field bears the identifier of the emitter of the card, be it an entity or an external service.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process"><a class="anchor" href="#card_process"></a>Process (<code>process</code>)</h6>
<div class="paragraph">
<p>This field indicates which process the card is attached to. This information is used to resolve the presentation
resources (bundle) used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process_version"><a class="anchor" href="#card_process_version"></a>Process Version (<code>processVersion</code>)</h6>
<div class="paragraph">
<p>The rendering of cards of a given process can evolve over time. To allow for this while making sure previous cards
remain correctly handled, OperatorFabric can manage several versions of the same process.
The <code>processVersion</code> field indicate which version of the process should be used to retrieve the presentation resources
(i18n, templates, etc.) to render this card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_process_instance_identifier_processinstanceid"><a class="anchor" href="#_process_instance_identifier_processinstanceid"></a>Process Instance Identifier (<code>processInstanceId</code>)</h6>
<div class="paragraph">
<p>A card is associated to a given process, which defines how it is rendered, but it is also more precisely associated to
a <strong>specific instance</strong> of this process. The <code>processInstanceId</code> field contains the unique identifier of the process instance.</p>
</div>
</div>
<div class="sect5">
<h6 id="_state_in_the_process_state"><a class="anchor" href="#_state_in_the_process_state"></a>State in the process (<code>state</code>)</h6>
<div class="paragraph">
<p>The card represents a specific state in the process. In addition to the process, this information is used to resolve the presentation
resources used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="start_date"><a class="anchor" href="#start_date"></a>Start Date (<code>startDate</code>)</h6>
<div class="paragraph">
<p>Start date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_severity_severity"><a class="anchor" href="#_severity_severity"></a>Severity (<code>severity</code>)</h6>
<div class="paragraph">
<p>The severity is a core principe of the OperatorFabric Card system. There are 4 severities available.
A color is associated in the GUI to each severity. Here the details about severity and their meaning for OperatorFabric:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ALARM: represents a critical state of the associated process, need an action from the operator. In the UI, the card is red;</p>
</li>
<li>
<p>ACTION: the associated process need an action form operators in order to evolve correctly. In the UI, the card is orange;</p>
</li>
<li>
<p>COMPLIANT: the process related to the card is in a compliant status. In the UI, the card is green.;</p>
</li>
<li>
<p>INFORMATION: give information to the operator. In the UI, the card is blue.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="card_title"><a class="anchor" href="#card_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>This attribute is display as header of a card in the feed of the GUI. It&#8217;s the main User destined Information of a card. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_summary"><a class="anchor" href="#card_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>This attribute is display as a description of a card in the feed of the GUI, when the card is selected by the operator. It&#8217;s completing the information of the card title. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_information"><a class="anchor" href="#_optional_information"></a>16.1.1.2. Optional information</h5>
<div class="sect5">
<h6 id="end_date"><a class="anchor" href="#end_date"></a>End Date (<code>endDate</code>)</h6>
<div class="paragraph">
<p>End date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_expiration_date_expirationdate"><a class="anchor" href="#_expiration_date_expirationdate"></a>Expiration Date (<code>expirationDate</code>)</h6>
<div class="paragraph">
<p>Expiration date of the active period of the card (process business time). When the expiration date has passed, the card will be automatically removed from the card feed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tags_tag"><a class="anchor" href="#_tags_tag"></a>Tags (<code>tag</code>)</h6>
<div class="paragraph">
<p>Tags are intended as an additional way to filter cards in the feed of the GUI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Grouping cards is an experimental feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tags can also be used to group cards together in the card feed. When <code>feed.enableGroupedCards</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file, cards that have the same tags are grouped together. In the feed window, only the top card will be visible and can be clicked to show  cards with the same tags.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/grouped-cards.png" alt="Closed grouped cards"></span>
<span class="image"><img src="../images/grouped-cards2.png" alt="Open grouped cards"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_entityrecipients_entityrecipients"><a class="anchor" href="#_entityrecipients_entityrecipients"></a>EntityRecipients (<code>entityRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to entity : all users members of the listed entities who have the right for the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_grouprecipients_grouprecipients"><a class="anchor" href="#_grouprecipients_grouprecipients"></a>GroupRecipients (<code>groupRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to groups : all users members of the groups will receive it. If this field is used in conjunction with entityRecipients, to receive the cards :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND one of the groups to receive the cards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND have the right for the process/state of the card.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_userrecipients_userrecipients"><a class="anchor" href="#_userrecipients_userrecipients"></a>UserRecipients (<code>userRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards directly to users without using groups or entities for card routing.</p>
</div>
</div>
<div class="sect5">
<h6 id="_last_time_to_decide_lttd"><a class="anchor" href="#_last_time_to_decide_lttd"></a>Last Time to Decide (<code>lttd</code>)</h6>
<div class="paragraph">
<p>Fixes the moment until when a <code>response</code> is possible for the card. After this moment, the response button won&#8217;t be usable. When lttd time is approaching, a clock is visible on the card in the feed with the residual time.  The lttd time can be set for cards that don&#8217;t expect any response</p>
</div>
</div>
<div class="sect5">
<h6 id="_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"><a class="anchor" href="#_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"></a>SecondsBeforeTimeSpanForReminder (<code>secondsBeforeTimeSpanForReminder</code>)</h6>
<div class="paragraph">
<p>Fixes the time for remind before the event define by the card see
<a href="#card_reminder">Card reminder</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_tonotify_tonotify"><a class="anchor" href="#_tonotify_tonotify"></a>ToNotify (<code>toNotify</code>)</h6>
<div class="paragraph">
<p>Boolean attribute. If the card must not be displayed in the feed and in monitoring screen, this field must be set to false.
In that case, it means the card is stored only in archivedCards collection and not in cards collection.</p>
</div>
</div>
<div class="sect5">
<h6 id="_publisher_type_publishertype"><a class="anchor" href="#_publisher_type_publishertype"></a>Publisher type (<code>publisherType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The sender is an external service</p>
</li>
<li>
<p>ENTITY - The sender of the card is the user on behalf of the entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_representative_representative"><a class="anchor" href="#_representative_representative"></a>Representative (<code>representative</code>)</h6>
<div class="paragraph">
<p>Used in case of sending card as a representative of an entity or a publisher (unique ID of the entity or publisher)</p>
</div>
</div>
<div class="sect5">
<h6 id="_representative_type_representativetype"><a class="anchor" href="#_representative_type_representativetype"></a>Representative Type (<code>representativeType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The representative is an external service</p>
</li>
<li>
<p>ENTITY - The representative is an entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_geographical_information_wktgeometry_and_wktprojection"><a class="anchor" href="#_geographical_information_wktgeometry_and_wktprojection"></a>Geographical information (<code>wktGeometry</code> and <code>wktProjection</code>)</h6>
<div class="paragraph">
<p>You can add geographical location in  <code>wktGeometry</code> and the projection in <code>wktProjection</code>  fields.</p>
</div>
<div class="paragraph">
<p>When <code>feed.enableMap</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file and the card is visible in the line feed, a geographical map will be drawn. When the card has set its wktGeometry, the location will be highlighted on the card. Two geometrical shapes are supported <code>POINT</code>, which will show a circle on the map, and <code>POLYGON</code> which will draw the specified area on the map.  For example show a circle based on the card location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POINT (5.8946407 51.9848624)&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example to highlight an area on the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POLYGON ((5.5339097 52.0233042,  5.7162495 51.7603784, 5.0036701 51.573684, 4.8339214 52.3547498, 5.5339097 52.0233042))&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specifications of the Well-known Text Representation of coordinate reference systems
can be found at <a href="https://www.ogc.org/standards/wkt-crs">WKT Specification</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the POINT and POLYGON are supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_actions_actions"><a class="anchor" href="#_actions_actions"></a>Actions (<code>actions</code>)</h6>
<div class="paragraph">
<p>A list of predetermined actions that will be executed upon receiving the card. The available actions include:
- KEEP_CHILD_CARDS : used to keep child cards when the parent card is modified.
- PROPAGATE_READ_ACK_TO_PARENT_CARD : used only for response cards. When receiving the child card, the status of the parent card should be considered as 'unread' and 'not acknowledged' until the user reads or acknowledge it again.
- KEEP_EXISTING_ACKS_AND_READS : used to keep existing reads and acks when updating a card</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_business_period"><a class="anchor" href="#_business_period"></a>16.1.1.3. Business period</h5>
<div class="paragraph">
<p>We define the business period as starting form startDate to endDate.  The card will be visible on the UI if the business period overlap the user chosen period (i.e. the period selected on  the timeline). If endDate is not set, the card will be visible as soon as the startDate is between start and end date of the chosen period.</p>
</div>
</div>
<div class="sect4">
<h5 id="_store_information"><a class="anchor" href="#_store_information"></a>16.1.1.4. Store information</h5>
<div class="sect5">
<h6 id="_uid_uid"><a class="anchor" href="#_uid_uid"></a>uid (<code>uid</code>)</h6>
<div class="paragraph">
<p>Unique identifier of the card in the OperatorFabric system. This attribute is always set by OperatorFabric.</p>
</div>
</div>
<div class="sect5">
<h6 id="_id_id"><a class="anchor" href="#_id_id"></a>id (<code>id</code>)</h6>
<div class="paragraph">
<p>State id of the associated process, determined by <code>OperatorFabric</code> can be set arbitrarily by the <code>publisher</code>. The id is determined by 'OperatorFabric' as follows : process.processInstanceId</p>
</div>
</div>
<div class="sect5">
<h6 id="_publish_date_publishdate"><a class="anchor" href="#_publish_date_publishdate"></a>Publish Date (<code>publishDate</code>)</h6>
<div class="paragraph">
<p>Indicates when the card has been registered in <code>OperatorFabric</code> system. This is technical information exclusively managed by <code>OperatorFabric</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_destined_information_of_the_card"><a class="anchor" href="#_user_destined_information_of_the_card"></a>16.1.2. User destined Information of the card</h4>
<div class="paragraph">
<p>There are two kind of User destined information in a card. Some are restricted to the card format, others are defined by the publisher as long as there are encoded in <code>json</code>format.</p>
</div>
<div class="sect4">
<h5 id="_in_card_format"><a class="anchor" href="#_in_card_format"></a>16.1.2.1. in Card Format</h5>
<div class="sect5">
<h6 id="_title_title"><a class="anchor" href="#_title_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>See
<a href="#card_title">Title</a>
.</p>
</div>
</div>
<div class="sect5">
<h6 id="_summary_summary"><a class="anchor" href="#_summary_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>See
<a href="#card_summary">Summary</a>
.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_part"><a class="anchor" href="#_custom_part"></a>16.1.2.2. Custom part</h5>
<div class="sect5">
<h6 id="_data_data"><a class="anchor" href="#_data_data"></a>Data (<code>data</code>)</h6>
<div class="paragraph">
<p>Determines where custom information is store. The content in this attribute, is purely <code>publisher</code> choice.
This content, as long as it&#8217;s in <code>json</code> format can be used to display details. For the way the details are
displayed, see below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must not use dot in json field names. In this case, the card will be refused with following message :
"Error, unable to handle pushed Cards: Map key xxx.xxx contains dots but no replacement was configured!""
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_presentation_information_of_the_card"><a class="anchor" href="#_presentation_information_of_the_card"></a>16.1.3. Presentation Information of the card</h4>
<div class="sect4">
<h5 id="_timespans_timespans"><a class="anchor" href="#_timespans_timespans"></a>16.1.3.1. TimeSpans (<code>timeSpans</code>)</h5>
<div class="paragraph">
<p>When the simple startDate and endDate are not enough to characterize your
process business times, you can add a list of TimeSpan to your card. TimeSpans
are rendered in the timeline component as cluster bubbles. This has no effect on the feed
content.</p>
</div>
<div class="paragraph">
<p><strong>example :</strong></p>
</div>
<div class="paragraph">
<p>to display the card two times in the timeline you can add two TimeSpan to your
card:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"publisherVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000},
        {"start" : 1546297500000}
    ]

}</pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, the card will be displayed twice in the timeline. The card
start date will be ignored.</p>
</div>
<div class="paragraph">
<p>For timeSpans, you can specify an end date, but it is not implemented in OperatorFabric (it was intended for future uses, but it will be deprecated).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cards_examples"><a class="anchor" href="#_cards_examples"></a>16.2. Cards Examples</h3>
<div class="paragraph">
<p>Before detailing the content of cards, let&#8217;s show you what cards look like through few examples of json.</p>
</div>
<div class="sect3">
<h4 id="minimal_card"><a class="anchor" href="#minimal_card"></a>16.2.1. Minimal Card</h4>
<div class="paragraph">
<p>The OperatorFabric Card specification defines mandatory attributes, but some optional attributes are needed for cards to be useful in OperatorFabric. Let&#8217;s clarify those point through few examples of minimal cards and what happens when they&#8217;re used as if.</p>
</div>
<div class="sect4">
<h5 id="reception_rules"><a class="anchor" href="#reception_rules"></a>16.2.1.1. Rules for receiving cards</h5>
<div class="paragraph">
<p>Whatever the recipient(s) of the card (user directly, group and/or entity), the user must have the receive right on the process/state of the card to receive it (<code>Receive</code> or <code>ReceiveAndWrite</code>).
So the rules for receiving cards are :</p>
</div>
<div class="paragraph">
<p>1) If the card is sent to user1, the card is received and visible for user1 if he has the receive right for the corresponding process/state</p>
</div>
<div class="paragraph">
<p>2) If the card is sent to GROUP1 (or ENTITY1_FR), the card is received and visible for user if <strong>all</strong> the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of GROUP1 (or ENTITY1_FR)</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3) If the card is sent to ENTITY1_FR and GROUP1, the card is received and visible for user if <strong>all</strong> the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of ENTITY1_FR (either directly or through one of its children entities)</p>
</li>
<li>
<p>he&#8217;s a member of GROUP1</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this chapter, when we talk about receive right, it means <code>Receive</code> or <code>ReceiveAndWrite</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_one_user"><a class="anchor" href="#_send_to_one_user"></a>16.2.1.2. Send to One User</h5>
<div class="paragraph">
<p>The following card contains only the mandatory attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"]

}</pre>
</div>
</div>
<div class="paragraph">
<p>This an information about the process instance <code>process-000</code> of process <code>process</code>, sent by <code>TEST_PUBLISHER</code>. The title and the summary refer to <code>i18n</code> keys
defined in the associated <code>i18n</code> file of the process. This card is displayable since the first january 2019 and
should only be received by the user using the <code>operator1_fr</code> login (provided that this user has receive right on this process/state).</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_several_users"><a class="anchor" href="#_send_to_several_users"></a>16.2.1.3. Send to several users</h5>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group"><a class="anchor" href="#_simple_case_sending_to_a_group"></a>Simple case (sending to a group)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is a group, the <code>Dispatcher</code>. So all users who are members of this group and who have receive right on the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_an_entity"><a class="anchor" href="#_simple_case_sending_to_an_entity"></a>Simple case (sending to an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is an entity, <code>ENTITY1_FR</code>, and there is no group recipient anymore. So all users who are members of this entity and who have a receive right for the process/state of the card will receive it. More information on perimeters can be found in
&lt;&lt;'users_management,user documentation'&gt;&gt;</p>
</div>
<div class="paragraph">
<p>Example :
Given this perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id" : "perimeter1",
    "process" : "process",
    "stateRights" : [
        {
            "state" : "myState",
            "right" : "Receive"
        },
        {
            "state" : "myState2",
            "right" : "ReceiveAndWrite"
        }
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Given this group :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Perimeters can only be linked to groups, so let&#8217;s link the perimeter <code>perimeter1</code> to the group <code>group1</code>. You can do this with this command line for example ($token is your access token) :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/perimeters/perimeter1/groups -H "Content-type:application/json" -H "Authorization:Bearer $token" --data "[\"group1\"]"</pre>
</div>
</div>
<div class="paragraph">
<p>Then you can see <code>group1</code> is now :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example",
    "perimeters": ["perimeter1"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the connected user is a member of <code>group1</code>, then he has a <code>Receive</code> right on process/state
<code>process/myState</code> (and also on`process/myState2`). So if the user is also a member of <code>ENTITY1_FR</code>
then he will receive the card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group_and_an_entity"><a class="anchor" href="#_simple_case_sending_to_a_group_and_an_entity"></a>Simple case (sending to a group and an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"],
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipients are a group and an entity, the <code>Dispatcher</code> group and <code>ENTITY1_FR</code> entity. To receive the card, the user must be a member of both ENTITY1_FR and GROUP1 and must have the receive right for the corresponding process/state.</p>
</div>
</div>
<div class="sect5">
<h6 id="_complex_case"><a class="anchor" href="#_complex_case"></a>Complex case</h6>
<div class="paragraph">
<p>If this card need to be viewed by a user who is not in the <code>Dispatcher</code> group, it&#8217;s possible to tune more precisely the
definition of the recipient. If the <code>operator2_fr</code> needs to see also this card, the recipient definition could be(the following code details only the recipient part):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher"],
"userRecipients": ["operator2_fr"]</pre>
</div>
</div>
<div class="paragraph">
<p>So here, all the users of the <code>Dispatcher</code> group will receive the <code>INFORMATION</code> as should the <code>tos2-operator</code> user.</p>
</div>
<div class="paragraph">
<p>Another example, if a card is destined to the operators of <code>Dispatcher</code> and <code>Planner</code> and needs to be also seen by the <code>admin</code>, the recipient configuration looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher", "Planner"],
"userRecipients": ["admin"]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_card"><a class="anchor" href="#_regular_card"></a>16.2.2. Regular Card</h4>
<div class="paragraph">
<p>The previous cards were nearly empty regarding information carrying. In fact, cards are intended to contain more information than a title and a summary. The optional attribute <code>data</code> is here for that. This attribute is destined to contain any <code>json</code> object. The creator of the card is free to put any information needed as long as it&#8217;s in a <code>json</code> format.</p>
</div>
<div class="sect4">
<h5 id="_full_of_hidden_data"><a class="anchor" href="#_full_of_hidden_data"></a>16.2.2.1. Full of Hidden data</h5>
<div class="paragraph">
<p>For this example we will use our previous example for the <code>Dispatcher</code> group with a <code>data</code> attribute containing the definition of a <code>json</code> object containing two attributes: <code>stringExample</code> and <code>numberExample</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"],
	"data":{
		"stringExample":"This is a not so random string of characters.",
		"numberExample":123
		}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This card contains some data but when selected in the feed nothing more than the previous example of card happen because
there is no rendering configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fully_useful"><a class="anchor" href="#_fully_useful"></a>16.2.2.2. Fully useful</h5>
<div class="paragraph">
<p>When a card is selected in the feed (of the GUI), the data is displayed in the detail panel.
The way details are formatted depends on the template contained in the bundle associated with the process as
<a href="#template_description">described here</a>
. To have an effective example without too many actions to perform, the following example will use an already existing
configuration. You can find the corresponding bundle of the following example in the test directory of OperatorFabric
(src/test/resources/bundles).</p>
</div>
<div class="paragraph">
<p>At the card level, the attributes in the card telling OperatorFabric which template to use are the <code>process</code> and <code>state</code>
attributes, the <code>templateName</code> can be retrieved from the definition of the bundle.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"1",
	"process":"defaultProcess",
	"processInstanceId":"process-000",
	"state":"messageState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"message.title"},
	"summary":{"key":"message.summary"},
	"userRecipients": ["operator1_fr"],
	"data":{"message":"Data displayed in the detail panel"},

}</pre>
</div>
</div>
<div class="paragraph">
<p>So here a single custom data is defined, and it&#8217;s <code>message</code>. This attribute is used by the template called by the
<code>templateName</code> attribute.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_rendering"><a class="anchor" href="#_card_rendering"></a>17. Card rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated above, third applications interact with OperatorFabric by sending cards.</p>
</div>
<div class="paragraph">
<p>The Businessconfig service allows them to tell OperatorFabric for each process how these cards should be rendered including translation if
several languages are supported.  Configuration is done via files zipped in a "bundle", these files are send to OperatorFabric via a REST end point.</p>
</div>
<div class="paragraph">
<p>In addition, it lets third-party applications define additional menu entries for the navbar (for example linking back
to the third-party application) that can be integrated either as iframe or external links.</p>
</div>
<div class="sect2">
<h3 id="_process_declaration_and_configuration"><a class="anchor" href="#_process_declaration_and_configuration"></a>17.1. Process: Declaration and Configuration</h3>
<div class="paragraph">
<p>To declare and configure a <code>Process</code>, OperatorFabric uses <code>bundles</code>.
This section describes their content and how to use them.
An <code>OperatorFabric Process</code> is a way to define a business configuration.
Once this bundle fully created, it must be uploaded to the server through the <code>Businessconfig service</code>.</p>
</div>
<div class="paragraph">
<p>Some examples show how to configure a <code>process</code> using a <code>bundle</code> before diving in more technical details of the configuration.
The following instructions describe tests to perform on OperatorFabric to understand how customizations are possible.</p>
</div>
<div class="sect3">
<h4 id="_bundle_as_process_declaration"><a class="anchor" href="#_bundle_as_process_declaration"></a>17.1.1. Bundle as Process declaration</h4>
<div class="paragraph">
<p>A bundle contains all the configuration regarding a given business process, describing for example the various steps of the process but also how the associated cards and card details should be displayed.</p>
</div>
<div class="paragraph">
<p>Bundle are technically <code>tar.gz</code> archives containing at least a descriptor file named <code>config.json</code>.
To display the card date, some <code>css files</code>, <code>i18n file</code> and <code>handlebars templates</code> must be added.</p>
</div>
<div class="paragraph">
<p>For didactic purposes, in this section, the businessconfig bundle name is <code>BUNDLE_TEST</code> (to match the parameters used by the script).
The l10n (localization) configurations is English.</p>
</div>
<div class="paragraph">
<p>As detailed in the <code>Businessconfig core service README</code> the bundle contains at least a metadata file called <code>config.json</code>, a file <code>i18n.json</code>, a <code>css</code> folder and a <code>template</code> folder.</p>
</div>
<div class="paragraph">
<p>Except for the <code>config.json file</code>, all elements are optional.</p>
</div>
<div class="paragraph">
<p>The file organization within a bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bundle
 config.json
 i18n.json
 css
    bundleTest.css
 template
     template1.handlebars
     template2.handlebars</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_config_json_file"><a class="anchor" href="#_the_config_json_file"></a>17.1.2. The config.json file</h4>
<div class="paragraph">
<p>It&#8217;s a description file in <code>json</code> format.
It lists the content of the bundle.</p>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uiVisibility</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">monitoring</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logging</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">state.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Never</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: id of the process;</p>
</li>
<li>
<p><code>name</code>: process name;</p>
</li>
<li>
<p><code>version</code>: enables the correct display of the card data, even for the old ones.
The server store the previous versions in its file system.
This field value should match a businessconfig configuration for a correct rendering;</p>
</li>
<li>
<p><code>states</code>: lists the available states which each declares associated actions, associated templates and if cards could be acknowledged by users;</p>
</li>
<li>
<p><code>uiVisibility</code>: in the monitoring, logging and calendar screens, not all the cards are visible, it depends on the business process they are part of. For a card to be visible in these screens, the corresponding parameter must be set to true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mandatory field are <code>id</code>,<code>name</code> and <code>version</code>.</p>
</div>
<div class="paragraph">
<p>See the
<a href="../api/businessconfig/index.html">Businessconfig API documentation</a>
for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_i18n_json_file"><a class="anchor" href="#_the_i18n_json_file"></a>17.1.3. The i18n.json file</h4>
<div class="paragraph">
<p>This file contains internationalization information, in particular the translation for title and summary fields
If there is no i18n file or key is missing, OperatorFabric displays i18n key, such as <code>BUNDLE_TEST.1.missing-i18n-key</code>.
In the case where the bundle declares no i18n key corresponds to <code>missing-i18n-key</code>.</p>
</div>
<div class="paragraph">
<p>The choice of i18n keys is up to the maintainer of the Businessconfig process.</p>
</div>
<div class="sect4">
<h5 id="_template_folder"><a class="anchor" href="#_template_folder"></a>17.1.3.1. Template folder</h5>
<div class="paragraph">
<p>The <code>template</code> folder contains one template file for each process/state. They will be used for the card details rendering.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>For this example, the name of the process is  <code>Bundle Test</code> and its technical name is <code>BUNDLE_TEST</code>.
The bundle provides an english l10n.</p>
</div>
<div class="paragraph">
<p>Title and summary have to be localized.</p>
</div>
<div class="paragraph">
<p>Here is the content of <code>i18n.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span> 
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the i18n, after the upload of the bundle, use a <code>GET</code> request against the <code>businessconfig</code> service.
The simpler is to ask for the i18n file, as described
<a href="../api/businessconfig/index.html#/businessconfig/getI18n">here</a>
.</p>
</div>
<div class="paragraph">
<p>Set the <code>version</code> of the bundle and the <code>technical name</code> of the businessconfig party to get json in the response.</p>
</div>
<div class="paragraph">
<p>For example, to check if the french l10n data of the version 1 of the <code>BUNDLE_TEST</code> businessconfig party use the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl "http://localhost:2100/businessconfig/processes/BUNDLE_TEST/i18n?version=1" \
-H  "Authorization: Bearer ${token}"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid token for OperatorFabric use.</p>
</div>
<div class="paragraph">
<p>The <code>businessconfig</code> service should answer with a 200 status associated with the following json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span> 
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processes_and_states"><a class="anchor" href="#_processes_and_states"></a>17.1.3.2. Processes and States</h5>
<div class="paragraph">
<p>Each Process declares associated states.
Each state declares specific templates for card details and specific actions.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to display elements of businessconfig card data in a custom format.</p>
</div>
<div class="sect5">
<h6 id="_configuration"><a class="anchor" href="#_configuration"></a>configuration</h6>
<div class="paragraph">
<p>The process entry in the configuration file is a dictionary of processes, each key maps to a process definition.
A process definition is itself a dictionary of states, each key maps to a state definition.</p>
</div>
</div>
<div class="sect5">
<h6 id="_templates"><a class="anchor" href="#_templates"></a>Templates</h6>
<div class="paragraph">
<p>For demonstration purposes, there will be two simple templates.
For more advance feature go to the section detailing the handlebars templates and associated helpers available in OperatorFabric.
As the card used in this example are created above, the bundle template folder needs to contain 2 templates: <code>template1.handlebars</code> and <code>template2.handlebars</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples of template (i18n versions)</strong></p>
</div>
<div class="paragraph">
<p>The following template displays a title and a line containing the value of the scope property <code>card.level1.level1Prop</code>.
The value of this key is '<em>This is a root property</em>'.</p>
</div>
<div class="paragraph">
<p><code>/template/template1.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Template Number One<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following template example displays also a title and a list of numeric values from 1 to 3.</p>
</div>
<div class="paragraph">
<p><code>/template/template2.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Second Template<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        {{#each card.data.level1.level1Array}}
                <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bunle-test-list-item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{this.level1ArrayProp}}<span class="tag">&lt;/li&gt;</span>
        {{/each}}
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_css"><a class="anchor" href="#_css"></a>CSS</h6>
<div class="paragraph">
<p>This folder contains regular css files.
The file name must be declared in the <code>config.json</code> file in order to be used in the templates and applied to them.</p>
</div>
<div class="sect6">
<h7 id="_examples_2"><a class="anchor" href="#_examples_2"></a>Examples</h7>
<div class="paragraph">
<p>As above, all parts of files irrelevant for our example are symbolised by a <code></code> character.</p>
</div>
<div class="paragraph">
<p><strong>Declaration of css files in <code>config.json</code> file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
        <span class="error"></span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">state1</span><span class="delimiter">&quot;</span></span> : {
                  <span class="error"></span>
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest</span><span class="delimiter">&quot;</span></span>]
                  }
              }
        <span class="error"></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CSS Class used in <code>./template/template1.handlebars</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">        
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span>
        </code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, the value of <code>{{card.data.level1.level1Prop}}</code> of a test card is <code>This is a level1 property</code></p>
</div>
<div class="paragraph">
<p><strong>Style declaration in <code>./css/bundleTest.css</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.h2</span>{
        <span class="key">color</span>:<span class="color">#fd9312</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected result</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/expected-result.png" alt="Formatted root property">
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_upload"><a class="anchor" href="#_upload"></a>17.1.3.3. Upload</h5>
<div class="paragraph">
<p>To upload a bundle to the OperatorFabric server use a <code>POST</code> http request as described in the
<a href="../api/businessconfig/.html#/businessconfig/uploadBundle">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${BUNDLE_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processes&quot;\
        -H  &quot;accept: application/json&quot;\
        -H  &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@bundle-test.tar.gz;type=application/gzip&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${BUNDLE_FOLDER}</code> is the folder containing the bundle archive to be uploaded.</p>
</li>
<li>
<p><code>bundle-test.tar.gz</code> is the name of the uploaded bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command line should return a <code>200 http status</code> response with the details of the bundle in the response body such as :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template1</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template2</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest.css</span><span class="delimiter">&quot;</span></span> ]
          }
      }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further help check the
<a href="#troubleshooting_bundle">Troubleshooting</a>
section which resumes how to resolve common problems.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processes_groups"><a class="anchor" href="#_processes_groups"></a>17.1.4. Processes groups</h4>
<div class="paragraph">
<p>OperatorFabric offers the possibility of defining process groups. These groups have an impact only on the UI, for
example on the notification configuration screen, by offering a more organized view of all the processes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A process can only belong to one process group.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To define processes groups, you have to upload a file via a <code>POST</code> http request as described in the</p>
</div>
<div class="paragraph">
<p><a href="../api/businessconfig/index.html#/businessconfig/uploadProcessgroups">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${PROCESSES_GROUPS_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processgroups&quot;\
        -H &quot;accept: application/json&quot;\
        -H &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@processesGroups.json&quot;\
        -H &quot;Authorization: Bearer ${token}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${PROCESSES_GROUPS_FOLDER}</code> is the folder containing the processes groups file to upload.</p>
</li>
<li>
<p><code>processesGroups.json</code> is the name of the uploaded file.</p>
</li>
<li>
<p><code>${token}</code> is a valid token for OperatorFabric use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of content for uploaded file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process1</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process2</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process3</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process4</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These command line should return a <code>201 http status</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_description"><a class="anchor" href="#template_description"></a>17.2. Templates</h3>
<div class="paragraph">
<p>Templates are <a href="https://handlebarsjs.com/">Handlebars</a> template files. Templates
are then filled with data coming from two sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>card</strong> property (See
<a href="../api/cards/index.html">card data model</a>
for more information)</p>
</li>
<li>
<p>a <strong>userContext</strong> :</p>
<div class="ulist">
<ul>
<li>
<p><strong>login</strong>: user login</p>
</li>
<li>
<p><strong>token</strong>: user jwt token</p>
</li>
<li>
<p><strong>firstName</strong>: user first name</p>
</li>
<li>
<p><strong>lastName</strong>: user last name</p>
</li>
<li>
<p><strong>groups</strong> : user groups as an array of groups ID</p>
</li>
<li>
<p><strong>entities</strong> : user entities as an array of entities ID</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use these data in the template , you need to reference them inside double braces. For example if you want to display the user login:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Your login is : {{userContext.login}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display specific business data from the card, write for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>My data : {{card.data.mydataField}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look to  <a href="https://handlebarsjs.com/" class="bare">handlebarsjs.com/</a> for more information on the templating mechanism.</p>
</div>
<div class="paragraph">
<p>In addition to Handlebars basic syntax and helpers, OperatorFabric defines the
following helpers :</p>
</div>
<div class="sect3">
<h4 id="_operatorfabric_specific_handlebars_helpers"><a class="anchor" href="#_operatorfabric_specific_handlebars_helpers"></a>17.2.1. OperatorFabric specific handlebars helpers</h4>
<div class="sect4">
<h5 id="arrayContains"><a class="anchor" href="#arrayContains"></a>17.2.1.1. arrayContains</h5>
<div class="paragraph">
<p>Verify if an array contains a specified element. If the array does contain the element, it returns true. Otherwise, it returns false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p {{#if (arrayContains colors 'red')}}class="text-danger"{{/if}}&gt;test&lt;/p&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If the colors array contains 'red', the output is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p class="text-danger"&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="arrayContainsOneOf"><a class="anchor" href="#arrayContainsOneOf"></a>17.2.1.2. arrayContainsOneOf</h5>
<div class="paragraph">
<p>If the first array contains at least one element of the second array, return true. Otherwise, return false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (arrayContainsOneOf arr1 arr2)}}
  &lt;p&gt;Arr1 contains at least one element of arr2&lt;/p&gt;
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bool"><a class="anchor" href="#bool"></a>17.2.1.3. bool</h5>
<div class="paragraph">
<p>returns a boolean result value on an arithmetical operation (including object
equality) or boolean operation.</p>
</div>
<div class="paragraph">
<p>Arguments: - v1: left value operand - op: operator (string value) - v2: right
value operand</p>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>==</p>
</li>
<li>
<p>===</p>
</li>
<li>
<p>!=</p>
</li>
<li>
<p>!==</p>
</li>
<li>
<p>&lt;</p>
</li>
<li>
<p>&#8656;</p>
</li>
<li>
<p>&gt;</p>
</li>
<li>
<p>&gt;=</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>boolean operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp;&amp;</p>
</li>
<li>
<p>||</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (bool v1 '&lt;' v2)}}
  v1 is strictly lower than v2
{{else}}
 V2 is lower or equal to v1
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditionalAttribute"><a class="anchor" href="#conditionalAttribute"></a>17.2.1.4. conditionalAttribute</h5>
<div class="paragraph">
<p>Adds the specified attribute to an HTML element if the given condition is truthy.
This is useful for attributes such as <code>checked</code> where it is the presence or absence of the attribute that matters (i.e.
an checkbox with <code>checked=false</code> will still be checked).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;input type="checkbox" id="optionA" {{conditionalAttribute card.data.optionA 'checked'}}&gt;&lt;/input&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="replace"><a class="anchor" href="#replace"></a>17.2.1.5. replace</h5>
<div class="paragraph">
<p>Replaces all the occurrences in a given string
You should specify the substring to find, what to replace it with and the input string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{replace "&amp;lt;p&amp;gt;" "&lt;p&gt;"  this.value}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dateformat"><a class="anchor" href="#dateformat"></a>17.2.1.6. dateFormat</h5>
<div class="paragraph">
<p>formats the submitted parameters (millisecond since epoch) using
<a href="https://momentjs.com/">mement.format</a>. The locale used is the current user
selected one, the format is "format" hash parameter
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthday format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
<div class="paragraph">
<p><em>Note</em><br>
You can also pass a milliseconds value as a string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthdayAsString format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="json"><a class="anchor" href="#json"></a>17.2.1.7. json</h5>
<div class="paragraph">
<p>Convert the element in json, this can be useful to use the element as a javascript object in the template. For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var myAttribute = {{json data.myAttribute}};</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_keepspacesandendofline"><a class="anchor" href="#_keepspacesandendofline"></a>17.2.1.8. keepSpacesAndEndOfLine</h5>
<div class="paragraph">
<p>Convert a string to a light HTML by replacing :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>each new line character with &lt;br/&gt;</p>
</li>
<li>
<p>spaces with &amp;nbsp; when there is at least two consecutive spaces.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="keyValue"><a class="anchor" href="#keyValue"></a>17.2.1.9. keyValue</h5>
<div class="paragraph">
<p>This allows to traverse a map.</p>
</div>
<div class="paragraph">
<p>Notice that this should normally be feasible by using the built-in each helper, but a client was having some troubles using it so we added this custom helper.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#keyValue studentGrades}}
  &lt;p&gt; {{index}} - {{key}}: {{value}} &lt;/p&gt;
{{/keyValue}}</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the studentGrades map is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  'student1': 15,
  'student2': 12,
  'student3': 9
}</pre>
</div>
</div>
<div class="paragraph">
<p>The output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt; 0 - student1: 15&lt;/p&gt;
&lt;p&gt; 1 - student2: 12&lt;/p&gt;
&lt;p&gt; 2 - student3: 9&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="math"><a class="anchor" href="#math"></a>17.2.1.10. math</h5>
<div class="paragraph">
<p>returns the result of a mathematical operation.</p>
</div>
<div class="paragraph">
<p>arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>v1: left value operand</p>
</li>
<li>
<p>op: operator (string value)</p>
</li>
<li>
<p>v2: right value operand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>+</p>
</li>
<li>
<p>-</p>
</li>
<li>
<p>*</p>
</li>
<li>
<p>/</p>
</li>
<li>
<p>%</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{math 1 '+' 2}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mergeArrays"><a class="anchor" href="#mergeArrays"></a>17.2.1.11. mergeArrays</h5>
<div class="paragraph">
<p>Return an array that is a merge of the two arrays.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#each (mergeArrays arr1 arr2)}}
  &lt;p&gt;{{@index}} element: {{this}}&lt;/p&gt;
{{/each}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="now"><a class="anchor" href="#now"></a>17.2.1.12. now</h5>
<div class="paragraph">
<p>outputs the current date in millisecond from epoch. The date is computed from
application internal time service and thus may be different from the date that
one can compute from javascript api which relies on the browsers' system time.</p>
</div>
<div class="paragraph">
<p>NB: Due to Handlebars limitation you must provide at least one argument to
helpers otherwise, Handlebars will confuse a helper and a variable. In the
bellow example, we simply pass an empty string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;{{now ""}}&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;{{dateFormat (now "") format="MMMM Do YYYY, h:mm:ss a"}}&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;1551454795179&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;mars 1er 2019, 4:39:55 pm&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for a local set to <code>FR_fr</code></p>
</div>
</div>
<div class="sect4">
<h5 id="numberformat"><a class="anchor" href="#numberformat"></a>17.2.1.13. numberFormat</h5>
<div class="paragraph">
<p>formats a number parameter using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/NumberFormat">Intl.NumberFormat</a>.
The locale used is the current user selected one, and options are passed as hash
parameters (<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{numberFormat card.data.price style="currency" currency="EUR"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="padStart"><a class="anchor" href="#padStart"></a>17.2.1.14. padStart</h5>
<div class="paragraph">
<p>pads the start of a string with a specific string to a certain length using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String/padStart">String.prototype.padStart()</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{padStart card.data.byhour 2 '0'}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="preservespace"><a class="anchor" href="#preservespace"></a>17.2.1.15. preserveSpace</h5>
<div class="paragraph">
<p>preserves space in parameter string to avoid html standard space trimming.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{preserveSpace card.data.businessId}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="slice"><a class="anchor" href="#slice"></a>17.2.1.16. slice</h5>
<div class="paragraph">
<p>extracts a sub array from ann array</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 0 2)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 1)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;bar&lt;/li&gt;
  &lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sort"><a class="anchor" href="#sort"></a>17.2.1.17. sort</h5>
<div class="paragraph">
<p>sorts an array or some object&#8217;s properties (first argument) using an optional
field name (second argument) to sort the collection on this fields natural
order.</p>
</div>
<div class="paragraph">
<p>If there is no field argument provided :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an array, the original order of the array is kept ;</p>
</li>
<li>
<p>for an object, the structure is sorted by the object field name.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
users :

{"john": { "firstName": "John", "lastName": "Cleese"},
"graham": { "firstName": "Graham", "lastName": "Chapman"},
"terry": { "firstName": "Terry", "lastName": "Gilliam"},
"eric": { "firstName": "Eric", "lastName": "Idle"},
"terry": { "firstName": "Terry", "lastName": "Jones"},
"michael": { "firstName": "Michael", "lastName": "Palin"},
--&gt;

&lt;ul&gt;
{{#each (sort users)}}
    &lt;li&gt;{{this.firstName}} {{this.lastName}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (sort users "lastName")}}
    &lt;li&gt;{{this.firstName}} {{this.lastName&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="split"><a class="anchor" href="#split"></a>17.2.1.18. split</h5>
<div class="paragraph">
<p>splits a string into an array based on a split string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (split 'my.example.string' '.')}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;my&lt;/li&gt;
  &lt;li&gt;example&lt;/li&gt;
  &lt;li&gt;string&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="times"><a class="anchor" href="#times"></a>17.2.1.19. times</h5>
<div class="paragraph">
<p>Allows to perform the same action a certain number of times. Internally, this uses a for loop.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#times 3}}
  &lt;p&gt;test&lt;/p&gt;
{{/times}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="toBreakage"><a class="anchor" href="#toBreakage"></a>17.2.1.20. toBreakage</h5>
<div class="paragraph">
<p>Change the breakage of a string. The arguments that you can specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lowercase &#8658; The string will be lowercased</p>
</li>
<li>
<p>uppercase &#8658; The string will be uppercased</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>{{toBreakage key 'lowercase'}}s</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the key variable is "TEST", the output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tests</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="objectContainsKey"><a class="anchor" href="#objectContainsKey"></a>17.2.1.21. objectContainsKey</h5>
<div class="paragraph">
<p>Verify if a JavaScript object contains the specified key. It returns true if it contains it, false otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{objectContainsKey card.data.myObject 'myKey' }}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="findObjectByProperty"><a class="anchor" href="#findObjectByProperty"></a>17.2.1.22. findObjectByProperty</h5>
<div class="paragraph">
<p>Searching directly an object in a list using the value of a property. Returns the object if it contains it, null otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#with (findObjectByProperty card.data.myObjectsList propertyName propertyValue)}}
  &lt;p&gt;Property value of found object: {{this.propertyName}}&lt;/p&gt;
{{/with}}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_naming_convention"><a class="anchor" href="#_naming_convention"></a>17.2.2. Naming convention</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please do not prefix <code>id</code> attributes of DOM elements or css class names of your templates with "opfab". Indeed, so that there is no confusion between the elements of OperatorFabric and those of your templates, we have prefixed all our <code>id</code> attributes and css classes with "opfab".
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="opfab_template_style"><a class="anchor" href="#opfab_template_style"></a>17.2.3. OperatorFabric css styles</h4>
<div class="paragraph">
<p>OperatorFabric defines several css classes that you should use so your templates don&#8217;t clash with the rest of the OperatorFabric look and feel. These styles are especially useful for templates used in user card or card with responses.</p>
</div>
<div class="paragraph">
<p>Your can find example using these classes in the OperatorFabric core repository (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles">src/test/resources/bundles</a>).</p>
</div>
<div class="paragraph">
<p>The following css styles are available.</p>
</div>
<div class="sect4">
<h5 id="_opfab_input"><a class="anchor" href="#_opfab_input"></a>17.2.3.1. opfab-input</h5>
<div class="paragraph">
<p>An input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-input"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;input id="my_input" name="my_input"&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_textarea"><a class="anchor" href="#_opfab_textarea"></a>17.2.3.2. opfab-textarea</h5>
<div class="paragraph">
<p>A text area input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-textarea"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;textarea id="my_textearea_input" name="my_textearea_input"&gt; &lt;/textarea&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_select"><a class="anchor" href="#_opfab_select"></a>17.2.3.3. opfab-select</h5>
<div class="paragraph">
<p>A select input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-select" style="position:relative"&gt;
      &lt;label&gt; My select label &lt;/label&gt;
      &lt;select id="my_select" name="my_select"&gt;
          &lt;option  value="option1"&gt; Option 1 &lt;/option&gt;
          &lt;option  value="option2"&gt; Option 2&lt;/option&gt;
      &lt;/select&gt;
  &lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The use of <code>position:relative</code> is important here to avoid strange positioning of the label.</p>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_radio_button"><a class="anchor" href="#_opfab_radio_button"></a>17.2.3.4. opfab-radio-button</h5>
<div class="paragraph">
<p>A radio button input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-radio-button"&gt;
      &lt;span&gt; My radio choice &lt;/span&gt;
      &lt;input type="radio" id="my_radio_button"&gt;
      &lt;span class="opfab-radio-button-checkmark"&gt;&lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_checkbox"><a class="anchor" href="#_opfab_checkbox"></a>17.2.3.5. opfab-checkbox</h5>
<div class="paragraph">
<p>A checkbox input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-checkbox"&gt;
    My checkbox text
    &lt;input type="checkbox" id="my_checkbox" name="my_checkbox" &gt;
    &lt;span class="opfab-checkbox-checkmark"&gt; &lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_table"><a class="anchor" href="#_opfab_table"></a>17.2.3.6. opfab-table</h5>
<div class="paragraph">
<p>An HTML table, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-table"&gt;
    &lt;table&gt;
        .....
    &lt;/table&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_border_box"><a class="anchor" href="#_opfab_border_box"></a>17.2.3.7. opfab-border-box</h5>
<div class="paragraph">
<p>A box with a label, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-border-box"&gt;
    &lt;label&gt;  My box name  &lt;/label&gt;
    &lt;div&gt; My box text &lt;/div&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_color_danger_opfab_color_warning_and_opfab_color_success"><a class="anchor" href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success"></a>17.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</h5>
<div class="paragraph">
<p>Some styles for text standard colors, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;span class="opfab-color-danger"&gt; my text in color &lt;/span&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_btn_opfab_btn_cancel"><a class="anchor" href="#_opfab_btn_opfab_btn_cancel"></a>17.2.3.9. opfab-btn, opfab-btn-cancel</h5>
<div class="paragraph">
<p>Styles for buttons, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;button type="button" class="opfab-btn"&gt;OK&lt;/button&gt;
  &lt;button type="button" class="opfab-btn-cancel"&gt;CANCEL&lt;/button&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tooltip"><a class="anchor" href="#_tooltip"></a>17.2.4. Tooltip</h4>
<div class="paragraph">
<p>OperatorFabric provides a css tooltip component. To use it, you must use the <code>opfab-tooltip</code> class style. You can define
where the tooltip will be displayed using <code>left</code>, <code>top</code> or <code>bottom</code> (by default, it is displayed on the right). For
example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;span opfab-tooltip-text="Here is an example of tooltip" class="opfab-tooltip"&gt;Some tooltip text&lt;/span&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>or for a tooltip displyed on the left :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;span opfab-tooltip-text="Here is an example of tooltip" class="opfab-tooltip left"&gt;Some tooltip text&lt;/span&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_select"><a class="anchor" href="#_multi_select"></a>17.2.5. Multi Select</h4>
<div class="paragraph">
<p>OperatorFabric provides a multiselect component based on <a href="https://sa-si-dev.github.io/virtual-select/#/">Virtual Select</a>. To use it, one must use the OperatorFabric style and provide javascript to initialize the component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY MULTI SELECT   &lt;/label&gt;
        &lt;div id="my-multiselect"&gt;&lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;
  myMultiSelect = opfab.multiSelect.init({
                id: "my-multiselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: true,
                search: true
            });


  opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(() =&gt; {

        const selectedValues = myMultiSelect.getSelectedValues();
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can set selected values via method setSelectedValues();</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  myMultiSelect.setSelectedValues(['A','B']);</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to set the options list after init, use setOptions method :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  var options = [
    { label: 'Options 1', value: '1' },
    { label: 'Options 2', value: '2' },
    { label: 'Options 3', value: '3' },
  ];

  myMultiSelect.setOptions(options);</pre>
</div>
</div>
<div class="paragraph">
<p>You can enable (or disable) the multiselect component using enable (or disable) method :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  myMultiSelect.enable();
  myMultiSelect.disable();</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It strongly advice to NOT use directly virtual select (always use OperatorFabric js object and css) otherwise you will not be guaranteed compatibility when upgrading.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to use the component also as single value select. The advantage over a standard select is the possibility to benefit of the searching feature. To use the component as single select, initialize it with the <code>multiple</code> property set to false:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY SINGLE SELECT   &lt;/label&gt;
        &lt;div id="my-singleselect"&gt;
        &lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;

  opfab.multiSelect.init({
                id: "my-singleselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: false,
                search: true
            });


   opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(()  =&gt; {

        const selectedValues = document.getElementById('my-singleselect').value;

      ....</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rich_text_editor"><a class="anchor" href="#_rich_text_editor"></a>17.2.6. Rich Text Editor</h4>
<div class="paragraph">
<p>OperatorFabric provides a rich text editor component based on <a href="https://github.com/quilljs/quill" class="bare">github.com/quilljs/quill</a>.
The component provides the following text formatting tools :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Headings</p>
</li>
<li>
<p>Color</p>
</li>
<li>
<p>Bold</p>
</li>
<li>
<p>Underline</p>
</li>
<li>
<p>Italics</p>
</li>
<li>
<p>Link</p>
</li>
<li>
<p>Align</p>
</li>
<li>
<p>Bullet list</p>
</li>
<li>
<p>Ordered list</p>
</li>
<li>
<p>Indent</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the rich text editor component just add a &lt;opfab-richtext-editor&gt; tag in the template using the OperatorFabric style. From javascript it is then possible to get formatted text content.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;div class="opfab-textarea"&gt;
            &lt;label&gt; MESSAGE &lt;/label&gt;
            &lt;opfab-richtext-editor id="quill"&gt;{{card.data.richMessage}}&lt;/opfab-richtext-editor&gt;
        &lt;/div&gt;

 &lt;script&gt;

  const quillEditor = document.getElementById('quill');

  opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(() =&gt; {

        const editorContent = quillEditor.getContents();
        const editorHtml = quillEditor.getHtml();
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>The editor use a custom JSON format called Delta to store the formatted content. To get the JSON content as a string you can call the <code>getContents()</code> method. To get the HTML formatted text you can call the <code>getHtml()</code> method.</p>
</div>
<div class="paragraph">
<p>To set the initial content of the editor you can either call the <code>setContents(delta)</code> method from javascript  providing the content as Delta JSON string or directly in the template by putting the Delta JSON string as content of the &lt;opfab-richtext-editor&gt; tag.</p>
</div>
<div class="paragraph">
<p>Opfab provides a utility to obtain the Delta JSON representation of a rich text. This utility is available at the following link : <a href="http://localhost:2002/#/devtools/richtext" class="bare">localhost:2002/#/devtools/richtext</a>
The tool allows you to convert a rich text formatted using the visual editor into the corresponding Delta JSON format.</p>
</div>
<div class="paragraph">
<p>It is possible to disable/enable the editor by calling the <code>enable(enabled: boolean)</code> method.</p>
</div>
<div class="paragraph">
<p>To show the rich message in an HTML element you can call the <code>opfab.richTextEditor.showRichMessage(element)</code> method. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;span id="richMessage"&gt;{{card.data.richMessage}}&lt;/span&gt;

&lt;script&gt;

  opfab.richTextEditor.showRichMessage(document.getElementById("richMessage"));

  ...
&lt;/script&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_charts"><a class="anchor" href="#_charts"></a>17.2.7. Charts</h4>
<div class="paragraph">
<p>The library <a href="https://www.chartjs.org/">charts.js</a> is integrated in OperatorFabric, it means it&#8217;s possible to show charts in cards, you can find a bundle example in the operator fabric git (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles/defaultProcess_V1">src/test/resources/bundle/defaultProcess_V1</a>).</p>
</div>
<div class="paragraph">
<p>The version of chartjs integrated in OperatorFabric is v3.7.1.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_notification"><a class="anchor" href="#_card_notification"></a>18. Card notification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a user receives a card, he is notified via a resume of the card on the left panel of the UI, what is called the "feed".</p>
</div>
<div class="sect2">
<h3 id="_notification_configuration"><a class="anchor" href="#_notification_configuration"></a>18.1. Notification configuration</h3>
<div class="paragraph">
<p>For each process/state, the user can choose to be notified or not when receiving a card. If he chooses not to be
notified then the card will not be visible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the feed or the timeline</p>
</li>
<li>
<p>in the monitoring screen</p>
</li>
<li>
<p>in the calendar screen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it will be visible in the archives screen.</p>
</div>
<div class="paragraph">
<p>In order to have a better visual organization of the processes in the UI, you can define processes groups.
You can find more information
<a href="#_processes_groups">here</a></p>
</div>
<div class="paragraph">
<p>Some process/state may be non-filterable. In this case, the corresponding checkbox is disabled (and checked).
To make a process/state filterable or not, the admin must modify the "filtering notification allowed" field, in the
corresponding perimeter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sound_notification"><a class="anchor" href="#_sound_notification"></a>18.2. Sound notification</h3>
<div class="paragraph">
<p>If the option is activated in the general configuration file web-ui.json, the user can choose to have a sound played
when they receive a card (either by the browser or by an external device if configured).
This can be managed by the user in the settings screen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To customize the sounds played by the browser, see <code>config/docker/custom-sounds/README.adoc</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_card_read"><a class="anchor" href="#_card_read"></a>18.3. Card read</h3>
<div class="paragraph">
<p>When the user receives a new card, he can see it in the feed with a bold title and card resume. Once the card is opened, the text is not bold anymore and becomes grey.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgment"><a class="anchor" href="#_card_acknowledgment"></a>18.4. Card acknowledgment</h3>
<div class="sect3">
<h4 id="_acknowledgment_done_by_the_user"><a class="anchor" href="#_acknowledgment_done_by_the_user"></a>18.4.1. Acknowledgment done by the user</h4>
<div class="paragraph">
<p>The user can set a card as "acknowledged," so he will not see it any more by default in the feed. It is as well possible to cancel it and set a card to "unacknowledged" (a filter permit to see acknowledged cards).</p>
</div>
<div class="paragraph">
<p>To offer the possibility for the user to acknowledge card, it has to be configured in process definition.
The configuration is done on a state by setting the <code>acknowledgmentAllowed</code> field. Allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Never": acknowledgement not allowed</p>
</li>
<li>
<p>"Always": acknowledgement allowed (default value)</p>
</li>
<li>
<p>"OnlyWhenResponseDisabledForUser": acknowledgement allowed only when
the response is disabled for the user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to cancel a card acknowledgment unless process state configuration has the <code>cancelAcknowledgmentAllowed</code> field set to false.</p>
</div>
<div class="paragraph">
<p>When the user acknowledges a card, the card detail is closed unless process state configuration has the <code>closeCardWhenUserAcknowledges</code> field set to false.</p>
</div>
<div class="paragraph">
<p>You can see examples in src/test/resources/bundles/defaultProcess_V1/config.json</p>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment_done_by_entityies"><a class="anchor" href="#_acknowledgment_done_by_entityies"></a>18.4.2. Acknowledgment done by entity(ies)</h4>
<div class="paragraph">
<p>A card can also be set as acknowledged if a member (or several) of the entity of the user has acknowledged it.
A user can be member of several entities, so you can configure if acknowledgment done by only one entity
(of the user) suffices for the card to appear as acknowledged or if all entities must acknowledge the card.</p>
</div>
<div class="paragraph">
<p>To configure how a card is considered as acknowledged for the user, it has to be configured in process definition.
The configuration is done on a state by setting the <code>consideredAcknowledgedForUserWhen</code> field. Allowed values are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"UserHasAcknowledged" : the card is set as acknowledged if the user acknowledges it</p>
</li>
<li>
<p>"AllEntitiesOfUserHaveAcknowledged" : the card is set as acknowledged if all the entities of the user acknowledge it</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_displaying_the_entities_acknowledgments"><a class="anchor" href="#_displaying_the_entities_acknowledgments"></a>18.4.3. Displaying the entities acknowledgments</h4>
<div class="paragraph">
<p>The entities acknowledgments can be displayed in the footer of the card. You can choose to display it (or not) via the option
<code>showAcknowledgmentFooter</code> in a state definition. Allowed values are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"OnlyForEmittingEntity" (default value) : the entities acknowledgments are displayed only for the members of the entity
that has created the card</p>
</li>
<li>
<p>"OnlyForUsersAllowedToEdit" : the entities acknowledgments are displayed for the users allowed to edit the card</p>
</li>
<li>
<p>"ForAllUsers" : the entities acknowledgments are displayed for the members of all the entities</p>
</li>
<li>
<p>"Never" : The entities acknowledgments are displayed to no one</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pin_cards"><a class="anchor" href="#_pin_cards"></a>18.5. Pin cards</h3>
<div class="paragraph">
<p>It is possible to configure the state of a process so that cards are automatically "pinned" when acknowledged. Pinned cards are displayed in Feed page as small boxes with the title of the card just under the timeline Pinned cards are still visible even if the card is no more visible in the feed. A pinned card remains visible until card end date. If no end date, card will always be visible unless it is updated or deleted.</p>
</div>
<div class="paragraph">
<p>To configure a process state to automatically pin cards set the <code>automaticPinWhenAcknowledged</code> property to true in state definition.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"pinnedState": {
      "name": " Network Contingencies ",
      "description": "Contingencies state",
      "templateName": "contingencies",
      "styles": [
        "contingencies"
      ],
      "acknowledgmentAllowed": "Always",
      "type" : "INPROGRESS",
      "automaticPinWhenAcknowledged" : true
    }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="card_reminder"><a class="anchor" href="#card_reminder"></a>18.6. Card reminder</h3>
<div class="paragraph">
<p>For certain process and state, it is possible to configure a reminder. The reminder triggers the resending of the card at a certain time with status "unread" and "unacknowledged" and publishDate updated.</p>
</div>
<div class="paragraph">
<p>The time for "reactivation" is defined with the parameter "secondsBeforeTimeSpanForReminder" in the card.</p>
</div>
<div class="paragraph">
<p>The reminder is done related to the timespans values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the startDate</p>
</li>
<li>
<p>or recurrently if a recurrence objet is defined.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_simple_reminder"><a class="anchor" href="#_simple_reminder"></a>18.6.1. Simple reminder</h4>
<div class="paragraph">
<p>If a timespan is present without a recurrence object, a reminder will arise at <code>startDate - secondsBeforeTimeSpanForReminder</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recurrent_reminder"><a class="anchor" href="#_recurrent_reminder"></a>18.6.2. Recurrent reminder</h4>
<div class="paragraph">
<p>It is possible to set a recurrent reminder for a card. There are two ways to do it :</p>
</div>
<div class="sect4">
<h5 id="_using_rrule_field"><a class="anchor" href="#_using_rrule_field"></a>18.6.2.1. Using <code>rRule</code> field :</h5>
<div class="paragraph">
<p><code>rRule</code> field defines a regular event (as defined in the RFC 5545). It is defined with the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>freq : frequency of the recurrence (possible values : 'SECONDLY', 'MINUTELY', 'HOURLY', 'DAILY', 'WEEKLY', 'MONTHLY', 'YEARLY')</p>
</li>
<li>
<p>byweekday : list of days of the week when the event arises (possible values : 'MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU')</p>
</li>
<li>
<p>bymonth : list of months of the year when the event arises (possible values : number from 1 to 12, 1 being January and 12 being December)</p>
</li>
<li>
<p>byhour : list of hours of the day for the recurrence (from 0 to 23)</p>
</li>
<li>
<p>byminute : list of minutes within an hour for the recurrence (from 0 to 59)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reminder will arise for each <code>recurrent date of event - secondsBeforeTimeSpanForReminder</code> starting from startDate.</p>
</div>
<div class="sect5">
<h6 id="_recurrent_reminder_example_using_rrule_field"><a class="anchor" href="#_recurrent_reminder_example_using_rrule_field"></a>Recurrent reminder example using <code>rRule</code> field :</h6>
<div class="literalblock">
<div class="content">
<pre>rRule : {
    freq : 'DAILY',
    byweekday : ['TU', 'WE'],
    bymonth : [1, 3],
    byhour : [11],
    byminute : [30]
}</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_using_recurrence_field_in_the_timespan_object_deprecated"><a class="anchor" href="#_using_recurrence_field_in_the_timespan_object_deprecated"></a>18.6.2.2. Using <code>recurrence</code> field in the timespan object (deprecated)</h5>
<div class="paragraph">
<p><code>recurrence</code> field defines a regular event in the timespan structure. It is defined with the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HoursAndMinutes : hours and minutes of day when the event arise</p>
</li>
<li>
<p>DaysOfWeek : a list of days of the week when the event arises. The day of week is a number with 1 being Monday and 7 being Sunday as defined in <a href="https://en.wikipedia.org/wiki/ISO_8601#Week_dates">the ISO Standard 8601 (weekday number) </a></p>
</li>
<li>
<p>Months : a list of months of the year when the event arises. The month of year is a number with 0 being January and 11 being December</p>
</li>
<li>
<p>TimeZone : the time zone of reference for the recurrence definition (default value is Europe/Paris)</p>
</li>
<li>
<p>DurationInMinutes : the duration in minutes of the event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reminder will arise for each <code>recurrent date of event - secondsBeforeTimeSpanForReminder</code> starting from startDate.</p>
</div>
<div class="sect5">
<h6 id="_recurrent_reminder_example_using_recurrence_field"><a class="anchor" href="#_recurrent_reminder_example_using_recurrence_field"></a>Recurrent reminder example using <code>recurrence</code> field :</h6>
<div class="paragraph">
<p>If timespan is defined as follows :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>startDate : 1231135161
recurrence : {
    hoursAndMinutes : { hours:10 ,minutes:30},
    daysOfWeek : [6,7],
    durationInMinutes : 15,
    months : [10,11]
}</pre>
</div>
</div>
<div class="paragraph">
<p>If secondsBeforeTimeSpanForReminder is set to 600 seconds, the reminder will arise every Saturday and Sunday, in November and December at 10:20 starting from startDate.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debugging"><a class="anchor" href="#_debugging"></a>18.6.3. Debugging</h4>
<div class="paragraph">
<p>When a card with a reminder set is sent, the log of the "cards-reminder" service will contain a line with the date when the reminder will arise . For example :</p>
</div>
<div class="paragraph">
<p><code>2020-11-22T21:00:36.011Z Reminder Will remind card conferenceAndITIncidentExample.0cf5537b-f0df-4314-f17f-2797ccd8e4e9 at
                         Sun Nov 22 2020 22:55:00 GMT+0100 (heure normale dEurope centrale)</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_email_notifications"><a class="anchor" href="#_email_notifications"></a>19. Email Notifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpFab can send card notifications via email. These notifications are sent when a new card is published for a user, remains unread for a configured period, and the user is not connected to OpFab. The email subject includes the card title, summary, and start and end dates.</p>
</div>
<div class="sect2">
<h3 id="_configuring_email_notifications"><a class="anchor" href="#_configuring_email_notifications"></a>19.1. Configuring Email Notifications</h3>
<div class="paragraph">
<p>Users can enable email notifications in their user settings. They must provide an email address for receiving notifications and select the processes/states they want to be notified about.</p>
</div>
</div>
<div class="sect2">
<h3 id="_email_content"><a class="anchor" href="#_email_content"></a>19.2. Email Content</h3>
<div class="paragraph">
<p>The email body contains a link to the card details in OpFab. In the config.json file containing the state definition, the "emailBodyTemplate" field allows to define a template specific to the email body content.
This template can use handlebars helpers for formatting but can&#8217;t run javascript. If no template is specified, the mail is sent with just the link to the card in the body.</p>
</div>
<div class="paragraph">
<p>A specific handlebars helper <code>deltaToHtml</code> allows to display rich text content from a card containig the 'richMessage' field with the following syntax:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{ deltaToHtml data.richMessage }}}</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure to encapsulate the expression within three curly braces to prevent HTML escaping.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="response_cards"><a class="anchor" href="#response_cards"></a>20. Response cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within your template, you can allow the user to perform some actions (respond to a form, answer a question, &#8230;&#8203;).
The user fills these information and then clicks on a submit button. When he submits this action, a new card is created
and emitted to a third-party tool.</p>
</div>
<div class="paragraph">
<p>This card is called "a child card" as it is attached to the card where the question came from : "the parent card". This
child card is also sent to the users that have received the parent card. From the ui point of view, the information of
the child cards can be integrated in real time in the parent card if configured.</p>
</div>
<div class="paragraph">
<p>The process can be represented as follows :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardSequence.jpg" alt="ResponseCardSequence">
</div>
</div>
<div class="paragraph">
<p>Notice that the response will be associated to the entity and not to the user, i.e the user responds on behalf of his
entity. A user can respond more than one time to a card (a future evolution could add the possibility to limit to one
response per entity).</p>
</div>
<div class="paragraph">
<p>You can view a screenshot of an example of card with responses :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot2.png" alt="ResponseCardScreenshot2">
</div>
</div>
<div class="sect2">
<h3 id="_steps_needed_to_use_a_response_card"><a class="anchor" href="#_steps_needed_to_use_a_response_card"></a>20.1. Steps needed to use a response card</h3>
<div class="sect3">
<h4 id="define_a_third_party_tool"><a class="anchor" href="#define_a_third_party_tool"></a>20.1.1. Define a third party tool</h4>
<div class="paragraph">
<p>The response card is to be received by a third party application for business processing. The third-party application
will receive the card as an HTTP POST request. The card is in json format (the same format as when we send a card).
The field data in the json contains the user response.</p>
</div>
<div class="paragraph">
<p>The url of the third party receiving the response card is to be set in the .yml of the publication service. It is also
possible to configure whether the user token shall be propagated to the third party or not by setting the
"propagateUserToken" boolean property. Here is an example with two third parties configured.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>operatorfabric:
  cards-publication:
    external-recipients:
      recipients:
        - id: "third-party1"
          url: "http://thirdparty1/test1"
          propagateUserToken: true
        - id: "third-party2"
          url: "http://thirdparty2:8090/test2"
          propagateUserToken: false</pre>
</div>
</div>
<div class="paragraph">
<p>The name to use for the third-party is the publisherId of the parent card.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the url, do not use localhost if you run OperatorFabric in a docker, as the publication-service will not be able to
join your third party.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_response_in_config_json"><a class="anchor" href="#_configure_the_response_in_config_json"></a>20.1.2. Configure the response in config.json</h4>
<div class="paragraph">
<p>A card can have a response only if it&#8217;s in a process/state that is configured for. To do that you need to define the
appropriate configuration in the config.json of the concerned process. Here is an example of configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id": "defaultProcess",
  "name": "Test",
  "version": "1",
  "states": {
    "questionState": {
      "name": "question.title",
      "color": "#8bcdcd",
      "response": {
        "state": "responseState",
        "externalRecipients":["externalRecipient1", "externalRecipient2"]
      },
      "templateName": "question",
      "styles": [
        "style"
      ],
      "acknowledgmentAllowed": "Never",
      "showDetailCardHeader" : true
    },
    "responseState": {
      "name" : "response.title",
      "isOnlyAChildState" : true
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We define here a state name "questionState" with a response field. Now, if we send a card with process "defaultProcess"
and state "questionState", the user will have the possibility to respond if he has the required privileges.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field "state" in the response field is used to define the state to use for the response (the child card).</p>
</li>
<li>
<p>The field "externalRecipients" define the recipients of the response card. These recipients are the ids of the objects referenced in
the config file of cards-publication service, in "external-recipients" element. This field is optional.</p>
</li>
<li>
<p>The field "emittingEntityAllowedToRespond" in the response field is used to allow the emitting entity to respond to a card. To be able to respond, however, the emitting entity has to be one of the recipients of the card. Default value is false.</p>
</li>
<li>
<p>The field "showDetailCardHeader" permits to display the card header or not. This header contains the list of entities
that have already responded or not, and a countdown indicating the time remaining to respond, if necessary.</p>
</li>
<li>
<p>The field "isOnlyAChildState" indicates whether the state is only used for child cards or not. If yes, the state
is displayed neither in the feed notification configuration screen nor in archives screen filters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The state to be used for the response can also be set dynamically based on the contents of the card or the
response by returning it in the method registered by <code>opfab.currentCard.registerFunctionToGetUserResponse</code> (see below for details).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_design_the_question_form_in_the_template"><a class="anchor" href="#_design_the_question_form_in_the_template"></a>20.1.3. Design the question form in the template</h4>
<div class="paragraph">
<p>For the user to response you need to define the response form in the template with standard HTML syntax</p>
</div>
<div class="paragraph">
<p>To enable OperatorFabric to send the response, you need to implement a javascript function in your template
which returns an object containing the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>valid (<em>boolean</em>) : true if the user input is valid</p>
</li>
<li>
<p>errorMsg (<em>string</em>) : message in case of invalid user input. If valid is true this field is not necessary.</p>
</li>
<li>
<p>responseCardData (<em>any</em>) : the user input to send in the data field of the child card. If valid is false this field is not necessary.</p>
</li>
<li>
<p>responseState : name of the response state to use. This field is not mandatory, if it is not set the state defined in
<code>config.json</code> will be used for the response.</p>
</li>
<li>
<p>publisher (<em>string</em>) : the id of the Entity to be used as publisher of the response. This field is not mandatory, if it is not set the publisher will be the user entity, in case the user belongs to a single entity, or it will be choosen by the user between his available entities.</p>
</li>
<li>
<p>actions (<em>string array</em>) : an optional field used to define a set of predetermined actions that will be executed upon receiving the response card. The available actions include:</p>
<div class="ulist">
<ul>
<li>
<p>PROPAGATE_READ_ACK_TO_PARENT_CARD : when receiving the child card, the status of the parent card should be considered as 'unread' and 'not acknowledged' until the user reads or acknowledge it again.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method is to be registered via <code>opfab.currentCard.registerFunctionToGetUserResponse</code>, the method will be called by OperatorFabric when the user clicks on the button to send the response.</p>
</div>
<div class="paragraph">
<p>In the example below, the <code>getUserResponse</code> creates a <code>responseCardData</code> object by retrieving the user&#8217;s inputs from the HTML.
In addition, if the user chose several options, it overrides the response state defined in the <code>config.json</code> with another
state.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">  opfab.currentCard.registerFunctionToGetUserResponse(() =&gt; {

    const responseCardData = {};
    const formElement = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">question-form</span><span class="delimiter">'</span></span>);
    <span class="keyword">for</span> (const [key, value] of [... <span class="keyword">new</span> FormData(formElement)]) {
        (key <span class="keyword">in</span> responseCardData) ? responseCardData[key].push(value) : responseCardData[key] = [value];
    }

    const result = {
        <span class="key">valid</span>: <span class="predefined-constant">true</span>,
        <span class="key">responseCardData</span>: responseCardData
    };

      <span class="comment">// If the user chose several options, we decide to move the process to a specific state, for example to ask a follow-up question (what's their preferred option).</span>
    const choiceRequiresFollowUp = Object.entries(responseCardData).length&gt;<span class="integer">1</span>;
    <span class="keyword">if</span>(choiceRequiresFollowUp) result[<span class="string"><span class="delimiter">'</span><span class="content">responseState</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">multipleOptionsResponseState</span><span class="delimiter">'</span></span>;

    <span class="keyword">return</span> result;

    });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_define_permissions"><a class="anchor" href="#_define_permissions"></a>20.1.4. Define permissions</h4>
<div class="paragraph">
<p>To respond to a card a user must have the right privileges, it is done using "perimeters". The user must be in a group
that is attached to a perimeter with  a right "ReceiveAndWrite" for the concerned process/state, the state being the response
state defined in the config.json.</p>
</div>
<div class="paragraph">
<p>Here is an example of definition of a perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterQuestion",
  "process" : "defaultProcess",
  "stateRights" : [
    {
      "state" : "responseState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>To configure it in OperatorFabric , you need to make a POST of this json file to the end point /users/perimeters.</p>
</div>
<div class="paragraph">
<p>To add it to a group name for example "mygroup", you need to make a PATCH request  to endpoint
'users/groups/mygroup/perimeters' with payload ["perimeterQuestion"]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_a_question_card"><a class="anchor" href="#_send_a_question_card"></a>20.2. Send a question card</h3>
<div class="paragraph">
<p>The question card is like a usual card except that you have the field "entitiesAllowedToRespond" to set with the
entities allowed to respond to the card. If the user is not in the entity, he will not be able to respond.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, OperatorFabric considers that if the parent card (question card) is modified, then the child cards
are deleted. If you want to keep the child cards when the parent card is changed, then you must add in the parent
card the field "actions" as a string array containing the "KEEP_CHILD_CARDS" action.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The header in the card details will list the entities from which a response is expected, color-coding them depending
on whether they&#8217;ve already responded (green) or not (orange).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also set the property <code>entitiesRequiredToRespond</code> to differentiate between entities can respond
(<code>entitiesAllowedToRespond</code>) and those who must respond (<code>entitiesRequiredToRespond</code>).
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR","ENTITY3_FR"],
"entitiesRequiredToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>entitiesRequiredToRespond</code> is set and not empty, the card detail header will use this list instead of
<code>entitiesAllowedToRespond</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If set, <code>entitiesRequiredToRespond</code> does not have to be a subset of <code>entitiesAllowedToRespond</code>. To determine
if a user has the right to respond, OperatorFabric consider the union of the two lists.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_child_cards"><a class="anchor" href="#_integrate_child_cards"></a>20.3. Integrate child cards</h3>
<div class="paragraph">
<p>For each user response, a child card containing the response is emitted and stored in OperatorFabric like a normal card. It is not directly visible on the ui but this child card can be integrated in real time to the parent card of all the users watching the card. To do that, you need  some code in the template to process child data:</p>
</div>
<div class="paragraph">
<p>You shall give a reference to a method for processing the child cards via <em>opfab.currentCard.listenToChildCards</em> .</p>
</div>
<div class="paragraph">
<p>The define method shall have an array of child cards as a parameter and  will be called by OperatorFabric when loading the card and every time the list of child cards changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.currentCard.listenToChildCards( (childCards) =&gt; { // process child cards });</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_entity_name"><a class="anchor" href="#_entity_name"></a>20.3.1. Entity name</h4>
<div class="paragraph">
<p>If you want to show the name of an entity that send the response, you need to get the id of the entity via the publisher
field of the child card and then you  can get the name of the entity by calling <em>opfab.users.entities.getEntityName(entityId)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a>20.3.2. Example</h4>
<div class="paragraph">
<p>You can find an example in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lock_mechanism"><a class="anchor" href="#_lock_mechanism"></a>20.4. Lock mechanism</h3>
<div class="paragraph">
<p>When a user has never answered to a response card, the button will be marked as "VALIDATE ANSWER" and the card will be
unlocked.
When the user responds for the first time (and the response succeeds), the button will then be marked as "MODIFY ANSWER"
and the information that the card has been locked can be sent to the third template (see opfab.currentCard.listenToResponseLock in frontend API).</p>
</div>
<div class="paragraph">
<p>Once a user has responded to a response card, its entity status will be considered as "already answered" for this card.
Then all the users having the same entity will be in this status for this card.</p>
</div>
<div class="paragraph">
<p>From there, as soon as they will open this card the button will be marked as "MODIFY ANSWER" and this information (i.e. that this entity has already responded) is accessible to the card template (see opfab.currentCard.isResponseLocked in frontend API).</p>
</div>
<div class="paragraph">
<p>The user can then click on "MODIFY ANSWER" and the button will come back to its initial state ("VALIDATE ANSWER") and the information that the user wants to modify its initial answer can be sent to the card template (see opfab.currentCard.listenToResponseUnlock in frontend API).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user_cards"><a class="anchor" href="#user_cards"></a>21. User cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the <code>Create card</code> menu, the user can send cards to entities. This feature needs to be configured.</p>
</div>
<div class="sect2">
<h3 id="_configure_the_bundle"><a class="anchor" href="#_configure_the_bundle"></a>21.1. Configure the bundle</h3>
<div class="paragraph">
<p>A card is related to a process and a state, if you want users to be able to emit a card for a specific process and
state, you need to define it in the bundle for this process.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"id": "conferenceAndITIncidentExample",
"name": "conferenceAndITIncidentExample.label",
"version": "1",
"states": {
  "messageState": {
    "name": "message.title",
    "userCard" : {
      "template" : "usercard_message",
      "severityVisible" : true,
      "startDateVisible" : true,
      "endDateVisible" : true,
      "expirationDateVisible" : false,
      "lttdVisible" : false,
    },
    "templateName": "message",
    "styles": [],
    "acknowledgmentAllowed": "Always"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the field userCard states that we have a template called <code>usercard_message</code> that defines how
the specific business input fields for this user card will be displayed in the card sending form that will be
presented to the user (through the <code>Create Card</code> menu).</p>
</div>
<div class="paragraph">
<p>This template works the same as templates for card presentation. Here is an example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="opfab-textarea"&gt;
    &lt;label&gt; MESSAGE &lt;/label&gt;
    &lt;textarea id="message" name="message" placeholder="Write something.."
        style="width:100%"&gt; {{card.data.message}} &lt;/textarea&gt;
&lt;/div&gt;


&lt;script&gt;
    opfab.currentCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }
&lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The first part defines the HTML for the business-specific input fields. It should only include the form
fields specific to your process, because the generic fields (like startDate , endDate , severity &#8230;&#8203; ) are presented
by default. It is possible to hide certain generic fields, by setting their visibility to false in the config.json
(for example field <code>severityVisible</code>).</p>
</div>
<div class="paragraph">
<p>Please note that you should use an OpFab css class so the "business-specific" part of the form has the same look and
feel (See
<a href="#opfab_template_style">OperatorFabric Style </a>
for more information)</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be aware that as we have a preview of the card, the application loads the html related to the usercard (build with the
usercard template) and the html related to the card in preview (build with the card template) into the browser at the
same time. This implies that you MUST NOT name the elements with the same names in both templates. This rule applies
to HTML elements identifiers(id), global JavaScript variables and JavaScript function names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the card has been sent, users with the appropriate rights can edit it. If they choose to do so, they&#8217;re presented
with the same input form as for the card creation, but the fields are pre-filled with the current data of the card.
This way, they can only change what they need without having to re-create the card from scratch.
That&#8217;s what the reference to <code>{{card.data.message}}</code> is for. It means that this text-area input field should be filled
with the value of the field <code>message</code> from the card&#8217;s data.</p>
</div>
<div class="paragraph">
<p>The second part is a javascript method you need to implement to allow OperatorFabric to get your specific data .</p>
</div>
<div class="paragraph">
<p>To have a better understanding of this feature, we encourage you to have a look at the examples in the OperatorFabric
core repository under (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles/conferenceAndITIncidentExample">src/test/resources/bundles/conferenceAndITIncidentExample</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_registerfunctiontogetspecificcardinformation"><a class="anchor" href="#_method_registerfunctiontogetspecificcardinformation"></a>21.2. Method registerFunctionToGetSpecificCardInformation</h3>
<div class="paragraph">
<p>The following card fields can be set via the object <code>card</code> in the object returned by method the method register via
registerFunctionToGetSpecificCardInformation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>title</p>
</li>
<li>
<p>summary</p>
</li>
<li>
<p>startDate (epoch date in ms)</p>
</li>
<li>
<p>endDate (epoch date in ms)</p>
</li>
<li>
<p>expirationDate (epoch date in ms)</p>
</li>
<li>
<p>lttd (epoch date in ms)</p>
</li>
<li>
<p>keepChildCards (deprecated, use 'actions' field including "KEEP_CHILD_CARDS" action instead)</p>
</li>
<li>
<p>secondsBeforeTimeSpanForReminder</p>
</li>
<li>
<p>severity (in case it is not visible from the user , when <code>severityVisible</code> set to false in <code>config.json</code>)</p>
</li>
<li>
<p>data</p>
</li>
<li>
<p>entityRecipients</p>
</li>
<li>
<p>entitiesAllowedToEdit</p>
</li>
<li>
<p>entitiesAllowedToRespond</p>
</li>
<li>
<p>entitiesRequiredToRespond</p>
</li>
<li>
<p>externalRecipients (used to send cards to third party , see
<a href="#define_a_third_party_tool">Define a third party tool </a>
for more information).</p>
</li>
<li>
<p>rRule (used to define a card with recurrence, see
<a href="#_using_rrule_field">Using rRule field </a>
for more information).</p>
</li>
<li>
<p>wktGeometry (string)</p>
</li>
<li>
<p>wktProjection (string)</p>
</li>
<li>
<p>actions (list of card actions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you send a card to an ExternalRecipient, when the user delete it, the external recipient will receive the information via an HTTP DELETE request with the id of the deleted card at the end of the request (example : <a href="http://myexternal_app/myendpoint/ID_CARD" class="bare">myexternal_app/myendpoint/ID_CARD</a>).</p>
</div>
<div class="paragraph">
<p>If you want the card to be visible in the calendar feature, you need to set 'timeSpans' field (as array of TimeSpans objects) in the object returned by the method.
You can find an example in the file:
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/taskExample/template/usercard_task.handlebars">src/test/resources/bundles/taskExample/template/usercard_task.handlebars</a>.</p>
</div>
<div class="paragraph">
<p>If not using 'timeSpans' it&#8217;s possible to set the 'viewCardInCalendar' field to true, the card will be visible using card&#8217;s startDate and endDate as default timeSpan.</p>
</div>
<div class="paragraph">
<p>The 'recurrence' field is deprecated and could be removed in the future.</p>
</div>
<div class="paragraph">
<p>If the form is not filled correctly by the user, you can provide an error message (see example above).
Again, have a look to the examples provided.</p>
</div>
</div>
<div class="sect2">
<h3 id="_define_permissions_2"><a class="anchor" href="#_define_permissions_2"></a>21.3. Define permissions</h3>
<div class="paragraph">
<p>To send a user card, the user must be member of a group that has a perimeter defining the right <code>ReceiveAndWrite</code>
or <code>Write</code> for the chosen process and state. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterUserCard",
  "process" : "conferenceAndITIncidentExample",
  "stateRights" : [
    {
      "state" : "messageState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using the <code>ReceiveAndWrite</code> right instead of the <code>Write</code> right allows the user to receive the card they sent and
edit or delete it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="restrict_possible_emitters"><a class="anchor" href="#restrict_possible_emitters"></a>21.4. Restrict the list of possible emitter entities</h3>
<div class="paragraph">
<p>When sending a user card, if the user is member of multiple entities, it is possible to choose the emitter entity from all the available user entities. To limit the list of available emitter entities, it is possible to configure the property <code>publisherList</code> in userCard state definition with the list of allowed publisher entities.
For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"processState": {
      "name": "Process example ",
      "description": "Process state",
      "userCard" : {
        "template" : "usercard_process",
        "expirationDateVisible" : true,
        "publisherList": [{"id":"ENTITY_FR", "levels":[1]},{"id":"IT_SUPERVISOR_ENTITY"}]
      }</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available publisher entities will contain all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect2">
<h3 id="set_recipients_via_code"><a class="anchor" href="#set_recipients_via_code"></a>21.5. Set the list of recipients via the template</h3>
<div class="paragraph">
<p>To do that, you have to provide the list of recipients when returning the card object in the field <code>entityRecipients</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          entityRecipients: ["ENTITY_FR","IT_SUPERVISOR_ENTITY"],
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        }
  });</pre>
</div>
</div>
<div class="paragraph">
<p>When recipient dropdown is not visible to the user (attribute <code>recipientVisible</code> set to <code>false</code> in state definition in config.json) the final recipients list will be the one defined in the template, otherwise it will be the union of user selection and template <code>entityRecipients</code> definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_editing"><a class="anchor" href="#_card_editing"></a>21.6. Card editing</h3>
<div class="paragraph">
<p>Once a user card has been sent it can be edited by a user member of the publisher entity who has write access for the process/state of the card.
It is possible to allow other entities to edit the card by specifying the 'entitiesAllowedToEdit' card field.
It is possible to hide card edit button on UI by setting 'editCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_copy"><a class="anchor" href="#_card_copy"></a>21.7. Card copy</h3>
<div class="paragraph">
<p>A user can copy a card and send it if he has write access for the process/state of the card. Before sending the card, the user can modify it if he wants.
It is possible to hide card copy button on UI by setting 'copyCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_delete"><a class="anchor" href="#_card_delete"></a>21.8. Card delete</h3>
<div class="paragraph">
<p>Once a user card has been sent it can be deleted by a user member of the publisher entity who has write access for the process/state of the card.
It is possible to hide card delete button on UI by setting 'deleteCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_send_response_automatically_experimental_feature"><a class="anchor" href="#_send_response_automatically_experimental_feature"></a>21.9. Send response automatically (experimental feature)</h3>
<div class="paragraph">
<p>It is possible to configure a template to automatically send a response when sending a user card expecting an answers from one of the entities of the emitting user.
The response card will be sent only if the user is enabled to respond to the card.</p>
</div>
<div class="paragraph">
<p>To enable the automated response the template should add a <code>childCard</code> field to the object returned by
 <code>getSpecificCardInformation</code> method. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> &lt;script&gt;
     opfab.currentUserCard.registerFunctionToGetSpecificCardInformation( () =&gt;  {
        const card = {...}

        childCard : {
          summary : {key : "example.summary"},
          title : {key : "example.title"},
          state : "mystateForResponse"
          data : {
                  // specific child  card date
                  }
          };
        ...
        return {
            valid: true,
            card: card,
            childCard: childCard
        };

    });
  &lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The card preview will display the card detail with the automated response as it will be displayed in Feed page.</p>
</div>
<div class="paragraph">
<p>When editing a user card, the template can get the response sent by current user by calling the
<em>opfab.currentUserCard.getUserEntityChildCard</em> function.</p>
</div>
<div class="paragraph">
<p>By default, the publisher of the childCard is the publisher of the parent card. In the template, it is possible to
set another value for the publisher of the childCard, provided that the user is a member of the entity publisher you
want to set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc"><a class="anchor" href="#_misc"></a>21.10. Misc</h3>
<div class="paragraph">
<p>When a user send a card, the card is also sent to the members of the entity that publish the card (and therefore also to
the sender himself), whatever the user chooses in the recipient list.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_in_templates"><a class="anchor" href="#_build_in_templates"></a>22. Build-in templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of coding your own templates for cards or user cards, you can use opfab build-in templates if it suits your needs.</p>
</div>
<div class="sect2">
<h3 id="_message"><a class="anchor" href="#_message"></a>22.1. Message</h3>
<div class="sect3">
<h4 id="_card_template"><a class="anchor" href="#_card_template"></a>22.1.1. Card template</h4>
<div class="paragraph">
<p>If you want to show only a simple message, you can use the message build-in template, to do that just put in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build-in template supposes the message is stored in the card in field <code>data.message</code>.</p>
</div>
<div class="paragraph">
<p>You can change the text header by providing the message-header attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card  message-header=&quot;a new header&quot;&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template"><a class="anchor" href="#_user_card_template"></a>22.1.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card for a simple message, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-usercard&gt; &lt;/opfab-message-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message will be stored in the field <code>data.message</code> of the card</p>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
&lt;&lt;'build-in_templates_common_usercard_attributes,common attributes for user cards'&gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_question"><a class="anchor" href="#_question"></a>22.2. Question</h3>
<div class="sect3">
<h4 id="_card_template_2"><a class="anchor" href="#_card_template_2"></a>22.2.1. Card template</h4>
<div class="paragraph">
<p>If you want to show a question and see user responses, you can use the question build-in template, to do that just put in your handlebar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-card&gt; &lt;/opfab-question-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build-in template supposes the question is stored in the card in the field <code>data.question</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template_2"><a class="anchor" href="#_user_card_template_2"></a>22.2.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card for a simple question, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-usercard&gt; &lt;/opfab-question-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The question will be stored in the field <code>data.question</code> of the card</p>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
&lt;&lt;'build-in_templates_common_usercard_attributes,common attributes for user cards'&gt;&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_message_or_question_list"><a class="anchor" href="#_message_or_question_list"></a>22.3. Message Or Question List</h3>
<div class="sect3">
<h4 id="_card_template_3"><a class="anchor" href="#_card_template_3"></a>22.3.1. Card template</h4>
<div class="paragraph">
<p>If you want to show a message or a question and the answers, you can use the message or question list build-in template, to do that just put in your handlebar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-or-question-list-card&gt; &lt;/opfab-message-or-question-list-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build-in template supposes the message or question is stored in the card in the field <code>data.message</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template_3"><a class="anchor" href="#_user_card_template_3"></a>22.3.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card where you can select a list of messages or questions linked to a json file, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-or-question-list-usercard businessData=&quot;businessDataFileName&quot;&gt; &lt;/opfab-message-or-question-list-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message will be stored in the field <code>data.message</code> of the card
You need to set the json file name with the <code>businessData</code> attribute
If you want to use the template as is, the json file must follow this structure :</p>
</div>
<div class="paragraph">
<p>`{   "possibleRecipients": [
    {"id": "ENTITY1_FR"},
    {"id": "ENTITY2_FR"}
    ],</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"messagesList": [{
    "id": "Warning",
    "title": "Warning about the state of the grid",
    "summary": "Warning about the state of the grid : a problem has been detected",
    "message": "A problem has been detected, please put maintenance work on hold and be on stand by",
    "question": false,
    "severity": "ALARM",
    "publishers":  [
        "ENTITY1_FR",
        "ENTITY2_FR",
        "ENTITY3_FR"
    ]
    "recipients" : [
        "ENTITY1_FR",
        "ENTITY2_FR"
    ]
},
{
    "id": "Confirmation",
    "title": "Confirmation the issues have been fixed",
    "message": "Please confirm the issues in your area have been fixed",
    "question": true,
    "severity": "ACTION",
    "recipients" : [
        "ENTITY1_FR"
    ]
}]</pre>
</div>
</div>
<div class="paragraph">
<p>}`</p>
</div>
<div class="paragraph">
<p>The <code>severity</code> field is optional. If not specified, the card will take a default severity value depending on 'question'
field value : "ACTION" if question is true, "INFORMATION" if question is false.</p>
</div>
<div class="paragraph">
<p>The <code>publishers</code> field is optional. It is used to restrict the possible publishers of the message. If specified, the
message option is available only for the specified entities. If not specified or empty, there are no restrictions.</p>
</div>
<div class="paragraph">
<p>The <code>summary</code> field is optional. If specified, considering 'xxx' is the value of the field, so the summary you will see
in the feed will be 'Message received : xxx'. If not specified, the summary will only be 'Message received'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="build-in_templates_common_usercard_attributes"><a class="anchor" href="#build-in_templates_common_usercard_attributes"></a>22.4. Common attributes for user cards build-in templates</h3>
<div class="paragraph">
<p>For each user card templates, you can set :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entity recipient list</p>
</li>
<li>
<p>The initial selected recipients</p>
</li>
<li>
<p>The entity recipient for information list</p>
</li>
<li>
<p>The initial selected recipients for information</p>
</li>
<li>
<p>The external recipients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-usercard
    entityRecipientList='[{&quot;id&quot;: &quot;ENTITY_FR&quot;, &quot;levels&quot;: [0, 1]}, {&quot;id&quot;: &quot;ENTITY_IT&quot;},{&quot;id&quot;: &quot;IT_SUPERVISOR_ENTITY&quot;}]'
    initialSelectedRecipients='[&quot;ENTITY1_FR&quot;, &quot;ENTITY2_FR&quot;, &quot;ENTITY3_FR&quot;]'
    entityRecipientForInformationList='[{&quot;id&quot;: &quot;ENTITY_FR&quot;, &quot;levels&quot;: [0, 1]},{&quot;id&quot;: &quot;IT_SUPERVISOR_ENTITY&quot;}]'
    initialSelectedRecipientsForInformation='[&quot;ENTITY4_FR&quot;]'
    externalRecipients='[&quot;externalRecipient1&quot;, &quot;externalRecipient2&quot;]'&gt;
&lt;/opfab-message-usercard&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="business_data"><a class="anchor" href="#business_data"></a>23. Business Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the API, it is now possible to store business data and then call it from the templates. This storage system is intended for light documents and should not be treated as a database.</p>
</div>
<div class="sect2">
<h3 id="_pushing_data"><a class="anchor" href="#_pushing_data"></a>23.1. Pushing data</h3>
<div class="paragraph">
<p>It is expected for the data being pushed to be compliant with the <code>json</code> format. The different methods are detailed in the (<a href="https://opfab.github.io/documentation/current/api/businessconfig/#/default/getBusinessData">API documentation</a>). The default limit of file size accepted is 100 MB, it can be updated in the nginx configuation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_a_resource"><a class="anchor" href="#_calling_a_resource"></a>23.2. Calling a resource</h3>
<div class="paragraph">
<p>Once a resource has been stored, it is possible to call it from the template of a card. See in this template (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles/conferenceAndITIncidentExample/template/usercard_incidentInProgress.handlebars">usercard_incidentInProgress.handlebars</a>) how the resource <code>services</code> is called with the method <code>opfab.businessconfig.businessData.get()</code></p>
</div>
<div class="paragraph">
<p>This prevents writing directly in the template&#8217;s code long lists and allows easy data duplication between templates.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frontend_api"><a class="anchor" href="#_frontend_api"></a>24. Frontend API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The frontend API is intended to provide a way for template to communicate with the core opfab code. It&#8217;s divided as follow :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users API : API to get information about users and entities</p>
</li>
<li>
<p>Navigate API : API to ask opfab to navigate to a specific view</p>
</li>
<li>
<p>CurrentCard API : API to get information regarding the current card</p>
</li>
<li>
<p>CurrentUserCard API : API to get information regarding the current user card (card in creation or edition)</p>
</li>
<li>
<p>Utils API : utilities functions</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_users_api"><a class="anchor" href="#_users_api"></a>24.1. Users API</h3>
<div class="sect3">
<h4 id="_entities"><a class="anchor" href="#_entities"></a>24.1.1. Entities</h4>
<div class="paragraph">
<p>Entity object contains the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'id' : id of the entity</p>
</li>
<li>
<p>'name' : name of the entity</p>
</li>
<li>
<p>'description' : description of the entity</p>
</li>
<li>
<p>'parents' : list of parent entities</p>
</li>
<li>
<p>'labels' : list of labels associated to the entity</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_function_getentityname"><a class="anchor" href="#_function_getentityname"></a>24.1.1.1. Function getEntityName</h5>
<div class="paragraph">
<p>Obtain the name of an entity :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const myEntityName = opfab.users.entities.getEntityName('myEntityId');</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_function_getentity"><a class="anchor" href="#_function_getentity"></a>24.1.1.2. Function getEntity</h5>
<div class="paragraph">
<p>Obtain a specific entity :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const myEntity = opfab.users.entities.getEntity('myEntityId');</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_function_getallentities"><a class="anchor" href="#_function_getallentities"></a>24.1.1.3. Function getAllEntities</h5>
<div class="paragraph">
<p>Obtain all entities as an array :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const entities = opfab.users.entities.getAllEntities();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_navigate_api"><a class="anchor" href="#_navigate_api"></a>24.2. Navigate API</h3>
<div class="sect3">
<h4 id="_function_redirecttobusinessmenu"><a class="anchor" href="#_function_redirecttobusinessmenu"></a>24.2.1. Function redirectToBusinessMenu</h4>
<div class="paragraph">
<p>Its possible to redirect the user from a card to a business application declared in ui-menu.json.</p>
</div>
<div class="paragraph">
<p>This can be done by calling the following function from the template :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.navigate.redirectToBusinessMenu(idMenu);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>idMenu is the id of the menu entry defined in ui-menu.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to append a url extension (sub paths and/or parameters) to the url that will be called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.navigate.redirectToBusinessMenu('myMenu','/extension?param1=aParam&amp;param2=anotherParam');</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be useful to pass context from the card to the business application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_showcarddetail"><a class="anchor" href="#_function_showcarddetail"></a>24.2.2. Function showCardDetail</h4>
<div class="paragraph">
<p>It is possible from the template to redirect the user to another "card detail" in feed page</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> opfab.navigation.showCardDetail('cardId');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currentcard_api"><a class="anchor" href="#_currentcard_api"></a>24.3. CurrentCard API</h3>
<div class="sect3">
<h4 id="_function_displayloadingspinner"><a class="anchor" href="#_function_displayloadingspinner"></a>24.3.1. Function displayLoadingSpinner</h4>
<div class="paragraph">
<p>Once the card is loaded, there may be some processing that is time consuming. In this case, it is possible to show a spinner using the method displayLoadingSpinner and hideLoadingSpinner in the card template .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.displayLoadingSpinner();
        // Time consumming code
        ....
        opfab.currentCard.hideLoadingSpinner();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_hideloadingspinner"><a class="anchor" href="#_function_hideloadingspinner"></a>24.3.2. Function hideLoadingSpinner</h4>
<div class="paragraph">
<p>Hide loading spinner previously open with displayLoadingSpinner()</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.hideLoadingSpinner()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getchildcards"><a class="anchor" href="#_function_getchildcards"></a>24.3.3. Function getChildCards</h4>
<div class="literalblock">
<div class="content">
<pre>Returns an array of the child cards. The structure of a child card is the same as the structure of a classic card.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const childCards =  opfab.currentCard.getChildCards();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getcard"><a class="anchor" href="#_function_getcard"></a>24.3.4. Function getCard()</h4>
<div class="paragraph">
<p>You can access the current selected card as a js object using the getCard() method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const currentCard = opfab.currentCard.getCard();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getdisplaycontext"><a class="anchor" href="#_function_getdisplaycontext"></a>24.3.5. Function getDisplayContext</h4>
<div class="paragraph">
<p>To adapt the template content to the display context it is possible to get from OperatorFabric the page context where the template will be rendered by calling the javascript function getDisplayContext(). The function returns a string with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'realtime' : realtime page context (feed, monitoring)</p>
</li>
<li>
<p>'archive' : archive page context</p>
</li>
<li>
<p>'preview': preview context (user card)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const displayContext =  opfab.currentCard.getDisplayContext();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getentitiesallowedtorespond"><a class="anchor" href="#_function_getentitiesallowedtorespond"></a>24.3.6. Function getEntitiesAllowedToRespond</h4>
<div class="paragraph">
<p>If inside your template, you want to get the ids of the entities allowed to send a response, you can call the method getEntitiesAllowedToRespond. This method returns an array containing the ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const entities = opfab.currentCard.getEntitiesAllowedToRespond();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getentityusedforuserresponse"><a class="anchor" href="#_function_getentityusedforuserresponse"></a>24.3.7. Function  getEntityUsedForUserResponse</h4>
<div class="paragraph">
<p>If inside your template, you want to get the id of the entity used by the user to send a response, you can call the method getEntityUsedForUserResponse. This method is deprecated and you should favor the use of the method getEntitiesUsableForUserResponse.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const entity = opfab.currentCard.getEntityUsedForUserResponse()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getentitiesusableforuserresponse"><a class="anchor" href="#_function_getentitiesusableforuserresponse"></a>24.3.8. Function  getEntitiesUsableForUserResponse</h4>
<div class="paragraph">
<p>If inside your template, you want to get the ids of the entities the user can answer on behalf of, you can call the method getEntitiesUsableForUserResponse. This method will return an array containing the entities' ids</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const entities = opfab.currentCard.getEntitiesUsableForUserResponse()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isresponselocked"><a class="anchor" href="#_function_isresponselocked"></a>24.3.9. Function isResponseLocked</h4>
<div class="paragraph">
<p>To know if template is locked (i.e user can not respond unless he unlocks the card)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isResponseLocked =  opfab.currentCard.isResponseLocked()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isuserallowedtorespond"><a class="anchor" href="#_function_isuserallowedtorespond"></a>24.3.10. Function isUserAllowedToRespond</h4>
<div class="paragraph">
<p>The template can know if the current user has the permission to send a response to the current card by calling the isUserAllowedToRespond() function.
An example of usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars">src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isUserAllowed = opfab.currentCard.isUserAllowedToRespond();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isusermemberofanentityrequiredtorespond"><a class="anchor" href="#_function_isusermemberofanentityrequiredtorespond"></a>24.3.11. Function isUserMemberOfAnEntityRequiredToRespond</h4>
<div class="paragraph">
<p>The template can know if the current user is member of an Entity required to respond by calling the isUserMemberOfAnEntityRequiredToRespond function.
An example of usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isUserRequired = opfab.currentCard.isUserMemberOfAnEntityRequiredToRespond()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoresponselock"><a class="anchor" href="#_function_listentoresponselock"></a>24.3.12. Function listenToResponseLock</h4>
<div class="paragraph">
<p>Register a function to be informed when template is locked (i.e user has responded to the current card)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToResponseLock( () =&gt; {// do some stuff});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoresponseunlock"><a class="anchor" href="#_function_listentoresponseunlock"></a>24.3.13. Function listenToResponseUnlock</h4>
<div class="paragraph">
<p>Register a function to be informed when template is unlocked (i.e user has clicked the modify button to prepare a new response)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToResponseUnlock( () =&gt; {// do some stuff}))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentochildcards"><a class="anchor" href="#_function_listentochildcards"></a>24.3.14. Function listenToChildCards</h4>
<div class="paragraph">
<p>Register a function to receive the child cards on card loading and when the childCards list changes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.currentCard.listenToChildCards( (childCards) =&gt; { // process child cards });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentolttdexpired"><a class="anchor" href="#_function_listentolttdexpired"></a>24.3.15. Function listenToLttdExpired</h4>
<div class="paragraph">
<p>If the card has a last time to decide (lttd) configured, when the time is expired this information can be received by the template by registering a listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToLttdExpired( () =&gt; { // do some stuff });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentostylechange"><a class="anchor" href="#_function_listentostylechange"></a>24.3.16. Function listenToStyleChange</h4>
<div class="paragraph">
<p>Card template can be informed when switching day/night mode by registering a listener as follow :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToStyleChange( () =&gt; { // do some stuff });</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used by a template to refresh styles and reload embedded charts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoscreensize"><a class="anchor" href="#_function_listentoscreensize"></a>24.3.17. Function listenToScreenSize</h4>
<div class="paragraph">
<p>To adapt the template content on screen size it is possible to receive from OperatorFabric information on the size of the window where the template will be rendered. To receive screen size information you need to implement a listener function which will receive as input a string parameter with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'md' : medium size window</p>
</li>
<li>
<p>'lg' : large size window</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.listenToScreenSize( (screenSize) =&gt; {
            if (screenSize == 'lg') // do some stuff
            else // do some other stuff
        })</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentotemplaterenderingcomplete"><a class="anchor" href="#_function_listentotemplaterenderingcomplete"></a>24.3.18. Function listenToTemplateRenderingComplete</h4>
<div class="paragraph">
<p>It is possible to be informed when opfab has finished all tasks regarding rendering template by registering a listener function .The function will be called after the call of the other listener (applyChildCard, lockAnswer ,lttdExpired and screenSize)</p>
</div>
<div class="paragraph">
<p>It can be used by a template to launch some processing when loading is complete</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.listenToTemplateRenderingComplete(() =&gt; {// do some stuff})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_registerfunctiontogetuserresponse"><a class="anchor" href="#_function_registerfunctiontogetuserresponse"></a>24.3.19. Function registerFunctionToGetUserResponse</h4>
<div class="paragraph">
<p>Register the template function to call to get user response. This function will be called by opfab when user clicks on the "send reponse" button. More explanation can be found in the <a href="#response_cards">response card chapter</a>.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.registerFunctionToGetUserResponse ( () =&gt;
          {
                const question = document.getElementById('question').value;

                if (question.length &lt;1) return {
                    valid: false,
                    errorMsg : &quot;You must provide a question&quot;
                }

                const card = {
                    summary: { key: &quot;question.summary&quot; },
                    title: { key: &quot;question.title&quot; },
                    severity: &quot;ACTION&quot;,
                    data: {
                        question: question,
                    }
                };
                return {
                    valid: true,
                    card: card,
                    viewCardInCalendar: false
                };

            })</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currentusercard_api"><a class="anchor" href="#_currentusercard_api"></a>24.4. CurrentUserCard API</h3>
<div class="sect3">
<h4 id="_function_geteditionmode"><a class="anchor" href="#_function_geteditionmode"></a>24.4.1. Function getEditionMode</h4>
<div class="paragraph">
<p>The template can know if the user is creating a new card or editing an existing card by calling the <em>opfab.currentUserCard.getEditionMode()</em> function. The function will return one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'CREATE'</p>
</li>
<li>
<p>'EDITION'</p>
</li>
<li>
<p>'COPY'</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const mode = opfab.currentUserCard.getEditionMode();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getenddate"><a class="anchor" href="#_function_getenddate"></a>24.4.2. Function getEndDate</h4>
<div class="paragraph">
<p>The template can know the current endDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getEndDate()</em> function. The function will return a number corresponding to the endDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const endDate = opfab.currentUserCard.getEndDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getexpirationdate"><a class="anchor" href="#_function_getexpirationdate"></a>24.4.3. Function getExpirationDate</h4>
<div class="paragraph">
<p>The template can know the current expirationDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getExpirationDate()</em> function. The function will return a number corresponding to the expirationDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const expirationDate = opfab.currentUserCard.getExpirationDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getlttd"><a class="anchor" href="#_function_getlttd"></a>24.4.4. Function getLttd</h4>
<div class="paragraph">
<p>The template can know the current lttd of the card in creation or edition by calling the <em>opfab.currentUserCard.getLttd()</em> function. The function will return a number corresponding to the lttd as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const lttd = opfab.currentUserCard.getLttd();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getprocessid"><a class="anchor" href="#_function_getprocessid"></a>24.4.5. Function getProcessId</h4>
<div class="paragraph">
<p>The template can know the process id of the card by calling the <em>opfab.currentUserCard.getProcessId()</em>  function. The function will return a string corresponding to the process id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const id = opfab.currentUserCard.getProcessId();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getselectedentityrecipients"><a class="anchor" href="#_function_getselectedentityrecipients"></a>24.4.6. Function getSelectedEntityRecipients</h4>
<div class="paragraph">
<p>The template can know the list of entities selected by the user as recipients of the card by calling the <em>opfab.currentUserCard.getSelectedEntityRecipients()</em> function. The function will return an array of entity ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const recipients = opfab.currentUserCard.getSelectedEntityRecipients();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getselectedentityforinformationrecipients"><a class="anchor" href="#_function_getselectedentityforinformationrecipients"></a>24.4.7. Function getSelectedEntityForInformationRecipients</h4>
<div class="paragraph">
<p>The template can know the list of entities selected by the users as recipients of the card by calling the <em>opfab.currentUserCard.getSelectedEntityForInformationRecipients()</em> function.  The function will return an array of entity ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const recipients = opfab.currentUserCard.getSelectedEntityForInformationRecipients();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getstartdate"><a class="anchor" href="#_function_getstartdate"></a>24.4.8. Function getStartDate</h4>
<div class="paragraph">
<p>The template can know the current startDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getStartDate()</em> function.The function will return a number corresponding to the startDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const startDate = opfab.currentUserCard.getStartDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getstate"><a class="anchor" href="#_function_getstate"></a>24.4.9. Function getState</h4>
<div class="paragraph">
<p>The template can know the state of the card by calling the <em>opfab.currentUserCard.getState()</em> function. The function will return a string corresponding to the state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const state = opfab.currentUserCard.getState();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getuserentitychildcard"><a class="anchor" href="#_function_getuserentitychildcard"></a>24.4.10. Function getUserEntityChildCard</h4>
<div class="paragraph">
<p>When editing a user card, the template can get the response sent by the entity of the current user by calling the <em>opfab.currentUserCard.getUserEntityChildCard()</em> function. The function will return the response child card sent by current user entity or null if there is no response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const card = opfab.currentUserCard.getUserEntityChildCard();</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The method returns only one child card and is therefore not compatible with the fact that the user is in more than one activity area authorized to send the card. In this case, if there is more than one child card, only one will be returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoentityusedforsendingcard"><a class="anchor" href="#_function_listentoentityusedforsendingcard"></a>24.4.11. Function listenToEntityUsedForSendingCard</h4>
<div class="paragraph">
<p>The template can receive the emitter entity of the card by registering a listener function. The function will be called by OperatorFabric after loading the template and every time the card emitter changes (if the user can choose from multiple entities).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentUserCard.listenToEntityUsedForSendingCard((entityId) =&gt; {// do some stuff with the entity id})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_registerfunctiontogetspecificcardinformation"><a class="anchor" href="#_function_registerfunctiontogetspecificcardinformation"></a>24.4.12. Function registerFunctionToGetSpecificCardInformation</h4>
<div class="paragraph">
<p>Register the template function to call to get user card specific information. This function will be called by opfab when user clicks on the "preview" button. More explanation can be found in the <a href="#user_cards">user card chapter</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : &quot;message.summary&quot;},
          title : {key : &quot;message.title&quot;},
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setdropdownentityrecipientlist"><a class="anchor" href="#_function_setdropdownentityrecipientlist"></a>24.4.13. Function setDropdownEntityRecipientList</h4>
<div class="paragraph">
<p>When sending a user card, by default it is possible to choose the recipients from all the available entities. To limit the list of available recipients it is possible to configure the list of possible recipients via javascript in the user template.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setDropdownEntityRecipientList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available recipients will contain: "ENTITY_FR" (level 0), all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setdropdownentityrecipientforinformationlist"><a class="anchor" href="#_function_setdropdownentityrecipientforinformationlist"></a>24.4.14. Function setDropdownEntityRecipientForInformationList</h4>
<div class="paragraph">
<p>When sending a user card, by default it is possible to choose the recipients for information from all the available entities. To limit the list of available recipients it is possible to configure the list of possible recipients via javascript in the user template.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setDropdownEntityRecipientForInformationList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available recipients for information will contain: "ENTITY_FR" (level 0), all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialenddate"><a class="anchor" href="#_function_setinitialenddate"></a>24.4.15. Function setInitialEndDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>endDate</code> by calling  <em>opfab.currentUserCard.setInitialEndDate(endDate)</em> . The endDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const endDate = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialEndDate(endDate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialexpirationdate"><a class="anchor" href="#_function_setinitialexpirationdate"></a>24.4.16. Function setInitialExpirationDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>expirationDate</code> by calling  <em>opfab.currentUserCard.setInitialExpirationDate(expirationDate)</em> . The expirationDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const expirationDate = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialExpirationDate(expirationDate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitiallttd"><a class="anchor" href="#_function_setinitiallttd"></a>24.4.17. Function setInitialLttd</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>lttd</code> by calling  <em>opfab.currentUserCard.setInitialLttd(lttd)</em> . The lttd is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const lttd = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialLttd(lttd);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialselectedrecipients"><a class="anchor" href="#_function_setinitialselectedrecipients"></a>24.4.18. Function setInitialSelectedRecipients</h4>
<div class="paragraph">
<p>It is possible to configure the list of initially selected recipients via javascript in the user template by calling the setInitialSelectedRecipients method. The method takes as input the list of Entity ids to be preselected. The method will work only at template loading time, cannot be used to modify the selected recipients after the template is loaded or in card edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setInitialSelectedRecipients([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialselectedrecipientsforinformation"><a class="anchor" href="#_function_setinitialselectedrecipientsforinformation"></a>24.4.19. Function setInitialSelectedRecipientsForInformation</h4>
<div class="paragraph">
<p>It is possible to configure the list of initially selected recipients for information via javascript in the user template by calling the setInitialSelectedRecipientsForInformation method. The method takes as input the list of Entity ids to be preselected. The method will work only at template loading time, cannot be used to modify the selected recipients after the template is loaded or in card edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setInitialSelectedRecipientsForInformation([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients for information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setselectedrecipients"><a class="anchor" href="#_function_setselectedrecipients"></a>24.4.20. Function setSelectedRecipients</h4>
<div class="paragraph">
<p>It is possible to configure the list of selected recipients via javascript in the user template by calling the setInitialSelectedRecipients method. The method takes as input the list of Entity ids to be preselected. This method can be called at any time and also in edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setSelectedRecipients([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setselectedrecipientsforinformation"><a class="anchor" href="#_function_setselectedrecipientsforinformation"></a>24.4.21. Function setSelectedRecipientsForInformation</h4>
<div class="paragraph">
<p>It is possible to configure the list of selected recipients for information via javascript in the user template by calling the setSelectedRecipientsForInformation method. The method takes as input the list of Entity ids to be selected.  This method can be called at any time and also in edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setSelectedRecipientsForInformation([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients for information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialseverity"><a class="anchor" href="#_function_setinitialseverity"></a>24.4.22. Function setInitialSeverity</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for card severity choice by calling the function <em>setInitialSeverity(severity)</em></p>
</div>
<div class="paragraph">
<p>Allowed severity values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'ALARM'</p>
</li>
<li>
<p>'ACTION'</p>
</li>
<li>
<p>'INFORMATION'</p>
</li>
<li>
<p>'COMPLIANT'</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>       opfab.currentUserCard.setInitialSeverity('ACTION');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialstartdate"><a class="anchor" href="#_function_setinitialstartdate"></a>24.4.23. Function setInitialStartDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial values for <code>startDate</code> by calling  <em>opfab.currentUserCard.setInitialStartDate(startDate)</em> . The startDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const startDate = new Date().valueOf();
        opfab.currentUserCard.setInitialStartDate(startDate);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_utils_api"><a class="anchor" href="#_utils_api"></a>24.5. Utils API</h3>
<div class="sect3">
<h4 id="_function_escapehtml"><a class="anchor" href="#_function_escapehtml"></a>24.5.1. Function escapeHtml</h4>
<div class="paragraph">
<p>To avoid script injection, OperatorFabric provides a utility function 'opfab.utils.escapeHtml()' to sanitize input content by escaping HTML specific characters. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;input id=&quot;input-message&quot; type=&quot;text&quot; name=&quot;message&quot;&gt;
&lt;button onClick=&quot;showMessage()&quot;&gt;

&lt;span id=&quot;safe-message&quot;&gt;&lt;/span&gt;


&lt;script&gt;
  showMessage : function() {
    let msg = document.getElementById(&quot;input-message&quot;);
    document.getElementById(&quot;safe-message&quot;).innerHTML = opfab.utils.escapeHtml(msg.value);
  }

&lt;/script&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archived_cards"><a class="anchor" href="#_archived_cards"></a>25. Archived Cards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_key_concepts"><a class="anchor" href="#_key_concepts"></a>25.1. Key concepts</h3>
<div class="paragraph">
<p>Every time a card is published, in addition to being delivered to the users
and persisted as a "current" card in MongoDB, it is also immediately
persisted in the archived cards.</p>
</div>
<div class="paragraph">
<p>Archived cards are similar in structure to current cards, but they are managed differently.
Current cards are uniquely identified by their id (made up of the publisher and the process id).
That is because if a new card is published with id as an existing card, it will replace it in the
card collection. This way, the current card reflects the current state of a process instance.
In the archived cards collection however, both cards will be kept, so that the archived cards
show all the states that a given process instance went through.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archives_screen_in_the_ui"><a class="anchor" href="#_archives_screen_in_the_ui"></a>25.2. Archives screen in the UI</h3>
<div class="paragraph">
<p>The Archives screen in the UI allows the users to query these archives with different filters.
The layout of this screen is very similar to the Feed screen: the results are displayed in a
(paginated) card list, and the user can display the associated card details by clicking a card in the list.</p>
</div>
<div class="paragraph">
<p>The results of these queries are limited to cards that the user is allowed to see, either :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because this user is direct recipient of the card,</p>
</li>
<li>
<p>because he belongs to a group (or entity) that is a recipient,</p>
</li>
<li>
<p>or because he belongs to a group that has the right to receive the card (via definition of perimeters)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a card is sent to an entity and a group, then this user must be part of both the group and the entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, child cards are not shown in the Archives, only the parent card is shown.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the user is a member of a group that has the <code>VIEW_ALL_ARCHIVED_CARDS</code> permission, the user can
see all archives, whether he is part of the recipients or not, whether he has the right to receive the card or not.
If the user is a member of a group that has the <code>VIEW_ALL_ARCHIVED_CARDS_FOR_USER_PERIMETERS</code> permission, the user
can see all archives for which he has the right to receive it, whether he is part of the recipients or not.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="geomap"><a class="anchor" href="#geomap"></a>26. Geographical map</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The geographical map is a feature that allows you to display the geographical location of cards on a map on the feed screen.</p>
</div>
<div class="paragraph">
<p>To activate the geographical map feature, set the <code>feed.enableMap</code> property to <code>true</code> in the <code>web-ui.json</code> configuration file.</p>
</div>
<div class="paragraph">
<p>The geographical location of the cards is determined by the <code>wktGeometry</code> and <code>wktProjection</code> fields in the card&#8217;s metadata. If a card has a defined <code>wktGeometry</code>, its location will be highlighted on the card. The system supports two geometrical shapes: <code>POINT</code> and <code>POLYGON</code>. A <code>POINT</code> will display as a circle on the map, while a <code>POLYGON</code> will outline the specified area.</p>
</div>
<div class="paragraph">
<p>For instance, to display a circle at a specific location, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POINT (5.8946407 51.9848624)&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>To outline a polygonal area, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POLYGON ((5.5339097 52.0233042,  5.7162495 51.7603784, 5.0036701 51.573684, 4.8339214 52.3547498, 5.5339097 52.0233042))&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specifications of the Well-known Text Representation of coordinate reference systems
can be found at <a href="https://www.ogc.org/standards/wkt-crs">WKT Specification</a>.</p>
</div>
<div class="paragraph">
<p>You can customize the map by setting parameters in the <code>web-ui.json</code> configuration file. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The map uses OpenStreetMap tiles by default, but you can specify different tiles using the <code>feed.geomap.bglayer.xyz</code> parameters.</p>
</li>
<li>
<p>You can add GeoJSON layers to the map using the <code>feed.geomap.layer.geojson</code> parameter in web-ui.json. For each layer it is possible to specify the url and an optional style. The style object can have styling properties for stroke, fill, image, and text styles as defined in OpenLayer flat style (<a href="https://openlayers.org/en/latest/apidoc/module-ol_style_flat.html" class="bare">openlayers.org/en/latest/apidoc/module-ol_style_flat.html</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the
<a href="#ui_properties">web-ui configuration</a>
section for more information and additional customization options.</p>
</div>
<div class="paragraph">
<p>The example configuration references a GeoJSON layer from  Opendata Rseau nergies (<a href="https://odre.opendatasoft.com/" class="bare">odre.opendatasoft.com/</a>) published under open licence v2.0 <a href="https://www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf" class="bare">www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>27. Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The monitoring screen is a realtime view of processes based on current cards received by the user (i.e. the last version of cards visible by the user). It can be seen as another view of the feed.</p>
</div>
<div class="paragraph">
<p>Not all the cards are visible, it depends on the business process they are part of. For a card to be visible in this screen, the parameter <code>uiVisibility.monitoring</code> must be set to <code>true</code> in the config.json file of its process.</p>
</div>
<div class="sect2">
<h3 id="_export_configuration"><a class="anchor" href="#_export_configuration"></a>27.1. Export configuration</h3>
<div class="paragraph">
<p>An Excel export function is available in the monitoring screen, the content of the export can be configured.
To do so, a json file describing the expected output can be sent to the businessconfig service through the /businessconfig/monitoring endpoint.</p>
</div>
<div class="paragraph">
<p>In opfab git repository, you can find in directory <a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/monitoringConfig">src/test/resources/monitoringConfig</a>  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a script to load a monitoring configuration <code>loadMonitoringConfig.sh</code></p>
</li>
<li>
<p>an example of configuration in <code>monitoringConfig.json</code> (for the response fields to be filled , you need to respond to a card question in process messageOrQuestionExample )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A description of the structure of the configuration can be found in
<a href="../api/businessconfig/">the businessconfig api documentation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_process_monitoring"><a class="anchor" href="#_process_monitoring"></a>27.2. Process monitoring</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is experimental
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The process monitoring screen has the following similarities with the monitoring screen :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it is a realtime view of processes based on current cards received by the user
(i.e. the last version of cards visible by the user)</p>
</li>
<li>
<p>not all the cards are visible, it depends on the business process they are part of. For a card to be visible on
this screen, the parameter <code>uiVisibility.processmonitoring</code> must be set to <code>true</code> in the <code>config.json</code> file of its
process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This screen provides the following features :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the columns displayed on this screen can be configured. To do that, you have to define the <code>processMonitoring</code> field
in the <code>web-ui.json</code> configuration file. This object is a list of the fields you want to see in the array.</p>
</li>
<li>
<p>depending on the permissions of the groups to which the user is attached, he can also see the cards he is not the
recipient of.</p>
</li>
<li>
<p>if geographical map view is enabled ('feed.geomap.enableMap' set to 'true' in web-ui.json) it is possible to view the cards on the map by checking the "View Results on a Geographical Map" checkbox.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of processMonitoring configuration :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> &quot;processMonitoring&quot;: [
    {
      &quot;field&quot;: &quot;startDate&quot;,
      &quot;type&quot;: &quot;date&quot;,
      &quot;colName&quot;: &quot;Start Date&quot;,
      &quot;size&quot;: &quot;200&quot;
    },
    {
      &quot;field&quot;: &quot;titleTranslated&quot;,
      &quot;colName&quot;: &quot;Title&quot;,
      &quot;size&quot;: &quot;250&quot;
    },
    {
      &quot;field&quot;: &quot;entityRecipients&quot;,
      &quot;type&quot;: &quot;array&quot;,
      &quot;colName&quot;: &quot;Entity Recipients&quot;,
      &quot;size&quot;: &quot;400&quot;
    },
    {
      &quot;field&quot;: &quot;data.message&quot;,
      &quot;colName&quot;: &quot;My field&quot;,
      &quot;size&quot;: &quot;300&quot;
    },
    {
      &quot;field&quot;: &quot;summaryTranslated&quot;,
      &quot;colName&quot;: &quot;Summary&quot;,
      &quot;size&quot;: &quot;250&quot;
    },
    {
      &quot;field&quot;: &quot;data.error&quot;,
      &quot;colName&quot;: &quot;My second field&quot;,
      &quot;size&quot;: &quot;100&quot;
    }
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the description of the fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"field" : the name of the field in the card (or in the database) you want to display</p>
</li>
<li>
<p>"type" : field type to be used for formatting. Possible values : <code>date</code>, <code>array</code>. Set to <code>date</code> if you want to display a date/time field, set it to <code>array</code> to display an array as a comma separated list.</p>
</li>
<li>
<p>"colName" : name of the column on the UI</p>
</li>
<li>
<p>"size" : size of the column on the UI, proportionally to each other</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="users_management"><a class="anchor" href="#users_management"></a>28. User management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The User service manages users, groups, entities and perimeters (linked to groups).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Users</dt>
<dd>
<p>represent account information for a person destined to receive cards in the OperatorFabric instance.</p>
</dd>
<dt class="hdlist1">Entities</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>can be used to model organizations, for examples : control center, company , department&#8230;&#8203;</p>
</li>
<li>
<p>can be used in a way to handle rights on card reception in OperatorFabric.</p>
</li>
<li>
<p>can be part of another entity (or even several entities). This relationship is modeled using the "parent entity" property</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Groups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>has a set of perimeters to define rights for card reception in OperatorFabric (group type 'PERMISSION').</p>
</li>
<li>
<p>can be used to model roles in organizations (group type 'ROLE'), for examples : supervisor, dispatcher &#8230;&#8203;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The user define here is an internal representation of the individual card recipient in <code>OperatorFabric</code> the authentication is leave to specific OAuth2 external service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is an authentication token currently valid for the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> system.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_users_groups_entities_and_perimeters"><a class="anchor" href="#_users_groups_entities_and_perimeters"></a>28.1. Users, groups, entities and perimeters</h3>
<div class="paragraph">
<p>User service manages users, groups, entities and perimeters.</p>
</div>
<div class="sect3">
<h4 id="_users"><a class="anchor" href="#_users"></a>28.1.1. Users</h4>
<div class="paragraph">
<p>Users are the individuals and mainly physical person who can log in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The access to this service has to be authorized, in the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> instance, at least to access User information and to manage Users. The membership of groups and entities are stored in the user information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User login must be lowercase. Otherwise, it will be converted to lowercase before saving to the database.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Resource identifiers such as login, group id, entity id and perimeter id must only contain the following characters: letters, _, - or digits.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, a user cannot have several sessions at the same time. If you want to enable it, set <code>operatorfabric.checkIfUserIsAlreadyConnected</code> to false in the configuration file of the card consultation service ( cards-consultation-XXX.yml ). However, this is not recommended as it may cause synchronization problems between the sessions using the same login
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_automated_user_creation"><a class="anchor" href="#_automated_user_creation"></a>28.1.1.1. Automated user creation</h5>
<div class="paragraph">
<p>In case of a user does exist in a provided authentication service but he does not exist in the <code>OperatorFabric</code>
instance, when he is authenticated and connected for the first time in the <code>OperatorFabric</code> instance, the user is
automatically created in the system without attached group or entity.
The administration of the groups, entities and perimeters is dealt by the administrator manually.
More details about automated user creation
<a href="#opfab_spec_conf">here</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entities_2"><a class="anchor" href="#_entities_2"></a>28.1.2. Entities</h4>
<div class="paragraph">
<p>The notion of entity is loose and can be used to model organizations structures(examples : control center, company , department&#8230;&#8203; ).
Entities are used to send cards to several users without a name specifically. The information about membership to an
entity is stored in the user&#8217;s data (<code>entities</code> field of the <code>user</code> object). In Entity objects, the <code>parents</code> property (array) expresses the fact that this entity is a part of one or several other entities. This feature allows cards to be sent to a group of entities without having to repeat the detailed list of entities for each card.
The roles attribute allows to set the utility of an entity. It determines if an entity can send or receive cards and if it&#8217;s part of an activity area. This can be useful for a group of entities where only child entities should be used as card publishers while the parent is just a logical group usable as a card recipient. The <code>labels</code> property (array) allows to associate string labels to an Entity object.</p>
</div>
<div class="paragraph">
<p>Examples using entities can be found
<a href="#_send_to_several_users">here</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_permissions"><a class="anchor" href="#_permissions"></a>28.1.3. Permissions</h4>
<div class="paragraph">
<p>Permissions in <code>OperatorFabric</code> are used to configure user&#8217;s permission on the UI and control the access to the APIs.
The information about permissions is stored in the data of the user&#8217;s groups (<code>Permissions</code> field of the <code>group</code> object).
The available permissions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ADMIN</code>: Administrator permission</p>
</li>
<li>
<p><code>ADMIN_BUSINESS_PROCESS</code>: Permission to administer process bundles (add, update, delete bundles)</p>
</li>
<li>
<p><code>VIEW_ALL_ARCHIVED_CARDS</code>: Permission to access all archived cards</p>
</li>
<li>
<p><code>VIEW_ALL_ARCHIVED_CARDS_FOR_USER_PERIMETERS</code>: Permission to access all archived cards which are in the perimeter of the user</p>
</li>
<li>
<p><code>VIEW_ALL_CARDS</code>: Permission to access all cards</p>
</li>
<li>
<p><code>VIEW_ALL_CARDS_FOR_USER_PERIMETERS</code>: Permission to access all cards which are in the perimeter of the user</p>
</li>
<li>
<p><code>READONLY</code>: Readonly permission. User cannot send user cards, cannot respond to a card, when acknowledges a card he does not acknowledge it for his entities.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_groups"><a class="anchor" href="#_groups"></a>28.1.4. Groups</h4>
<div class="paragraph">
<p>The notion of group is loose and can be used to simulate business role in <code>OperatorFabric</code> (examples : supervisor, dispatcher &#8230;&#8203; ) by setting group type to 'ROLE' or to define permissions on processes/states by setting the group type to 'PERMISSION'.
Groups are used to send cards to several users without a name specifically. The information about membership to a
group is stored in the user information. A group contains a list of perimeters which define the rights of reception/writing for a couple process/state. The rules used to send cards are described in the
<a href="#reception_rules">recipients section</a>
.
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_perimeters"><a class="anchor" href="#_perimeters"></a>28.1.5. Perimeters</h4>
<div class="paragraph">
<p>Perimeters are used to define rights for reading/writing cards. A perimeter is composed of an identifier (unique), a process name and a list of state/rights couple.
Possible rights for receiving/writing cards are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receive : the rights for receiving a card</p>
</li>
<li>
<p>Write : the rights for writing a card, that is to say respond to a card or create a new card</p>
</li>
<li>
<p>ReceiveAndWrite : the rights for receiving and writing a card</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_way_to_manage_groups_and_entities"><a class="anchor" href="#_alternative_way_to_manage_groups_and_entities"></a>28.1.6. Alternative way to manage groups and entities</h4>
<div class="paragraph">
<p>The standard way to handle groups and entities in <code>OperatorFabric</code> instance is dealt on the user information.
There is an alternative way to manage groups and entities through the authentication token, the groups and entities are defined by the administrator of the authentication service.
See
<a href="#jwt_mode">here</a>
for more details to use this feature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currently_connected_users"><a class="anchor" href="#_currently_connected_users"></a>28.2. Currently connected users</h3>
<div class="paragraph">
<p>The endPoint <code>/cards/connections</code> gives the list of connected users in real time. It is accessible by all users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_real_time_users"><a class="anchor" href="#_real_time_users"></a>28.3. Real time users</h3>
<div class="paragraph">
<p>OperatorFabric allows you to see which entities/groups are logged in and not logged in. To have this information, you must upload a configuration file, using the endpoint /businessconfig/realtimescreens, via a POST request. In this file, you can configure several screens, each one containing the list of entities/groups you want to see.</p>
</div>
<div class="paragraph">
<p>This interface is accessible via the user menu (top right of the screen).</p>
</div>
<div class="paragraph">
<p>Here is an example of the configuration file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">realTimeScreens</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">All Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_FR</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_IT</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_NL</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">French Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_FR</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Italian Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_IT</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dutch Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_NL</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration file, 4 different screens will be available : "All Control Centers", "French Control Centers", "Italian Control Centers" and "Dutch Control Centers". To associate the entities under each entity group, it is required to label the entity group as a parent of the entities.</p>
</div>
<div class="paragraph">
<p>For example, in the UI, "All Control Centers" will look like :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/realtimescreen_screenshot.png" alt="Real Time Screens screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activity_area"><a class="anchor" href="#_activity_area"></a>28.4. Activity area</h3>
<div class="paragraph">
<p>OperatorFabric allows you to connect/disconnect to/from one or several entity/ies. By default, the user is connected to
all the entities to which he belongs.
By choosing to disconnect from an entity, the user will still be a member of this entity, but he will no longer have
access to the cards intended for this entity, until he reconnects to it.</p>
</div>
<div class="paragraph">
<p>If set visible in ui-menu.json, this interface is accessible via the user menu (top right of the screen).</p>
</div>
<div class="paragraph">
<p>The choice of activity area may be done during user logging phase if you set selectActivityAreaOnLogin to true in web-ui.json.</p>
</div>
<div class="paragraph">
<p>If the user is a member of one (or more) real-time group(s), then he will see on the screen the members of these groups, currently connected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_actions_logs"><a class="anchor" href="#_user_actions_logs"></a>28.5. User actions logs</h3>
<div class="paragraph">
<p>OperatorFabric allows you to view most relevant user actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OPEN_SUBSCRIPTION</p>
</li>
<li>
<p>CLOSE_SUBSCRIPTION</p>
</li>
<li>
<p>ACK_CARD</p>
</li>
<li>
<p>UNACK_CARD</p>
</li>
<li>
<p>READ_CARD</p>
</li>
<li>
<p>UNREAD_CARD</p>
</li>
<li>
<p>SEND_CARD</p>
</li>
<li>
<p>SEND_RESPONSE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each action the following information are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>date</code>: date and time of the action</p>
</li>
<li>
<p><code>action</code>: type of action</p>
</li>
<li>
<p><code>login</code>: username of te user who performed the action</p>
</li>
<li>
<p><code>entities</code>: list of user entities</p>
</li>
<li>
<p><code>cardUid</code>: card Uid</p>
</li>
<li>
<p><code>comment</code>: textual information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, logs older than 61 days are automatically deleted.</p>
</div>
<div class="paragraph">
<p>If set visible in ui-menu.json and user is admin, this interface is accessible via the user menu (top right of the screen).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_customization"><a class="anchor" href="#_ui_customization"></a>29. UI Customization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ui_configuration"><a class="anchor" href="#_ui_configuration"></a>29.1. UI configuration</h3>
<div class="paragraph">
<p>To customize the UI, declare specific parameters in the <code>web-ui.json</code> file as <a href="../deployment/index.html#ui_properties">listed here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="menu_entries"><a class="anchor" href="#menu_entries"></a>29.2. Menu Entries</h3>
<div class="paragraph">
<p>The <code>ui-menu.json</code> file is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To manage the visibility of core OperatorFabric menus (feed, monitoring, etc.)</p>
</li>
<li>
<p>To declare specific business menus to be displayed in the navigation bar of OperatorFabric</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This file contains 4 fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>navigationBar</code> : contains the navigation bar mixing core menus and custom menus</p>
</li>
<li>
<p><code>topRightIconMenus</code> : contains only the two menu icons <code>agenda</code> and <code>usercard</code> on the top right of the screen</p>
</li>
<li>
<p><code>topRightMenus</code> : contains core menus you want to see when you click the user, on the top right of the screen</p>
</li>
<li>
<p><code>locales</code> : contains the translations for the custom menus</p>
</li>
<li>
<p><code>showDropdownMenuEvenIfOnlyOneEntry</code> : indicates if the name of the menu and a dropdown menu are displayed if it
contains only one submenu entry. If false, the submenu entry will be displayed directly in the navigation bar. This field is
optional, the default value is false.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="core_menu_config"><a class="anchor" href="#core_menu_config"></a>29.2.1. Core menus</h4>
<div class="paragraph">
<p>Core menus are objects containing the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>opfabCoreMenuId</code>: Id of the core menu (string)</p>
</li>
<li>
<p><code>visible</code>: Whether this menu should be visible for this OperatorFabric instance (boolean). This field is not
needed in <code>navigationBar</code> field but it is needed in <code>topRightIconMenus</code> and <code>topRightMenus</code>.</p>
</li>
<li>
<p><code>showOnlyForGroups</code> : List of groups for which this menu should be visible (array, optional)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Menu visibility summary</div>
<ul>
<li>
<p>For a core menu with <code>"visible": true</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>showOnlyForGroups</code> is not present, null or an empty array : the menu is visible for all users.</p>
</li>
<li>
<p>If <code>showOnlyForGroups</code> is present and with a non-empty array as a value: menu is visible only for users from the
listed groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. List of core menus and corresponding ids</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Location of menu</th>
<th class="tableblock halign-left valign-top">Menu</th>
<th class="tableblock halign-left valign-top">Id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">Navigation bar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dashboard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Navigation bar (icon)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User card</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock">Top-right menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External devices configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">externaldevicesconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real time users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtimeusers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activity area</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityarea</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feedconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User action logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">useractionlogs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">About</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">about</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Night/Day toggle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nightdaymode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changepassword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <code>/config/docker/ui-menu.json</code> for an example containing all core menus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you decide not to make the night/day toggle visible (globally or for certain users), you should consider
setting the <code>settings.styleWhenNightDayModeDesactivated</code> property in <code>web-ui.json</code> to specify which mode should be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_business_menus"><a class="anchor" href="#_custom_business_menus"></a>29.2.2. Custom business menus</h4>
<div class="paragraph">
<p>A menu can target directly a link or give access to several sub-menus when clicked.
Those sub-menus can target a link or an opfab core menu.
A targeted link can be open in an iframe or in a new tab.</p>
</div>
<div class="paragraph">
<p>Menus support i18n following the i18n OperatorFabric rules.
The ui-menu.json file contains directly the i18n dictionary for the menus.</p>
</div>
<div class="paragraph">
<p>In case of a single menu, the navigation bar displays the l10n of the <code>label</code> of the entry menu.
In this case, the <code>label</code> declared at the root level of the menu is useless and can be omitted (see example below).</p>
</div>
<div class="paragraph">
<p>A single menu or a menu with sub-menus has at least attributes named <code>id</code> and <code>entries</code>.
The <code>entries</code> attribute is an array of <code>menu entry</code>. It is possible to restrict the visibility of one menu entry
to one or more user groups by setting the <code>showOnlyForGroups</code> parameter.
Note that menus with sub-menus need a <code>label</code> declaring an i18n key.</p>
</div>
<div class="paragraph">
<p>A menu entry can target a core menu id or a link. If it targets a link, it must declare the attributes listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>customMenuId</code>: identifier of the entry menu in the UI;</p>
</li>
<li>
<p><code>url</code>: url opening a new page in a tab in the browser;</p>
</li>
<li>
<p><code>label</code>: it&#8217;s an i18n key used to l10n the entry in the UI.</p>
</li>
<li>
<p><code>linkType</code>: Defines how to display business menu links in the navigation bar and how to open them. Possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>TAB</code>: displays only a text link. Clicking it opens the link in a new tab.</p>
</li>
<li>
<p><code>IFRAME</code>: displays only a text link. Clicking it opens the link in an iframe in the main content zone below the navigation bar.</p>
</li>
<li>
<p><code>BOTH</code>: default value. Displays a text link plus a little arrow icon. Clicking the text link opens the link in an iframe while clicking the icon opens in a new tab.
**</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>showOnlyForGroups</code>: Defines the list of user groups entitled to see the menu entry, if not defined or empty it will be visible to every user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, the configuration file declares two additional business menus.
The first has only one entry, which targets a link. The second business menu has three entries, one which targets the
core menu <code>Dashboard</code> and two others which target links.
The sample also contains the 2 top right icons (<code>usercard</code> and <code>calendar</code>), the composition of the top right menu and
the i18n translations in English and French.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">navigationBar</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feed</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">archives</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_0</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.single</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title.multi</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dashboard</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ReadOnly,Dispatcher</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.wikipedia.org/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">topRightIconMenus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">usercard</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">topRightMenus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">activityarea</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feedconfiguration</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">realtimeusers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">externaldevicesconfiguration</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">useractionlogs</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nightdaymode</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">about</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changepassword</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">logout</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">locales</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Single menu entry</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First menu entry</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu entry</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu</span><span class="delimiter">&quot;</span></span>
        }
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier lment</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier lment</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxime lment</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxime menu</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For iframes opened from menu, the associated request uses an extra parameter containing the current theme information.
Named <code>opfab_theme</code>, this parameter has a value corresponding to the current theme: <code>DAY</code> or <code>NIGHT</code>. For example:
<code><a href="http://mysite.com/index.htm?opfab_theme=NIGHT" class="bare">mysite.com/index.htm?opfab_theme=NIGHT</a></code>. Switching theme will trigger reload of open iframes.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supervisor"><a class="anchor" href="#_supervisor"></a>30. Supervisor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Supervisor service can monitor users connections and card acknowledgements to send alert cards when specified conditions are met. To configure the module see <a href="https://github.com/opfab/operatorfabric-core/blob/master/config/docker/node-services.yml">config/docker/node-services.yml</a></p>
</div>
<div class="sect2">
<h3 id="_entities_connection"><a class="anchor" href="#_entities_connection"></a>30.1. Entities connection</h3>
<div class="paragraph">
<p>It is possible to configure supervisor module for monitoring users connections to Opfab to ensure that there is at least one user connected to Opfab for each configured entity. When no user of an entity connects to Opfab for a specified period, supervisor module will send an alert card to the configured recipient entity.</p>
</div>
<div class="paragraph">
<p>The database stores a comprehensive list of supervised entities and their corresponding supervisors. The 'Supervised Entities' admin page offers functionalities to view, modify, add, or delete these entities. Within the supervisor service configuration section, there exists an option to define a default configuration for initial supervised entities. This default configuration applies only when the database&#8217;s supervised entities collection is empty. In such a scenario, the defined configuration will be saved into the database for subsequent use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgement"><a class="anchor" href="#_card_acknowledgement"></a>30.2. Card acknowledgement</h3>
<div class="paragraph">
<p>It is possible to configure supervisor module to monitor card acknowledgements for specific processes/states. When a card of a configured process and state remains not acknowledged for a configured period, supervisor module will send an alert to the card publisher with the list of recipients that did not acknowledge the card.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_devices_service"><a class="anchor" href="#_external_devices_service"></a>31. External Devices Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The external devices service is an optional service allowing OperatorFabric to relay notifications to external
physical devices.</p>
</div>
<div class="sect2">
<h3 id="_specification"><a class="anchor" href="#_specification"></a>31.1. Specification</h3>
<div class="paragraph">
<p>The aim of this section is to describe the initial business need that led to the creation of this service and what use
cases are currently supported.</p>
</div>
<div class="paragraph">
<p>OperatorFabric users already have the option to be notified of a card&#8217;s arrival by a sound played by their browser.
There is a different sound for each severity, and they are configurable for a given instance. The users can decide to
opt out of sound notifications for certain severities.
We also added an option for the sounds to be repeated until the operator interacted with the application (i.e. clicked
anywhere on the page) so as to make them harder to miss.</p>
</div>
<div class="paragraph">
<p>This can be enough for some use cases, but it was not ideal for operators working in control rooms. Indeed, control
rooms each have an external sound system that is shared for the whole room, and existing applications currently
trigger sound alerts on these sound systems rather than on each operator&#8217;s computer.</p>
</div>
<div class="paragraph">
<p>This has several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The sound can be heard by all operators</p>
</li>
<li>
<p>It can be heard even if the operator is not at their desk</p>
</li>
<li>
<p>The sound system can warn that the connection with an application has been lost if it hasn&#8217;t received a "watchdog"
signal for a given period of time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, external devices support in OperatorFabric aims to allow sound notifications to be passed on to external
sound systems. The sound system on which the sound will be played can depend on the user receiving the notification.
For example, all operators working in control room A will have their sounds played on the control room&#8217;s central sound
system, while operators from control room B will use theirs.
Each user can have several external devices configured.</p>
</div>
<div class="paragraph">
<p>So far, only sound systems using the Modbus protocol are supported, but we would like to be able to support other
protocols (and ultimately allow people to supply their own drivers) in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation"><a class="anchor" href="#_implementation"></a>31.2. Implementation</h3>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a>31.2.1. Architecture</h4>
<div class="paragraph">
<p>Given the use case described above, a new service was necessary to act as a link between the OperatorFabric UI and
the external devices. This service is in charge of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing the configuration relative to external devices (see below for details)</p>
</li>
<li>
<p>Process requests from the UI (e.g. "play the sound for ALARM for user operator1_fr") and translate them as requests to
the appropriate device in their supported protocol, based on the above configuration</p>
</li>
<li>
<p>Allow the pool of devices to be managed (connection, disconnection)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This translates as three APIs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ExtDevArchitecture.drawio.png" alt="Architecture diagram">
</div>
</div>
<div class="paragraph">
<p>Here is what happens when user operator1_fr receives a card with severity ALARM:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Angular code, the reception of the card triggers a sound notification.</p>
</li>
<li>
<p>If the external devices feature is enabled and the user has chosen to play sounds on external devices
(instead of the browser), the UI code sends a POST request on the <code>external-devices/notifications</code> endpoint on the
NGINX gateway, with the following payload:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabSignalId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>The NGINX server, acting as a gateway, forwards it to the <code>/notifications</code> endpoint on the External Devices service.</p>
</li>
<li>
<p>The External Devices service queries the configuration repositories to find out which external devices are configured
for operator1_fr, how to connect to them and what signal "ALARM" translates to on these particular devices.</p>
</li>
<li>
<p>It then creates the appropriate connections if they don&#8217;t exist yet, and sends the signal.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>31.2.2. Configuration</h4>
<div class="paragraph">
<p>The following elements need to be configurable:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each user, which devices to use:</p>
<div class="listingblock">
<div class="title">userConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">userLogin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operator1_fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">externalDeviceIds</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</li>
<li>
<p>How to connect to a given external device (host, port)</p>
<div class="listingblock">
<div class="title">deviceConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "isEnabled" field is optional and allows the user to activate or deactivate an external device.
When a device is disabled (isEnabled = false) , OperatorFabric will not send any signal and watchdog to the device.</p>
</div>
<div class="paragraph">
<p>The default value of the "isEnabled" field is true.</p>
</div>
</li>
<li>
<p>How to map an OperatorFabric signal key <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> to a signal (sound, light) on the external system</p>
<div class="listingblock">
<div class="title">signalMapping</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This means that a single physical device allowing 2 different sets of sounds to be played (for example one set for desk
A and another set for desk B) would be represented as two different device configurations, with different ids.</p>
</div>
<div class="listingblock">
<div class="title">Device configurations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
}]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Signal mappings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>
  }
}]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The signalMapping object is built as a Map with String keys (rather than the Severity enum or any otherwise
constrained type) because there is a strong possibility that in the future we might want to map something other than
severities.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the <a href="https://opfab.github.io/documentation/current/api/external-devices/">API documentation</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a <code>Device</code> object distinct from <code>DeviceConfiguration</code> because the latter represents static information
about how to reach a device, while the former contains information about the actual connection.
For example, this is why the device configuration contains a <code>host</code> (which can be a hostname) while the device
has a <code>resolvedAddress</code>.
As a result, they are managed through separate endpoints, which might also make things easier if we need to secure
them differently.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>31.3. Configuration</h3>

</div>
<div class="sect2">
<h3 id="_connection_management"><a class="anchor" href="#_connection_management"></a>31.4. Connection Management</h3>
<div class="paragraph">
<p>OperatorFabric does automatically attempt to connect to enabled configured external devices at startup. If several external devices share the same host and port, only one connection will be open for the external devices and only one watchdog will be sent for the external devices.</p>
</div>
<div class="paragraph">
<p>If an external driver is disconnected, OperatorFabric will try to reconnect it every 10 seconds (default value).</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_management"><a class="anchor" href="#_configuration_management"></a>31.5. Configuration Management</h3>
<div class="paragraph">
<p>In coherence with the way Entities, Perimeters, Users and Groups are managed, SignalMapping, UserConfiguration and
DeviceConfiguration resources can be deleted even if other resources link to them.
For example, if a device configuration lists <code>someMapping</code> as its <code>signalMappingId</code> and a DELETE request is sent
on <code>someMapping</code>, the deletion will be performed and return a 200 Success, and the device will have a <code>null</code>
<code>signalMappingId</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_drivers"><a class="anchor" href="#_drivers"></a>31.6. Drivers</h3>
<div class="paragraph">
<p>This section contains information that is specific to each type of driver. Currently, the only supported driver uses
the <a href="https://en.wikipedia.org/wiki/Modbus">Modbus protocol</a>.</p>
</div>
<div class="sect3">
<h4 id="_modbus_driver"><a class="anchor" href="#_modbus_driver"></a>31.6.1. Modbus Driver</h4>
<div class="paragraph">
<p>The Modbus driver is based on the <a href="https://github.com/kochedykov/jlibmodbus">jlibmodbus</a> library to create a
<code>ModbusMaster</code> for each device and then send requests through it using the
<a href="https://github.com/kochedykov/jlibmodbus/blob/master/src/com/intelligt/modbus/jlibmodbus/msg/request/WriteSingleRegisterRequest.java">WriteSingleRegisterRequest</a>
object.</p>
</div>
<div class="paragraph">
<p>We are currently using the "BROADCAST" mode, which (at least in the jlibmodbus implementation) means that the Modbus
master doesn&#8217;t expect any response to its requests (which makes sense because if there really are several clients
responding to the broadcast, )
This is mitigated by the fact that if watchdog signals are enabled, the external devices will be able to detect that
they are not receiving signals correctly.
In the future, it could be interesting to switch to the TCP default so OperatorFabric can be informed of any exception
in the processing of the request, allowing for example to give a more meaningful connection status
(see <a href="https://github.com/opfab/operatorfabric-core/issues/2294">#2294</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_drivers"><a class="anchor" href="#_adding_new_drivers"></a>31.6.2. Adding new drivers</h4>
<div class="paragraph">
<p>New drivers should implement the <code>ExternalDeviceDriver</code> interface, and a corresponding factory implementing the
<code>ExternalDeviceDriverFactory</code> interface should be created with it.</p>
</div>
<div class="paragraph">
<p>The idea is that in the future, using dependency injection, Spring should be able to pick up any factory on the classpath implementing
the correct interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ExternalDeviceDriver</code>, <code>ExternalDeviceDriverFactory</code> and the accompanying custom exceptions should be made
available as a jar on Maven Central if we want to allow project users to provide their own drivers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If several drivers need to be used on a given OperatorFabric instance at the same time, we will need to introduce
a device type in the deviceConfiguration object.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_applications_integration"><a class="anchor" href="#_external_applications_integration"></a>32. External Applications Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The external web applications can take advantage of OperatorFabric shared stylesheet to style pages and specific components.
The available css classes are detailed in
<a href="#opfab_template_style">OperatorFabric css styles</a></p>
</div>
<div class="paragraph">
<p>To use the shared stylesheet the web application should link the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/shared/css/opfab-application.css</code> : css classes</p>
</li>
<li>
<p><code>/shared/css/opfab-application.js</code> : javascript objects to hande day/night themes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your can find an example of a web page using these resources in the OperatorFabric core repository (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/externalWebAppExample/index.html">src/test/externalWebAppExample/index.html</a>).</p>
</div>
<div class="paragraph">
<p>The example test page can be accessed from OperatorFabric directly at the following url  <code><a href="http://localhost:2002/external/appExample/" class="bare">localhost:2002/external/appExample/</a></code> and also using one of the example business menu entries.</p>
</div>
</div>
</div>
<h1 id="_deployment_and_administration_of_operatorfabric" class="sect0"><a class="anchor" href="#_deployment_and_administration_of_operatorfabric"></a>Deployment and Administration of OperatorFabric</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to explain how to configure and deploy OperatorFabric.
</div>
</div>
<div class="sect1">
<h2 id="_deployment"><a class="anchor" href="#_deployment"></a>33. Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For now OperatorFabric consist of Docker images available either by compiling
the project or by using images releases from <a href="https://hub.docker.com/">Dockerhub</a></p>
</div>
<div class="paragraph">
<p>Service images are all based on <a href="https://hub.docker.com/_/openjdk">openjdk:8-jre-alpine</a>.</p>
</div>
<div class="paragraph">
<p>For simple one instance per service deployment, you can find a sample
deployment as a docker-compose file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/config/docker">here</a></p>
</div>
<div class="paragraph">
<p>To run OperatorFabric in development mode, see
<a href="#dev_env">the development environment documentation</a>
.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_computer"><a class="anchor" href="#_user_computer"></a>34. User computer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From the user perspective, OperatorFabric is compatible with recent versions of chrome, edge and firefox and has no specific hardware performance constraints.</p>
</div>
<div class="paragraph">
<p>Be aware that if you use OperatorFabric in realtime you should prevent user&#8217;s computers to go in "sleep mode".</p>
</div>
<div class="paragraph">
<p>In particular, <strong>if you are using edge have a look to <a href="https://github.com/opfab/operatorfabric-core/issues/2754" class="bare">github.com/opfab/operatorfabric-core/issues/2754</a></strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>35. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration is divided into two parts, the configuration of the business services and the configuration of the UI.</p>
</div>
<div class="paragraph">
<p>Opfab comes with a default embedded configuration, but certain parameters need to be provided and configured.</p>
</div>
<div class="paragraph">
<p>The configuration is centralized in the <strong>config</strong> directory of the GitHub repository. The dev subdirectory contains
configurations specific to development environments, while the <strong>docker</strong> subdirectory contains a specific configuration
meant for use in a full docker environment.</p>
</div>
<div class="sect2">
<h3 id="_business_service_configuration"><a class="anchor" href="#_business_service_configuration"></a>35.1. Business service configuration</h3>
<div class="sect3">
<h4 id="_shared_service_configuration"><a class="anchor" href="#_shared_service_configuration"></a>35.1.1. Shared service configuration</h4>
<div class="paragraph">
<p>The configuration shared by all services is in a yaml file, you can find an example with the file
/config/docker/common.yml.</p>
</div>
<div class="sect4">
<h5 id="_mongo_configuration"><a class="anchor" href="#_mongo_configuration"></a>35.1.1.1. Mongo configuration</h5>
<div class="paragraph">
<p>We only use URI configuration for mongo through the usage of the <code><code>operatorfabric.mongodb.uri</code></code>,
it allows us to share the same configuration behavior for simple or cluster
configuration and with both spring classic and reactive mongo configuration.
See <a href="https://docs.mongodb.com/manual/reference/connection-string/">mongo connection string</a> for the complete URI syntax.</p>
</div>
<div class="paragraph">
<p>This configuration is mandatory (no default configuration is provided).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rabbitmq"><a class="anchor" href="#_rabbitmq"></a>35.1.2. RabbitMQ</h4>
<div class="paragraph">
<p>A rabbitMQ component (docker image) is provided in opfab, it has a default configuration.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SECURITY WARNING : The default user/password should be changed if a rabbit port is exposed outside of docker network. To do that, set the environment variables "RABBITMQ_DEFAULT_USER" and "RABBITMQ_DEFAULT_PASS" when starting the image and adjust the following parameters in the common yml config file.</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.rabbitmq.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ host address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.rabbitmq.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ listen port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.rabbitmq.username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ username</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.rabbitmq.password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RabbitMQ password</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_internal_account"><a class="anchor" href="#_internal_account"></a>35.1.2.1. Internal account</h5>
<div class="paragraph">
<p>The back service cards-reminder ,cards-diffusion and supervision need an internal account to communicate between opfab back services. Therefore, if you intend to utilize any of these services, it is necessary to create an Opfab technical account with ADMIN permissions and configure it</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.internalAccount.login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user account used to call Opfab services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.internalAccount.password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user password to call Opfab services</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The services require knowledge of the URL to retrieve the account&#8217;s token, and this URL should be configured within operatorfabric.servicesUrls.authToken. A default value, based on OperatorFabric default installation, is set to: "http://web-ui/auth/token".</p>
</div>
</div>
<div class="sect4">
<h5 id="_optional_configuration_values"><a class="anchor" href="#_optional_configuration_values"></a>35.1.2.2. Optional configuration values</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.servicesUrls.users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://users:2103" class="bare">users:2103</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates where the Users service can be reached from the other services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.servicesUrls.businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://businessconfig:2100" class="bare">businessconfig:2100</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates where the Business service can be reached from the other services.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.servicesUrls.cardsPublication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://cards-publication:2102" class="bare">cards-publication:2102</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards publication service URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.servicesUrls.cardsConsultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://cards-consultation:2104" class="bare">cards-consultation:2104</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards consultation service URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.servicesUrls.authToken</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://web-ui/auth/token" class="bare">web-ui/auth/token</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication service URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.userActionLogActivated</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_service_specific_configurations"><a class="anchor" href="#_service_specific_configurations"></a>35.1.3. Service specific configurations</h4>
<div class="paragraph">
<p>Each service can have a specific yaml configuration file that can override the default configuration</p>
</div>
<div class="paragraph">
<p>Examples of configuration of each service can be found under config/docker or config/dev .</p>
</div>
<div class="sect4">
<h5 id="_businessconfig_service"><a class="anchor" href="#_businessconfig_service"></a>35.1.3.1. Businessconfig service</h5>
<div class="paragraph">
<p>The businessconfig service has this specific property :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.businessconfig.storage.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/businessconfig-storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File path to data storage folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_users_service"><a class="anchor" href="#_users_service"></a>35.1.3.2. Users service</h5>
<div class="paragraph">
<p>The user service has these specific properties :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.user-settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user settings objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of group objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of entity objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.daysBeforeLogExpiration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">61</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration beyond which user action logs get automatically deleted</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cards-pub-conf"><a class="anchor" href="#cards-pub-conf"></a>35.1.3.3. Cards-publication service</h5>
<div class="paragraph">
<p>The cards publication service has these specific properties :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.checkAuthenticationForCardSending</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If false, OperatorFabric will not require user authentication to send or delete a card via endpoint /cards (it does not concern user cards which always need authentication). Be careful when setting the value to false, nginx conf must be adapted for security reasons (see security warning in <a href="https://github.com/opfab/operatorfabric-core/blob/master/config/docker/nginx.conf">the reference nginx.conf</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.authorizeToSendCardWithInvalidProcessState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, OperatorFabric will allow to publish a card referring a not existent process or state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.checkPerimeterForCardSending</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, OperatorFabric will check user perimeter for card sending via endpoint /cards (it does not concern user cards which are always controlled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.kafka.consumer.group-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, support for receiving cards via Kafka is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.deserializer.value.delegate.class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.confluent.kafka.serializers.
KafkaAvroDeserializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deserializer used to convert the received bytes into objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.serializer.value.delegate.class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.confluent.kafka.serializers.
KafkaAvroSerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializer used to convert cards to bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.kafka.producer.bootstrap-servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9092" class="bare">localhost:9092</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">comma separated list of URL(s) of the broker(s) / bootstrap server(s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.kafka.topics.card.topicname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic to read the messages from</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.kafka.topics.response-card.topicname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic to place the response cards to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.kafka.schema.registry.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8081" class="bare">localhost:8081</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the schema registry. Can be set to the empty string "" is no registry is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.delayForDeleteExpiredCardsScheduling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The delay in millisecond after the last execution finished and the next execution starts.
<a id="cardSendingLimitCardCount"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.cardSendingLimitCardCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the Rate limiter, this defines how many cards can be sent during <code>cardSendingLimitPeriod</code>.
<a id="cardSendingLimitPeriod"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.cardSendingLimitPeriod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the Rate limiter, this defines the time period (in seconds) during which <code>cardSendingLimitCardCount</code> is applied.
<a id="activateCardSendingLimiter"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cards-publication.activateCardSendingLimiter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If false, the Rate limiter will be ignored when sending cards.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_operatorfabric_kafka_configuration"><a class="anchor" href="#_operatorfabric_kafka_configuration"></a>OperatorFabric Kafka configuration</h6>
<div class="paragraph">
<p>Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic. In the default configuration Kafka is disabled.
To enable Kafka you need to set the consumer group to the consumer group you assign to the OpFab Kafka consumer. This can be any group-id, as long as it isn&#8217;t used by other consumers
(unless you explicitly want multiple consumers for the same group).</p>
</div>
<div class="paragraph">
<p>You can set the group_id by uncommenting the <code>kafka.consumer.group_id</code> in the <code>cards-publication.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">opfab-command</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the consumer will consume messages from the <code>opfab</code> topic.
See <a href="https://docs.spring.io/spring-kafka/reference/html/">Spring for Apache Kafka</a> for more information on the Spring Kafka implementation.</p>
</div>
<div class="paragraph">
<p>With the default settings, the Kafka consumer expects a broker running on http//127.0.0.1:9092 and a schema registry on <a href="http://127.0.0.1:8081" class="bare">127.0.0.1:8081</a>.</p>
</div>
<div class="paragraph">
<p>Operator Fabric is also able to publish response cards to a Kafka topic. The default topic name  <code>opfab-response</code>. You can specify which response cards
are to be returned via Kafka by setting the <code>external-recipients</code> in the <code>cards-publication</code> yaml file. Instead of setting <code>http://</code> URL you should set it to <code>kafka:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">external-recipients</span>:
      <span class="key">recipients</span>:
        - <span class="string"><span class="content">id: &quot;processAction&quot;</span></span>
          <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
          <span class="key">propagateUserToken</span>: <span class="string"><span class="content">true</span></span>
        - <span class="string"><span class="content">id: &quot;mykafka&quot;</span></span>
          <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kafka:topicname</span><span class="delimiter">&quot;</span></span>
          <span class="key">propagateUserToken</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>topicname</code> is a placeholder for now. All response cards are returned via the same Kafka response topic, as specified in the <code>opfab.kafka.topics.response-card</code> field.</p>
</div>
<div class="paragraph">
<p>Also note enabling Kafka does not disable the REST interface.</p>
</div>
<div class="paragraph">
<p>Example Kafka configuration plain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">cards-publication</span></span>
  <span class="key">deserializer</span>:
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.consumer.KafkaAvroWithoutRegistryDeserializer</span></span>
  <span class="key">serializer</span>:
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.producer.KafkaAvroWithoutRegistrySerializer</span></span>
  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">OPFAB</span></span>
      <span class="key">properties</span>:
        <span class="key">specific</span>:
          <span class="key">avro</span>:
            <span class="key">reader</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">producer</span>:
      <span class="key">client-id</span>: <span class="string"><span class="content">operatorfabric-producer</span></span>
    <span class="key">bootstrap-servers</span>: <span class="string"><span class="content">kafka-server:9092</span></span>
<span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">kafka</span>:
      <span class="key">topics</span>:
        <span class="key">card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">m_opfab-card-commands_dev</span></span>
        <span class="key">response-card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">m_opfab-card-response_dev</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Kafka configuration SASL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">cards-publication</span></span>
  <span class="key">deserializer</span>:
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.consumer.KafkaAvroWithoutRegistryDeserializer</span></span>
  <span class="key">serializer</span>:
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.producer.KafkaAvroWithoutRegistrySerializer</span></span>
  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">OPFAB</span></span>
      <span class="key">security</span>:
        <span class="key">protocol</span>: <span class="string"><span class="content">SASL_SSL</span></span>
      <span class="key">properties</span>:
        <span class="key">specific</span>:
          <span class="key">avro</span>:
            <span class="key">reader</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">sasl</span>:
          <span class="key">mechanism</span>: <span class="string"><span class="content">SCRAM-SHA-256</span></span>
          <span class="key">jaas</span>:
            <span class="key">config</span>: <span class="string"><span class="content">org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;kafkaUsername&quot; password=&quot;kafkaPassword&quot;;</span></span>
    <span class="key">producer</span>:
      <span class="key">client-id</span>: <span class="string"><span class="content">operatorfabric-producer</span></span>
      <span class="key">security</span>:
        <span class="key">protocol</span>: <span class="string"><span class="content">SASL_SSL</span></span>
      <span class="key">properties</span>:
        <span class="key">sasl</span>:
          <span class="key">mechanism</span>: <span class="string"><span class="content">SCRAM-SHA-256</span></span>
          <span class="key">jaas</span>:
            <span class="key">config</span>: <span class="string"><span class="content">org.apache.kafka.common.security.scram.ScramLoginModule required username=&quot;kafkaUsername&quot; password=&quot;kafkaPassword&quot;;</span></span>
    <span class="key">bootstrap-servers</span>: <span class="string"><span class="content">kafka-server:9094</span></span>
    <span class="key">ssl</span>:
      <span class="key">trust-store-type</span>: <span class="string"><span class="content">PKCS12</span></span>
      <span class="key">trust-store-password</span>: <span class="string"><span class="content">truststorePassword</span></span>
      <span class="key">trust-store-location</span>: <span class="string"><span class="content">file:///etc/truststore.pkcs</span></span>
    <span class="key">properties</span>:
      <span class="key">ssl</span>:
        <span class="key">endpoint</span>:
          <span class="key">identification</span>:
            <span class="key">algorithm</span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
<span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">kafka</span>:
      <span class="key">topics</span>:
        <span class="key">card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab-card-commands</span></span>
        <span class="key">response-card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab-card-response</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Kafka configuration Kerberos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">cards-publication</span></span>
  <span class="key">deserializer</span>:
    <span class="key">key</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.apache.kafka.common.serialization.StringDeserializer</span></span>
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.consumer.KafkaAvroWithoutRegistryDeserializer</span></span>
  <span class="key">serializer</span>:
    <span class="key">value</span>:
      <span class="key">delegate</span>:
        <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.producer.KafkaAvroWithoutRegistrySerializer</span></span>
  <span class="key">kafka</span>:
    <span class="key">security</span>:
      <span class="key">protocol</span>: <span class="string"><span class="content">SASL_SSL</span></span>
    <span class="key">properties</span>:
      <span class="key">sasl.mechanism</span>: <span class="string"><span class="content">GSSAPI</span></span>
      <span class="key">sasl</span>:
        <span class="key">jaas</span>:
          <span class="key">config</span>: <span class="string"><span class="content">com.sun.security.auth.module.Krb5LoginModule required useKeyTab=true keyTab=&quot;/etc/kafkaUsername.keytab&quot; storeKey=true useTicketCache=false serviceName=&quot;kafka&quot; principal=&quot;kafkaUsername@DOMAIN&quot;;</span></span>
    <span class="key">bootstrap-servers</span>: <span class="string"><span class="content">kafka-server:9094</span></span>
    <span class="key">ssl</span>:
      <span class="key">trust-store-type</span>: <span class="string"><span class="content">pkcs12</span></span>
      <span class="key">trust-store-password</span>: <span class="string"><span class="content">truststorePassword</span></span>
      <span class="key">trust-store-location</span>: <span class="string"><span class="content">file:///etc/truststore.pkcs12</span></span>
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">OPFAB</span></span>
      <span class="key">key-deserializer</span>: <span class="string"><span class="content">org.springframework.kafka.support.serializer.ErrorHandlingDeserializer</span></span>
      <span class="key">value-deserializer</span>: <span class="string"><span class="content">org.springframework.kafka.support.serializer.ErrorHandlingDeserializer</span></span>
      <span class="key">properties</span>:
        <span class="key">spring</span>:
          <span class="key">deserializer</span>:
            <span class="key">key</span>:
              <span class="key">delegate</span>:
                <span class="key">class</span>: <span class="string"><span class="content">org.apache.kafka.common.serialization.StringDeserializer</span></span>
            <span class="key">value</span>:
              <span class="key">delegate</span>:
                <span class="key">class</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.consumer.KafkaAvroWithoutRegistryDeserializer</span></span>
    <span class="key">producer</span>:
      <span class="key">client-id</span>: <span class="string"><span class="content">OPFAB</span></span>
      <span class="key">value-serializer</span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.producer.KafkaAvroWithoutRegistrySerializer</span></span>
<span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">kafka</span>:
      <span class="key">topics</span>:
        <span class="key">card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab-card-commands</span></span>
        <span class="key">response-card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab-card-response</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Kafka configuration OAUTHBEARER / AADToken:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">properties</span>:
        <span class="key"><span class="delimiter">&quot;</span><span class="content">[security.protocol]</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">SASL_SSL</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">[sasl.jaas.config]</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required ;</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">[sasl.mechanism]</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">OAUTHBEARER</span></span>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">[sasl.login.callback.handler.class]</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="content">org.opfab.cards.publication.kafka.auth.AADWorkloadIdentityLoginCallbackHandler</span></span>
    <span class="key">producer</span>:
      <span class="error">...the same...</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cards_consultation_service"><a class="anchor" href="#_cards_consultation_service"></a>35.1.3.4. Cards-consultation service</h5>
<div class="paragraph">
<p>The cards-consultation service has these specific properties :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.checkIfUserIsAlreadyConnected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If false, OperatorFabric will allow a user to have several sessions opened at the same time. However, it may cause synchronization problems between the sessions using the same login, so it is recommended to let it true, its default value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.heartbeat.checkIntervalInSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency at which the heartbeat from the ui to the server is checked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.heartbeat.delayInSecondsToConsiderUserDisconnected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After how many seconds without heartbeat, the user is considered disconnected</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="external-devices-conf"><a class="anchor" href="#external-devices-conf"></a>35.1.3.5. External devices service</h5>
<div class="paragraph">
<p>The external devices service can be configured with the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.externaldevices.watchdog.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, watchdog signals will be sent to external devices to show that the OperatorFabric is running and connected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.externaldevices.watchdog.cron</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*/5 * * * * *</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CRON expression determining when watchdog signals should be sent to external devices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.externaldevices.watchdog.signalId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Id of the signal the external devices are expecting as watchdog</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cards-external-diffusion-conf"><a class="anchor" href="#cards-external-diffusion-conf"></a>35.1.3.6. Cards external diffusion service</h5>
<div class="paragraph">
<p>The card external diffusion service can be configured with the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file folder (inside docker container)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"opfab.%DATE%.log"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default log level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.mail.host</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail server host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.mail.port</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail server port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.mail.auth.user</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail server authentication user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.mail.auth.pass</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail server authentication password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.adminPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2106</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Listen port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.activeOnStartup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to start the notification service on startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.mailFrom</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail from address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.dailyEmailTitle</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Cards received during the day'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daily mail subject prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.hourToSendDailyEmail</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hour at which to send the daily recap email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.minuteToSendDailyEmail</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minute at which to send the daily recap email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.subjectPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Opfab card received'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail subject prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.bodyPrefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'You received a card in opfab : '</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail body prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.opfabUrlInMailContent</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Url to write in mail to access the opfab server (example : <a href="https://opfab_url/" class="bare">opfab_url/</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.windowInSecondsForCardSearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">360</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time interval used to query new cards (in seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.secondsAfterPublicationToConsiderCardAsNotRead</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time period after card publication before sending mail notification</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.checkPeriodInSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time interval between consecutive checks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.activateCardsDiffusionRateLimiter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to activate mail sending rate limiting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.sendRateLimit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of mail sent allowed for a single destination in the configured period</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsExternalDiffusion.defaultConfig.sendRateLimitPeriodInSec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time period for rate limiting control</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The parameters in "operatorfabric.cardsExternalDiffusion.defaultConfig" section can be modified at runtime by sending an http POST request to the <code>/config</code> API of cards external diffusion service with a JSON payload containing the config parameters to be changed.</p>
</div>
</div>
<div class="sect4">
<h5 id="cards-reminder-conf"><a class="anchor" href="#cards-reminder-conf"></a>35.1.3.7. Cards reminder service</h5>
<div class="paragraph">
<p>The card reminder service can be configured with the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file folder (inside docker container)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"opfab.%DATE%.log"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default log level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsReminder.adminPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2107</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards reminder service Listen port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsReminder.activeOnStartup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to start the cards reminder service on startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.cardsReminder.checkPeriodInSeconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards reminder time interval between consecutive checks</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="supervisor-conf"><a class="anchor" href="#supervisor-conf"></a>35.1.3.8. Supervisor service</h5>
<div class="paragraph">
<p>The supervisor service can be configured with the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file folder (inside docker container)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"opfab.%DATE%.log"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.logConfig.logLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">info</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default log level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.adminPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2106</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards reminder service Listen port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.activeOnStartup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag to start the cards reminder service on startup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.considerConnectedIfUserInGroups</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set the user must be in one of the mention groups to consider his entities as connected, example :  ["Dispatcher","Planner"]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.entitiesToSupervise</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of entity id and related supervisor list ({ "id": "ENTITY1", "supervisors": ["ENTITY2"] })</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.disconnectedCardTemplate.publisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publisher for card template used to send connections alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.disconnectedCardTemplate.process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supervisor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process for card template used to send connections alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.disconnectedCardTemplate.processVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process version for card template used to send connections alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.disconnectedCardTemplate.state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disconnectedEntity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State for card template used to send connections alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.disconnectedCardTemplate.severity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALARM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity for card template used to send connections alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.secondsBetweenConnectionChecks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection check period</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.nbOfConsecutiveNotConnectedToSendFirstCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of consecutive failed checks before sending first alert card</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.nbOfConsecutiveNotConnectedToSendSecondCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of consecutive failed checks before sending second alert card</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.processesToSupervise</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of processes and related states to monitor for missing acknowledgment ({ "process": "defaultProcess", "states": ["processState"] })</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.unackCardTemplate.publisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Publisher for card template used to send acknowledgment alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.unackCardTemplate.process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supervisor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process for card template used to send acknowledgment alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.unackCardTemplate.processVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process version for card template used to send acknowledgment alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.unackCardTemplate.state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unacknowledgedCards</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State for card template used to send acknowledgment alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.unackCardTemplate.severity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALARM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity for card template used to send acknowledgment alerts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.windowInSecondsForCardSearch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time period used to search for not acknowledged cards</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.secondsBetweenAcknowledgmentChecks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Card acknowledgment check period</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.supervisor.defaultConfig.secondsAfterPublicationToConsiderCardAsNotAcknowledged</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time period to wait after card publishing to consider a card as not acknowledged and send the alert</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The parameters in "operatorfabric.supervisor.defaultConfig" section can be modified at runtime by sending an http POST request to the <code>/config</code> API of supervisor service with a JSON payload containing the config parameters to be changed.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_ui_configuration"><a class="anchor" href="#_web_ui_configuration"></a>35.2. Web UI Configuration</h3>
<div class="paragraph">
<p>OperatorFabric Web UI service is built on top of a <a href="https://www.nginx.com/">NGINX</a> server.
It  serves the Angular SPA to browsers and act as a reverse proxy for other services.</p>
</div>
<div class="sect3">
<h4 id="_nginx_configuration"><a class="anchor" href="#_nginx_configuration"></a>35.2.1. NGINX configuration</h4>
<div class="paragraph">
<p>An external <code>nginx.conf</code> file configures the OperatorFabric Nginx instance named <code>web-ui</code> service.
Those files are mounted as docker volumes. There are two of them in OperatorFabric, one in <code>config/dev</code> and one in <code>config/docker</code>.</p>
</div>
<div class="paragraph">
<p>The one in <code>config/dev</code> is set with
 permissive <code>CORS</code> rules to enable web development using <code>ng serve</code> within the <code>ui/main</code> project.It&#8217;s possible to use <code>ng serve</code> with the one in <code>config/docker</code> version also. To do so use the conf file named
<code>nginx-cors-permissive.conf</code> by configuring the <code>/docker-compose.yml</code> with the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- "./nginx-cors-permissive.conf:/etc/nginx/conf.d/default.conf"</pre>
</div>
</div>
<div class="paragraph">
<p>instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- "./nginx.conf:/etc/nginx/conf.d/default.conf"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The line customized in the nginx configuration file must end with  semicolon (';') otherwise the Nginx server will stop immediately</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ui_properties"><a class="anchor" href="#ui_properties"></a>35.2.2. UI properties</h4>
<div class="paragraph">
<p>The properties lie in the <code>web-ui.json</code>.The following table describes their meaning and  how to use them. An example file can be found in the config/docker directory.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">about</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>no</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Declares application names and their version into web-ui about section.<br>
Each entry is
a free key value followed by its name (a string of characters), its version (a string of characters) and its facultative rank of declaration (a number).<br>
It is not necessary to declare <code>OperatorFabric</code> as application because it is added automatically with current release version and rank <code>0</code>.<br>
For example adding <code>Keycloak</code> application, with <code>'Keycloak'</code> as <code>name</code>, <code>1</code> as <code>rank</code> and  <code>'6.0.1'</code> as <code>version</code> should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">about</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">keycloak</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Keycloak</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">rank</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">6.0.1</span><span class="delimiter">&quot;</span></span>
    }
  }</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alerts.hideBusinessMessages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true, the business alert messages are hidden</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alerts.messageBusinessAutoClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true, the (red) business alert message will automatically close after a few seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alerts.messageOnBottomOfTheScreen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true, the alert message is shown on the bottom of the page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.page.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page size of archive filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.publishDate.days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default search period (days) for publish date filter in archives page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.tags.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags to choose from in the corresponding filter in archives page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.history.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of card history visible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkIfUrlIsLocked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to false, an OperatorFabric url can be used by several tabs in the same browser. Note that there can only be one token per browser for a given OperatorFabric url, so the first session will be replaced by the second one</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultEntryPage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration determines the default page that will be displayed after a user logs in. The possible values include all core menus, with the exception of 'usercard' and 'about'. Additionally, you can set a custom application as the entry page by using 'businessconfigparty/menuId' as the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">environmentColor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of the background of the environment name. The format of color is css, for example : <code>red</code> , <code>#4052FF</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">environmentName</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the environment to display in the top-right corner (examples: PROD , TEST .. ), if the value not set the environment name is not shown .</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalDevicesEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, users have the opportunity to play sounds on external devices rather than in the browser. See <code>settings.playSoundOnExternalDevice</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideAckAllCardsFeature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the option for acknowledging all the visible cards of the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideApplyFiltersToTimeLineChoice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the option of applying filters or not to timeline in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideResponseFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the response filter in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideProcessFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the process filter in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideStateFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the state filter in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.maxNbOfCardsToDisplay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of card visible in feed (This limit is used for performance reasons, setting the value too high can have consequences on browser response times)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.secondsBeforeLttdForClockDisplay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds before lttd when a clock is activated in cards on the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.time.display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUSINESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>card time display mode in the feed. Values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BUSINESS: displays card with entire business period. It is the fallback if the set value is none of the values listed here;</p>
</li>
<li>
<p>BUSINESS_START: displays card with business start date;</p>
</li>
<li>
<p>PUBLICATION: displays card with publication date;</p>
</li>
<li>
<p>LTTD: displays card with lttd date;</p>
</li>
<li>
<p>NONE: nothing displayed.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.titleUpperCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the card titles are in UPPERCASE. (Option applies to the 'Card Feed', 'Archives' and 'Monitoring')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.defaultAcknowledgmentFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"notack"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default card acknowledgment filtering option in feed page, possible values are : "notack", "ack", "all".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.defaultSorting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"unread"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default card sorting option in feed page, possible values are : "unread", "date", "severity", "startDate", "endDate".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.enableGroupedCards</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(Experimental feature)</em>: If true cards with the same tags are grouped together. Clicking on the grouped card will show the other cards with the same tags in the feed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.bglayer.xyz.crossOrigin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom xyz/tiled background layer crossOrigin setting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.bglayer.xyz.tileSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom xyz/tiled background layer tile size (Int value, example: 256. Required when using custom background layer).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.bglayer.xyz.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom xyz/tiled background layer service URL, Replaces OSM background layer (Add endpoint with {x}{y}{z} variables. Example: "https://service.pdok.nl/brt/achtergrondkaart/wmts/v2_0/grijs/EPSG:3857/{z}/{x}/{y}.png".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.defaultDataProjection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPSG:4326</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default data projection of <code>card.wktGeometry</code> to use when no wktProjection is embedded in the card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.enable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>(Experimental feature)</em>: If true a geographical map will be shown and cards that have geographical coordinates will be drawn on the map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.enableGraph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show a graph on the map with number of cards per severity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.highlightPolygonStrokeWidth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the stroke width when highlighting polygon in the geomap view of a card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.initialLatitude</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial latitude of the map when no cards with geographical coordinates are present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.initialLongitude</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial longitude of the map when no cards with geographical coordinates are present.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.initialZoom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial zoom level of the map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.layer.geojson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of GeoJSON layers to add to the map with optional style attribute. The style object can have styling properties for stroke, fill, image, and text styles as defined in OpenLayer flat style (<a href="https://openlayers.org/en/latest/apidoc/module-ol_style_flat.html" class="bare">openlayers.org/en/latest/apidoc/module-ol_style_flat.html</a>). Example: [{"url":"assets/layers/service-area.geojson"},{"url":"https://localhost:8000/network-lines.geojson", "style": {"stroke-color": "blue"}}]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.maxZoom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max zoom level, to prevent zooming in too much when only one card is shown (or multiple cards in close proximity).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.popupContent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">publishDateAndTitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the content of the geomap popup. Possible values are : <code>publishDateAndTitle</code> (default value) or <code>summary</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.zoomDuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds it takes to zoom the map to the specific location. Set to 0 to disable the zoom animation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.geomap.zoomToLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zoom level when zooming to a location of a selected card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.showSearchFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to false, the search filter is hidden.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.timeline.domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">["TR", "J", "7D", "W", "M", "Y"]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of domains to show on the timeline, possible domains are : "TR", "J", "7D", "W", "M", "Y".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heartbeatSendingInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency in seconds at which the ui sends heartbeat to the server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i18n.supported.locales</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported locales (Only fr and en so far)
Values should be taken from the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">TZ database</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.filters.publishDate.days</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default search period (days) for publish date filter in logging page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.filters.tags.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags to choose from in the corresponding filter in logging page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.base64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium OperatorFabric icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encoding result of converting the svg logo to Base64, use this <a href="https://base64.guru/converter/encode/image/svg">online tool</a> to encode your svg. If it is not set, a medium (32px) OperatorFabric icon is displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.height</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The height of the logo (in px) (only taken into account if logo.base64 is set). The value cannot be more than 48px (if it is set to more than 48px, it will be ignored and set to 48px).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The width of the logo (in px) (only taken into account if logo.base64 is set).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secondsToCloseSession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds between logout and token expiration. If you use IMPLICIT authentication mode, exercise caution when modifying the value to prevent logouts before token silent refresh.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.changePasswordUrl</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL to change the user password (if the top-right menu item "Change password" is visible)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.logout-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The keycloak logout URL. Is a composition of:
- Your keycloak instance and the <em>auth</em> keyword (ex: <a href="https://www.keycloakurl.com/auth" class="bare">www.keycloakurl.com/auth</a>), but we also support domains without <em>auth</em> (ex: <a href="https://www.keycloakurl.com/customPath" class="bare">www.keycloakurl.com/customPath</a>)
- The realm name (Ex: dev)
- The redirect URL (<em>redirect_uri</em>): The redirect URL after success authentication</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.flow.delegate-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Url to redirect the browser to for authentication. Mandatory with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE flow: must be the url with protocol choice and version as query parameters;</p>
</li>
<li>
<p>IMPLICIT flow: must be the url part before <code>.well-known/openid-configuration</code> (for example in dev configuration it&#8217;s
<code><a href="http://localhost:89/auth/realms/dev" class="bare">localhost:89/auth/realms/dev</a></code>).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.flow.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>authentication mode, available options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE: Authorization Code Flow;</p>
</li>
<li>
<p>PASSWORD: Direct Password Flow (fallback);</p>
</li>
<li>
<p>IMPLICIT: Implicit Flow.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selectActivityAreaOnLogin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true the users belonging to multiple Entities will be required to configure activity area on login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.dateFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value from the browser configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format for date rendering (example : DD/MM/YYYY )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.dateTimeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value from the browser configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format for date and time rendering (example : HH:mm DD/MM/YYYY )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user locale (use en if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.playSoundForAction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Action cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.playSoundForAlarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Alarm cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.playSoundForCompliant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Compliant cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.playSoundForInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Information cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.playSoundOnExternalDevice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true (and <code>externalDevicesEnabled</code> is set to true as well) and the user has an external device configured, sounds will be played on this device rather than in the browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.remoteLoggingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, some logs from the UI are sent to the back and write in the log file of the cards-consultation service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.replayEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, sounds are replayed every <code>settings.replayInterval</code> seconds until the user interacts with the application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.replayInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval between sound replays (see <code>settings.replayEnabled</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.systemNotificationAction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a system notification is sent when Action cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.systemNotificationAlarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a system notification is sent when Alarm cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.systemNotificationCompliant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a system notification is sent when Compliant cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.systemNotificationInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a system notification is sent when Information cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.styleWhenNightDayModeDesactivated</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Style to apply if not using day night mode, possible value are DAY or NIGHT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.timeFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value from the browser configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format for time rendering (example : HH:mm )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settingsScreen.hiddenSettings</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of string indicating which field(s) we want to hide in the settings screen. Possible values :<br>
"language" : if present, language field will not be displayed<br>
"remoteLoggingEnabled" : if present, the checkbox to activate remote logging will not be displayed<br>
"sounds" : if present, the checkboxes for sound notifications won&#8217;t be displayed<br>
"systemNotifications" : if present, the checkboxes for systemNotifications won&#8217;t be displayed<br>
"sendCardsByEmail"  : if present, the email options won&#8217;t be displayed<br>
"emailToPlainText"  : if present, the email option to have the emails sent as plain text won&#8217;t be displayed
"sendDailyEmail"  : if present, the email option to have the daily email recap won&#8217;t be displayed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">showUserEntitiesOnTopRightOfTheScreen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set to true the users entities will be displayed under the login on top right of the screen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OperatorFabric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Title of the application, displayed on the browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercard.useDescriptionFieldForEntityList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, show entity <code>description</code> field instead of <code>name</code> in user card page</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>IMPORTANT:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>To declare settings parameters, you now need to group all fields under <code>settings: { }</code>
For example:</p>
</div>
<div class="paragraph">
<p>Replace the following invalid settings config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings.replayInterval&quot;: 10,
  &quot;settings.replayEnabled&quot;: true,
  &quot;settings&quot;: {
    &quot;about&quot;: {
      &quot;keycloak&quot;: {
        &quot;name&quot;: &quot;Keycloak&quot;,
        &quot;rank&quot;: 2,
        &quot;version&quot;: &quot;6.0.1&quot;
      },
    }
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>By this valid one :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings&quot;: {
    &quot;replayInterval&quot;: 10,
    &quot;replayEnabled&quot;: true,
    &quot;about&quot;: {
      &quot;keycloak&quot;: {
        &quot;name&quot;: &quot;Keycloak&quot;,
        &quot;rank&quot;: 2,
        &quot;version&quot;: &quot;6.0.1&quot;
      },
    }
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="opfab_spec_conf"><a class="anchor" href="#opfab_spec_conf"></a>35.3. Security Configuration</h3>
<div class="paragraph">
<p>Configure the security concern throughout several files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nginx.conf</code> of the nginx server</p>
</li>
<li>
<p><code>config/docker/common.yml</code> the common configuration file for back services</p>
</li>
<li>
<p><code>web-ui.json</code> served by the <code>web-ui</code> service;</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_authentication_configuration"><a class="anchor" href="#_authentication_configuration"></a>35.3.1. Authentication configuration</h4>
<div class="paragraph">
<p>There are 3 OAuth2 Authentication flows available into OperatorFabric UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>password grant: referred as <code>PASSWORD</code> mode flow;</p>
</li>
<li>
<p>code flow : referred as <code>CODE</code> mode flow;</p>
</li>
<li>
<p>implicit flow: referred as <code>IMPLICIT</code> mode flow.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively there is also another flow available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>none flow: referred as <code>NONE</code> mode flow.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>NONE</code> flow assumes that the application is behind a secured proxy wich handles login and token generation.
Calls to backend services will get a valid token added to the headers and the token will not be visible for the (web)client.</p>
</div>
<div class="sect4">
<h5 id="_nginx_configuration_2"><a class="anchor" href="#_nginx_configuration_2"></a>35.3.1.1. Nginx Configuration</h5>
<div class="paragraph">
<p>The UI calls need some mapping to reach the Authentication Provider. In the default OperatorFabric configuration it&#8217;s a
<code>docker keycloak instance</code>, called <code>keycloak</code> in the project <code>docker-compose.yml</code> files.</p>
</div>
<div class="paragraph">
<p>There are 3 properties to configure within <code>nginx.conf</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$KeycloakBaseUrl</code>: the base url of keycloak;</p>
</li>
<li>
<p><code>$OperatorFabricRealm</code>: the realm configure within keycloak instance to provide authentication to OperatorFabric;</p>
</li>
<li>
<p><code>$ClientPairOFAuthentication</code>: base64 encoded string of the pair of client authentication used by OperatorFabric
to log to the Authentication Provider (keycloak). The cient-id and the client-secret are separated by a colon(':').</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Example of the <code>docker</code> configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Url of the Authentication provider
    set $KeycloakBaseUrl "http://keycloak:89";
# Realm associated to OperatorFabric within the Authentication provider
    set $OperatorFabricRealm "dev";

# base64 encoded pair of authentication in the form of 'client-id:secret-id'
    set $ClientPairOFAuthentication "b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==" ;</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code> is the base64 encoded string of
<code>opfab-client:opfab-keycloak-secret</code> with <code>opfab-client</code> as client-id and <code>opfab-keycloak-secret</code> its client secret.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_file_common_yml"><a class="anchor" href="#_configuration_file_common_yml"></a>35.3.1.2. Configuration file common.yml</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.resourceserver.jwt.jwk-set-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The url providing the certificate used to verify the jwt signature</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.loginClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim used for user login</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>example of <code>common.yml</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">spring</span>:
  <span class="key">security</span>:
    <span class="key">oauth2</span>:
      <span class="key">resourceserver</span>:
        <span class="key">jwt</span>:
          <span class="key">jwk-set-uri</span>:  <span class="string"><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/certs</span></span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_file_web_ui_json"><a class="anchor" href="#_configuration_file_web_ui_json"></a>35.3.1.3. Configuration file web-ui.json</h5>
<div class="paragraph">
<p>Nginx web server serves this file. OperatorFabric creates and uses a custom Docker image containing an Nginx server with a docker volume containing this file. The  docker-compose.yml contains an example of it. The path in the image to it is <code>/usr/share/nginx/html/opfab/web-ui.json</code>.</p>
</div>
<div class="paragraph">
<p>For OAuth2 security concerns into this file, there are two ways to configure it, based on the Oauth2 chosen flow.
There are several common properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.logout-url</code>: url used when a user is logged out of the UI;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code>: url used to connect to the Authentication provider;</p>
</li>
<li>
<p><code>security.oauth2.flow.mode</code>: technical way to be authenticated by the Autentication provider.</p>
</li>
<li>
<p><code>security.oauth2.client-id</code> : the OAuth2 client ID</p>
</li>
<li>
<p><code>security.jwt.login-claim</code> : the field in the token that will be used to identify your account (default value : sub)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2_password_or_code_flows"><a class="anchor" href="#_oauth2_password_or_code_flows"></a>35.3.1.4. OAuth2 PASSWORD or CODE Flows</h5>
<div class="paragraph">
<p>These two modes share the same way of declaring the delegate URL. This has to be defined in web-ui.json by setting :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.oauth2.flow.mode</code> to <code>PASSWORD</code> or <code>CODE</code>;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the protocol used for authentication.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_of_configuration_for_code_flow"><a class="anchor" href="#_example_of_configuration_for_code_flow"></a>Example of Configuration For CODE Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jwt</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">login-claim</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">preferred_username</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">client-id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">OAUTHCLIENTID</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CODE</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">delegate-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client</span><span class="delimiter">&quot;</span></span>
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">logout-url</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property <code>dev</code> is the keycloak client realm of OperatorFabric.
For keycloak instance used for development purposes, this <code>delegate-url</code> correspond to the realm under which the client <code>opfab-client</code> is registred.
Here, the <code>client-id</code> value is <code>opfab-client</code> which is define as client under the <code>realm</code> named <code>dev</code> on the dev keycloak instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2_implicit_flow"><a class="anchor" href="#_oauth2_implicit_flow"></a>35.3.1.5. OAuth2 IMPLICIT Flow</h5>
<div class="paragraph">
<p>It had its own way of configuration.
To enable IMPLICIT Flow authentication the following properties need to be set in web-ui.json:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.oauth2.flow.mode</code> to <code>IMPLICIT</code>;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the <code>.well-known/openid-configuration</code> end-point used for authentication configuration.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_of_configuration_for_implicit_flow"><a class="anchor" href="#_example_of_configuration_for_implicit_flow"></a>Example of configuration for IMPLICIT Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">jwt</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">login-claim</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">preferred_username</span><span class="delimiter">&quot;</span></span>
      },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">client-id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">OAUTHCLIENTID</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">IMPLICIT</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">delegate-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev</span><span class="delimiter">&quot;</span></span>
      }
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logout-url</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/</span><span class="delimiter">&quot;</span></span>,
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property <code>dev</code> is the keycloak client realm of OperatorFabric.
For keycloak instance used for development purposes, this <code>delegate-url</code> correspond to the realm under which the client <code>opfab-client</code> is registred.
The url look up by the implicit ui mechanism is <code><a href="http://localhost:89/auth/realms/dev/.well-known/openid-configuration" class="bare">localhost:89/auth/realms/dev/.well-known/openid-configuration</a></code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_none_flow"><a class="anchor" href="#_none_flow"></a>35.3.1.6. NONE Flow</h5>
<div class="paragraph">
<p>The configuration for the NONE flow is a bit different because the token isn&#8217;t handled/visible in the front-end.</p>
</div>
<div class="sect5">
<h6 id="_nginx"><a class="anchor" href="#_nginx"></a>Nginx</h6>
<div class="paragraph">
<p>The following variables can be removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$KeycloakBaseUrl</code></p>
</li>
<li>
<p><code>$OperatorFabricRealm</code></p>
</li>
<li>
<p><code>$ClientPairOFAuthentication</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The locations for handling tokens can be edited to return a 401 by default.
If one of these locations is called, the token generated by the secured proxy has expired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="config">location /auth/check_token {
  return 401;
}
location /auth/token {
  return 401;
}
location /auth/code/ {
  return 401;
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_web_ui_json"><a class="anchor" href="#_web_ui_json"></a>Web-ui.json</h6>
<div class="paragraph">
<p>Set the security.oauth2.flow.mode to <code>NONE</code>;</p>
</div>
<div class="paragraph">
<p>Set the security.oauth2.client-id to <code>Your Oauth client ID</code>;</p>
</div>
<div class="paragraph">
<p>Use the security.jwt.login-claim to select value from the token will be used to identify your account. In this example <code>preferred_username</code> is used;</p>
</div>
<div class="paragraph">
<p>Settings that are not required are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delegate-url</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_of_configuration"><a class="anchor" href="#_example_of_configuration"></a>Example of configuration</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">jwt</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">login-claim</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">preferred_username</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">client-id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">OAUTHCLIENTID</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">logout-url</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://my-secured-proxy/OAUTHTENANTID/oauth2/logout?client_id=OAUTHCLIENTID&amp;post_logout_redirect_uri=https%3A%2F%2Flocalhost:2002%2Fui%2Fui/</span><span class="delimiter">&quot;</span></span>
    }
 }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_creation"><a class="anchor" href="#_user_creation"></a>35.3.2. User creation</h4>
<div class="paragraph">
<p>If a user exists in the authentication system but not in Opfab, their profile will be automatically created upon their initial login. The user&#8217;s name and family name will be extracted from the authentication token.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.givenNameClaim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">given-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim to use to get the user&#8217;s name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.familyName-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">family-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim to used to get the user&#8217;s family name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="jwt_mode"><a class="anchor" href="#jwt_mode"></a>35.3.3. Alternative way to manage groups (and/or entities)</h4>
<div class="paragraph">
<p>By default, <code>OperatorFabric</code> manages groups (and/or entities) through the user's collection in the database.
Another mode can be defined, the JWT mode. The groups (and/or entities) come from the authentication token.</p>
</div>
<div class="paragraph">
<p>To activate this option , you need to set some parameter in the common.yml file :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPERATOR_FABRIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the group mode, possible values JWT or OPERATOR_FABRIC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandard.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardArray.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines an array of groups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.separator</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the separator value of the list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to check if that path does exist, if it does, use the roleValue as a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.roleValue</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the value of the group if the path exists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.entitiesIdClaim</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the name of the field in the token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.gettingEntitiesFromToken</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean indicating if you want the entities of the user to come from the token and not mongoDB (possible values : true/false)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>operatorfabric:
  security:
    jwt:
      entitiesIdClaim: entitiesId
      gettingEntitiesFromToken: true
      groups:
        mode: JWT # value possible JWT | OPERATOR_FABRIC
        rolesClaim:
          rolesClaimStandard:
            - path: &quot;ATTR1&quot;
            - path: &quot;ATTR2&quot;            
          rolesClaimStandardArray:  
            - path: &quot;resource_access/opfab-client/roles&quot;
          rolesClaimStandardList:  
            - path: &quot;roleFieldList&quot; 
              separator: &quot;;&quot;           
          rolesClaimCheckExistPath: 
            - path: &quot;resource_access/AAA&quot; 
              roleValue: &quot;roleAAA&quot;      
            - path: &quot;resource_access/BBB&quot;
              roleValue: &quot;roleBBB&quot;  </code></pre>
</div>
</div>
<div class="paragraph">
<p><em>JWT example</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
  &quot;jti&quot;: &quot;5ff87583-10bd-4946-8753-9d58171c8b7f&quot;,
  &quot;exp&quot;: 1572979628,
  &quot;nbf&quot;: 0,
  &quot;iat&quot;: 1572961628,
  &quot;iss&quot;: &quot;http://localhost:89/auth/realms/dev&quot;,
  &quot;aud&quot;: [
    &quot;AAA&quot;,
    &quot;BBB&quot;,
    &quot;account&quot;
  ],
  &quot;sub&quot;: &quot;example_user&quot;,
  &quot;typ&quot;: &quot;Bearer&quot;,
  &quot;azp&quot;: &quot;opfab-client&quot;,
  &quot;auth_time&quot;: 0,
  &quot;session_state&quot;: &quot;960cbec4-fcb2-47f2-a155-975832e61300&quot;,
  &quot;acr&quot;: &quot;1&quot;,
  &quot;realm_access&quot;: {
    &quot;roles&quot;: [
      &quot;offline_access&quot;,
      &quot;uma_authorization&quot;
    ]
  },
  &quot;resource_access&quot;: {
    &quot;AAA&quot;: {
      &quot;roles&quot;: [
        &quot;role_AAA&quot;
      ]
    },
    &quot;BBB&quot;: {
      &quot;roles&quot;: [
        &quot;role_BBB&quot;
      ]
    },
    &quot;opfab-client&quot;: {
      &quot;roles&quot;: [
        &quot;USER&quot;
      ]
    },
    &quot;account&quot;: {
      &quot;roles&quot;: [
        &quot;manage-account&quot;,
        &quot;manage-account-links&quot;,
        &quot;view-profile&quot;
      ]
    }
  },
  &quot;scope&quot;: &quot;openid ATTR2 email ATTR1 profile roleFieldList&quot;,
  &quot;email_verified&quot;: false,
  &quot;name&quot;: &quot;example_firtstname example_lastname&quot;,
  &quot;ATTR2&quot;: &quot;roleATTR2&quot;,
  &quot;ATTR1&quot;: &quot;roleATTR1&quot;,
  &quot;preferred_username&quot;: &quot;example_user&quot;,
  &quot;given_name&quot;: &quot;example_firtstname&quot;,
  &quot;entitiesId&quot;: &quot;ENTITY1&quot;,
  &quot;family_name&quot;: &quot;example_lastname&quot;,
  &quot;email&quot;: &quot;example_user@mail.com&quot;,
  &quot;roleFieldList&quot;: &quot;roleA;roleB;roleC&quot;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the result, the group will be [ATTR1, ATTR2, roleA, roleB, roleC, USER, roleBBB, roleAAA]</p>
</div>
</div>
<div class="sect3">
<h4 id="custom_certificates"><a class="anchor" href="#custom_certificates"></a>35.3.4. Adding certification authorities or certificates to the Java keystore</h4>
<div class="paragraph">
<p>If you&#8217;re using certificates (for example for Keycloak) that are not from a certification authority trusted by the JVM,
this will cause errors such as this one:</p>
</div>
<div class="listingblock">
<div class="title">Missing certificate error message</div>
<div class="content">
<pre>Caused by: sun.security.validator. ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to
requested target
at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:397)
at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:302)
at sun.security.validator.Validator.validate(Validator.java:262)
at sun.security.ssl.X509TrustManager Impl.validate(x509TrustManagerImpl.java:330)
at sun.security.ssl.X509TrustManagerImpl.checkTrusted(x509TrustManagerImpl.java:237)
at sun.security.ssl.X509TrustManager Impl.checkServerTrusted(x509TrustManager Impl.java:132)
at sun.security.ssl.clientHandshaker.serverCertificate(ClientHandshaker.java:1621)
94 common frames omitted
Caused by: sun.security.provider.certpath. SunCertPathBuilderException: unable to find valid certification path to requested target
at sun.security.provider.certpath. SunCertPathBuilder.build(SunCertPathBuilder.java:141)
at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:126)
at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:280)
at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:392)
... 100 common frames omitted</pre>
</div>
</div>
<div class="paragraph">
<p>If that is the case, you can pass the additional authorities or certificates that you use to the containers at runtime.</p>
</div>
<div class="paragraph">
<p>To do so, put the relevant files (*.der files for example) under <strong>src/main/docker/certificates</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This directory should only contain the files to be added to the keystore.</p>
</li>
<li>
<p>The files can be nested inside directories.</p>
</li>
<li>
<p>Each certificate will be added with its filename as alias. For example, the certificate in file mycertificate.der
will be added under alias <strong>mycertificate</strong>. As a consequence, filenames should be unique or it will cause an error.</p>
</li>
<li>
<p>If you need to add or remove certificates while the container is already running, the container will have to be
restarted for the changes to be taken into account.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you would like certificates to be sourced from a different location, replace the volumes declarations in the deploy
docker-compose.yml file with the selected location:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>volumes:
 - "path/to/my/selected/location:/certificates_to_add"</pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="literalblock">
<div class="content">
<pre>volumes:
 - "../../../../src/main/docker/certificates:/certificates_to_add"</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The steps described here assume you&#8217;re running OperatorFabric in docker mode using the deploy docker-compose,
but they can be adapted for single container deployments and development mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to check that the certificates were correctly added, you can do so with the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a bash shell in the container you want to check</p>
<div class="literalblock">
<div class="content">
<pre>docker exec -it deploy_businessconfig_1 bash</pre>
</div>
</div>
</li>
<li>
<p>Run the following command</p>
<div class="literalblock">
<div class="content">
<pre>$JAVA_HOME/bin/keytool -list -v -keystore /tmp/cacerts -storepass changeit</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also look at the default list of authorities and certificates trusted by the JVM with this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$JAVA_HOME/bin/keytool -list -v -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ip_address_control"><a class="anchor" href="#_ip_address_control"></a>35.3.5. IP address control</h4>
<div class="paragraph">
<p>For each user it is possible to configure a list of authorized source ip addresses by setting the <code>authorizedIPAddresses</code> field in User object.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_2"><a class="anchor" href="#_monitoring_2"></a>36. Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operator Fabric provides end points for monitoring via <a href="https://prometheus.io/">prometheus</a>. The monitoring is available for the five following services: user, businessconfig, cards-consultation, cards-publication and external-devices.  To enable the monitoring , you need to open the endpoint by adding in the common yml configuration file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>management:
  endpoints:
    web:
      exposure:
        include: '*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start a test prometheus instance via <code>config/monitoring/startPrometheus.sh</code> , the monitoring will be accessible on <a href="http://localhost:9090/" class="bare">localhost:9090/</a></p>
</div>
<div class="paragraph">
<p>It is also possible to monitor the health status of cards-external-diffusion, cards-reminder and supervisor services by making an HTTP GET request to the "/healthcheck" endpoint exposed by each service. The healthcheck endpoint will return a HTTP 200 status code if the service is up and running.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logging_administration"><a class="anchor" href="#_logging_administration"></a>37. Logging Administration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_logging_configuration"><a class="anchor" href="#_logging_configuration"></a>37.1. Logging configuration</h3>
<div class="paragraph">
<p>Log levels can be defined either globally in the YAML configuration file or individually for each service. You will find a commented configuration for each service within the directory config/docker.</p>
</div>
<div class="paragraph">
<p>Services are designed to write logs to two primary destinations: standard output and log files within the Docker containers.</p>
</div>
<div class="paragraph">
<p>If you want to save logs you can redirect the standard output to a file.</p>
</div>
<div class="paragraph">
<p>Or you can also map the Docker directory /var/log/opfab to a location on the host machine for each business services, keeping logs outside of the container.</p>
</div>
<div class="paragraph">
<p>For the web-ui service&#8217;s logs are in the /var/log/nginx directory. You can map this directory to the host to preserve those logs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_configuration"><a class="anchor" href="#_runtime_configuration"></a>37.2. Runtime configuration</h3>
<div class="paragraph">
<p>Operator Fabric includes the ability to view and configure the log levels at runtime through APIs for most of the business services. It is possible to configure and view an individual logger configuration, which is made up of both the explicitly configured logging level as well as the effective logging level given to it by the logging framework.</p>
</div>
<div class="paragraph">
<p>Querying and setting logging levels is restricted to administrators.</p>
</div>
<div class="sect3">
<h4 id="_java_services"><a class="anchor" href="#_java_services"></a>37.2.1. Java services</h4>
<div class="paragraph">
<p>For java services (user, businessconfig, cards-consultation, cards-publication and external-devices) the available logging levels are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TRACE</p>
</li>
<li>
<p>DEBUG</p>
</li>
<li>
<p>INFO</p>
</li>
<li>
<p>WARN</p>
</li>
<li>
<p>ERROR</p>
</li>
<li>
<p>FATAL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view the configured logging level for a given logger it is possible to send a GET request to the '/actuator/logger' URI as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://&lt;server&gt;:&lt;port&gt;/actuator/loggers/${logger} -H "Authorization: Bearer ${token}" -H "Content-type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid OAuth2 JWT for a user with administration privileges
and <code>${logger}</code> is the logger (ex: org.opfab)</p>
</div>
<div class="paragraph">
<p>The response will be a json object like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
  "configuredLevel" : "INFO",
  "effectiveLevel" : "INFO"
}</pre>
</div>
</div>
<div class="paragraph">
<p>To get the log level for ROOT logger of a service it is possible to call the provided script
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/logs/getLogs.sh">src/test/resources/logs/getLogs.sh</a> as follows: <code>getLogs.sh &lt;server:port&gt; &lt;user&gt; &lt;opfab_url&gt;</code>. For example to get the current log level for "card-publication" service  execute: <code>getLogs.sh localhost:2102 admin <a href="http://localhost" class="bare">localhost</a></code></p>
</div>
<div class="paragraph">
<p>To configure a given logger, POST a json entity to the '/actuator/logger' URI, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -i -X POST http://&lt;server&gt;:&lt;port&gt;/actuator/loggers/${logger} -H "Authorization: Bearer ${token}" -H 'Content-Type: application/json' -d '{"configuredLevel": "DEBUG"}'</pre>
</div>
</div>
<div class="paragraph">
<p>To reset the specific level of the logger (and use the default configuration instead) it is possible to pass a value of null as the configuredLevel.</p>
</div>
<div class="paragraph">
<p>To set the log level for ROOT logger of a service it is possible to call the provided script
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/logs/setLogs.sh">src/test/resources/logs/setLogs.sh</a> as follows: <code>setLogs.sh &lt;server:port&gt; &lt;log_level&gt;  &lt;user&gt; &lt;opfab_url&gt;</code>. For example to set the log level to DEBUG for "card-publication" service  execute: <code>setLogs.sh localhost:2102 DEBUG admin <a href="http://localhost" class="bare">localhost</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="_node_services"><a class="anchor" href="#_node_services"></a>37.2.2. Node Services</h4>
<div class="paragraph">
<p>For node services (supervisor, cards-external-diffusion and cards-reminder) the available logging levels are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>silly</p>
</li>
<li>
<p>debug</p>
</li>
<li>
<p>verbose</p>
</li>
<li>
<p>http</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>warn</p>
</li>
<li>
<p>error</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view the configured logging level for a given logger it is possible to send a GET request to the '/logLevel' URI as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl http://&lt;server&gt;:&lt;port&gt;/logLevel -H "Authorization: Bearer ${token}"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid OAuth2 JWT for a user with administration privileges</p>
</div>
<div class="paragraph">
<p>The response will be the configured logging level as string</p>
</div>
<div class="paragraph">
<p>To get the log level of a node service it is possible to call the provided script
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/logs/getLogsNodeService.sh">src/test/resources/logs/getLogsNodeService.sh</a> as follows: <code>getLogsNodeService.sh &lt;server:port&gt; &lt;user&gt; &lt;opfab_url&gt;</code>. For example to get the current log level for "card-external-diffusion" service  execute: <code>getLogsNodeService.sh localhost:2106 admin <a href="http://localhost" class="bare">localhost</a></code></p>
</div>
<div class="paragraph">
<p>To configure a given logger, POST a json entity to the '/logLevel' URI, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -i -X POST http://&lt;server&gt;:&lt;port&gt;/logLevel -H "Authorization: Bearer ${token}" -H 'Content-Type: application/json' -d '{"configuredLevel": "debug"}'</pre>
</div>
</div>
<div class="paragraph">
<p>To reset the specific level of the logger (and use the default configuration instead) it is possible to pass a value of null as the configuredLevel.</p>
</div>
<div class="paragraph">
<p>To set the log level for a node service it is possible to call the provided script
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/logs/setLogsNodeService.sh">src/test/resources/logs/setLogsNodeService.sh</a> as follows: <code>setLogsNodeService.sh &lt;server:port&gt; &lt;log_level&gt;  &lt;user&gt; &lt;opfab_url&gt;</code>. For example to set the log level to DEBUG for "card-external-diffusion" service  execute: <code>setLogsNodeService.sh localhost:2106 DEBUG admin <a href="http://localhost" class="bare">localhost</a></code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_users_groups_and_entities_administration"><a class="anchor" href="#_users_groups_and_entities_administration"></a>38. Users, Groups and Entities Administration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A new operator call John Doe, who has OAuth granted right to connect to current <code>OperatorFabric</code> instance, need to receive cards within current <code>OperatorFabric</code> instance.
As a user of OperatorFabric, he needs to be added to the system with a <code>login</code> (john-doe-operator), his <code>firstName</code> (John) and his <code>lastName</code> (Doe).
As there is no <code>Administration GUI</code> for the moment, it must be performed through command line, as detailed in the Users API.</p>
</div>
<div class="sect2">
<h3 id="_users_2"><a class="anchor" href="#_users_2"></a>38.1. Users</h3>
<div class="sect3">
<h4 id="_list_all_users"><a class="anchor" href="#_list_all_users"></a>38.1.1. List all users</h4>
<div class="paragraph">
<p>First of all, list the users (who are the recipients in OperatorFabric) of the system with the following commands:</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -v http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "firstName": null,
        "groups": [
            "ADMIN"
        ],
        "entities": [
            "ENTITY1_FR",
            "ENTITY2_FR"
        ],
        "lastName": null,
        "login": "admin"
    },
    {
        "firstName": null,
        "groups": [
            "RTE",
            "ADMIN",
            "CORESO",
            "ReadOnly",
            "TEST"
        ],
        "lastName": null,
        "login": "operator3_fr"
    },
    {
        "firstName": null,
        "groups": [
            "ELIA"
        ],
        "lastName": null,
        "login": "elia-operator"
    },
    {
        "firstName": null,
        "groups": [
            "CORESO"
        ],
        "lastName": null,
        "login": "coreso-operator"
    },
    {
        "firstName": null,
        "groups": [
            "Dispatcher",
            "ReadOnly",
            "TEST"
        ],
        "entities": [
            "ENTITY1_FR"
        ],
        "lastName": null,
        "login": "operator1_fr"
    },
    {
        "firstName": null,
        "groups": [
            "Planner",
            "ReadOnly"
        ],
        "entities": [
            "ENTITY2_FR"
        ],
        "lastName": null,
        "login": "operator2_fr"
    },
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_user"><a class="anchor" href="#_create_a_new_user"></a>38.1.2. Create a new User</h4>
<div class="paragraph">
<p>We are sure that no John-doe-operator exists in our OperatorFabric instance.
We can add him in our OperatorFabric instance using the following command use httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}' | http POST http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>Or here cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_user_details"><a class="anchor" href="#_fetch_user_details"></a>38.1.3. Fetch user details</h4>
<div class="paragraph">
<p>It&#8217;s always a good thing to verify if all the information has been correctly recorded in the system:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http -b http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "groups": [],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_user_details"><a class="anchor" href="#_update_user_details"></a>38.1.4. Update user details</h4>
<div class="paragraph">
<p>As shown by this result, the firstName of the new operator has been misspelled.
We need
<a href="../api/users/index.html#/users/updateUser">to update the existing user</a>
with <code>john-doe-operator</code> login.
To correct this mistake, the following commands can be used:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","lastName":"Doe","firstName":"John"}' | http PUT http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"John","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groupsentities"><a class="anchor" href="#_groupsentities"></a>38.2. Groups/Entities</h3>
<div class="paragraph">
<p>All the commands below :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List groups</p>
</li>
<li>
<p>Create a new group</p>
</li>
<li>
<p>Fetch details of a given group</p>
</li>
<li>
<p>Update details of a group</p>
</li>
<li>
<p>Add a user to a group</p>
</li>
<li>
<p>Remove a user from a group</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>are available for both groups and entities. In order not to overload the documentation, we will only detail group endpoints.</p>
</div>
<div class="sect3">
<h4 id="_list_groups_or_entities"><a class="anchor" href="#_list_groups_or_entities"></a>38.2.1. List groups (or entities)</h4>
<div class="paragraph">
<p>This operator is the first member of a new group operator called the <code>OPERATORS</code>, which doesn&#8217;t exist for the moment in
the system. As shown when we
<a href="../api/users/index.html#/groups/fetchGroups">list the groups</a>
existing in the server.</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "description": "The admin group",
        "name": "ADMIN group",
        "id": "ADMIN"
    },
    {
        "description": "RTE TSO Group",
        "name": "RTE group",
        "id": "RTE"
    },
    {
        "description": "ELIA TSO group",
        "name": "ELIA group",
        "id": "ELIA"
    },
    {
        "description": "CORESO Group",
        "name": "CORESO group",
        "id": "CORESO"
    },
    {
        "description": "Dispatcher Group",
        "name": "Dispatcher",
        "id": "Dispatcher"
    },
    {
        "description": "Planner Group",
        "name": "Planner",
        "id": "Planner"
    },
    {
        "description": "ReadOnly Group",
        "name": "ReadOnly",
        "id": "ReadOnly"
    }
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_group_or_entity"><a class="anchor" href="#_create_a_new_group_or_entity"></a>38.2.2. Create a new group (or entity)</h4>
<div class="paragraph">
<p>Firstly, the group called <code>OPERATORS</code> has to be
<a href="../api/users/index.html#/groups/createGroup">added to the system</a>
using the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"OPERATORS","decription":"This is the brand new group of operator"}' | http POST http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"OPERATORS","decription":"This is the brand new group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "perimeters": [],
    "description": null,
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_details_of_a_given_group_or_entity"><a class="anchor" href="#_fetch_details_of_a_given_group_or_entity"></a>38.2.3. Fetch details of a given group (or entity)</h4>
<div class="paragraph">
<p>The result returned seems strange, to verify if it&#8217;s the correct answer by
<a href="../api/users/index.html#/groups/fetchGroup">displaying the details of the group</a>
called <code>OPERATORS</code>, use the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "perimeters": [],
    "description": null,
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_details_of_a_group_or_entity"><a class="anchor" href="#_update_details_of_a_group_or_entity"></a>38.2.4. Update details of a group (or entity)</h4>
<div class="paragraph">
<p>The description is really null. After verification, in our first command used to create the group,
the attribute for the description is misspelled. Using the following command
<a href="../api/users/index.html#/groups/updateGroup">to update the group</a>
with the correct spelling, the new group of operator gets a proper description:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"OPERATORS","description":"This is the brand-new group of operator"}' | http -b PUT http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"OPERATORS","description":"This is the brand-new group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "perimeters": []
    "description": "This is the brand-new group of operator",
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_user_to_a_group_or_entity"><a class="anchor" href="#_add_a_user_to_a_group_or_entity"></a>38.2.5. Add a user to a group (or entity)</h4>
<div class="paragraph">
<p>As both new group and new user are correct it&#8217;s time
<a href="../api/users/index.html#/users/addGroupUsers">to make the user a member of the group</a>
. To achieve this, use the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '["john-doe-operator"]' | http PATCH http://localhost:2103/groups/OPERATORS/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PATCH http://localhost:2103/groups/OPERATORS/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '["john-doe-operator"]'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s verify that the changes are correctly recorded by fetching the :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": ["OPERATORS"],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now possible to send cards either specifically to <code>john-doe-operator</code> or more generally to the <code>OPERATORS</code> group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_a_user_from_a_group_or_entity"><a class="anchor" href="#_remove_a_user_from_a_group_or_entity"></a>38.2.6. Remove a user from a group (or entity)</h4>
<div class="paragraph">
<p>When John Doe is no longer in charge of hypervising cards for <code>OPERATORS</code> group, this group has to be removed from his login by using the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http DELETE http://localhost:2103/groups/OPERATORS/users/john-doe-operator "Authorization:Bearer $token"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Authorization:Bearer $token" http://localhost:2103/groups/OPERATORS/users/john-doe-operator</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
	"login":"john-doe-operator","
	firstName":"John",
	"lastName":"Doe",
	"groups":[],
    "entities":[]
}</pre>
</div>
</div>
<div class="paragraph">
<p>A last command to verify that <code>OPERATORS</code> is no longer linked to <code>john-doe-operator</code>:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": [],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"

}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entity_parents"><a class="anchor" href="#_entity_parents"></a>38.2.7. Entity parents</h4>
<div class="paragraph">
<p>Entities have a 'parents' attribute instead of a 'perimeters' one.
This attribute is a string array.
Each element of the array is the id of another Entity.
When adding or patching an Entity into the system, operatorFabric performs a cycle detection.
On a positive cycle detection cancels the addition or the patch.</p>
</div>
<div class="sect4">
<h5 id="_add_a_new_entity_without_a_cycle_in_the_parent_declaration"><a class="anchor" href="#_add_a_new_entity_without_a_cycle_in_the_parent_declaration"></a>38.2.7.1. Add a new Entity without a cycle in the parent declaration</h5>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["ENTITY1_FR"]}' \
| http POST http://localhost:2103/entities "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/entities -H "Authorization:Bearer $token" -H "Content-Type:application/json" \
--data '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["ENTITY1_FR"]}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "id": "NEW_ENTITY",
    "parents": ["ENTITY1_FR"],
    "name": "Last New Entity",
    "description":"This is the last new entity",
    "labels":[]
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_a_new_entity_with_a_cycle"><a class="anchor" href="#_add_a_new_entity_with_a_cycle"></a>38.2.7.2. Add a new Entity with a cycle</h5>
<div class="paragraph">
<p>For simplicity, in this example the new entity will declare itself as a parent.
This auto-referencing triggers a cycle detection.</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["NEW_ENTITY"]}' | http POST http://localhost:2103/entities "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/entities -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["NEW_ENTITY"]}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "status":"BAD_REQUEST",
    "message":"A cycle has been detected: NEW_ENTITY-&gt;NEW_ENTITY"
}</pre>
</div>
</div>
<div class="paragraph">
<p>with a <code>400</code> as http status return.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_port_table"><a class="anchor" href="#_service_port_table"></a>39. Service port table</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web ui and gateway  (Nginx server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Businessconfig management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-devices</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External devices management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2106</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-external-diffusion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail notification service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2107</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-reminder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards reminder service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2108</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">supervisor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supervisor service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mongo api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amqp api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rabbitmq api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MailHog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MailHog SMTP port (for testing only)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8025</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MailHog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MailHog web UI and API http (REST) (for testing only)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_rate_limiter_for_card_sending"><a class="anchor" href="#_rate_limiter_for_card_sending"></a>40. Rate limiter for card sending</h2>
<div class="sectionbody">
<div class="paragraph">
<p>External publishers are monitored by this module which limits how many cards they can send
<a href="#cardSendingLimitCardCount"><code>cardSendingLimitCardCount</code></a>
 in a period of time
<a href="#cardSendingLimitPeriod"><code>cardSendingLimitPeriod</code></a>
.
This is to avoid potential overloading due to external apps stuck in a card sending loop.
It can be disabled / enabled with
<a href="#activateCardSendingLimiter"><code>activateCardSendingLimiter</code></a>
.
It is also possible to reset the data of the limiter by calling the API through the "/cards/rateLimiter" endpoint (e.g.
POST "$url:2102/cards/rateLimiter" -H "Authorization:Bearer $token").</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restricted_operations_administration"><a class="anchor" href="#_restricted_operations_administration"></a>41. Restricted operations (administration)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some operations are restricted to users with administrative roles, either because they are administration
operations with the potential to impact the OperatorFabric instance as a whole, or because they
give access to information that should be private to a user.</p>
</div>
<div class="paragraph">
<p>Below is a quick recap of these restricted operations.</p>
</div>
<div class="paragraph">
<div class="title">Users Service</div>
<p>Any action (read, create/update or delete) regarding a single user&#8217;s data (their personal info such as their first and
last name, as well as their settings) can be performed either by the user in question or by a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<p>Any action on users, groups, entities or perimeters lists (if authorization is managed in OperatorFabric) is restricted to users with the ADMIN role.</p>
</div>
<div class="paragraph">
<p>Access to users action logs information is restricted to users with ADMIN role or VIEW_USER_ACTION_LOGS role.</p>
</div>
<div class="paragraph">
<div class="title">Businessconfig Service</div>
<p>Any write (create, update or delete) action on bundles can only be performed by a user with the ADMIN role or ADMIN_BUSINESS_PROCESS role. As such,
administrators are responsible for the quality and security of the provided bundles.
In particular, as it is possible to use scripts in templates, they should perform a security check to make sure that
there is no XSS risk.</p>
</div>
<div class="paragraph">
<div class="title">Cards consultation Service</div>
<p>Users holding the ADMIN role are authorized to read all archived cards, regardless of the card&#8217;s sender, recipients, or the user&#8217;s assigned perimeters
IMPORTANT: The ADMIN role doesn&#8217;t grant any special privileges when it comes to current cards consultation so a user with the ADMIN role will only receive cards that have been addressed to them (or to one of their
groups or entities), just like any other user.</p>
</div>
<div class="paragraph">
<div class="title">External devices service</div>
<p>Any action (read, create/update or delete) on external devices configuration is restricted to users with th ADMIN role.</p>
</div>
</div>
</div>
<h1 id="dev_env" class="sect0"><a class="anchor" href="#dev_env"></a>Development environment</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to provide all the necessary information to developers who would like to start working on
OperatorFabric.
It will walk you through setting up the necessary tooling to be able to launch OperatorFabric in development mode,
describe the structure of the project and point out useful tools (Gradle tasks, scripts, etc.) for development purposes.
</div>
</div>
<div class="sect1">
<h2 id="_requirements"><a class="anchor" href="#_requirements"></a>42. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To install a  dev environment for Operator Fabric , you need</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A linux physical or virtual machine</p>
</li>
<li>
<p>A git client</p>
</li>
<li>
<p>Docker</p>
</li>
<li>
<p>Docker Compose with 2.1+ file format support</p>
</li>
<li>
<p>Chrome (needed for UI tests in build)</p>
</li>
<li>
<p><a href="https://stedolan.github.io/jq/">jq</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup_dev_env"><a class="anchor" href="#setup_dev_env"></a>43. Setting up your development environment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_clone_repository"><a class="anchor" href="#_clone_repository"></a>43.1. Clone repository</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">git clone https://github.com/opfab/operatorfabric-core.git
cd operatorfabric-core</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not forget to set proxy if needed , for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>git config --global http.proxy http://LOGIN:PWD@PROXY_URL:PORT</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_sdkman_and_nvm"><a class="anchor" href="#_install_sdkman_and_nvm"></a>43.2. Install sdkman and  nvm</h3>
<div class="paragraph">
<p>sdkman is used to manage java version , see <a href="https://sdkman.io/" class="bare">sdkman.io/</a> for installation</p>
</div>
<div class="paragraph">
<p>nvm is used to manage node and npm version , see <a href="https://github.com/nvm-sh/nvm" class="bare">github.com/nvm-sh/nvm</a> for installation
See :</p>
</div>
<div class="paragraph">
<p>Do not forget to set proxy if needed , for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>export https_proxy= http://LOGIN:PWD@PROXY_URL:PORT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have installed sdkman and nvm, you can <strong>source</strong> the following
script to set up your development environment (appropriate versions of Node
Java and project variables set):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>source bin/load_environment_light.sh</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
From now on, you can use environment variable <code>${OF_HOME}</code> to go back to
the home repository of <code>OperatorFabric</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_your_proxy_configuration"><a class="anchor" href="#_setting_up_your_proxy_configuration"></a>43.3. Setting up your proxy configuration</h3>
<div class="paragraph">
<p>If you use a proxy to access internet, you must configure it for all tools needed to build opfab</p>
</div>
<div class="sect3">
<h4 id="_docker"><a class="anchor" href="#_docker"></a>43.3.1. Docker</h4>
<div class="paragraph">
<p>To download images , you need to set the proxy for the docker daemon</p>
</div>
<div class="paragraph">
<p>See  <a href="https://docs.docker.com/config/daemon/systemd/">docker documentation</a> to set the proxy</p>
</div>
<div class="paragraph">
<p>To build docker images, you need to set a proxy via the variable https_proxy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>export https_proxy= http://LOGIN:PWD@PROXY_URL:PORT</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may have some DNS error when building docker images, in this case use the IP address of your proxy instead of the FQDN .</p>
</div>
</div>
<div class="sect3">
<h4 id="_gradle"><a class="anchor" href="#_gradle"></a>43.3.2. Gradle</h4>
<div class="paragraph">
<p>In gradle.properties (in ~/.gradle repository)</p>
</div>
<div class="paragraph">
<p>Example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>systemProp.https.proxyHost=PROXY_URL
systemProp.https.proxyPort=PROXY_PORT
systemProp.https.proxyUser=LOGIN
systemProp.https.proxyPassword=PASSWORD</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_npm"><a class="anchor" href="#_npm"></a>43.3.3. Npm</h4>
<div class="paragraph">
<p>Example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>npm config set https-proxy http://LOGIN:PWD@PROXY_URL:PORT</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_needed_docker_containers"><a class="anchor" href="#_deploy_needed_docker_containers"></a>43.4. Deploy needed docker containers</h3>
<div class="paragraph">
<p><code>OperatorFabric</code> development needs docker images of <code>MongoDB</code>, <code>RabbitMQ</code>, <code>web-ui</code> and <code>Keycloak</code> running.</p>
</div>
<div class="paragraph">
<p>For this, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_operatorfabric_with_gradle"><a class="anchor" href="#_build_operatorfabric_with_gradle"></a>43.5. Build OperatorFabric with Gradle</h3>
<div class="paragraph">
<p>Using the wrapper in order to ensure building the project the same way from one machine to another.</p>
</div>
<div class="paragraph">
<p>To fully build opfab :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew buildDocker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, it is possible to</p>
</div>
<div class="sect3">
<h4 id="_only_compile_and_package_the_jars"><a class="anchor" href="#_only_compile_and_package_the_jars"></a>43.5.1. Only compile and package the jars</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew assemble</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_only_launch_the_unit_test_compile_and_package_the_jars"><a class="anchor" href="#_only_launch_the_unit_test_compile_and_package_the_jars"></a>43.5.2. Only launch the Unit Test, compile and package the jars</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew build</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_operatorfabric_services_using_the_run_all_sh_script"><a class="anchor" href="#_run_operatorfabric_services_using_the_run_all_sh_script"></a>43.6. Run OperatorFabric Services using the <code>run_all.sh</code> script</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
bin/run_all.sh -w start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <code>bin/run_all.sh -h</code> for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_log_into_the_ui"><a class="anchor" href="#_log_into_the_ui"></a>43.7. Log into the UI</h3>
<div class="paragraph">
<p><strong><em>URL:</em></strong> localhost:2002<br>
<strong><em>login:</em></strong> operator1_fr<br>
<strong><em>password:</em></strong> test</p>
</div>
<div class="paragraph">
<p>Other users available in development mode are <code>operator2_fr</code>,<code>operator3_fr</code>, <code>operator4_fr</code> and <code>admin</code>, with <code>test</code> as password.</p>
</div>
</div>
<div class="sect2">
<h3 id="_push_cards_to_the_feed"><a class="anchor" href="#_push_cards_to_the_feed"></a>43.8. Push cards to the feed</h3>
<div class="paragraph">
<p>You can check that you see cards into the feed by running the following scripts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">./src/test/resources/loadTestConf.sh
./src/test/resources/send6TestCards.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_local_quality_report_generation"><a class="anchor" href="#_enabling_local_quality_report_generation"></a>43.9. Enabling local quality report generation</h3>
<div class="paragraph">
<p>This step is optional and is generally not needed (only needed if you want a Sonarqube report locally)</p>
</div>
<div class="paragraph">
<p>Sonarqube reporting needs a <code>SonarQube</code> docker container.
Use the <code>${OF_HOME}/src/main/docker/test-quality-environment/docker-compose.yml</code> to get them all running.</p>
</div>
<div class="paragraph">
<p>To generate the quality report, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew jacocoTestReport</code></pre>
</div>
</div>
<div class="paragraph">
<p>To export the reports into the <code>SonarQube</code> docker instance, install and use <a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/">SonarScanner</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_interface"><a class="anchor" href="#_user_interface"></a>44. User Interface</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the following document the variable declared as <code>OF_HOME</code> is the root folder of the <code>operatorfabric-core project</code>.
</td>
</tr>
</table>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CLI
</td>
<td class="hdlist2">
<p>stands for <strong>Command Line Interface</strong></p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_build"><a class="anchor" href="#_build"></a>44.1. Build</h3>
<div class="paragraph">
<p>Within the folder <code>${OF_HOME}/ui/main</code>, run <code>ng build</code> to build the project.</p>
</div>
<div class="paragraph">
<p>The build artifacts will be stored in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">${OF_HOME}/ui/main/build/distribution</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command could lead to the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See &quot;/tmp/ng-&lt;random-string&gt;/angular-errors.log&quot; for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use <code>node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code> instead to solve this problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test"><a class="anchor" href="#_test"></a>44.2. Test</h3>
<div class="sect3">
<h4 id="_standalone_tests"><a class="anchor" href="#_standalone_tests"></a>44.2.1. Standalone tests</h4>
<div class="paragraph">
<p>Run in the <code>${OF_HOME}/ui/main</code> directory the command <code>ng test --watch=false</code> to execute the unit tests
on <a href="https://jasmine.github.io">Jasmine</a> using <a href="https://karma-runner.github.io">Karma</a> to drive the browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_during_ui_development"><a class="anchor" href="#_test_during_ui_development"></a>44.2.2. Test during UI development</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the RabbitMQ, MongoDB and Keycloak docker containers are not running, launch them;</p>
</li>
<li>
<p>set your environment variables with <code>source ${OF_HOME}/bin/load_environment_light.sh</code>;</p>
</li>
<li>
<p>run the micro services using the same command as earlier: <code>${OF_HOME}/bin/run_all.sh start</code>;</p>
</li>
<li>
<p>launch an angular server with the command: <code>ng serve</code>;</p>
</li>
<li>
<p>test your changes in your browser using this url: <code><a href="http://localhost:4200" class="bare">localhost:4200</a></code> which leads to <code><a href="http://localhost:4200/#/feed" class="bare">localhost:4200/#/feed</a></code>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>44.2.2.1. Troubleshooting :</h5>
<div class="paragraph">
<p>If <code>ng serve</code> returns the error <code>Command 'ng' not found</code>, install the Angular CLI globally with the following
command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>npm install -g @angular/cli</pre>
</div>
</div>
<div class="paragraph">
<p>This will install the latest version of the Angular command line, which might not be in line with the one used by the
project, but it&#8217;s not an issue as when you run <code>ng serve</code> the local version of the Angular CLI
(as defined in the package.json file) will be used.</p>
</div>
<div class="paragraph">
<p>If it is still not running , launch in the ui/main directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>npm link @angular/cli</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>45. Environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These variables are loaded by bin/load_environment_light.sh</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OF_HOME: OperatorFabric root dir</p>
</li>
<li>
<p>OF_VERSION : OperatorFabric version, as defined in the <code>$OF_HOME/VERSION</code> file</p>
</li>
<li>
<p>OF_CLIENT_REL_COMPONENTS : List of modules for the client libraries</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_structure"><a class="anchor" href="#_project_structure"></a>46. Project Structure</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/bin">bin</a>: contains useful scripts for dev purposes</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/CICD/github">CICD/github</a>: scripts used by Github for the
build process</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client">client</a>: contains REST APIs simple beans definition, may be
used by external projects</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/config">config</a>: contains external configurations for all services , keycloak and docker-compose files to help with tests and demonstrations</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/node-services">node-services</a>: contains the node microservices that make up
OperatorFabric</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services">services</a>: contains the java microservices that make up
OperatorFabric</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/cards-consultation">cards-consultation
(cards-consultation-service)</a>: Card consultation service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/cards-publication">cards-publication
(cards-publication-service)</a>: Card publication service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/external-devices">external-devices
(external-devices-service)</a>: External Devices service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/src">src</a>: contains swagger templates for services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/businessconfig">businessconfig (businessconfig-service)</a>:
Businessconfig-party information management service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/users">users (users-service)</a>: Users management
service</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/web-ui">web-ui</a>: project based on Nginx server to serve
the OperatorFabric UI</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src">src</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs">docs</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs/asciidoc">asciidoc</a>: General documentation (Architecture,
Getting Started Guide, etc.)</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main">main</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker">docker</a>: contains docker-compose files to help with
tests and demonstrations</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test">test</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/api">api</a> : karate code for automatic api testing (non-regression tests)</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/clientApp">clientApp</a> : test application that send card (used to test client lib)</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/cypress">cypress</a> : cypress code for automatic ui testing</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/dummyModbusDevice">dummyModbusDevice</a> : application emulating a Modbus device for test purposes</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/externalApp">externalApp</a> : external test application that received card</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/externalWebAppExample">externalWebAppExample</a> : example application to show integration of an external application in opfab UI</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources">resources</a> : scripts and data for manual testing</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools">tools</a> : code common to every back services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/ui">ui</a>: Angular sources for the UI</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_conventions_regarding_project_structure_and_configuration"><a class="anchor" href="#_conventions_regarding_project_structure_and_configuration"></a>46.1. Conventions regarding project structure and configuration</h3>
<div class="paragraph">
<p>Sub-projects must conform to a few rules in order for the configured Gradle
tasks to work:</p>
</div>
<div class="sect3">
<h4 id="_java"><a class="anchor" href="#_java"></a>46.1.1. Java</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/java
</td>
<td class="hdlist2">
<p>contains java source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/java
</td>
<td class="hdlist2">
<p>contains java tests source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/resources
</td>
<td class="hdlist2">
<p>contains resource files</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/resources
</td>
<td class="hdlist2">
<p>contains test resource files</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modeling"><a class="anchor" href="#_modeling"></a>46.1.2. Modeling</h4>
<div class="paragraph">
<p>Core services projects declaring REST APIS that use Swagger for their
definition must declare two files:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/swagger.yaml
</td>
<td class="hdlist2">
<p>Swagger API definition</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/config.json
</td>
<td class="hdlist2">
<p>Swagger generator configuration</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_docker_2"><a class="anchor" href="#_docker_2"></a>46.1.3. Docker</h4>
<div class="paragraph">
<p>Services project all have docker image generated in their build cycle. See
<a href="#gradle_tasks">Gradle Tasks</a>
for details.</p>
</div>
<div class="paragraph">
<p>Per project configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docker file : <strong>[sub-project]/Dockerfile</strong></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_tools"><a class="anchor" href="#_development_tools"></a>47. Development tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scripts_bin_and_cicd"><a class="anchor" href="#_scripts_bin_and_cicd"></a>47.1. Scripts (bin and CICD)</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
bin/load_environment_light.sh
</td>
<td class="hdlist2">
<p>sets up environment when <strong>sourced</strong> (java
version &amp; node version)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
bin/run_all.sh
</td>
<td class="hdlist2">
<p>runs all all services (see below)</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_run_all_sh"><a class="anchor" href="#_run_all_sh"></a>47.1.1. run_all.sh</h4>
<div class="paragraph">
<p>Please see <code>run_all.sh -h</code> usage before running.</p>
</div>
<div class="paragraph">
<p>Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mongo running on port 27017 with user "root" and password "password"
(See src/main/docker/mongodb/docker-compose.yml for a pre configured instance).</p>
</li>
<li>
<p>rabbitmq running on port 5672 with user "guest" and password "guest"
(See src/main/docker/rabbitmq/docker-compose.yml for a pre configured
instance).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Ports configuration</strong>
 </summary><div> </p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web ui and gateway  (Nginx server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Businessconfig service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-devices</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External devices service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-devices</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_tasks"><a class="anchor" href="#gradle_tasks"></a>47.2. Gradle Tasks</h3>
<div class="paragraph">
<p>In this section only custom tasks are described. For more
information on tasks, refer to the output of the "tasks" gradle task and
to gradle and plugins official documentation.</p>
</div>
<div class="sect3">
<h4 id="_services"><a class="anchor" href="#_services"></a>47.2.1. Services</h4>
<div class="sect4">
<h5 id="_common_tasks_for_all_sub_projects"><a class="anchor" href="#_common_tasks_for_all_sub_projects"></a>47.2.1.1. Common tasks for all sub-projects</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
</li>
<li>
<p>Other:</p>
<div class="ulist">
<ul>
<li>
<p>copyDependencies: copy dependencies to build/support_libs (for Sonar)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_businessconfig_service_2"><a class="anchor" href="#_businessconfig_service_2"></a>47.2.1.2. Businessconfig Service</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestDataDir: prepare directory (build/test-data) for test data</p>
</li>
<li>
<p>compressBundle1Data, compressBundle2Data: generate tar.gz businessconfig party
configuration data for tests in build/test-data</p>
</li>
<li>
<p>prepareDevDataDir: prepare directory (build/dev-data) for bootRun task</p>
</li>
<li>
<p>createDevData: prepare data in build/test-data for running bootRun task
during development</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other tasks</p>
<div class="ulist">
<ul>
<li>
<p>copyCompileClasspathDependencies: copy compile classpath dependencies,
catching lombok that must be sent for sonarqube</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_toolsgeneric"><a class="anchor" href="#_toolsgeneric"></a>47.2.1.3. tools/generic</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestData: copy test data from src/test/data/simple to
build/test-data/</p>
</li>
<li>
<p>compressTestArchive: compress the contents of /src/test/data/archive to
/build/test-data/archive.tar.gz</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_client_library"><a class="anchor" href="#_client_library"></a>47.2.2. Client Library</h4>
<div class="paragraph">
<p>The jars produced by the projects under "client" will now be published to Maven Central after each release to make
integration in client applications more manageable (see <a href="https://central.sonatype.org/publish">the official Sonatype
documentation</a>) for more information about the requirements and publishing process.</p>
</div>
<div class="paragraph">
<p>To that end, we are using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Maven Publish</a> Gradle plugin to take care of the
metadata (producing the required pom.xml for example) and publishing the artifacts to a staging repository</p>
</li>
<li>
<p>the <a href="https://docs.gradle.org/current/userguide/signing_plugin.html">Signing</a> Gradle plugin to sign the produced artifacts
using a GPG key.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="client_lib_pub_conf"><a class="anchor" href="#client_lib_pub_conf"></a>47.2.2.1. Configuration</h5>
<div class="paragraph">
<p>For the signing task to work, you need to :</p>
</div>
<div class="sect5">
<h6 id="_import_the_opfab_secret_key_file"><a class="anchor" href="#_import_the_opfab_secret_key_file"></a>Import the opfab secret key file</h6>
<div class="listingblock">
<div class="content">
<pre>gpg2 --import OPFAB_KEY_FILE</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_set_the_signing_configuration_in_your_gradle_properties_file"><a class="anchor" href="#_set_the_signing_configuration_in_your_gradle_properties_file"></a>Set the signing configuration in your gradle.properties file</h6>
<div class="paragraph">
<p>Add to your gradle.properties :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>signing.gnupg.keyName=ID_OF_THE_GPG_KEY_TO_USE
signing.secretKeyRingFile=LOCATION_OF_THE_KEYRING_HOLDING_THE_GPG_KEY</pre>
</div>
</div>
<div class="paragraph">
<p>To get the keyName (ID_OF_THE_GPG_KEY_TO_USE) use :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --list-secret-keys</pre>
</div>
</div>
<div class="paragraph">
<p>LOCATION_OF_THE_KEYRING_HOLDING_THE_GPG_KEY is usually /YOUR_HOME_DIRECTORY/.gnupg/pubring.kbx</p>
</div>
</div>
<div class="sect5">
<h6 id="_set_the_credential_for_the_publication"><a class="anchor" href="#_set_the_credential_for_the_publication"></a>Set the credential for the publication</h6>
<div class="paragraph">
<p>For the publication to the staging repository (OSSRH) to work, you need to set the credentials in your gradle.properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ossrhUsername=SONATYPE_JIRA_USERNAME
ossrhPassword=SONATYPE_JIRA_PASSWORD</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The credentials need to belong to an account that has been granted the required privileges on the project (this
is done by Sonatype on request via the same JIRA).
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_more_information"><a class="anchor" href="#_more_information"></a>More information</h6>
<div class="paragraph">
<p>See <a href="https://makandracards.com/makandra-orga/notes/37763-gpg-extract-private-key-and-import-on-different-machine">this link</a>
for more information about importing a GPG key to your machine and getting its id.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_relevant_tasks"><a class="anchor" href="#_relevant_tasks"></a>47.2.2.2. Relevant tasks</h5>
<div class="paragraph">
<p>These plugins and the associated configuration in the <code>client.gradle</code> file make the following tasks available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>publishClientLibraryMavenPublicationToOssrhRepository</code>: this will publish the client jars to the OSSRH repository (in the
case of a X.X.X.RELEASE version) or to a <code>repos</code> directory in the build directory (in the case of a <code>SNAPSHOT</code> version).</p>
</li>
<li>
<p><code>publishClientLibraryMavenPublicationToMavenLocal</code>: this will publish the client jars to the local Maven repository</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The publication tasks will call the signing task automatically.</p>
</div>
<div class="paragraph">
<p>See the plugins documentations for more details on the other tasks available and the dependencies between them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As the client library publication is currently the only configured publication in our build, it is also possible
to use the corresponding aggregate tasks as shortcuts: <code>publish</code> instead of
<code>publishClientLibraryMavenPublicationToOssrhRepository</code> and <code>publishToMavenLocal</code> instead of
<code>publishClientLibraryMavenPublicationToMavenLocal</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_plugins"><a class="anchor" href="#_gradle_plugins"></a>47.2.3. Gradle Plugins</h4>
<div class="paragraph">
<p>In addition to these custom tasks and standard Gradle tasks, OperatorFabric
uses several Gradle plugins, among which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/">Spring Boot Gradle Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/avast/gradle-docker-compose-plugin/">Docker Compose Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/int128/gradle-swagger-generator-plugin">Gradle Swagger Generator Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/asciidoctor/asciidoctor-gradle-plugin">Gradle Asciidoctor Plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_testing_with_karate_dsl"><a class="anchor" href="#_api_testing_with_karate_dsl"></a>47.3. API testing with Karate DSL</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your OperatorFabric instance is not running on localhost, you need to replace localhost with the address
of your running instance within the <code>karate-config.js</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All the scripts and test files are in src/test/api/karate.</p>
</div>
<div class="sect3">
<h4 id="_run_a_feature"><a class="anchor" href="#_run_a_feature"></a>47.3.1. Run a feature</h4>
<div class="paragraph">
<p>To launch a specific test, launch in src/test/api/karate.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$OF_HOME/gradlew karate --args=myfeature.feature</pre>
</div>
</div>
<div class="paragraph">
<p>The result will be available in the <code>target</code> repository.</p>
</div>
</div>
<div class="sect3">
<h4 id="_non_regression_tests"><a class="anchor" href="#_non_regression_tests"></a>47.3.2. Non regression tests</h4>
<div class="paragraph">
<p>You can launch operatorFabric non-regression tests via the script launchAll.sh in src/test/api/karate.</p>
</div>
<div class="paragraph">
<p>To have the test passed, you need to have a clean Mongo DB database. To do that, you can use the scripts :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>src/test/resources/deleteAllCards.sh</p>
</li>
<li>
<p>src/test/resources/deleteAllArchivedCards.sh</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cypress_tests"><a class="anchor" href="#_cypress_tests"></a>47.4. Cypress Tests</h3>
<div class="paragraph">
<p>Automatic UI testing</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All paths for cd are given assuming you&#8217;re starting from <code>$OF_HOME</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a>47.4.1. Installation</h4>
<div class="paragraph">
<p>Before running Cypress tests for the first time you need to install it using NPM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
npm install</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cypress_file_structure"><a class="anchor" href="#_cypress_file_structure"></a>47.4.2. Cypress file structure</h4>
<div class="paragraph">
<p>By default, all test files are located in <code>cypress/cypress/integration</code> but it is possible to put it on another directory</p>
</div>
<div class="paragraph">
<p>The <code>commands.js</code> file under <code>cypress/cypress/support</code> is used to create custom commands and overwrite existing commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_launching_the_opfab_instance_to_test"><a class="anchor" href="#_launching_the_opfab_instance_to_test"></a>47.4.3. Launching the OpFab instance to test</h4>
<div class="sect4">
<h5 id="_commands"><a class="anchor" href="#_commands"></a>47.4.3.1. Commands</h5>
<div class="paragraph">
<p>You can launch the OpFab instance for Cypress tests either in dev or docker mode. The following commands launch the
instance in docker mode, just substitute <code>dev</code> for <code>docker</code> to launch it in dev mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd config/docker
docker-compose down <i class="conum" data-value="1"></i><b>(1)</b>
./startOpfabForCypress.sh <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Remove existing config/docker containers to avoid conflicts</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start "Cypress-flavoured" containers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After you&#8217;re done with your tests, you can stop and destroy containers (as it is better to start with fresh containers to avoid
side-effects from previous tests) with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd config/docker
docker-compose down</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation"><a class="anchor" href="#_explanation"></a>47.4.3.2. Explanation</h5>
<div class="paragraph">
<p>The Cypress tests rely on a running OpFab instance that is an adaptation from the config/docker docker-compose file
(environment name, shorter time before lttd clock display, etc.).</p>
</div>
<div class="paragraph">
<p>The <code>generateUIConfigForCypress.sh</code> script performs this adaptation to create this base Cypress configuration.</p>
</div>
<div class="paragraph">
<p>This will create the following files under <code>config/cypress/ui-config</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ui-menu.json</p>
</li>
<li>
<p>web-ui.json</p>
</li>
<li>
<p>web-ui-base.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>XXX-base.json</code> and <code>XXX.json</code> are created by copying the corresponding <code>XXX.json</code> file for standard docker
configuration (found under <code>config/docker/ui-config</code>) and making the necessary adaptations needed for the cypress instance to
work well for the tests (changing the authentication mode, making all features visible, etc.).</p>
</div>
<div class="paragraph">
<p>Then, during the course of the cypress tests, the <code>web-ui.json</code> file will be modified to test specific features
(for example, hiding a feature, defining a new menu, etc.). It is reset with the content of <code>web-ui-base.json</code>
before each test or series of test.</p>
</div>
<div class="paragraph">
<p>The docker container relies on the <code>XXX.json</code> files under <code>config/cypress/ui-config</code>.</p>
</div>
<div class="paragraph">
<p>For convenience, the <code>generateUIConfigForCypress.sh</code> is launched as part of the <code>startOpfabForCypress.sh</code> scripts.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_existing_tests"><a class="anchor" href="#_running_existing_tests"></a>47.4.4. Running existing tests</h4>
<div class="paragraph">
<p>To launch the Cypress test runner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
./node_modules/.bin/cypress open</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will open the Cypress test runner. Either click on the test you want to run or <code>run all X tests</code> on the right to
run all existing tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can select the browser (and version) that you want to use from a dropdown list on the right. The list will
display the browsers that are currently installed on your computer (and supported by Cypress).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_running_tests_on_4200_ng_serve"><a class="anchor" href="#_running_tests_on_4200_ng_serve"></a>47.4.5. Running tests on 4200 (ng serve)</h4>
<div class="paragraph">
<p>Follow the steps described above in "Dev mode" to start a Cypress-flavoured OpFab instance in development mode, then
run ng serve to start a dynamically generated ui on port 4200:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd ui/main
ng serve</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then launch the Cypress test runner as follows:</p>
</div>
<div class="paragraph">
<p>To launch the Cypress test runner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/cypress
./node_modules/.bin/cypress open --config baseUrl=http://localhost:4200</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_tests_with_gradle"><a class="anchor" href="#_running_tests_with_gradle"></a>47.4.6. Running tests with Gradle</h4>
<div class="paragraph">
<p>The tests can also be run in command line mode using a Gradle task :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew runCypressTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run a subset of the tests, for example if you want to run all the tests starting with 'User':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew runSomeCypressTests -PspecFiles=User*</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clearing_mongodb"><a class="anchor" href="#_clearing_mongodb"></a>47.4.7. Clearing MongoDB</h4>
<div class="paragraph">
<p>If you want to start with a clean database (from the cards and archived cards point of view), you can purge the
associated collections through the MongoDB shell with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker exec -it docker_mongodb_1 bash
mongo &quot;mongodb://root:password@localhost:27017/?authSource=admin&quot;
use operator-fabric
db.cards.remove({})
db.archivedCards.remove({})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_current_status_of_tests"><a class="anchor" href="#_current_status_of_tests"></a>47.4.8. Current status of tests</h4>
<div class="paragraph">
<p>All tests should be passing when run alone (i.e. not with run all specs) against empty card/archived cards collections.
However, tests in the "Flaky" folder can sometimes fail because they involve dates (round up errors for example).</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_new_tests"><a class="anchor" href="#_creating_new_tests"></a>47.4.9. Creating new tests</h4>
<div class="paragraph">
<p>Create a new XXXX.spec.js file under <code>cypress/cypress/integration</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will need to define a convention for naming and organizing tests.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_useful_documentation"><a class="anchor" href="#_useful_documentation"></a>47.4.9.1. Useful documentation</h5>
<div class="sect5">
<h6 id="_cypress_documentation"><a class="anchor" href="#_cypress_documentation"></a>Cypress Documentation</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.cypress.io/guides/references/assertions#Common-Assertions">Most Common Assertions</a></p>
</li>
<li>
<p><a href="https://docs.cypress.io/guides/references/assertions">Assertions Reference</a></p>
</li>
<li>
<p><a href="https://docs.cypress.io/faq/questions/using-cypress-faq">FAQ</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_other_links"><a class="anchor" href="#_other_links"></a>Other links</h6>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/slido-dev-blog/cypress-tips-4-testing-lists-of-items-dccd4b688816">Testing lists of items</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en/docs/Learn/HTML/Howto/Use_data_attributes">Use data attributes</a></p>
</li>
<li>
<p><a href="https://codelikethis.com/lessons/javascript/cypress#anchor/nothing_happens_immediately">Nothing happens immediately</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_guidelines_and_tips"><a class="anchor" href="#_guidelines_and_tips"></a>47.4.9.2. Guidelines and tips</h5>
<div class="ulist">
<ul>
<li>
<p>Use the <a href="https://docs.cypress.io/api/commands/get#Get-in-within">find or within commands</a> rather than complex CSS
selectors to target descendants elements.</p>
</li>
<li>
<p>If you want to access aliases using the <code>this</code> keyword, make sure you are using anonymous functions rather than fat
arrow functions, otherwise use cy.get('@myAlias') to access it asynchronously
(<a href="https://docs.cypress.io/guides/core-concepts/variables-and-aliases#Avoiding-the-use-of-this">the documentation</a>
has recently been updated on this topic).</p>
</li>
<li>
<p>When running tests, make sure that you are not connected to OpFab as it can cause unexpected behaviour with read
cards for example.</p>
</li>
<li>
<p>When chaining a <code>should</code> assertion to a <code>cy.get</code> command that returns several elements, it will pass if it is true for
ANY of these elements. Use each + callback to check that an assertion is true on every element.</p>
</li>
<li>
<p><code>cy.contains</code> is a command, not an assertion. If you want to test the attribute, classes, content etc. of an element,
it&#8217;s better to target the element by id or data attribute using a <code>cy.get()</code> command for example and then chain an
assertion with <code>should()</code>.
This way, you will get an expected/actual error message if the assertion fails, you will avoid false positives (text is
found in another sibling element) and hard to debug behaviour with retries.</p>
</li>
<li>
<p>Be careful with <code>find()</code> (see #1751 for an example of issue that it can cause). See the Cypress documentation for
<a href="https://docs.cypress.io/guides/core-concepts/retry-ability#Only-the-last-command-is-retried">an
explanation</a> and <a href="https://docs.cypress.io/guides/core-concepts/retry-ability#Merging-queries">a less flaky alternative</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_5"><a class="anchor" href="#_configuration_5"></a>47.4.10. Configuration</h4>
<div class="paragraph">
<p>In <code>cypress.config.js</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>e2e.baseUrl</code>: The base url of the OperatorFabric instance you&#8217;re testing against. It will be appended in front of any
<code>visit</code> call.</p>
</li>
<li>
<p><code>e2e.env.host</code>: The host corresponding to the OperatorFabric instance you&#8217;re testing against. It will be used for API
calls.</p>
</li>
<li>
<p><code>e2e.env.defaultWaitTime</code>: Using the custom-defined command cy.waitDefaultTime() instead of cy.wait(XXX) allows the wait
time to be changed globally for all steps to the value defined by this property.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_load_testing_with_gatling"><a class="anchor" href="#_load_testing_with_gatling"></a>47.5. Load testing with Gatling</h3>
<div class="paragraph">
<p>Load tests using Gatling are written in java.
All test java sources are in src/test/gatling/src/java</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your OperatorFabric instance is not running on localhost, you need to edit the tests classes  and replace localhost with the address of your running instance.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_run_a_test"><a class="anchor" href="#_run_a_test"></a>47.5.1. Run a test</h4>
<div class="paragraph">
<p>To launch a specific test, launch:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$OF_HOME/gradlew clean  gatlingRun-&lt;TestClassName&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The result will be available in the <code>src/test/gatling/build/reports/gatling/</code> folder.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_node_services_2"><a class="anchor" href="#_node_services_2"></a>47.6. Node services</h3>
<div class="paragraph">
<p>When developing Node services, you have the option to run the service outside of the Docker environment. To do this, follow these steps:</p>
</div>
<div class="paragraph">
<p>Stop the Docker container running the Node service. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    docker stop cards-reminder</code></pre>
</div>
</div>
<div class="paragraph">
<p>After stopping the Docker container, you can start the service in development mode with hot reload :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    cd node-services/cards-reminder
    npm run start:dev</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_other_useful_commands"><a class="anchor" href="#_other_useful_commands"></a>47.6.1. Other useful commands</h4>
<div class="paragraph">
<p>Here are some other useful commands for working with Node services:</p>
</div>
<div class="paragraph">
<p>To launch unit tests :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    npm run test</code></pre>
</div>
</div>
<div class="paragraph">
<p>To build the service :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    npm run build</code></pre>
</div>
</div>
<div class="paragraph">
<p>To start the service without hot reload :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    node build/cardReminder.ts</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_useful_recipes"><a class="anchor" href="#_useful_recipes"></a>48. Useful recipes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_sub_project_from_jar_file"><a class="anchor" href="#_running_sub_project_from_jar_file"></a>48.1. Running sub-project from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>java -jar [sub-projectPath]/build/libs/[sub-project].jar</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_properties_when_running_from_jar_file"><a class="anchor" href="#_overriding_properties_when_running_from_jar_file"></a>48.2. Overriding properties when running from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>java -jar [sub-projectPath]/build/libs/[sub-project].jar
spring.config.additional-location=file:[filepath]
NB : properties may be set using ".properties" file or ".yml" file. See
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">Spring
Boot configuration</a> for more info.</p>
</li>
<li>
<p>Generic property list extract :</p>
<div class="ulist">
<ul>
<li>
<p>server.port : embedded server port</p>
</li>
</ul>
</div>
</li>
<li>
<p>:services:core:businessconfig-party-service properties list extract :</p>
<div class="ulist">
<ul>
<li>
<p>operatorfabric.businessconfig.storage.path (defaults to &quot;&quot;) : where to
save/load OperatorFabric Businessconfig  data</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_generating_docker_images"><a class="anchor" href="#_generating_docker_images"></a>48.3. Generating docker images</h3>
<div class="paragraph">
<p>To Generate all docker images run `./gradlew buildDocker'</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_documentation_from_asciidoc_sources"><a class="anchor" href="#_generating_documentation_from_asciidoc_sources"></a>48.4. Generating documentation (from AsciiDoc sources)</h3>
<div class="paragraph">
<p>The sources for the documentation are located under <code>src/docs/asciidoc</code>. To generate HTML pages from these sources,
use the <code>asciidoctor</code> gradle task from the project root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $OF_HOME
./gradlew asciidoctor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task output can be found under <code>$OF_HOME/build/docs/asciidoc</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_api_documentation"><a class="anchor" href="#_generating_api_documentation"></a>48.5. Generating API documentation</h3>
<div class="paragraph">
<p>The documentation for the API is generated from the <code>swagger.yaml</code> definitions using SwaggerUI. To generate the
API documentation, use the <code>generateSwaggerUI</code> gradle task, either from the project root or from one of the services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $OF_HOME
./gradlew generateSwaggerUI</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task output can be found for each service under <code>[service-path]/build/docs/api</code>
(for example <code>services/businessconfig/build/docs/api</code>). Open the <code>index.html</code> file in a browser to have a look at
the generated SwaggerUI.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>49. Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p> <details><summary> 
<strong>Proxy error when running businessconfig-party docker-compose</strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Pulling rabbitmq (rabbitmq:3-management)...
ERROR: Get https://registry-1.docker.io/v2/: Proxy Authentication Required</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>When running docker-compose files using businessconfig-party images(such as rabbitmq,
mongodb etc.) the first time, docker will need to pull these images from
their repositories.
If the docker proxy isn&#8217;t set properly, you will see the above message.</p>
</div>
<div class="paragraph">
<p>To set the proxy, follow <a href="https://docs.docker.com/config/daemon/systemd/">these
steps from the docker documentation</a>.</p>
</div>
<div class="paragraph">
<p>If your proxy needs authentication, add your user and password as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP_PROXY=http://user:password@proxy.example.com:80/</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The password should be URL-encoded.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Gradle Metaspace error</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>Gradle task (for example gradle build) fails with the following error:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>* What went wrong:
Metaspace</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>Issue with the Gradle daemon. Stopping the daemon using <code>./gradlew --stop</code>
and re-launching the build should solve this issue.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Java version not available when setting up environment</strong>
 </summary><div> 
When sourcing the <a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a>
script to set up your environment, you might get the following error message:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Stop! java 8.0.192-zulu is not available. Possible causes:
 * 8.0.192-zulu is an invalid version
 * java binaries are incompatible with Linux64
 * java has not been released yet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select the next available version and update
<a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a> accordingly before
sourcing it again.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The java version currently listed in the script might have been deprecated
(for security reasons) or might not be available for your operating system
(for example, 8.0.192-zulu wasn&#8217;t available for Ubuntu).</p>
</div>
<div class="paragraph">
<p>Run <code>sdk list java</code> to find out which versions are available. You will get
this kind of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>================================================================================
Available Java Versions
================================================================================
     13.ea.16-open       9.0.4-open          1.0.0-rc-11-grl
     12.0.0-zulu         8.0.202-zulu        1.0.0-rc-10-grl
     12.0.0-open         8.0.202-amzn        1.0.0-rc-9-grl
     12.0.0-librca       8.0.202.j9-adpt     1.0.0-rc-8-grl
     11.0.2-zulu         8.0.202.hs-adpt
     11.0.2-open         8.0.202-zulufx
     11.0.2-amzn         8.0.202-librca
     11.0.2.j9-adpt      8.0.201-oracle
     11.0.2.hs-adpt  &gt; + 8.0.192-zulu
     11.0.2-zulufx       7.0.211-zulu
     11.0.2-librca       6.0.119-zulu
     11.0.2-sapmchn      1.0.0-rc-15-grl
     10.0.2-zulu         1.0.0-rc-14-grl
     10.0.2-open         1.0.0-rc-13-grl
     9.0.7-zulu          1.0.0-rc-12-grl

================================================================================
+ - local version
* - installed
&gt; - currently in use
================================================================================</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>BUILD FAILED with message <code>Execution failed for task ':ui:main-user-interface:npmInstall'.</code></strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>FAILURE: Build failed with an exception.

    What went wrong:
    Execution failed for task ':ui:main-user-interface:npmInstall'.</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>A <code>sudo</code> has been used before the <code>./gradlew assemble</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t use <strong>sudo</strong> to build OperatorFabric otherwise unexpected problems could arise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl get Failed to connect to localhost:2002: Connection refused</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>curl: (7) Failed to connect to localhost port 2002: Connexion refused</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The <code>web-ui</code> docker container stops running. Check its configuration.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by ngnix</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/thirds/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.17.10&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested page is not or no more mapped by the <code>nginx.conf</code> of <code>web-ui</code>.
Update it or check for the new end point of the desired page.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig</code> replaces now the former <code>thirds</code> end-point.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by OperatorFabric</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/businessconfig/ -H &quot;Authorization: Bearer ${token}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid OAuth2 JWT.</p>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>{&quot;timestamp&quot;:&quot;XXXX-XX-XXTXX:XX:XX.XXX+00:00&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:&quot;&quot;,&quot;path&quot;:&quot;/businessconfig&quot;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>XXXX-XX-XXTXX:XX:XX.XXX+00:00</code> is a time stamp corresponding to the moment when the request has been sent.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested end-point is not or no more valid in <code>OperatorFabric</code>.
Check the API documentation for correct path.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig/processes</code> is a correct end-point whereas <code>businessconfig</code> alone is not.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>ERROR: for web-ui</code> when running docker-compose in <code>${OF_HOME}/config/dev</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>ERROR: for web-ui  Cannot start service web-ui: OCI runtime create failed: container_linux.go:345: starting container process caused &quot;process_linux.go:430: container init caused \&quot;rootfs_linux.go:58: mounting \\\&quot;/home/legallron/projects/operatorfabric-core/config/dev/nginx.conf\\\&quot; to rootfs </code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code></code> is specific to the runtime environment.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is no <code>nginx.conf</code> file in the <code>${OF_HOME}/conf/dev</code> directory.</p>
</div>
<div class="paragraph">
<p>A first run of OperatorFabric <code>docker-compose</code> in dev config needs a <code>nginx.conf</code> file.
To create it, and run a docker-compose environment use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>If docker-compose has created a <code>nginx.conf</code> directory, delete it before running the previous commands.</p>
</div>
<div class="paragraph">
<p>Once this <code>nginx.conf</code> file created a simple <code>docker-compose up -d</code> is enough to run a dev docker-compose environment.
Sometimes a <code>nginx.conf</code> has been created as an attempt to launch the <code>web-ui</code> docker.
See the following section to resolve this.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>/docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code> when running <code>${OF_HOME}/config/dev/docker-compose.sh</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>./docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes</div>
<p>A <code>docker-compose up</code> has been run previously without <code>nginx.conf</code>.
A folder named <code>nginx.conf</code> has been created by <code>docker-compose</code>.</p>
</div>
<div class="paragraph">
<div class="title">Resolution</div>
<p>You have rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
rm -rf nginx.conf
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have the rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker run -ti --rm -v $(pwd):/current alpine # if there is no `alpine` docker available it will pull it from dockerHub
# your are now in the alpine docker container
cd /current
rm -rf nginxconf
&lt;ctrl-d&gt; # to exit the `alpine` container bash environement
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>An unhandled exception occurred: Call retries were exceeded</code> occurs when using <code>ng build</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/ui/main
ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See &quot;/tmp/ng-&lt;random-string&gt;/angular-errors.log&quot; for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is not enough allocated memory space to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use the following command to solve the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak_configuration"><a class="anchor" href="#_keycloak_configuration"></a>50. Keycloak Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration needed for development purposes is automatically loaded from the dev-realms.json file.
However, the steps below describe how they can be reproduced from scratch on a blank Keycloak instance in case you
want to add to it.</p>
</div>
<div class="paragraph">
<p>The Keycloak Management interface is available here:  [host]:89/auth/admin
Default credentials are admin/admin.</p>
</div>
<div class="sect2">
<h3 id="_add_realm"><a class="anchor" href="#_add_realm"></a>50.1. Add Realm</h3>
<div class="ulist">
<ul>
<li>
<p>Click top left down arrow next to Master</p>
</li>
<li>
<p>Add Realm</p>
</li>
<li>
<p>Name it dev (or whatever)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup_at_least_one_client_or_best_one_per_service"><a class="anchor" href="#_setup_at_least_one_client_or_best_one_per_service"></a>50.2. Setup at least one client (or best one per service)</h3>
<div class="sect3">
<h4 id="_create_client"><a class="anchor" href="#_create_client"></a>50.2.1. Create client</h4>
<div class="ulist">
<ul>
<li>
<p>Click Clients in left menu</p>
</li>
<li>
<p>Click Create Button</p>
</li>
<li>
<p>Set client ID to "opfab-client" (or whatever)</p>
</li>
<li>
<p>Select Openid-Connect Protocol</p>
</li>
<li>
<p>Click Next</p>
</li>
<li>
<p>Enable client authentication</p>
</li>
<li>
<p>Enable authorization</p>
</li>
<li>
<p>Select Authentication flows: Standard flow, Direct access grants, Implicit flow</p>
</li>
<li>
<p>Click Next</p>
</li>
<li>
<p>Enter Valid redirect URIs : <a href="http://localhost:2002/*" class="bare">localhost:2002/*</a></p>
</li>
<li>
<p>Add Valid redirect URIs : <a href="http://localhost:4200/*" class="bare">localhost:4200/*</a></p>
</li>
<li>
<p>Click Save</p>
</li>
<li>
<p>Remove Web origins settings</p>
</li>
<li>
<p>Click Save</p>
</li>
<li>
<p>Select Client scopes tab</p>
</li>
<li>
<p>Click on opfab-client-dedicated</p>
</li>
<li>
<p>From Mappers tab click Add Mapper</p>
</li>
<li>
<p>Select by configuration</p>
</li>
<li>
<p>Select User Property</p>
</li>
<li>
<p>name it sub</p>
</li>
<li>
<p>set Property to username</p>
</li>
<li>
<p>set Token claim name to sub</p>
</li>
<li>
<p>enable add to access token</p>
</li>
<li>
<p>save</p>
</li>
<li>
<p>From Mappers tab click Add Mapper</p>
</li>
<li>
<p>Select by configuration</p>
</li>
<li>
<p>Select User Attribute</p>
</li>
<li>
<p>name it groups</p>
</li>
<li>
<p>set Property to groups</p>
</li>
<li>
<p>set User attribute to groups</p>
</li>
<li>
<p>set Token claim name to groups</p>
</li>
<li>
<p>enable add to access token</p>
</li>
<li>
<p>save</p>
</li>
<li>
<p>From Mappers tab click Add Mapper</p>
</li>
<li>
<p>Select by configuration</p>
</li>
<li>
<p>Select User Attribute</p>
</li>
<li>
<p>name it groups</p>
</li>
<li>
<p>set Property to entitiesId</p>
</li>
<li>
<p>set User attribute to entitiesId</p>
</li>
<li>
<p>set Token claim name to entitiesId</p>
</li>
<li>
<p>enable add to access token</p>
</li>
<li>
<p>save</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_users"><a class="anchor" href="#_create_users"></a>50.3. Create Users</h3>
<div class="ulist">
<ul>
<li>
<p>Click Users in left menu</p>
</li>
<li>
<p>Click Add User button</p>
</li>
<li>
<p>Set username to admin</p>
</li>
<li>
<p>Create</p>
</li>
<li>
<p>Select Credentials tab</p>
</li>
<li>
<p>set password and confirmation to "test"</p>
</li>
<li>
<p>disable Temporary flag</p>
</li>
<li>
<p>Select Attributes tab</p>
</li>
<li>
<p>add groups or entitiesId attributes if needed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>repeat process for other users:
operator3_fr, operator1_fr, operator2_fr, etc ..</p>
</div>
<div class="sect3">
<h4 id="_development_specific_configuration"><a class="anchor" href="#_development_specific_configuration"></a>50.3.1. Development-specific configuration</h4>
<div class="paragraph">
<p>To facilitate development, in  the configuration file provided in the git (dev-realms.json) ,session are set to have
a duration of 10 hours (36000 seconds) and SSL is not required. These parameters should not be used in production.</p>
</div>
<div class="paragraph">
<p>The following parameters are set :
accessTokenLifespan : 36000
ssoSessionMaxLifespan : 36000
accessCodeLifespan" : 36000
accessCodeLifespanUserAction : 36000
sslRequired : none</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_oauth2_token_with_the_cli"><a class="anchor" href="#_using_oauth2_token_with_the_cli"></a>51. Using OAuth2 token with the CLI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_a_token_2"><a class="anchor" href="#_get_a_token_2"></a>51.1. Get a token</h3>
<div class="paragraph">
<p>End point: <code><a href="http://localhost:2002/auth/token" class="bare">localhost:2002/auth/token</a></code></p>
</div>
<div class="paragraph">
<p>Method: <code>POST</code></p>
</div>
<div class="paragraph">
<p>Body arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>client_id: <code>string</code> constant=<code>clientIdPassword</code>;</p>
</li>
<li>
<p>grant_type: <code>string</code> constant=<code>password</code>;</p>
<div class="ulist">
<ul>
<li>
<p>username: <code>string</code> any value, must match an OperatorFabric registered user name;</p>
</li>
</ul>
</div>
</li>
<li>
<p>password: <code>string</code> any value;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will be for <code>admin</code> user.</p>
</div>
<div class="sect3">
<h4 id="_curl"><a class="anchor" href="#_curl"></a>51.1.1. Curl</h4>
<div class="paragraph">
<p>command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"username=admin&amp;password=test&amp;grant_type=password&amp;client_id=clientIdPassword"
http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cC
I6MTU1MjY1OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOi
IwMmQ4MmU4NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZF
Bhc3N3b3JkIiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0
rWVtFGAZzRHj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdK
VAz0CkMKqng4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVD
SJew1rj5EiSybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZC
AYVM-mmHbjk8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw","to
ken_type":"bearer","refresh_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWI
iOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLCJ1c2VyX2luZm8iXSwiYXRpIjoiMDJkODJlODUtMTNmMC0
0Njc4LTk3NGQtMThlYjA2MjE1YTY1IiwiZXhwIjoxNTUyNzAxMTM4LCJhdXRob3JpdGllcyI6WyJST0x
FX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aSI6IjMwOWY2ZDllLWNmOGEtNDg0YS05ZjMxLWViOTAxYzk
4YTFkYSIsImNsaWVudF9pZCI6ImNsaWVudElkUGFzc3dvcmQifQ.jnZDt6TX2BvlmdT5JV-A7eHTJz_s
lC5fHrJFVI58ly6N7AUUfxebG_52pmuVHYULSKqTJXaLR866r-EnD4BJlzhk476FtgtVx1nazTpLFRLb
8qDCxeLrzClQBkzcxOt6VPxB3CD9QImx3bcsDwjkPxofUDmdg8AxZfGTu0PNbvO8TKLXEkeCztLFvSJM
GlN9zDzWhKxr49I-zPZg0XecgE9j4WITkFoDVwI-AfDJ3sGXDi5AN55Sz1j633QoqVjhtc0lO50WPVk5
YT7gU8HLj27EfX-6vjnGfNb8oeq189-NX100QHZM9Wgm79mIm4sRgwhpv-zzdDAkeb3uwIpb8g","exp
ires_in":1799,"scope":"read
user_info","jti":"02d82e85-13f0-4678-974d-18eb06215a65"}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie"><a class="anchor" href="#_httpie"></a>51.1.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/token username=admin password=test
grant_type=password client_id=clientIdPassword</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 13:57:19 GMT
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "access_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOS
wiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yz
g3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2
NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd
3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST
8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge
8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfD
J6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q",
    "expires_in": 1799,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "refresh_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLC
J1c2VyX2luZm8iXSwiYXRpIjoiNjI0MzA5YjEtN2M4Ny00Y2RjLTg0NDMtMDEyNDUxNWY4N2Y4IiwiZX
hwIjoxNTUyNzAxNDM5LCJhdXRob3JpdGllcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aS
I6ImRiYzMxNTJiLTM4YTUtNGFmZC1hY2VmLWVkZTI4MjJkOTE3YyIsImNsaWVudF9pZCI6ImNsaWVudE
lkUGFzc3dvcmQifQ.Ezd8kbfNQHOOvUCNNN4UmOOkncHiT9QVEM63FiW1rq0uXDa3xfBGil8geM5MsP0
7Q2He-mynkFb8sGNDrAXTdO-8r5o4a60zWrktrMg2QH4icC1lyeZpiwZxe6675QpLpSeMlXt9PdYj-pb
14lrRookxXP5xMQuIMteZpbtby7LuuNAbNrjveZ1bZ4WMi7zltUzcYUuqHlP1AYPteGRrJVKXiuPpoDv
gwMsEk2SkgyyACI7SdZZs8IT9IGgSsIjjgTMQKzj8P6yYxNLUynEW4o5y1s2aAOV0xKrzkln9PchH9zN
qO-fkjTVRjy_LBXGq9zkn0ZeQ3BUe1GuthvGjaA",
    "scope": "read user_info",
    "token_type": "bearer"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token"><a class="anchor" href="#_extract_token"></a>51.2. Extract token</h3>
<div class="paragraph">
<p>From the previous results, the data needed to be considered to be authenticated by OperatorFabric services is the content of the <code>"access_token"</code> attribute of the body response.</p>
</div>
<div class="paragraph">
<p>Once this value extracted, it needs to be passed at the end of the value of the http HEADER of type <code>Authorization:Bearer</code>. Note that a space is needed between <code>Bearer</code> and token actual value.
example from previous results:</p>
</div>
<div class="sect3">
<h4 id="_curl_2"><a class="anchor" href="#_curl_2"></a>51.2.1. Curl</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1OTczOCw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4NS0xM2Y
wLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzRHj7KPga
OXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqng4kQeQm
_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5EiSybuy83
PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbjk8mF89f
L9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_2"><a class="anchor" href="#_httpie_2"></a>51.2.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOSw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yzg
3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd3
PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST8
fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge8
scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfDJ
6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_a_token"><a class="anchor" href="#_check_a_token"></a>51.3. Check a token</h3>
<div class="sect3">
<h4 id="_curl_3"><a class="anchor" href="#_curl_3"></a>51.3.1. Curl</h4>
<div class="paragraph">
<p>from previous example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1
OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4
NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3Jk
Iiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzR
Hj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqn
g4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5Ei
Sybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbj
k8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw"
http://localhost:2002/auth/check_token</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "sub":"admin",
    "scope":["read","user_info"],
    "active":true,"exp":1552659738,
    "authorities":["ROLE_ADMIN","ROLE_USER"],
    "jti":"02d82e85-13f0-4678-974d-18eb06215a65",
    "client_id":"clientIdPassword"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_3"><a class="anchor" href="#_httpie_3"></a>51.3.2. Httpie</h4>
<div class="paragraph">
<p>from previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/check_token
token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2M
DAzOSwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliM
S03Yzg3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkI
iwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2q
Fa5Bd3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lH
Dd8ST8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNX
J4Bge8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeA
pKdfDJ6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 14:19:31 GMT
Expires: 0
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "active": true,
    "authorities": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "client_id": "clientIdPassword",
    "exp": 1552660039,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "scope": [
        "read",
        "user_info"
    ],
    "sub": "admin"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token_2"><a class="anchor" href="#_extract_token_2"></a>51.4. Extract token</h3>
<div class="paragraph">
<p>The utility <code>jq</code>, sadly not always available on some Linux distro, parses json input and extracts requested json path value(<code>access_token</code> here).
Here is a way to do so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell"> curl -d &quot;username=${user}&amp;password=${password}&amp;grant_type=password&amp;client_id=opfab-client&quot; &quot;http://localhost:2002/auth/token&quot; | jq -r .access_token</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${user}</code>: login existing on keycloak for operatorfabric;</p>
</li>
<li>
<p><code>${password}</code>: password for the previous login in keycloak;</p>
</li>
<li>
<p><code>opfab-client</code>:  is the id of the client for OperatorFabric associated to the <code>dev</code> realm in Keycloak in a <code>dev</code>(<code>${OF_HOME/config/dev</code>) or <code>docker</code>(<code>${OF_HOME/config/docker</code>) configuration of operatorFabric.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-r</code> option, for raw, leaves the output without any quotes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_implementation"><a class="anchor" href="#_kafka_implementation"></a>52. Kafka Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic.
In the default configuration Kafka is disabled.</p>
</div>
<div class="sect2">
<h3 id="_setup_kafka_environment"><a class="anchor" href="#_setup_kafka_environment"></a>52.1. Setup Kafka environment</h3>
<div class="paragraph">
<p>If you do not have a Kafka environment running you need to set one up so the Kafka consumers and producers can find each other.
You can for example download <a href="{lense}">lenses.io</a> for an easy-to-use broker with a graphical interface. Another option is to add
a free broker like a bitnami Kafka image to docker compose. To do so, add the following lines to <code>config/dev/docker-compose.yml</code> or
<code>config/docker/docker-compose.yml</code> for the zookeeper and bitnami images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">services</span>:
  <span class="key">zookeeper</span>:
    <span class="key">image</span>: <span class="string"><span class="content">bitnami/zookeeper:3</span></span>
    <span class="key">ports</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">2181:2181</span><span class="delimiter">&quot;</span></span>
    <span class="key">environment</span>:
      <span class="key">ALLOW_ANONYMOUS_LOGIN</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>
  <span class="key">kafka</span>:
    <span class="key">image</span>: <span class="string"><span class="content">bitnami/kafka:2</span></span>
    <span class="key">ports</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">9092:9092</span><span class="delimiter">&quot;</span></span>
    <span class="key">environment</span>:
      <span class="key">KAFKA_BROKER_ID</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_LISTENERS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PLAINTEXT://:9092</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_ADVERTISED_LISTENERS</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PLAINTEXT://172.17.0.1:9092</span><span class="delimiter">&quot;</span></span>
      <span class="key">KAFKA_ZOOKEEPER_CONNECT</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeper:2181</span><span class="delimiter">&quot;</span></span>
      <span class="key">ALLOW_PLAINTEXT_LISTENER</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>
  <span class="key">rabbitmq</span>:</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_kafka"><a class="anchor" href="#_enabling_kafka"></a>52.2. Enabling Kafka</h3>
<div class="paragraph">
<p>To enable Kafka support you need to set the <code>kafka.consumer.group_id property</code> in the <code>cards-publication.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">spring</span>:
    <span class="key">kafka</span>:
      <span class="key">consumer</span>:
        <span class="key">group-id</span>: <span class="string"><span class="content">opfab-command</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default topic from which the messages are consumed is called <code>opfab</code>. This setting can be modified by setting <code>opfab.kafka.card.topics.topicname</code>. Messages are encoded in the <code>CardCommand.card</code> field.
The default topic to which messages are produced is called <code>opfab-response</code>. This setting can be modified by setting the <code>opfab.kafka.topics.response-card</code>, see below. Messages produced by Operator Fabric are encoded in the <code>CardCommand.responseCard</code> field</p>
</div>
<div class="paragraph">
<p>The default Kafka Avro serializers and deserializers need a registry service. Make sure the registry service setting is provided in
the <code>card-publication.yml</code> file. When you use the provided <code>KafkaAvroWithoutRegistrySerializer</code> and
<code>KafkaAvroWithoutRegistryDeserializer</code> no schema registry setting is needed.</p>
</div>
<div class="paragraph">
<p>With the default settings, the Kafka consumer expects a broker running on http//127.0.0.1:9092 and a schema registry on <a href="http://127.0.0.1:8081" class="bare">127.0.0.1:8081</a>.</p>
</div>
<div class="paragraph">
<p>Example settings for the cards-publication.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">kafka</span>:
      <span class="key">topics</span>:
        <span class="key">card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab</span></span>
        <span class="key">response-card</span>:
          <span class="key">topicname</span>: <span class="string"><span class="content">opfab-response</span></span>
      <span class="key">schema</span>:
        <span class="key">registry</span>:
          <span class="key">url</span>: <span class="string"><span class="content">http://localhost:8081</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#cards-pub-conf">Cards-publication service</a>
for more settings.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.confluent.io/current/schema-registry/index.html">Schema management</a> for detailed information on using and benefits of a schema registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_kafka_source_code"><a class="anchor" href="#_operatorfabric_kafka_source_code"></a>52.3. OperatorFabric Kafka source code</h3>

</div>
<div class="sect2">
<h3 id="_listener_deserializer"><a class="anchor" href="#_listener_deserializer"></a>52.4. Listener / deserializer</h3>
<div class="paragraph">
<p>Most of the OperatorFabric Kafka implementation can be found at</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.opfab.cards.publication.kafka</code></dt>
<dd>
<p>for
the implementation of the deserializers and mapping of Kafka topics to OperatorFabric cards and</p>
</dd>
<dt class="hdlist1"><code>org.opfab.autoconfigure.kafka</code> </dt>
<dd>
<p>for the various Kafka configuration options.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_kafka_operatorfabric_avro_schema"><a class="anchor" href="#_kafka_operatorfabric_avro_schema"></a>52.4.1. Kafka OperatorFabric AVRO schema</h4>
<div class="paragraph">
<p>The AVRO schema, the byte format in which messages are transferred using Kafka topics, can be found at <code>client/src/main/avro</code>.
Message are wrapped in a CardCommand object before being sent to a Kafka topic. The CardCommand consists of some additional information and the
OperatorFabric card itself, see also <a href="#card_structure">Card Structure</a>. The additional information, for example CommandType, consists mostly of the information
present in a REST operation but not in Kafka. For example the http method (POST, DELETE, UPDATE) used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_kafka"><a class="anchor" href="#_configure_kafka"></a>52.5. Configure Kafka</h3>
<div class="sect3">
<h4 id="_setting_a_new_deserializer"><a class="anchor" href="#_setting_a_new_deserializer"></a>52.5.1. Setting a new deserializer</h4>
<div class="paragraph">
<p>By default, OperatorFabric uses the  <code>io.confluent.kafka.serializers.KafkaAvroDeserializer</code> from <a href="https://www.confluent.io/">Confluent</a>. However, you can write your own
deserializer. To use your own deserializer, make sure
<code>spring.deserializer.value.delegate.class</code> points to your deserializer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_a_broker"><a class="anchor" href="#_configuring_a_broker"></a>52.5.2. Configuring a broker</h4>
<div class="paragraph">
<p>When you have a broker running on localhost port 9092, you do not need to set the bootstrap severs. If this is not the case, you need tell
Operator Fabric where the broker can be found. You can do so by setting the bootstrap-servers property in the <code>cards-publication.yml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">kafka</span>:
    <span class="key">bootstrap-servers</span>: <span class="string"><span class="content">172.17.0.1:9092</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_card_producer"><a class="anchor" href="#_kafka_card_producer"></a>52.6. Kafka card producer</h3>
<div class="paragraph">
<p>To send a CardCommand to OperatorFabric, start by implementing a simple Kafka producer by following for example <a href="https://docs.spring.io/spring-kafka/reference/html/">Spring for Apache Kafka</a>.
Note that some properties of CardCommand or its embedded Card are required. If not set, the card will be rejected by OperatorFabric.</p>
</div>
<div class="paragraph">
<p>When you dump the card (which is about to be put on a topic) to stdout, you should see something like the line below. Do ignore the actual values from the dump below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">command</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE_CARD</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">integrationTest</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa6ce61f-192f-11eb-a6e3-eea952defe56</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">card</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">parentCardUid</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myFirstPublisher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publishDate</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lttd</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1603897942000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1604070742000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timeSpans</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.title</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.summary</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">userRecipients</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso1-operator</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso2-operator</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesAllowedToRespond</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">hasBeenAcknowledged</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">action</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">Just do something</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_response_cards"><a class="anchor" href="#_response_cards"></a>52.7. Response Cards</h3>
<div class="paragraph">
<p>OperatorFabric
<a href="#response_cards">response cards</a>
can be sent by REST of put on a Kafka topic. The Kafka response card configuration follows the
convention to configure a REST endpoint. Instead of setting the 'http://host/api' URL, you set it to 'kafka:response-topic' in the <code>external-recipients:</code>
section from the cards-publication.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">operatorfabric</span>:
  <span class="key">cards-publication</span>:
    <span class="key">external-recipients</span>:
      <span class="key">recipents</span>:
        - <span class="string"><span class="content">id: &quot;processAction&quot;</span></span>
          <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
          <span class="key">propagateUserToken</span>: <span class="string"><span class="content">false</span></span>
        - <span class="string"><span class="content">id: &quot;mykafka&quot;</span></span>
          <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">kafka:topicname</span><span class="delimiter">&quot;</span></span>
          <span class="key">propagateUserToken</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>topicname</code> is a placeholder for now. All response cards are returned via the same Kafka response topic, as specified in the <code>opfab.kafka.topics.response-card</code> field.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mailhog_smtp_server"><a class="anchor" href="#_mailhog_smtp_server"></a>53. MailHog SMTP server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>MailHog is an SMTP mail server suitable for testing.
Opfab uses MailHog to test mail notification service.
MailHog allows to view sent messages in the web UI, or retrieve them with the JSON API.</p>
</div>
<div class="sect2">
<h3 id="_mailhog_docker_container"><a class="anchor" href="#_mailhog_docker_container"></a>53.1. MailHog docker container</h3>
<div class="paragraph">
<p>A MailHog docker container is configured in Opfab docker-compose.yaml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">mailhog</span>:
    <span class="key">image</span>: <span class="string"><span class="content">mailhog/mailhog:v1.0.1</span></span>
    <span class="key">ports</span>:
      - <span class="string"><span class="content">1025:1025</span></span>
      - <span class="string"><span class="content">8025:8025</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The container exposes port 1025 for SMTP protocol and port 8025 for web UI and HTTP REST API.
Mailhog web interface is accesible at <code><a href="http://localhost:8025" class="bare">localhost:8025</a></code>.
Mailhog REST API allows to list, retrieve and delete messages.</p>
</div>
<div class="paragraph">
<p>For example, to retrieve the list of received messages, send an http GET request to: <code><a href="http://localhost:8025/api/v2/messages" class="bare">localhost:8025/api/v2/messages</a></code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependency_analysis"><a class="anchor" href="#_dependency_analysis"></a>54. Dependency analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inside the bin/dependencies directory, you can find scripts to help analyze the dependencies used by the project. These scripts should be executed from within the same directory.</p>
</div>
<div class="paragraph">
<p>The first script, named generateDependencyReport.sh, aggregates all dependency trees (including Java and npm dependencies) into a single file. The generated file includes the name of the current branch, making it easier to compare dependencies between branches.</p>
</div>
<div class="paragraph">
<p>The second script, searchForDependency.sh, allows you to search for dependencies based on the generated file. For example, if you are searching for the "rabbit" dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd bin/dependencies
./searchForDependency.sh rabbit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The analysis is conducted on the current branch by default. If you wish to utilize a report from another branch, you can specify it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./searchForDependency rabbit myBranch</code></pre>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_community" class="sect0"><a class="anchor" href="#_operatorfabric_community"></a>OperatorFabric Community</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The aim of this document is to present the OperatorFabric community, its code of conduct and to welcome contributors!</p>
</div>
<div class="paragraph">
<p>First, thank you for your interest !</p>
</div>
<div class="paragraph">
<p>We can&#8217;t stress enough that feedback, discussions, questions and contributions to OperatorFabric are very much
appreciated.</p>
</div>
<div class="paragraph">
<p>This project is governed by the <a href="../pdf/technical-charter.pdf">OperatorFabric Technical Charter</a>.</p>
</div>
<div class="paragraph">
<p>This project applies the LF Energy Code of Conduct. By participating, you are expected to uphold this code.
Please report unacceptable behavior to <a href="mailto:opfab_AT_lists.lfenergy.org">opfab_AT_lists.lfenergy.org</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license_and_DCO"><a class="anchor" href="#license_and_DCO"></a>55. License and Developer Certificate of Origin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is an open source project licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License 2.0</a>.
By contributing to OperatorFabric, you accept and agree to the terms and conditions for your present and future
contributions submitted to OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The project also uses a mechanism known as a <a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>
to ensure that we are legally allowed to distribute all the code and assets for the project. A DCO is a legally binding
statement that asserts that you are the author of your contribution, and that you wish to allow OperatorFabric to use
your work.</p>
</div>
<div class="paragraph">
<p>Contributors sign-off that they adhere to these requirements by adding a <code>Signed-off-by</code> line to commit messages. All
commits to any repository of the OperatorFabric organization have to be signed-off like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This is my commit message.

Signed-off-by: John Doe &lt;john.doe@email-provider.com&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can write it manually but Git has a -s command line option to append it automatically to your commit message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git commit -s -m 'This is my commit message'</pre>
</div>
</div>
<div class="paragraph">
<p>Most IDEs can also take care of this for you.</p>
</div>
<div class="paragraph">
<p>A check will be performed during the integration, making sure all commits in the Pull Request
contain a valid <code>Signed-off-by</code> line.</p>
</div>
<div class="paragraph">
<p>These processes and templates have been adapted from the ones defined by the <a href="https://github.com/powsybl">PowSyBl</a>
project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reporting_bugs_or_vulnerabilities_and_suggesting_enhancements"><a class="anchor" href="#_reporting_bugs_or_vulnerabilities_and_suggesting_enhancements"></a>56. Reporting Bugs or Vulnerabilities and Suggesting Enhancements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Anyone is welcome to report bugs and suggest enhancements or new features by opening a GitHub issue on this repository.
Vulnerabilities can be reported publicly in the same way.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_code_or_documentation"><a class="anchor" href="#_contributing_code_or_documentation"></a>57. Contributing Code or Documentation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contribution_workflow"><a class="anchor" href="#_contribution_workflow"></a>57.1. Contribution Workflow</h3>
<div class="sect3">
<h4 id="_principles"><a class="anchor" href="#_principles"></a>57.1.1. Principles</h4>
<div class="sect4">
<h5 id="_release_names"><a class="anchor" href="#_release_names"></a>57.1.1.1. Release names</h5>
<div class="paragraph">
<p>We use the following naming convention for our releases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>X.0.0.RELEASE</code> for major release (e.g. 1.0.0.RELEASE)</p>
</li>
<li>
<p><code>X.X.0.RELEASE</code> for minor release (e.g. 1.2.0.RELEASE)</p>
</li>
<li>
<p><code>X.X.X.RELEASE</code> for patch releases (e.g. 3.2.1.RELEASE)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_develop_branch"><a class="anchor" href="#_develop_branch"></a>57.1.1.2. <code>develop</code> branch</h5>
<div class="paragraph">
<p>The <code>develop</code> branch is where feature branches are branched off from, and where they&#8217;re merged back to. This way,
the HEAD of the <code>develop</code> branch always reflects a state with the latest delivered development changes for the next
release.</p>
</div>
<div class="paragraph">
<p>The repository version on the <code>develop</code> branch should always be <code>SNAPSHOT</code>.</p>
</div>
<div class="paragraph">
<p>A daily CRON GitHub Action generating the documentation and docker images for the <code>SNAPSHOT</code> version is run from
this branch.</p>
</div>
</div>
<div class="sect4">
<h5 id="_x_x_release_branch"><a class="anchor" href="#_x_x_release_branch"></a>57.1.1.3. <code>X.X.release</code> branch</h5>
<div class="paragraph">
<p>When the source code in the develop branch reaches a stable point and is ready to be released, all the changes
should be integrated in a release branch named X.X.release.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_branches"><a class="anchor" href="#_feature_branches"></a>57.1.1.4. Feature branches</h5>
<div class="paragraph">
<p>Feature branches are used to develop new features or fix bugs described in GitHub issues.
They have two distinct use cases with similar workflows.</p>
</div>
<div class="sect5">
<h6 id="_feature_branches_for_majorminor_version"><a class="anchor" href="#_feature_branches_for_majorminor_version"></a>Feature branches for major/minor version</h6>
<div class="paragraph">
<p>These feature branches are used to develop new features or fix bugs <strong>for the next release</strong>.</p>
</div>
<div class="paragraph">
<p>Their lifecycle is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A new feature branch is branched off <code>develop</code> before starting work on a feature or bug.</p>
</li>
<li>
<p>Once the developments are deemed ready by the developer(s) working on the feature, a pull request should be created
for this branch.</p>
</li>
<li>
<p>New pull requests are discussed during daily meetings to assign someone from the Reviewers group to the issue.</p>
</li>
<li>
<p>The pull request author and reviewer(s) then make use of the
<a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests">Git Hub pull requests</a>
features (comments, proposed changes, etc.) to make changes to the PR until it meets the project requirements.</p>
</li>
<li>
<p>Once it is ready to be included in the next version, the pull request is then merged back into <code>develop</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_feature_branches_for_patch_versions"><a class="anchor" href="#_feature_branches_for_patch_versions"></a>Feature branches for patch versions</h6>
<div class="paragraph">
<p>These feature branches fix bugs in existing releases and give rise to new patches.</p>
</div>
<div class="paragraph">
<p>Their lifecycle is similar to regular feature branches, except they should be branched off (and merged back to) the
<code>X.X.release</code> branch corresponding to the release they are fixing.</p>
</div>
<div class="paragraph">
<p>Example: A feature branch working on bug 1234 affecting version 1.8.0.RELEASE should be branched off
branch <code>1.8.release</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_common_conventions"><a class="anchor" href="#_common_conventions"></a>Common conventions</h6>
<div class="paragraph">
<p><strong>Naming convention:</strong> Feature branches names should always start with "FE-" followed by the reference of the GitHub issue
they&#8217;re addressing, followed by additional information to give context.</p>
</div>
<div class="ulist">
<div class="title">Examples of valid feature branch names:</div>
<ul>
<li>
<p>FE-123-AddMailNotification</p>
</li>
<li>
<p>FE-123-FixIssueWithMailNotification</p>
</li>
<li>
<p>FE-123-RefactorBundleCompression</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Examples of invalid feature branch names:</div>
<ul>
<li>
<p>123</p>
</li>
<li>
<p>FE-123</p>
</li>
<li>
<p>SomeTextDescribingTheBranch</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commit messages should also contain the GitHub issue reference: ` My commit message (#123)`</p>
</div>
<div class="paragraph">
<p>This allows the branch, PR and commits to be directly accessible from the GitHub issue.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_and_commands"><a class="anchor" href="#_examples_and_commands"></a>57.1.2. Examples and commands</h4>
<div class="paragraph">
<p>The aim of this section is to illustrate how our workflow works on a concrete example, complete with the required
<code>git</code> commands.</p>
</div>
<div class="sect4">
<h5 id="_starting_work_on_a_new_feature_for_the_next_version"><a class="anchor" href="#_starting_work_on_a_new_feature_for_the_next_version"></a>57.1.2.1. Starting work on a new feature for the next version</h5>
<div class="paragraph">
<p>Let&#8217;s say we want to start working on a feature described in GitHub issue #123.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout develop <i class="conum" data-value="1"></i><b>(1)</b>
git pull <i class="conum" data-value="2"></i><b>(2)</b>
git checkout -b FE-123 <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check out the <code>develop</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Make sure it is up to date with the remote (=GitHub repository)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a <code>FE-123</code> off the <code>develop</code> branch</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, you can start working on the feature and commit your work to the branch. Referencing the issue you&#8217;re working
on at the end of the commit message allows the commit to be listed on the issue&#8217;s page for future reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git commit -s -m "Short message describing content of commit (#123)"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The -s flag is to automatically add a sign-off to your commit message, which is our way to implement the
<a href="#license_and_DCO">Developer Certificate of Origin</a>
.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At any point during your work you can push your feature branch to the GitHub repository, to back your work up, let
others look at your work or contribute to the feature.</p>
</div>
<div class="paragraph">
<p>To do this, just run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git push</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If it&#8217;s your first push to this branch, Git will prompt you to define the remote branch to be associated with
your local branch with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git push --set-upstream origin FE-123</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can re-work, squash your commits and push as many times as you want on a feature branch.
Force pushes are allowed on feature branches.</p>
</div>
</div>
<div class="sect4">
<h5 id="_submitting_a_pull_request_to_develop"><a class="anchor" href="#_submitting_a_pull_request_to_develop"></a>57.1.2.2. Submitting a pull request to develop</h5>
<div class="paragraph">
<p>Once you are satisfied with the state of your developments, you can submit it as a pull request.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before submitting your branch as a pull request, please squash/fix your commits to reduce the number of commits
and comment them accordingly. In the end, the division of changes into commits should make the PR easier to understand
and review.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should also take a look at the
<a href="#review_checklist">review checklist</a>
below to make sure your branch meets its criteria.</p>
</div>
<div class="paragraph">
<p>Open pull requests are then reviewed by the core maintainers to assign a reviewer to each of them.</p>
</div>
<div class="paragraph">
<p>To do so, go to the <code>branches</code> tab of the repository as described above.
Click the "New Pull Request" button for your branch.</p>
</div>
<div class="paragraph">
<p>Add a comment containing a short summary of the PR goal and any information that should go into the release notes.
It&#8217;s especially important for PRs that have a direct impact on existing OperatorFabric deployments, to alert administrators
of the impacts of deploying a new version and help them with the migration.
Whenever possible/relevant, a link to the corresponding documentation is appreciated.</p>
</div>
<div class="paragraph">
<p>You need to
<a href="https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue">link your PR to the issue it is fixing</a>
so merging the PR will automatically close the corresponding issue. You can do so either manually or by adding
"Fix #XXX" to the PR&#8217;s description.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the base branch for the PR is <code>develop</code>, because feature branches are meant to be merged back into
<code>develop</code>. This should be the default value since <code>develop</code> is the default branch on this repository, but if not, select
it in the base branch dropdown list.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="working_on_fix"><a class="anchor" href="#working_on_fix"></a>57.1.2.3. Working on a fix for a previous version</h5>
<div class="paragraph">
<p>To work on a fix for an existing version, the steps are similar to those described above, substituting <code>X.X.release</code> for
<code>develop</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reviewing_a_pull_request"><a class="anchor" href="#_reviewing_a_pull_request"></a>57.1.2.4. Reviewing a Pull Request</h5>
<div class="paragraph">
<p>Only developers from the <code>reviewers</code> group can merge pull requests into <code>develop</code>, but this shouldn&#8217;t
stop anyone interested in the topic of a PR to comment and review it.</p>
</div>
<div class="sect5">
<h6 id="review_checklist"><a class="anchor" href="#review_checklist"></a>Review checklist</h6>
<div class="ulist">
<ul>
<li>
<p>The PR comment contains the text to insert in release note. Otherwise, it should say why this development doesn&#8217;t need to be on the release notes.</p>
</li>
<li>
<p>If necessary, the PR should create or add content to a migration guide for the next version, under
<code>src/docs/asciidoc/resources</code></p>
</li>
<li>
<p>Check that GitHub Action build is passing for the PR</p>
</li>
<li>
<p>The SonarCloud analysis should report no new bug or code smells, and should pass the quality gate</p>
</li>
<li>
<p>Check that the base branch (i.e. the branch into which we want to merge changes) is correct: for feature branches pull requests, this branch should be <code>develop</code>.</p>
</li>
<li>
<p>Look through changed files to make sure everything is relevant to the PR (no mistakenly added changes,
no secret information, no malicious changes) and to see if you have remarks on the way things are implemented</p>
</li>
<li>
<p>Check that the commit(s) message(s) is(are) relevant and follow conventions</p>
</li>
<li>
<p>If there is more than one commit, is it meaningful or do we need to squash ?</p>
</li>
<li>
<p>Meaningful and sufficient unit tests for the backend</p>
</li>
<li>
<p>Meaningful unit tests for the frontend (Angular tests can be complex to implement, we should focus on testing complex logic and not the framework itself)</p>
</li>
<li>
<p>API testing via Karate has been updated</p>
</li>
<li>
<p>Documentation has been updated (especially if configuration is needed)</p>
</li>
<li>
<p>Migration guide has been updated if necessary</p>
</li>
<li>
<p>Configuration examples have been updated</p>
</li>
<li>
<p>Build and run OpFab locally to see the new feature or bug fix at work. In the case of a new feature, it&#8217;s also a way
of making sure that the configuration documentation is correct and easily understandable.</p>
</li>
<li>
<p>Check for error messages in the browser console.</p>
</li>
<li>
<p>Check the UI in resolution 1680x1050 (minimum supported resolution for all features)</p>
</li>
<li>
<p>Check the UI in smartphone resolution (only for feed, settings and notification filter features)</p>
</li>
<li>
<p>Depending on the scope of the PR , build docker images and test in docker mode</p>
</li>
<li>
<p>Check that the copyright header has been updated on the changed files if need be, and in the case of a first-time contributor, make sure they&#8217;re added to the AUTHORS.txt file.</p>
</li>
<li>
<p>Check new dependencies added to the project to see if they are compatible with the OperatorFabric license , see the following table</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_license_usage_restrictions"><a class="anchor" href="#_license_usage_restrictions"></a>License usage restrictions</h6>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>License Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SPX Identifier</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage, Restrictions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Academic Free License v1.1, v1.2, v2.0, v2.1, v3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AFL-1.1, AFL-1.2, AFL-2.0, AFL-2.1, AFL-3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None , Be careful of incompatibility with GPL license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache License 2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache-2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD 2-Clause "Simplified" License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD-2-Clause</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD 3-Clause "New" or "Revised" License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD-3-Clause</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD 4-Clause "Original" or "Old" License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BSD-4-Clause</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usage prohibited due to advertising clause.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Development and Distribution License 1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDDL-1.0 Moderate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library. Be careful of incompatibility with GPL license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Development and Distribution License 1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDDL-1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library.Be careful of incompatibility with GPL license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creative Commons Attribution 3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CC-BY-3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None. Suitable for documentation material.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creative Commons Attribution 4.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CC-BY-4.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None. Suitable for documentation material.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creative Commons Attribution Non Commercial (any version)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CC-BY-NC-&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non commercial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usage prohibited due to non commercial restriction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creative Commons Zero v1.0 Universal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CC0-1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free usage (public domain)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None. Suitable for documentation material.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse Public License 1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPL-1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library.Be careful of incompatibility with GPL license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eclipse Public License 2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EPL-2.0 Moderate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library GNU General Public License v2.0 only GPL-2.0-only Strong copyleft  Usage prohibited. Exemptions on a case by case basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU General Public License v2.0 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPL-2.0-or-later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strong copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usage prohibited. Exemptions on a case by case basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU General Public License v3.0 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPL-3.0-only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strong copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usage prohibited. Exemptions on a case by case basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU General Public License v3.0 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPL-3.0-or-later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strong copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Usage prohibited. Exemptions on a case by case basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU Lesser General Public License v2.1 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LGPL-2.1-only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU Lesser General Public License v2.1 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LGPL-2.1-or-later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU Lesser General Public License v3.0 only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LGPL-3.0-only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GNU Lesser General Public License v3.0 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LGPL-3.0-or-later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moderate copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISC License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIT License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mozilla Public License 2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MPL-2.0 Moderate (weak)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyleft</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only as a distinct library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SIL Open Font License 1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFL-1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive in relation to combination with non-font code (strong copyleft for font code)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for font components</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zlib License</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zlib</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permissive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_testing_environment_for_reviewer"><a class="anchor" href="#_testing_environment_for_reviewer"></a>Testing environment for reviewer</h6>
<div class="paragraph">
<p>Compile and run OperatorFabric docker images is the most effective way to check any regression.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull the submitted branch on a testing machine;</p>
</li>
<li>
<p>Run a <code>docker-compose</code> with the <code>${OF_HOME}/src/main/docker/test-environment/docker-compose.yml</code> file;</p>
</li>
<li>
<p>Create <code>SNAPSHOT</code> docker images, from the <code>${OF_HOME}</code> directory with the following command: <code>./gradlew clean buildDocker</code>;</p>
</li>
<li>
<p>Stop the <code>test-environment</code> docker-compose;</p>
</li>
<li>
<p>Go to <code>${OF_HOME}/config/docker</code>;</p>
</li>
<li>
<p>Run the <code>./docker-compose.sh</code> script (or use the <code>docker-compose.yml</code> with a <code>docker-compose</code> command);</p>
</li>
<li>
<p>Go to <code>${OF_HOME}/src/test/resources/</code>;</p>
</li>
<li>
<p>Run the following scripts: <code>./loadTestConf.sh &amp;&amp;  ./send6TestCards.sh</code>;</p>
</li>
<li>
<p>Open the front-end in a browser and look for any regression.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To automate build and API testing, you can use <code>${OF_HOME}/src/test/api/karate/buildAndLaunchAll.sh</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_merging_a_pull_request"><a class="anchor" href="#_merging_a_pull_request"></a>57.1.2.5. Merging a Pull Request</h5>
<div class="paragraph">
<p>Once the pull request meets all the criteria from the above check list, you can merge it into the <code>develop</code> branch.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the pull request page on GitHub</p>
</li>
<li>
<p>Check that the base branch for the pull request is <code>develop</code> (or <code>X.X.release</code>). This information is visible at the
top of the page.</p>
<div class="imageblock">
<div class="content">
<img src="../images/existing_PR_check_base.png" alt="existing PR check base">
</div>
</div>
</li>
<li>
<p>If that is not the case, you can edit the base branch by clicking the <code>Edit</code> button in the top right corner.</p>
</li>
<li>
<p>Click the <code>merge pull request</code> button at the bottom of the PR page</p>
</li>
<li>
<p>Make sure that the corresponding GitHub issue was associated to the project for the current release. It should now be
visible under the "Done" column. If not, add it to the project and put it there manually.</p>
</li>
<li>
<p>Go to the <a href="https://github.com/opfab/release-notes/">release-notes repository</a> and add the issue to the list with
the information provided in the PR comments.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_release"><a class="anchor" href="#_creating_a_release"></a>57.1.2.6. Creating a release</h5>
<div class="paragraph">
<p>See the
<a href="#release_process">release process</a>
described in our CICD documentation for details.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_guidelines"><a class="anchor" href="#_code_guidelines"></a>57.2. Code Guidelines</h3>
<div class="ulist">
<ul>
<li>
<p>We don&#8217;t mention specific authors by name in each file so as not
to have to maintain these mentions (since this information is tracked by git anyway).</p>
</li>
<li>
<p>For ui code, you must use prettier (<a href="https://prettier.io/" class="bare">prettier.io/</a>)  to format the code (config provided in .prettierrc.json in the git root repository). The file types to format via prettier are the following : js, ts, css and scss.</p>
</li>
<li>
<p>When adding a dependency, define a precise version of the dependency</p>
</li>
<li>
<p>When fixing a bug, the commit message shall be "Fix : Issue text (#XXXX) "</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_angulartypescript_development_caution_and_guidelines"><a class="anchor" href="#_angulartypescript_development_caution_and_guidelines"></a>57.2.1. Angular/TypeScript development caution and guidelines</h4>
<div class="ulist">
<ul>
<li>
<p>Use <code>foreach</code> to iterate over an array (instead of <code>for(let i = ..</code>).</p>
</li>
<li>
<p>Do not use ngFor / ngIf  with methods with computing as angular will call these methods very regularly
(around ten times per seconds), use instead variables and compute them only when necessary.</p>
</li>
<li>
<p>ngOnInit() :  ngOnInit is called when component is created, the creation is made by the parent component : be careful to check when initialization is done when calling method inside ngOnInit. When the context of the parent component change, it can lead to a new initialization or not.</p>
</li>
<li>
<p>Prefer using <code>*ngIf</code> over <code>hidden</code> property  to hide elements : <a href="https://stackoverflow.com/questions/51317666/when-should-i-use-ngif-over-hidden-property-and-vice-versa/51317774" class="bare">stackoverflow.com/questions/51317666/when-should-i-use-ngif-over-hidden-property-and-vice-versa/51317774</a></p>
</li>
<li>
<p>Do not use console.log or console.error, use specific opfab service : OpfabLoggerService</p>
</li>
<li>
<p>To give id to an HTML element, please use dashes between words and only lowercase letters. Example id="opfab-feed-filter-publish-date-to"</p>
</li>
<li>
<p>Always precise the return type of a function except when it is void (Example : <code>getUserName():string</code>)</p>
</li>
<li>
<p>Always precise the type of the function parameters (Example : <code>setUserName(name : string)</code>)</p>
</li>
<li>
<p>Function shall start with a verb (Example :  <code>showAlertPopup()</code>)</p>
</li>
<li>
<p>When the return type is a boolean, the method name shall be a yes/no question (Example : <code>isUserDeleted() : boolean</code>)</p>
</li>
<li>
<p>Whenever possible use changeDetection: ChangeDetectionStrategy.OnPush in the component decorator to improve performance</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_back_development"><a class="anchor" href="#_back_development"></a>57.2.2. Back development</h4>
<div class="ulist">
<ul>
<li>
<p>When developing a Spring Controller, you do not need to develop unit test, use karate api test (file pattern **/controllers/** is excluded from test coverage indicator in sonarCloud).</p>
</li>
<li>
<p>Do not use spring annotation (@Autowired, @PostConstruct.. ) in business code to avoid coupling business code with spring framework. This rules is recent so a lot of the business code depends on spring.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unit_test"><a class="anchor" href="#_unit_test"></a>57.2.3. Unit test</h4>
<div class="ulist">
<ul>
<li>
<p>Unit test shall not use random values which is considered as a bad practice</p>
</li>
<li>
<p>Unit test shall not use external resources (database, file system, network, &#8230;&#8203;)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation_guidelines"><a class="anchor" href="#_documentation_guidelines"></a>57.3. Documentation Guidelines</h3>
<div class="paragraph">
<p>The aim of this section is to explain how the documentation is currently organized and to give a few guidelines on how
it should be written.</p>
</div>
<div class="sect3">
<h4 id="_structure"><a class="anchor" href="#_structure"></a>57.3.1. Structure</h4>
<div class="paragraph">
<p>All the sources for the AsciiDoc documentation published on our <a href="https://opfab.github.io/">website</a> are found under
the <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs/asciidoc">src/docs/asciidoc</a> folder in the
operatorfabric-core repository.</p>
</div>
<div class="paragraph">
<p>It is organized into several folders (architecture documentation, deployment documentation, etc.). Each of these
folders represent a document and contain an <strong>index.adoc</strong> file, optionally referencing other adoc files (to break it
down into sections).</p>
</div>
<div class="paragraph">
<p>In addition, an <strong>images</strong> folder contains images for all documents and a <strong>resources</strong> folder contains various appendices
that might be of use to some people but that we felt weren&#8217;t part of the main documentation.</p>
</div>
<div class="paragraph">
<p>The table below gives a short summary of the content of each document as well as advice on which ones you should focus
on depending on your profile.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Contributor
</td>
<td class="hdlist2">
<p>A developer who contributes (or wishes to) to the OperatorFabric project</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Developer
</td>
<td class="hdlist2">
<p>A developer working on an application using OperatorFabric or a businessconfig-party application posting content to
an OperatorFabric instance</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Admin
</td>
<td class="hdlist2">
<p>Someone who is in charge of deploying and maintaining OperatorFabric in production as part of an integrated
solution</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Product Owner
</td>
<td class="hdlist2">
<p>Project managers, anyone interested in using OperatorFabric for their business requirements.</p>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Documentation Structure and Intended Readers</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Content</th>
<th class="tableblock halign-center valign-top">Contributor</th>
<th class="tableblock halign-center valign-top">Developer</th>
<th class="tableblock halign-center valign-top">Admin</th>
<th class="tableblock halign-center valign-top">Product Owner</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Architecture documentation</strong></p>
<p class="tableblock">Describes the business objects and concepts handled by OperatorFabric as well as the microservices architecture
behind it.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CICD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CICD Pipeline documentation</strong></p>
<p class="tableblock">Describes our CICD pipeline and release process</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">community</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OF Community documentation</strong></p>
<p class="tableblock">Everything about the OperatorFabric Community: Code of conduct, governance, contribution guidelines,
communication channels.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Deployment documentation</strong></p>
<p class="tableblock">Explains how to deploy and configure an OperatorFabric instance</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dev_env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Development Environment documentation</strong></p>
<p class="tableblock">Explains how to set up a working development environment for OperatorFabric with all the appropriate tooling and how to
run OperatorFabric in development mode.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This folder contains the documentation that should be archived for previous releases (as of today, the release notes
and single page documentation - see below).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getting_started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Getting Started Guide</strong>
guides you through setting up OperatorFabric and experimenting with its main features</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Maybe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reference_doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Reference Documentation</strong>
contains the reference documentation for each microservice. It starts off with a high-level functional documentation
and then goes into more technical details when needed.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to this asciidoctor documentation, API documentation is available in the form of SwaggerUI-generated html
pages. It is generated by the <code>generateSwaggerUI</code> Gradle task, using the swagger.yaml files from each service (for
example for the
<a href="https://github.com/opfab/operatorfabric-core/blob/master/services/businessconfig/src/main/modeling/swagger.yaml">BusinessConfig API</a>
). It can be found under the <strong>build/docs/api</strong> folder for each client or service project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conventions"><a class="anchor" href="#_conventions"></a>57.3.2. Conventions</h4>
<div class="ulist">
<ul>
<li>
<p>In addition to the "visible" structure described above, documents are broken down into coherent parts using the
<a href="https://asciidoctor.org/docs/user-manual/#include-directive">"include" feature of AsciiDoc</a>. This is done mostly to
avoid long files that are harder to edit, but it also allows us to reuse some content in different places.</p>
</li>
<li>
<p>Given the number of files this creates, we try to keep header attributes in files to a minimum. Instead, they&#8217;re
set in the configuration of the asciidoctor gradle task:</p>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">asciidoctor {

    baseDirFollowsSourceFile()

    sources {
        include <span class="string"><span class="delimiter">'</span><span class="content">*/index.adoc</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">docs/*</span><span class="delimiter">'</span></span>
    }
    resources {
        from(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/asciidoc</span><span class="delimiter">'</span></span>) {
            include <span class="string"><span class="delimiter">'</span><span class="content">images/*</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">pdf/*</span><span class="delimiter">'</span></span>
        }
    }
    attributes  nofooter            : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
            revnumber           : operatorfabric.version,
            revdate             : operatorfabric.revisionDate,
            sectnums            : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
            sectnumlevels       : <span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>,
            sectanchors         : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
            toc                 : <span class="string"><span class="delimiter">'</span><span class="content">left</span><span class="delimiter">'</span></span>,
            toclevels           : <span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>,
            icons               : <span class="string"><span class="delimiter">'</span><span class="content">font</span><span class="delimiter">'</span></span>,
            imagesdir           : <span class="string"><span class="delimiter">'</span><span class="content">../images</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hide-uri-scheme</span><span class="delimiter">&quot;</span></span>   : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">source-highlighter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">coderay</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In particular, the version and revision date are set automatically from the version defined in the
VERSION file at the root of the project and
the current date.</p>
</div>
</li>
<li>
<p>All files are created starting with level 0 titles so:</p>
<div class="ulist">
<ul>
<li>
<p>They can be generated on their own if need be.</p>
</li>
<li>
<p>They can be included at different levels in different documents using
<a href="https://asciidoctor.org/docs/user-manual/#include-partitioning">leveloffset</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In addition to being available as separate documents (architecture, reference, etc.) for the current release, the
documentation is also generated as a single page document available for all releases from the
<a href="https://opfab.github.io/pages/releases.html">releases</a> page. This is also a way to make searching the documentation
for specific terms easier, and could be used to generate a single page pdf documentation.</p>
</li>
<li>
<p>Unfortunately, this entails a little complexity for cross-references and relative links, because the path to
the content is a little different depending on whether the content is generated as different pages or as a single
page document.</p>
<div class="paragraph">
<p>For example, to link to the "Card Structure" section of the reference document from the architecture
document, one needs to use the following external cross-reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;&lt;/documentation/current/reference_doc/index.adoc#card_structure, Card Structure&gt;&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the single-page documentation however, both the architecture content and the reference content are part
of the same document, so the cross-reference becomes a simple internal cross-reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;&lt;card_structure, Card Structure&gt;&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This is managed by using the
<a href="https://asciidoctor.org/docs/user-manual/#conditional-preprocessor-directives"><code>ifdef</code> and <code>indef</code> directives</a> to
define which link syntax should be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ifdef::single-page-doc[&lt;&lt;card_structure, Card Structure&gt;&gt;]
ifndef::single-page-doc[&lt;&lt;/documentation/current/reference_doc/index.adoc#card_structure, Card Structure&gt;&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The label ("Card Structure" in this example) is defined with each link because it seems that defining it in the
target file along with the ID (<code>[[my_section_id, text to display]]</code>) doesn&#8217;t work with relative links.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the same way, for relative links to external files (mostly the API documentation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ifdef::single-page-doc[link:../api/cards/index.html#/archives[here]]
ifndef::single-page-doc[link:/documentation/current/api/cards/index.html#/archives[here]]</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For this to work, the
<a href="https://github.com/opfab/operatorfabric-core/blob/master/src/docs/asciidoc/docs/single_page_doc.adoc">single_page_doc.adoc</a>
file needs to have <code>:single-page-doc:</code> as a header attribute.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>As you can see in the examples above, we are using custom-defined section ids as anchors rather than taking advantage
of generated ones (see <a href="https://asciidoctor.org/docs/user-manual/#auto-generated-ids">documentation</a>).
This is cumbersome but:</p>
<div class="ulist">
<ul>
<li>
<p>Generation will give a warning if duplicate ids are defined, whereas with generated ids it will silently link to the
wrong section.</p>
</li>
<li>
<p>Restructuring the document might change the generated section ID, creating broken links.</p>
</li>
<li>
<p>Its easier to find referenced text (ctrl-f on id)</p>
</li>
<li>
<p>The presence of a custom-defined ID is a sign that the content is referenced somewhere else, which you should take
into account if you&#8217;re thinking of deleting or moving this content.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The :imagesdir: attribute is set globally as <code>../images</code>, because all images are stored under <code>src/docs/asciidoc/images</code>.</p>
</li>
<li>
<p>In addition to links, it is sometimes necessary to display the actual content of files (or part of it) in
the documentation (in the case of configuration examples, for instance).
Whenever possible, this should be done by using the
<a href="https://asciidoctor.org/docs/user-manual/#include-directive">include directive</a> rather than copying the content
into the adoc file.
This way the documentation will always be up to date with the file content at the time of generation.</p>
<div class="paragraph">
<p><em>See the <strong>build.gradle</strong> include above for an example using
<a href="https://asciidoctor.org/docs/user-manual/#by-tagged-regions">tags</a> to include only part of a file.</em></p>
</div>
</li>
<li>
<p>Source-highlighting is done using <a href="http://coderay.rubychan.de/">Coderay</a>. See their documentation for supported
languages, and the AsciiDoctor documentation on
<a href="https://asciidoctor.org/docs/user-manual/#applying-source-highlighting">how to apply source-highlighting</a>.</p>
</li>
<li>
<p>Avoid long lines whenever possible (for example, try not to go beyond 120 characters). This makes editing the
documentation easier and diffs more readable.</p>
</li>
<li>
<p>Most links to other OperatorFabric documents should be relative (see above) so they automatically point to the
document in the same version rather than the latest version.
Links starting with <strong><a href="https://opfab.github.io/documentation/current/" class="bare">opfab.github.io/documentation/current/</a></strong> should only be used when we want to always refer to
the latest (release) version of the documentation.</p>
</li>
<li>
<p>If necessary, add the relevant copyright at the top of the file.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copyright_headers"><a class="anchor" href="#_copyright_headers"></a>57.4. Copyright Headers</h3>
<div class="paragraph">
<p>All source files and documentation files for the project should bear copyright headers.</p>
</div>
<div class="sect3">
<h4 id="_header_templates"><a class="anchor" href="#_header_templates"></a>57.4.1. Header templates</h4>
<div class="paragraph">
<p>In the case of source files (*.java, *.css or *.scss, *.html, *.ts, etc.), we are working with the
<a href="http://mozilla.org/MPL/2.0/">Mozilla Public License, v. 2.0</a>, so the header should be something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) YYYY-YYYY, Entity Name (website or contact info)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of documentation files (*.adoc), we use the
<a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>, so the
header should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) YYYY-YYYY, Entity Name (website or contact info)
See AUTHORS.txt
This document is subject to the terms of the Creative Commons Attribution 4.0 International license.
If a copy of the license was not distributed with this
file, You can obtain one at https://creativecommons.org/licenses/by/4.0/.
SPDX-License-Identifier: CC-BY-4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>These templates should of course be converted to comments depending on the file type. See src/main/headers for examples.</p>
</div>
<div class="paragraph">
<p>Please make sure to include the appropriate header when creating new files and to update the existing one when
making changes to a file.</p>
</div>
<div class="paragraph">
<p>In the case of a first time contribution, the GitHub username of the person making the contribution should also be
added to the AUTHORS file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_3"><a class="anchor" href="#_examples_3"></a>57.4.2. Examples</h4>
<div class="sect4">
<h5 id="_creating_a_new_file"><a class="anchor" href="#_creating_a_new_file"></a>57.4.2.1. Creating a new file</h5>
<div class="paragraph">
<p>Let&#8217;s say a developer from entity Entity X creates a new java file in 2020. The header should read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updating_a_file"><a class="anchor" href="#_updating_a_file"></a>57.4.2.2. Updating a file</h5>
<div class="paragraph">
<p>Given an existing java file with the following header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a developer from entity Entity X edits it in 2021, the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if a developer from entity Entity X edits it in 2022, but no one from Entity X had touched it in 2021,
the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, 2022 Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_contributors"><a class="anchor" href="#_multiple_contributors"></a>57.4.2.3. Multiple contributors</h5>
<div class="paragraph">
<p>Given an existing java file with the following header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a developer from entity Entity Y edits it in 2021, the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
Copyright (c) 2021, Entity Y (http://www.entityY.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_releases"><a class="anchor" href="#_software_releases"></a>58. Software releases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The project uses release candidate to validate the release before the final release.</p>
</div>
<div class="paragraph">
<p>The technical steps for publishing a release are outlined in the
<a href="#release_process">CI/CD documentation</a></p>
</div>
<div class="sect2">
<h3 id="_manual_testing"><a class="anchor" href="#_manual_testing"></a>58.1. Manual testing</h3>
<div class="paragraph">
<p>Prior to initiating the release process, the release candidate must undergo manual testing by the team, as not all aspects are covered by automated tests.</p>
</div>
<div class="paragraph">
<p>The manual tests should, at a minimum, cover the following areas not addressed by automated tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Geographical features</p>
</li>
<li>
<p>Verification that a card is properly reminded (reminder feature)</p>
</li>
<li>
<p>Authentication using both IMPLICIT and CODE flows</p>
</li>
<li>
<p>Load testing via src/test/resources/cardsForStressTests/send6xN_TestCards.sh</p>
</li>
<li>
<p>Visual inspection of all screens at the minimum supported resolution in both day and night modes</p>
</li>
<li>
<p>Sound notifications</p>
</li>
<li>
<p>System notifications</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_governance"><a class="anchor" href="#_project_governance"></a>59. Project Governance</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_project_owner"><a class="anchor" href="#_project_owner"></a>59.1. Project Owner</h3>
<div class="paragraph">
<p>OperatorFabric is part of the <a href="https://www.lfenergy.org/">LF Energy Foundation</a>, a project of the
<a href="https://www.linuxfoundation.org/">Linux Foundation</a> that supports open source innovation projects within the energy
and electricity sectors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_committers"><a class="anchor" href="#_committers"></a>59.2. Committers</h3>
<div class="paragraph">
<p>Committers are contributors who have made several valuable contributions to the project and are now relied upon to both
write code directly to the repository and screen the contributions of others. In many cases they are programmers but it
is also possible that they contribute in a different role. Typically, a committer will focus on a specific aspect of
the project, and will bring a level of expertise and understanding that earns them the respect of the community and the
project owner.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_steering_committee"><a class="anchor" href="#_technical_steering_committee"></a>59.3. Technical Steering Committee</h3>
<div class="paragraph">
<p>See the <a href="https://opfab.github.io/pages/tsc.html">dedicated page</a> for more details on the Technical Steering Committee (scheduled meetings, minutes of past meetings, etc.).</p>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>59.4. Contributors</h3>
<div class="paragraph">
<p>Contributors include anyone in the technical community that contributes code, documentation, or other technical
artifacts to the project.</p>
</div>
<div class="paragraph">
<p>Anyone can become a contributor. There is no expectation of commitment to the project, no specific skill requirements
and no selection process. To become a contributor, a community member simply has to perform one or more actions that
are beneficial to the project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_communication_channels"><a class="anchor" href="#_communication_channels"></a>60. Communication channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to issues and discussions on GitHub, we use the following communication channels:</p>
</div>
<div class="sect2">
<h3 id="_slack_channel"><a class="anchor" href="#_slack_channel"></a>60.1. Slack channel</h3>
<div class="paragraph">
<p>We use the <a href="https://lfenergy.slack.com/archives/C025ZGJPXM4">operator-fabric channel on the LFEnergy Slack</a> for daily discussions, to warn of breaking changes
being merged into <code>develop</code> for example.</p>
</div>
<div class="paragraph">
<p>Everyone is welcome to <a href="https://lfenergy.slack.com/archives/C025ZGJPXM4">join</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lf_energy_mailing_lists"><a class="anchor" href="#_lf_energy_mailing_lists"></a>60.2. LF Energy Mailing Lists</h3>
<div class="paragraph">
<p>Several mailing lists have been created by LF Energy for the project, please feel free to subscribe to the ones you
could be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-announce">OperatorFabric Announcements</a> (such as new releases)</p>
</li>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-tsc">OperatorFabric Technical Steering Committee</a> (agenda, minutes and invitations for TSC)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="code_of_conduct"><a class="anchor" href="#code_of_conduct"></a>61. Code of Conduct</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Code of Conduct for the OperatorFabric community is
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt">version 2.0 of the Contributor Covenant</a>.</p>
</div>
<div class="sect2">
<h3 id="_our_pledge"><a class="anchor" href="#_our_pledge"></a>61.1. Our Pledge</h3>
<div class="paragraph">
<p>We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.
We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.</p>
</div>
</div>
<div class="sect2">
<h3 id="_our_standards"><a class="anchor" href="#_our_standards"></a>61.2. Our Standards</h3>
<div class="paragraph">
<p>Examples of behavior that contributes to a positive environment for our
community include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Demonstrating empathy and kindness toward other people</p>
</li>
<li>
<p>Being respectful of differing opinions, viewpoints, and experiences</p>
</li>
<li>
<p>Giving and gracefully accepting constructive feedback</p>
</li>
<li>
<p>Accepting responsibility and apologizing to those affected by our mistakes,
and learning from the experience</p>
</li>
<li>
<p>Focusing on what is best not just for us as individuals, but for the
overall community</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of unacceptable behavior include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of sexualized language or imagery, and sexual attention or
advances of any kind</p>
</li>
<li>
<p>Trolling, insulting or derogatory comments, and personal or political attacks</p>
</li>
<li>
<p>Public or private harassment</p>
</li>
<li>
<p>Publishing others private information, such as a physical or email
address, without their explicit permission</p>
</li>
<li>
<p>Other conduct which could reasonably be considered inappropriate in a
professional setting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement_responsibilities"><a class="anchor" href="#_enforcement_responsibilities"></a>61.3. Enforcement Responsibilities</h3>
<div class="paragraph">
<p>Community leaders are responsible for clarifying and enforcing our standards of
acceptable behavior and will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.
Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scope"><a class="anchor" href="#_scope"></a>61.4. Scope</h3>
<div class="paragraph">
<p>This Code of Conduct applies within all community spaces, and also applies when
an individual is officially representing the community in public spaces.
Examples of representing our community include using an official e-mail address,
posting via an official social media account, or acting as an appointed
representative at an online or offline event.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement"><a class="anchor" href="#_enforcement"></a>61.5. Enforcement</h3>
<div class="paragraph">
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported to the community leaders responsible for enforcement at <strong>opfab-tsc_AT_lists.lfenergy.org</strong>.
All complaints will be reviewed and investigated promptly and fairly.
All community leaders are obligated to respect the privacy and security of the
reporter of any incident.
Enforcement Guidelines
Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Correction</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A private, written warning from community leaders, providing
clarity around the nature of the violation and an explanation of why the
behavior was inappropriate. A public apology may be requested.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Warning</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>A violation through a single incident or series
of actions.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A warning with consequences for continued behavior. No
interaction with the people involved, including unsolicited interaction with
those enforcing the Code of Conduct, for a specified period of time. This
includes avoiding interactions in community spaces as well as external channels
like social media. Violating these terms may lead to a temporary or
permanent ban.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Temporary Ban</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>A serious violation of community standards, including
sustained inappropriate behavior.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Permanent Ban</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior,  harassment of an
individual, or aggression toward or disparagement of classes of individuals.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A permanent ban from any sort of public interaction within
the community.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_attribution"><a class="anchor" href="#_attribution"></a>61.6. Attribution</h3>
<div class="paragraph">
<p>This Code of Conduct is adapted from the Contributor Covenant,
version 2.0, available at
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct.html" class="bare">www.contributor-covenant.org/version/2/0/code_of_conduct.html</a>.
Community Impact Guidelines were inspired by Mozillas code of conduct
enforcement ladder.
For answers to common questions about this code of conduct, see the FAQ at
<a href="https://www.contributor-covenant.org/faq" class="bare">www.contributor-covenant.org/faq</a>. Translations are available at
<a href="https://www.contributor-covenant.org/translations" class="bare">www.contributor-covenant.org/translations</a>.
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt" class="bare">www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt</a></p>
</div>
</div>
</div>
</div>
<h1 id="CICD" class="sect0"><a class="anchor" href="#CICD"></a>OperatorFabric CICD</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to describe our CICD pipeline and our release process.
</div>
</div>
<div class="sect1">
<h2 id="_pipeline_configuration"><a class="anchor" href="#_pipeline_configuration"></a>62. Pipeline Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section briefly describes the organization of our CICD pipeline.</p>
</div>
<div class="paragraph">
<p>Most of the access and permissions required by our CICD plateform are managed by tokens that are created on
each of the required services (SonarCloud, DockerHub, GitHub).
A technical user account (opfabtech) has been created for each of these services so that these tokens are not linked
to the account of any member of the team.</p>
</div>
<div class="sect2">
<h3 id="_cicd_pipeline"><a class="anchor" href="#_cicd_pipeline"></a>62.1. CICD Pipeline</h3>
<div class="sect3">
<h4 id="_github_actions"><a class="anchor" href="#_github_actions"></a>62.1.1. Github Actions</h4>
<div class="paragraph">
<p>We use github Actions to manage our pipeline (<a href="https://github.com/opfab/operatorfabric-core/actions" class="bare">github.com/opfab/operatorfabric-core/actions</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonarcloud"><a class="anchor" href="#_sonarcloud"></a>62.1.2. SonarCloud</h4>
<div class="paragraph">
<p>To be allowed to push results to SonarCloud, github needs to be authenticated. This is done by generating a token on
SonarCloud with an account (opfabtech) that has admin rights to the organization, and then providing this token to github using <a href="https://github.com/opfab/operatorfabric-core/settings/secrets/actions">actions secrets</a> .</p>
</div>
</div>
<div class="sect3">
<h4 id="_github_documentation"><a class="anchor" href="#_github_documentation"></a>62.1.3. GitHub (documentation)</h4>
<div class="paragraph">
<p>To be allowed to push the generated documentation to the opfab.github.io, Github needs write access to the repository.
This is done by setting up a Personal Access Token in GitHub using the technical account.
This token is then passed to Github  using <a href="https://github.com/opfab/operatorfabric-core/settings/secrets/actions">actions secrets</a> .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After new content is pushed to the opfab.github.io repository, it can take a few minutes before this content is
visible on the website because it needs to be built by GitHub pages, and this can take a short while
depending on how busy the service is.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dockerhub"><a class="anchor" href="#_dockerhub"></a>62.1.4. DockerHub</h4>
<div class="paragraph">
<p>To be allowed to push images to DockerHub, Github needs to be authenticated. This is done again by generating a token in DockerHub using the technical account and provide it to github via actions secrets.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sonatype"><a class="anchor" href="#_sonatype"></a>62.1.5. Sonatype</h4>
<div class="paragraph">
<p>We use Sonatype accounts to be able to push libraries to maven central. The list of people authorized to publish is defined via issues : <a href="https://issues.sonatype.org/browse/OSSRH-67392" class="bare">issues.sonatype.org/browse/OSSRH-67392</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release_process"><a class="anchor" href="#release_process"></a>63. Release process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version_numbers"><a class="anchor" href="#_version_numbers"></a>63.1. Version numbers</h3>
<div class="paragraph">
<p>We work with three types of versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X.Y.Z.RELEASE versions are stable versions</p>
</li>
<li>
<p>X.Y.Z-RC.RELEASE versions are release candidates for the next stable version</p>
</li>
<li>
<p>SNAPSHOT version represents the current state of merged developments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Version numbers for X.Y.Z.RELEASE should be understood like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X: Major version, a major version adds new features and breaks compatibility with previous major and minor versions.</p>
</li>
<li>
<p>Y: Minor version, a minor version adds new features and does not break compatibility with previous minor versions for
the same major version.</p>
</li>
<li>
<p>Z: Patch, a patch version only contains bug fixes of current minor version</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_releasing_a_release_candidate"><a class="anchor" href="#_releasing_a_release_candidate"></a>63.2. Releasing a Release Candidate</h3>
<div class="paragraph">
<p>Before releasing a version, you need to prepare the release.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_release_branch_and_preparing_the_release_candidate"><a class="anchor" href="#_creating_a_release_branch_and_preparing_the_release_candidate"></a>63.2.1. Creating a release branch and preparing the release candidate</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <a href="https://github.com/opfab/operatorfabric-core">operatorfabric-core repository</a>, create a branch off the <code>develop</code> branch named
<code>X.X.release</code> if it does not exist  (note the lowercase <code>release</code> to distinguish it from <code>X.X.X.RELEASE</code> tags).</p>
<div class="listingblock">
<div class="content">
<pre>git checkout -b X.X.release
git push --set-upstream origin X.X.release</pre>
</div>
</div>
<div class="paragraph">
<p>Create a working branch for the release candidate. This branch will be used to prepare the release candidate :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout -b FE-X.X.X-RC.release.draft</pre>
</div>
</div>
</li>
<li>
<p>Use the ./CICD/prepare_release_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre>./CICD/prepare_release_version.sh -v X.X.X-RC.RELEASE</pre>
</div>
</div>
<div class="paragraph">
<p>You should get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Current version is SNAPSHOT (based on VERSION file)
Preparing X.X.X-RC.RELEASE
Updating version for pipeline in VERSION file
Replacing SNAPSHOT with X.X.X-RC.RELEASE in swagger.yaml files
Using X.X.X-RC.RELEASE for lfeoperatorfabric images in dev and docker environment docker-compose files
The following files have been updated:
 M VERSION
 M config/dev/docker-compose.yml
 M config/docker/docker-compose.yml
 M services/cards-publication/src/main/modeling/swagger.yaml
 M services/businessconfig/src/main/modeling/swagger.yaml
 M services/users/src/main/modeling/swagger.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>This script performs the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace SNAPSHOT with X.X.X-RC.RELEASE in swagger.yaml files and the VERSION file at the root operator-fabric folder</p>
</li>
<li>
<p>Change the version from SNAPSHOT to X.X.X-RC.RELEASE in the docker-compose files for dev and docker deployments</p>
</li>
</ul>
</div>
</li>
<li>
<p>Commit the changes with the template message:</p>
<div class="listingblock">
<div class="content">
<pre>git add .
git commit -s -m "[RELEASE] X.X.X-RC.RELEASE"</pre>
</div>
</div>
</li>
<li>
<p>Push the commit</p>
<div class="listingblock">
<div class="content">
<pre>git push --set-upstream origin FE-X.X.X-RC.release.draft</pre>
</div>
</div>
</li>
<li>
<p>Create a pull request from the <code>FE-X.X.X-RC.release.draft</code> branch to the <code>X.X.release</code> branch and ask for a review.</p>
</li>
<li>
<p>Once the pull request is approved and merge, create the tag for the release candidate:</p>
<div class="listingblock">
<div class="content">
<pre>git checkout X.X.release
git pull
git tag X.X.X-RC.RELEASE
git push origin X.X.X-RC.RELEASE</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_publish_the_release_candidate_on_docker_hub_and_documentation"><a class="anchor" href="#_publish_the_release_candidate_on_docker_hub_and_documentation"></a>63.2.2. Publish the release candidate on docker hub and documentation</h4>
<div class="paragraph">
<p>If the build and tests are successful, launch manually GitHubActions with jobs : <code>Build</code> , <code>Docker Push</code> and <code>Build and publish documentation</code></p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_client_lib_release"><a class="anchor" href="#publishing_client_lib_release"></a>63.2.3. Publishing the jars for the client library to Maven Central</h4>
<div class="paragraph">
<p>Once everything else looks ok, you can publish the jars for the client library to MavenCentral. This is done as a last
step once we are pretty sure we won&#8217;t need to go back and change things on the release because jars are not meant to be
removed from Maven Central once they are published (even briefly), and it&#8217;s not something that could be managed by the
project.</p>
</div>
<div class="paragraph">
<p>To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the appropriate properties (credentials and GPG key information) as described in the
<a href="#client_lib_pub_conf">documentation for the publishing task</a></p>
</li>
<li>
<p>Run the following command from the project root on the release branch:</p>
<div class="listingblock">
<div class="content">
<pre>./gradlew publish</pre>
</div>
</div>
</li>
<li>
<p>After a while you should be prompted to enter the passphrase for the GPG key.</p>
</li>
<li>
<p>Once the task has completed, log in to the <a href="https://s01.oss.sonatype.org/">OSSRH Repository</a> using the same credentials
as for the Sonatype JIRA.</p>
<div class="imageblock">
<div class="content">
<img src="../images/ossrh_repo_welcome.png" alt="Welcome page for the OSSRH repository manager">
</div>
</div>
</li>
<li>
<p>Click on <code>Staging repositories</code> link on the left. After a while (and maybe after clicking the refresh button), you
should see a repository with the name orgopfab-XXXX (where XXXX is a Sonatype-generated id, not related to the
release number).</p>
<div class="imageblock">
<div class="content">
<img src="../images/ossrh_staging_repos.png" alt="Staging repositories">
</div>
</div>
</li>
<li>
<p>Click on the repository then on the "content" tab below to check its content and metadata.</p>
<div class="imageblock">
<div class="content">
<img src="../images/check_staging_repo.png" alt="Check staging repository">
</div>
</div>
</li>
<li>
<p>If there is an issue with the repository, click on the "Drop" button and start the process again after making the
necessary changes. If everything looks in order, click on the "Close" button and add a small comment when prompted to
confirm.</p>
<div class="imageblock">
<div class="content">
<img src="../images/close_staging_repo.png" alt="Close staging repository">
</div>
</div>
</li>
<li>
<p>This will trigger validation of the <a href="https://central.sonatype.org/publish/requirements/">Sonatype requirements</a> (for
example, making sure that the pom file contains the required information), as you can see from the Activity tab below
(Refresh might be needed).</p>
<div class="imageblock">
<div class="content">
<img src="../images/closing_and_validation_of_repo.png" alt="Closing and validation of the staging repository">
</div>
</div>
</li>
<li>
<p>If all the validations pass, the "Release" button will become available. Click it to send the jars to Maven Central.
When prompted, write a comment then confirm (keeping the "Automatically Drop" option checked).</p>
<div class="imageblock">
<div class="content">
<img src="../images/confirm_release_to_maven_central.png" alt="Release to Maven Central">
</div>
</div>
</li>
<li>
<p>The jars for the release should then be available on the <a href="https://repo1.maven.org/maven2/org/opfab/">project space in the Maven repository</a> within 10 minutes.</p>
</li>
<li>
<p>It can take up to two hours for them to appear on the <a href="https://search.maven.org/search?q=opfab">Maven Central Repository Search</a> and up to one day for <a href="https://mvnrepository.com/artifact/org.opfab">MvnRepository</a></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_the_release_on_github"><a class="anchor" href="#_publishing_the_release_on_github"></a>63.2.4. Publishing the release on GitHub</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <a href="https://github.com/opfab/operatorfabric-core/releases"><code>releases</code> screen</a> for the core repository, draft a new
release.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the existing X.X.X-RC.RELEASE tag</p>
</li>
<li>
<p>The title should be X.X.X-RC.RELEASE</p>
</li>
<li>
<p>In the description field, paste the content from the release_notes_X.X.X.md file from the
<a href="https://github.com/opfab/release-notes/">release-notes repository</a>.</p>
</li>
<li>
<p>Reformat and correct the content as needed.</p>
</li>
<li>
<p>Check if there is a migration guide for this version, if so, check if the corresponding file has been included in
src/docs/asciidoc/resources/index.adoc and include a link to it at the top of the release notes.</p>
</li>
<li>
<p>Click "Publish release"</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a new release_notes.Y.Y.Y.md file with next version number.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_updating_the_version_list_on_the_website"><a class="anchor" href="#_updating_the_version_list_on_the_website"></a>63.2.5. Updating the version list on the website</h4>
<div class="paragraph">
<p>On the <a href="https://github.com/opfab/opfab.github.io">website repository</a>,
edit the <a href="https://github.com/opfab/opfab.github.io/blob/master/_data/versions.yml">/_data/versions.yml</a> file to add the version being released</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">id: SNAPSHOT</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">SNAPSHOT</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: D.E.F.RELEASE</span></span>
  <span class="key">badge</span>: <span class="string"><span class="content">current</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: A.B.C.RELEASE</span></span>
  <span class="comment">#... end of file omitted</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">id: SNAPSHOT</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">SNAPSHOT</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: X.X.X-RC.RELEASE</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
  <span class="key">badge</span>: <span class="string"><span class="content">current</span></span>
- <span class="string"><span class="content">id: D.E.F.RELEASE</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: A.B.C.RELEASE</span></span>
  <span class="comment">#... end of file omitted</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file determines which versions (and in which order) are displayed on the
<a href="https://opfab.github.io/pages/releases.html">release page</a> of the website.</p>
</div>
<div class="paragraph">
<p>Check that you see the X.X.X-RC.RELEASE under the <a href="https://opfab.github.io/pages/releases.html">releases page</a>
and that the links work (It may need a few minutes for the website to be updated).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>external_devices_api</code> property should be set to true for all new versions, so the API documentation for
the External Devices API is displayed on the website.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_advertising_the_new_release"><a class="anchor" href="#_advertising_the_new_release"></a>63.2.6. Advertising the new release</h4>
<div class="ulist">
<ul>
<li>
<p>Advertising on the LFE mailing list via an email to the <a href="mailto:opfab-announce@lists.lfenergy.org">opfab-announce@lists.lfenergy.org</a> mailing list with a link to the release notes on GitHub.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here is the link to the <a href="https://lists.lfenergy.org/g/main">administration website for the LFE mailing lists</a>
in case there is an issue.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Send a message on operator-fabric slack channel.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_releasing_a_major_or_minor_version"><a class="anchor" href="#_releasing_a_major_or_minor_version"></a>63.3. Releasing a Major or Minor Version</h3>
<div class="paragraph">
<p>Before releasing a version, you need to prepare the release.</p>
</div>
<div class="sect3">
<h4 id="_move_release_candidate_to_release"><a class="anchor" href="#_move_release_candidate_to_release"></a>63.3.1. Move Release Candidate to Release</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a branch to prepare the release from the release candidate branch:</p>
<div class="listingblock">
<div class="content">
<pre>git checkout X.X.release
git checkout -b X.X.X.release.draft</pre>
</div>
</div>
</li>
<li>
<p>Use the ./CICD/prepare_release_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre>./CICD/prepare_release_version.sh -v X.X.X.RELEASE</pre>
</div>
</div>
<div class="paragraph">
<p>You should get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Current version is SNAPSHOT (based on VERSION file)
Preparing X.X.X.RELEASE
Updating version for pipeline in VERSION file
Replacing SNAPSHOT with X.X.X.RELEASE in swagger.yaml files
Using X.X.X.RELEASE for lfeoperatorfabric images in dev and docker environment docker-compose files
The following files have been updated:
 M VERSION
 M config/dev/docker-compose.yml
 M config/docker/docker-compose.yml
 M services/cards-publication/src/main/modeling/swagger.yaml
 M services/businessconfig/src/main/modeling/swagger.yaml
 M services/users/src/main/modeling/swagger.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>This script performs the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace SNAPSHOT with X.X.X.RELEASE in swagger.yaml files and the VERSION file at the root operator-fabric folder</p>
</li>
<li>
<p>Change the version from SNAPSHOT to X.X.X.RELEASE in the docker-compose files for dev and docker deployments</p>
</li>
</ul>
</div>
</li>
<li>
<p>Commit the changes with the template message:</p>
<div class="listingblock">
<div class="content">
<pre>git add .
git commit -s -m "[RELEASE] X.X.X.RELEASE"</pre>
</div>
</div>
</li>
<li>
<p>Push the commit</p>
<div class="listingblock">
<div class="content">
<pre>git push --set-upstream origin X.X.X.release.draft</pre>
</div>
</div>
</li>
<li>
<p>Create a pull request from the 'X.X.X.release.draft` branch to the <code>X.X.release</code> branch and ask for a review.</p>
</li>
<li>
<p>Once the pull request is approved and merge, create the tag for the release candidate:</p>
<div class="listingblock">
<div class="content">
<pre>git checkout X.X.release
git pull
git tag X.X.X.RELEASE
git push origin X.X.X.RELEASE</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="publish_release_on_docker_hub_and_documentation"><a class="anchor" href="#publish_release_on_docker_hub_and_documentation"></a>63.3.2. Publish the release on docker hub and documentation</h4>
<div class="paragraph">
<p>Once the release branch build is passing, you should trigger the CICD tasks associated with a release (Docker images for DockerHub and
documentation).</p>
</div>
<div class="paragraph">
<p>To do so , go to
<a href="https://github.com/opfab/operatorfabric-core/actions">Github Actions</a>.
and launch the workflow on X.X.release branch with the following options :
- Build : true
- Karate tests : false
- Cypress tests : false
- Build and publish documentation : true
- Build and publish documentation - Latest : true if it is the last major/minor version
- Docker Push : true
- Docker Push - Latest : true if it is the last major/minor version</p>
</div>
<div class="paragraph">
<p>Wait for the build to complete and check that all jobs have been successful.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check that the <code>X.X.X.RELEASE</code> images have been generated and pushed to DockerHub.</p>
</li>
<li>
<p>Check that the <code>latest</code> images have been updated on DockerHub (if this has been triggered).</p>
</li>
<li>
<p>Check that the documentation has been generated and pushed to the GitHub pages website : check the version and revision date at the top of the documents in the current documentation
(for example <a href="https://opfab.github.io/documentation/current/architecture/">the architecture documentation</a>)</p>
</li>
<li>
<p>Check that the tag was correctly pushed to GitHub and is visible under the
<a href="https://github.com/opfab/operatorfabric-core/tags">tags page</a> for the repository.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="update_version_list_on_website"><a class="anchor" href="#update_version_list_on_website"></a>63.3.3. Updating the version list on the website</h4>
<div class="paragraph">
<p>On the <a href="https://github.com/opfab/opfab.github.io">website repository</a>,
edit the <a href="https://github.com/opfab/opfab.github.io/blob/master/_data/versions.yml">/_data/versions.yml</a> file to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the version being released to the list with the <code>current</code> badge</p>
</li>
<li>
<p>Remove the <code>current</code> badge from the previous version</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">id: SNAPSHOT</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">SNAPSHOT</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: D.E.F.RELEASE</span></span>
  <span class="key">badge</span>: <span class="string"><span class="content">current</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: A.B.C.RELEASE</span></span>
  <span class="comment">#... end of file omitted</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">id: SNAPSHOT</span></span>
  <span class="key">type</span>: <span class="string"><span class="content">SNAPSHOT</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: X.X.X.RELEASE</span></span>
  <span class="key">badge</span>: <span class="string"><span class="content">current</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: D.E.F.RELEASE</span></span>
  <span class="key">external_devices_api</span>: <span class="string"><span class="content">true</span></span>
- <span class="string"><span class="content">id: A.B.C.RELEASE</span></span>
  <span class="comment">#... end of file omitted</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file determines which versions (and in which order) are displayed on the
<a href="https://opfab.github.io/pages/releases.html">release page</a> of the website.</p>
</div>
<div class="paragraph">
<p>Check that you see the X.X.X.RELEASE under the <a href="https://opfab.github.io/pages/releases.html">releases page</a>
and that the links work (It may need a few minutes for the website to be updated).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>external_devices_api</code> property should be set to true for all new versions, so the API documentation for
the External Devices API is displayed on the website.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="checking_docker_compose"><a class="anchor" href="#checking_docker_compose"></a>63.3.4. Checking the docker-compose files</h4>
<div class="paragraph">
<p>While the docker-compose files should always point to the SNAPSHOT images while on the <code>develop</code> branch, on the <code>X.X.release</code>
branch they should rely on the latest RELEASE version available on DockerHub. Once the CI pipeline triggered by the
previous steps has completed successfully, and you can see X.X.X.RELEASE images for all services on DockerHub, you should:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove your locally built X.X.X.RELEASE images if any</p>
</li>
<li>
<p>Run the config/docker docker-compose file to make sure it pulls the images from DockerHub and behaves as intended.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>People who want to experiment with OperatorFabric are pointed to this docker-compose so it&#8217;s important to make sure
that it&#8217;s working correctly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_publishing_the_jars_for_the_client_library_to_maven_central"><a class="anchor" href="#_publishing_the_jars_for_the_client_library_to_maven_central"></a>63.3.5. Publishing the jars for the client library to Maven Central</h4>
<div class="paragraph">
<p>Like for release candidate , you need to <a href="#publishing_client_lib_release">release the client library jars</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="publishing_release_on_github"><a class="anchor" href="#publishing_release_on_github"></a>63.3.6. Publishing the release on GitHub</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <a href="https://github.com/opfab/operatorfabric-core/releases"><code>releases</code> screen</a> for the core repository, draft a new
release.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the existing X.X.X.RELEASE tag</p>
</li>
<li>
<p>The title should be X.X.X.RELEASE</p>
</li>
<li>
<p>In the description field, paste the content from the release_notes_X.X.X.md file from the
<a href="https://github.com/opfab/release-notes/">release-notes repository</a>.</p>
</li>
<li>
<p>Reformat and correct the content as needed.</p>
</li>
<li>
<p>Check if there is a migration guide for this version, if so, check if the corresponding file has been included in
src/docs/asciidoc/resources/index.adoc and include a link to it at the top of the release notes.</p>
</li>
<li>
<p>Click "Publish release"</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="supported_versions"><a class="anchor" href="#supported_versions"></a>63.3.7. Update supported versions</h4>
<div class="paragraph">
<p>Update supported version in security policy (SECURITY.md file) via a Pull Request on develop branch</p>
</div>
</div>
<div class="sect3">
<h4 id="advertising_new_release"><a class="anchor" href="#advertising_new_release"></a>63.3.8. Advertising the new release</h4>
<div class="ulist">
<ul>
<li>
<p>Advertising on the LFE mailing list via an email to the <a href="mailto:opfab-announce@lists.lfenergy.org">opfab-announce@lists.lfenergy.org</a> mailing list with a link to the release notes on GitHub.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here is the link to the <a href="https://lists.lfenergy.org/g/main">administration website for the LFE mailing lists</a>
in case there is an issue.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Send a message on operator-fabric slack channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_preparing_the_next_version"><a class="anchor" href="#_preparing_the_next_version"></a>63.3.9. Preparing the next version</h4>
<div class="paragraph">
<p>Remove the release_notes.X.X.X.md file corresponding to the release&#8217;s version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_releasing_a_patch_version"><a class="anchor" href="#_releasing_a_patch_version"></a>63.4. Releasing a Patch Version</h3>
<div class="paragraph">
<p>Let&#8217;s say fixes that will be released as X.X.X.RELEASE.</p>
</div>
<div class="paragraph">
<p>Follow the process described
<a href="#working_on_fix">here</a>
to create feature branches, work on fixes and merge them back into <code>X.X.release</code>.</p>
</div>
<div class="paragraph">
<p>Once all the big fixes that need to go into the version X.X.X.RELEASE have been merged into branch <code>X.X.release</code>, you
can release the patch version. To do so:</p>
</div>
<div class="paragraph">
<p>Create a branch to prepare the release from the release branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git pull X.X.release
git checkout X.X.release
git checkout -b X.X.X.release.draft</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the ./CICD/prepare_release_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre>./CICD/prepare_release_version.sh -v X.X.X.RELEASE</pre>
</div>
</div>
</li>
<li>
<p>Commit the changes and push to GitHub:</p>
<div class="listingblock">
<div class="content">
<pre>git add .
git commit -m "[RELEASE] X.X.X.RELEASE "
git push --set-upstream origin X.X.X.release.draft</pre>
</div>
</div>
</li>
<li>
<p>Create a pull request from the 'X.X.X.release.draft` branch to the <code>X.X.release</code> branch and ask for a review.</p>
</li>
<li>
<p>Once the pull request is approved and merge, create the tag for the release candidate:</p>
<div class="listingblock">
<div class="content">
<pre>git checkout X.X.release
git pull
git tag X.X.X.RELEASE
git push origin X.X.X.RELEASE</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You then have to follow the following steps as for a classic release:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#publish_release_on_docker_hub_and_documentation">Publish the release on docker hub and documentation</a></p>
</li>
<li>
<p><a href="#update_version_list_on_website">Updating the version list on the website</a>.</p>
</li>
<li>
<p><a href="#checking_docker_compose">Checking the docker-compose files</a>.</p>
</li>
<li>
<p><a href="#publishing_release_on_github">Publishing the release on GitHub</a>.</p>
</li>
<li>
<p><a href="#publishing_client_lib_release">Release the client library jars</a>.</p>
</li>
<li>
<p><a href="#supported_versions">Update supported versions</a>.</p>
</li>
<li>
<p><a href="#advertising_new_release">Advertising the new release</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_resources" class="sect0"><a class="anchor" href="#_resources"></a>Resources</h1>
<div class="sect1">
<h2 id="_appendix_b_publication_of_the_client_library_jars_to_maven_central"><a class="anchor" href="#_appendix_b_publication_of_the_client_library_jars_to_maven_central"></a>64. Appendix B: Publication of the client library jars to Maven Central</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a summary of the steps that were necessary to initially set up the publication of jars to Maven Central.
The process to actually publish the jars for each release is detailed in the release process documentation.</p>
</div>
<div class="olist arabic">
<div class="title">Publication process overview</div>
<ol class="arabic">
<li>
<p>Building and signing the jars</p>
</li>
<li>
<p>Publishing them to a staging repository where there are validations
(e.g. check that the POM contains the required information, validating the signature against the public key)</p>
</li>
<li>
<p>If the validations pass, release the jar to Maven Central</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_claiming_the_org_opfab_namespace_on_maven_central"><a class="anchor" href="#_claiming_the_org_opfab_namespace_on_maven_central"></a>64.1. Claiming the org.opfab namespace on Maven Central</h3>
<div class="paragraph">
<p>This is done by logging an <a href="https://issues.sonatype.org/browse/OSSRH-67392">issue</a> on the
<a href="https://issues.sonatype.org/">Sonatype JIRA</a> (create an account first). The namespace needs to match a domain that you
own (and this will be verified), which is why we had to rename our packages to <code>org.opfab.XXX</code>.</p>
</div>
<div class="paragraph">
<p>You can then request other users to be granted rights on the namespace as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_gpg_key_pair"><a class="anchor" href="#_creating_a_gpg_key_pair"></a>64.2. Creating a GPG key pair</h3>
<div class="paragraph">
<p>The key pair is generated with GPG2, keeping the default options and using the <code>opfabtech</code> technical account email as
contact. The key is further secured with a passphrase.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --full-generate-key

gpg (GnuPG) 2.2.19; Copyright (C) 2019 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
  (14) Existing key from card
Your selection? 1
RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (3072) 3072
Requested keysize is 3072 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0) 18m
Key expires at Tue 11 Oct 2022 12:38:13 CEST
Is this correct? (y/N) y

You need a user ID to identify your key; the software constructs the user ID
from the Real Name, Comment and Email Address in this form:
    "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

Real name: opfabtech
E-mail address: opfabtech@gmail.com
Comment: technical account for the OperatorFabric project
You selected this USER-ID:
    "opfabtech (technical account for the OperatorFabric project) &lt;opfabtech@gmail.com&gt;"

Change (N)ame, (C)omment, (E)-mail or (O)kay/(Q)uit? o
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilise the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
gpg: key 469E7252B8D25328 marked as ultimately trusted
gpg: directory '/home/guironnetale/.gnupg/openpgp-revocs.d' created
gpg: revocation certificate stored as '/home/guironnetale/.gnupg/openpgp-revocs.d/FE0D7AFF9C129CFBBDC18A0B469E7252B8D25328.rev'
public and secret key created and signed.

pub   rsa3072 2021-04-19 [SC] [expires: 2022-10-11]
      FE0D7AFF9C129CFBBDC18A0B469E7252B8D25328
uid                      opfabtech (technical account for the OperatorFabric project) &lt;opfabtech@gmail.com&gt;
sub   rsa3072 2021-04-19 [E] [expires: 2022-10-11]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A standard practice is to have the key expire in 18 months, so I set up a calendar reminder for us to renew it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sharing_the_signing_key"><a class="anchor" href="#_sharing_the_signing_key"></a>64.3. Sharing the signing key</h3>
<div class="paragraph">
<p>For other developers to be able to sign jars, you need to share both the key pair and the passphrase.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Export the key pair to a file</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --export-secret-keys OPFAB_KEY_ID &gt; key_pair.key</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Send the file to the other developers via a secure channel</p>
</li>
<li>
<p>Then, they need to import this file to their keyring (see the
<a href="#client_lib_pub_conf">documentation for the publishing task</a>
for details).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_publishing_the_public_key"><a class="anchor" href="#_publishing_the_public_key"></a>64.4. Publishing the public key</h3>
<div class="paragraph">
<p>The public key needs to be published to (preferably several) key directories so people wanting to use the signed jars
can check the signature against the public key. It is also checked as part of the validations performed on the
staging repository.</p>
</div>
<div class="paragraph">
<p>Our public key was initially published to <code>pool.sks-keyservers.net</code>, which became deprecated (causing the publication to
fail), so it was then published to the two servers that the sonatype validations seem to rely on.</p>
</div>
<div class="paragraph">
<div class="title">OpenPGP (<a href="https://keys.openpgp.org/" class="bare">keys.openpgp.org/</a>)</div>
<p>For OpenPGP you need to export the public key (and not the key pair) to a file and upload it to their web interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --export OPFAB_KEY_ID &gt; my_key.pub</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Ubuntu (<a href="http://keyserver.ubuntu.com" class="bare">keyserver.ubuntu.com</a>)</div>
<p>For Ubuntu you need to export the public key as ascii-armored ascii and paste the result to their web interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gpg2 --export --armor OPFAB_KEY_ID</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The key can be retrieved from both these servers by searching either for <code>opfabtech@gmail.com</code> or for the key ID.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_the_signing_and_publication_in_gradle"><a class="anchor" href="#_setting_up_the_signing_and_publication_in_gradle"></a>64.5. Setting up the signing and publication in Gradle</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You can&#8217;t publish a jar with version "SNAPSHOT" to the Maven staging repositories (you would get a 403
BAD REQUEST), that&#8217;s why the Gradle publication task is configured so that if the version ends with "SNAPSHOT", the
jars should be published to a local directory (<code>repos/snapshots</code>) rather than to the Maven Central staging repository.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_useful_links"><a class="anchor" href="#_useful_links"></a>64.6. Useful links</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://central.sonatype.org/publish/publish-guide/">General Sonatype Publication Documentation</a></p>
</li>
<li>
<p><a href="https://central.sonatype.org/publish/publish-gradle/">Documentation for publishing using Gradle</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/current/userguide/signing_plugin.html">Gradle Signing Plugin</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Gradle Maven Publish Plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_1_4_0_to_release_1_5_0"><a class="anchor" href="#_migration_guide_from_release_1_4_0_to_release_1_5_0"></a>65. Migration Guide from release 1.4.0 to release 1.5.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_refactoring_of_configuration_management"><a class="anchor" href="#_refactoring_of_configuration_management"></a>65.1. Refactoring of configuration management</h3>
<div class="sect3">
<h4 id="_motivation_for_the_change"><a class="anchor" href="#_motivation_for_the_change"></a>65.1.1. Motivation for the change</h4>
<div class="paragraph">
<p>The initial situation was to have a <code>Third</code> concept that was meant to represent third-party applications that publish
content (cards) to OperatorFabric.
As such, a Businessconfig was both the sender of the message and the unit of configuration for resources for card rendering.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because of that mix of concerns, naming was not consistent across the different services in the backend and frontend as
this object could be referred to using the following terms:
* Third
* ThirdParty
* Bundle
* Publisher
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But now that we&#8217;re aiming for cards to be sent by entities, users (see Free Message feature) or external services, it
doesn&#8217;t make sense to tie the rendering of the card ("Which configuration bundle should I take the templates and
details from?") to its publisher ("Who/What emitted this card and who/where should I reply?").</p>
</div>
</div>
<div class="sect3">
<h4 id="_changes_to_the_model"><a class="anchor" href="#_changes_to_the_model"></a>65.1.2. Changes to the model</h4>
<div class="paragraph">
<p>To do this, we decided that the <code>publisher</code> of a card would now have the sole meaning of <code>emitter</code>, and that the link
to the configuration bundle to use to render a card would now be based on its <code>process</code> field.</p>
</div>
<div class="sect4">
<h5 id="_on_the_businessconfig_model"><a class="anchor" href="#_on_the_businessconfig_model"></a>65.1.2.1. On the Businessconfig model</h5>
<div class="paragraph">
<p>We used to have a <code>Businessconfig</code> object which had an array of <code>Process</code> objects as one of its properties.
Now, the <code>Process</code> object replaces the <code>Businessconfig</code> object and this new object combines the properties of the old <code>Businessconfig</code>
and <code>Process</code> objects (menuEntries, states, etc.).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In particular, this means that while in the past one bundle could "contain" several processes, now there can be only
one process by bundle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Businessconfig</code> object used to have a <code>name</code> property that was actually its unique identifier (used to retrieve it through
the API for example).
It also had a <code>i18nLabelKey</code> property that was meant to be the i18n key to determine the display name of the
corresponding businessconfig, but so far it was only used to determine the display name of the associated menu in the navbar in
case there where several menu entries associated with this businessconfig.</p>
</div>
<div class="paragraph">
<p>Below is a summary of the changes to the <code>config.json</code> file that all this entails:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field before</th>
<th class="tableblock halign-left valign-top">Field after</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier of the bundle. Used to match the <code>publisher</code> field in associated cards, should now match <code>process</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for process display name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">states.mystate.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for state display name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i18nLabelKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">menuLabel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for menu display name in case there are several menu entries attached to the process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processes array is a root property, states array being a property of a given process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">states array is a root property</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of a simple config.json file:</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuEntries</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 0</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.first</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.la-rache.com</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.second</span><span class="delimiter">&quot;</span></span>}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">i18nLabelKey</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">businessconfig.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>
            }
          ]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuEntries</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 0</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.first</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.la-rache.com</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.second</span><span class="delimiter">&quot;</span></span>}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">mystate.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should also make sure that the new i18n label keys that you introduce match what is defined in the i18n
folder of the bundle.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_on_the_cards_model"><a class="anchor" href="#_on_the_cards_model"></a>65.1.2.2. On the Cards model</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field before</th>
<th class="tableblock halign-left valign-top">Field after</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">publisherVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies the version of the bundle. It was renamed for consistency now that bundles are linked to processes not
publishers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is now required and should match the id field of the process (bundle) to use to render the card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is just renamed , it represent an id of an instance of the process</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These changes impact both current cards from the feed and archived cards.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The id of the card is now build as process.processInstanceId an not anymore publisherID_process.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_on_the_web_ui_json"><a class="anchor" href="#_change_on_the_web_ui_json"></a>65.2. Change on the web-ui.json</h3>
<div class="paragraph">
<p>The parameter navbar.thirdmenus.type has been removed from this file. Starting from this release the related functionality has been moved on bundle basis and it&#8217;s not more global. See "Changes on bundle config.json" for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changes_on_bundle_config_json"><a class="anchor" href="#_changes_on_bundle_config_json"></a>65.3. Changes on bundle config.json</h3>
<div class="paragraph">
<p>Under menuEntries a new subproperty has been added: linkType. This property replace the old property navbar.thirdmenus.type in web-ui.json, making possible a more fine control of the related behaviour.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_name"><a class="anchor" href="#_component_name"></a>65.4. Component name</h3>
<div class="paragraph">
<p>We also change the component name of third which is now named businessconfig.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changes_to_the_endpoints"><a class="anchor" href="#_changes_to_the_endpoints"></a>65.5. Changes to the endpoints</h3>
<div class="paragraph">
<p>The <code>/third</code> endpoint becomes <code>/businessconfig/processes</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migration_steps"><a class="anchor" href="#_migration_steps"></a>65.6. Migration steps</h3>
<div class="paragraph">
<p>This section outlines the necessary steps to migrate existing data.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to perform these steps before starting up the OperatorFabric instance because starting up services with the new
version while there are still "old" bundles in the businessconfig storage will cause the businessconfig service to crash.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backup your existing bundles and existing Mongo data.</p>
</li>
<li>
<p>Edit your bundles as detailed above. In particular, if you had bundles containing several processes, you will need to
split them into several bundles. The <code>id</code> of the bundles should match the <code>process</code> field in the corresponding cards.</p>
</li>
<li>
<p>If you use navbar.thirdmenus.type in web-ui.json, rename it to navbar.businessmenus.type</p>
</li>
<li>
<p>Run the following scripts in the mongo shell to copy the value of <code>publisherVersion</code> to a new <code>processVersion</code> field and to copy the value of <code>processId</code> to a new <code>processInstanceId</code> field for all cards (current and archived):</p>
<div class="listingblock">
<div class="title">Current cards</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.updateMany(
{},
{ $rename: { &quot;publisherVersion&quot;: &quot;processVersion&quot;, &quot;processId&quot;: &quot;processInstanceId&quot; } }
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Archived cards</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.updateMany(
{},
{ $rename: { &quot;publisherVersion&quot;: &quot;processVersion&quot;, &quot;processId&quot;: &quot;processInstanceId&quot; } }
)</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure you have no cards without process using the following mongo shell commands:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.find({ process: null})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.find({ process: null})</code></pre>
</div>
</div>
</li>
<li>
<p>If it turns out to be the case, you will need to set a process value for all these cards to finish the migration. You
can do it either manually through Compass or using a mongo shell command. For example, to set the process to "SOME_PROCESS"
for all cards with an empty process, use:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.updateMany(
{ process: null },
{
$set: { &quot;process&quot;: &quot;SOME_PROCESS&quot;}
}
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.updateMany(
{ process: null },
{
$set: { &quot;process&quot;: &quot;SOME_PROCESS&quot;}
}
)</code></pre>
</div>
</div>
</li>
<li>
<p>If you have any code or scripts that push bundles, you should update it to point to the new endpoint.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_1_7_0_to_release_1_8_0"><a class="anchor" href="#_migration_guide_from_release_1_7_0_to_release_1_8_0"></a>66. Migration Guide from release 1.7.0 to release 1.8.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_card_detail_definition_in_business_configuration"><a class="anchor" href="#_card_detail_definition_in_business_configuration"></a>66.1. Card detail definition in business configuration</h3>
<div class="paragraph">
<p>There is no more the need for multiple definitions of card&#8217;s detail rendering because of the removal of multi-tab rendering. The rendering of the detail of a card is configured specifying the detail title, template name and the list of styles.</p>
</div>
<div class="paragraph">
<p>In the Businessconfig model definition the field <code>details</code> has been removed.</p>
</div>
<div class="paragraph">
<p>The new fields <code>detailTitle</code>, <code>templateName</code> and <code>styles</code> have been added.</p>
</div>
<div class="paragraph">
<p>Here is an example of a simple config.json file:</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">mystate.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">style1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">style2</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">mystate.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">detailTitle</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
        },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">style1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">style2</span><span class="delimiter">&quot;</span></span>]
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_business_menu_definition"><a class="anchor" href="#_business_menu_definition"></a>66.2. Business menu definition</h3>
<div class="paragraph">
<p>The business menu are not configured anymore in the business definition but in a specific single configuration file called ui-menu.json. You must move your configuration from the config.json to this new file, see
<a href="#menu_entries">documentation</a>
.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_1_8_0_to_release_2_0_0"><a class="anchor" href="#_migration_guide_from_release_1_8_0_to_release_2_0_0"></a>67. Migration Guide from release 1.8.0 to release 2.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_acknowledgmentallowed_field_in_business_configuration"><a class="anchor" href="#_acknowledgmentallowed_field_in_business_configuration"></a>67.1. AcknowledgmentAllowed field in business configuration</h3>
<div class="paragraph">
<p>In the process state definition the <code>acknowledgementAllowed</code> has been renamed to <code>acknowledgmentAllowed</code>.
The acknowledgmentAllowed field in no more a boolean type and can now assume one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Never": acknowledgment not allowed (default value)</p>
</li>
<li>
<p>"Always": acknowledgment allowed</p>
</li>
<li>
<p>"OnlyWhenResponseDisabledForUser": acknowledgment allowed only when the response is disabled for the user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a simple config.json file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">mystate.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">style1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">style2</span><span class="delimiter">&quot;</span></span>]
        }
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Never</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_response_card_templategateway_applychild"><a class="anchor" href="#_response_card_templategateway_applychild"></a>67.2. Response card : templateGateway.applyChild()</h3>
<div class="paragraph">
<p>For card with responses, it is not necessary to call templateGateway.applyChildCards() in your template on loading
anymore, OperatorFabric will do it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_2_0_to_release_2_3_0"><a class="anchor" href="#_migration_guide_from_release_2_2_0_to_release_2_3_0"></a>68. Migration Guide from release 2.2.0 to release 2.3.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_communication_between_template_and_opfab"><a class="anchor" href="#_communication_between_template_and_opfab"></a>68.1. Communication between template and opfab</h3>
<div class="sect3">
<h4 id="_getting_response_data_from_template"><a class="anchor" href="#_getting_response_data_from_template"></a>68.1.1. Getting response data from template</h4>
<div class="paragraph">
<p>Some renaming has been done in version 2.3.0 :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the method to have the response information from template is rename in <em>getUserResponse</em> instead of <em>validyForm</em>.</p>
</li>
<li>
<p>the return object of this method shall now contains the response data in field <em>responseCardData</em> instead of <em>formData</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So if you have the following code in your template :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    templateGateway.<span class="function">validyForm</span> = <span class="keyword">function</span> () {
        const response = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">response</span><span class="delimiter">'</span></span>).value;
        const formData = { <span class="key">response</span>: response };
        <span class="keyword">return</span> {
            <span class="key">valid</span>: <span class="predefined-constant">true</span>,
            <span class="key">formData</span>: formData
        };
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It must be modify this way :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    templateGateway.<span class="function">getUserResponse</span> = <span class="keyword">function</span> () {
        const response = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">response</span><span class="delimiter">'</span></span>).value;
        const responseCardData = { <span class="key">response</span>: response };
        <span class="keyword">return</span> {
            <span class="key">valid</span>: <span class="predefined-constant">true</span>,
            <span class="key">responseCardData</span>: responseCardData
        };

    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getting_the_information_if_the_user_can_respond"><a class="anchor" href="#_getting_the_information_if_the_user_can_respond"></a>68.1.2. Getting the information if the user can respond</h4>
<div class="paragraph">
<p>To know from a template that the user can respond to a card you must now call templateGateway.isUserAllowedToRespond() instead of implementing the method templateGateway.setUserCanRespond()</p>
</div>
<div class="paragraph">
<p>So if you have the following code in your template :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    templateGateway.<span class="function">setUserCanRespond</span> = <span class="keyword">function</span>(responseEnabled) {
        <span class="keyword">if</span> (responseEnabled) {
            <span class="comment">// do something</span>
        } <span class="keyword">else</span> {
            <span class="comment">// do something</span>
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It must be modify this way :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">    <span class="keyword">if</span> (templateGateway.isUserAllowedToRespond()) {
         <span class="comment">// do something</span>
    } <span class="keyword">else</span> {
        <span class="comment">// do something</span>
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_3_0_to_release_2_4_0"><a class="anchor" href="#_migration_guide_from_release_2_3_0_to_release_2_4_0"></a>69. Migration Guide from release 2.3.0 to release 2.4.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_send_card"><a class="anchor" href="#_send_card"></a>69.1. Send card</h3>
<div class="paragraph">
<p>The API does not have anymore an endpoint to send an Array of card.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The endPoint <code>cards</code> now receive only one card</p>
</li>
<li>
<p>The endPoint <code>async/cards</code> does not longer exist</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So if you use to send card as array, you need to modify your code to send it one by one via endpoint <code>cards</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_package_name_change"><a class="anchor" href="#_package_name_change"></a>69.2. Package name change</h3>
<div class="paragraph">
<p>The name of the packages in the OperatorFabric code has been changed from <code>org.lfenergy.operatorfabric.<strong></code> to
<code>org.opfab.</strong></code> in preparation for an upload of the client library to Maven Central.
You need to update any code using the client library to reflect this name change.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_4_0_to_release_2_5_0"><a class="anchor" href="#_migration_guide_from_release_2_4_0_to_release_2_5_0"></a>70. Migration Guide from release 2.4.0 to release 2.5.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_send_card_2"><a class="anchor" href="#_send_card_2"></a>70.1. Send card</h3>
<div class="paragraph">
<p>The API endpoint to send a card doesn&#8217;t return CardCreationReport object anymore.
The endPoint <code>cards</code> now returns :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>status code 201 (Created) in case of success.</p>
</li>
<li>
<p>status code 400 (Bad request) in case of a request with wrong data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So if you use CardCreationReport object when you send card, you need to modify your code to not use it anymore and to test the status code returned.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_recipients"><a class="anchor" href="#_card_recipients"></a>70.2. Card recipients</h3>
<div class="paragraph">
<p>The deprecated card field <code>recipient</code> is now deleted. So you have to use the fields <code>userRecipients</code>, <code>groupRecipients</code>
and <code>entityRecipients</code> to send a card.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_5_0_to_release_2_6_0"><a class="anchor" href="#_migration_guide_from_release_2_5_0_to_release_2_6_0"></a>71. Migration Guide from release 2.5.0 to release 2.6.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_inter_service_communication_ribbon"><a class="anchor" href="#_inter_service_communication_ribbon"></a>71.1. Inter-service communication - Ribbon</h3>
<div class="paragraph">
<p>Ribbon was used by our Feign client that lets business services get information on the current user from the Users
service.</p>
</div>
<div class="paragraph">
<p>Ribbon is no longer maintained, so we chose to remove it from our dependencies (mostly because it was blocking any
update of the other Spring dependencies).</p>
</div>
<div class="paragraph">
<p>Instead, the Feign client now relies on an external property to know where the Users service can be reached, and there
is no load-balancing for now.</p>
</div>
<div class="paragraph">
<p>This requires a change to service configuration: the <code>users.ribbon.listOfServers</code> property should be removed and
replaced with <code>operatorfabric.servicesUrls.users</code>.</p>
</div>
<div class="paragraph">
<p>It should be set in the configuration of all business services (except users), or in the common configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">operatorfabric</span>:
  <span class="key">servicesUrls</span>:
    <span class="key">users</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:2103</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>According to the Feign documentation, the property should contain "an absolute URL or resolvable hostname (the protocol
is optional)".</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This property is mandatory, if it is absent the application won&#8217;t start.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
While the ribbon property could handle an array of several urls, this new property expects a single url as
there is no load-balancing mechanism for now.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_6_0_to_release_2_7_0"><a class="anchor" href="#_migration_guide_from_release_2_6_0_to_release_2_7_0"></a>72. Migration Guide from release 2.6.0 to release 2.7.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_send_card_3"><a class="anchor" href="#_send_card_3"></a>72.1. Send card</h3>
<div class="paragraph">
<p>The API endPoint <code>cards</code> will now require authentication by default.
It is possible to configure the endpoint to not require authentication by setting the configuration parameter <code>checkAuthenticationForCardSending</code> to <code>false</code> in cards-publication service configuration file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_7_0_to_release_2_8_0"><a class="anchor" href="#_migration_guide_from_release_2_7_0_to_release_2_8_0"></a>73. Migration Guide from release 2.7.0 to release 2.8.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ui_configuration_management"><a class="anchor" href="#_ui_configuration_management"></a>73.1. UI Configuration Management</h3>
<div class="paragraph">
<p>The web-ui container has two configuration files: <code>web-ui.json</code> and <code>ui-menu.json</code>.</p>
</div>
<div class="paragraph">
<p>To avoid maintaining separate copies of these files for each <code>run environment</code> (docker, dev, Cypress), the reference
configuration will be the one for the <code>docker</code> mode, with the others being created by script, changing only the
properties that should be different between environments (e.g. environmentName).
Only the docker configuration will be version-controlled. The scripts creating the configuration are launched by
the <code>docker-compose.sh</code> and <code>docker-compose-cypress.sh</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
As a consequence, the web-ui.json and ui-menu.json files have been moved from <code>config/xxx/</code> to
<code>config/xxx/ui-config</code>. The volumes in the <code>docker-compose.yml</code> files have been updated accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This new organization will also allow us to run Cypress tests against different versions of the configuration, for
example to test the behaviour of a property meant to hide a component. See the Cypress tests README
(src/test/cypress/README.adoc) for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All modes (dev, docker, config) now use the <code>PASSWORD</code> authentication flow by default. If you want to test
with another authentication flow, you should use the <code>setSecurityAuthFlow.sh</code> script AFTER the containers have been
started.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example to use the CODE flow in dev mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd src/test/resources
.setSecurityAuthFlow.sh dev CODE</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_management_of_visible_menus"><a class="anchor" href="#_management_of_visible_menus"></a>73.2. Management of visible menus</h3>
<div class="paragraph">
<p>The visibility of some core OperatorFabric menus (monitoring, logging, feed configuration screen,&#8230;&#8203;) was so far
configurable for a given OperatorFabric instance through various properties in <code>web-ui.json</code>.</p>
</div>
<div class="paragraph">
<p>As of this version, it has been unified with that of custom menus:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It will now be managed in <code>ui-menu.json</code> along with custom menus</p>
</li>
<li>
<p>It is now possible to make these menus visible only for certain groups</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">The following properties in <code>web-ui.json</code> are no longer supported and should be removed</div>
<ul>
<li>
<p><code>navbar.hidden</code> (array of menus to hide)</p>
</li>
<li>
<p><code>admin.hidden</code> (boolean)</p>
</li>
<li>
<p><code>feedConfiguration.hidden</code> (boolean)</p>
</li>
<li>
<p><code>realTimeUsers.hidden</code> (boolean)</p>
</li>
<li>
<p><code>settings.nightDayMode</code> (boolean)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">New property in <code>ui-menu.json</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">coreMenusConfiguration</span><span class="delimiter">&quot;</span></span>:
  [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">coreMenuId1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">coreMenuId2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">coreMenuId3</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">SOME_OTHER_GROUP</span><span class="delimiter">&quot;</span></span>]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All core menus should be listed under this new <code>coreMenusConfiguration</code> property in <code>ui-menu.json</code>, each with their own
<code>visible</code> and (optionally) <code>showOnlyForGroups</code> property.</p>
</div>
<div class="paragraph">
<p>Necessary actions for the migration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove the deprecated properties listed above from your <code>web-ui.json</code></p>
</li>
<li>
<p>Add a <code>coreMenusConfiguration</code> block to your <code>ui-menu.json</code> (see the
<a href="#core_menu_config">documentation</a>
for details and a full example)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_simplification_mongodb_configuration"><a class="anchor" href="#_simplification_mongodb_configuration"></a>73.3. Simplification MongoDB Configuration</h3>
<div class="paragraph">
<p>We are getting rid of our specific MongoDB configuration to let SpringBoot autoconfigure it. As a result, we are
removing support for the <code>spring.data.mongodb.uris</code> property in favour of the standard <code>spring.data.mongodb.uri</code>
property. Please change the application configuration files for the services accordingly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This property can only hold a single URI.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_10_0_to_release_2_11_0"><a class="anchor" href="#_migration_guide_from_release_2_10_0_to_release_2_11_0"></a>74. Migration Guide from release 2.10.0 to release 2.11.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_logging_screen_filter_with_tags_list"><a class="anchor" href="#_logging_screen_filter_with_tags_list"></a>74.1. Logging screen : Filter with tags list</h3>
<div class="paragraph">
<p>As for archives screen, now you have to specify the list of tags you want to see in the filter of logging screen.
You have to set this list in the <code>web-ui.json</code> file, with the parameter <code>logging.filters.tags.list</code>. For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">logging</span><span class="delimiter">&quot;</span></span>: {
  <span class="key"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Label for tag 1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tag1</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_2_11_0_to_release_3_0_0"><a class="anchor" href="#_migration_guide_from_release_2_11_0_to_release_3_0_0"></a>75. Migration Guide from release 2.11.0 to release 3.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_changes_in_configuration_due_to_business_translation_mechanism_removal"><a class="anchor" href="#_changes_in_configuration_due_to_business_translation_mechanism_removal"></a>75.1. Changes in configuration due to business translation mechanism removal</h3>
<div class="paragraph">
<p>In order to remove unnecessary complexity for third-party, we have decided to remove translation for
some of business data, this implies the following migration tasks :</p>
</div>
<div class="sect3">
<h4 id="_template_directory"><a class="anchor" href="#_template_directory"></a>75.1.1. Template directory</h4>
<div class="paragraph">
<p>The <code>template</code> directory does not contain language repository anymore. There is one template per process/state
 and the templates are located directly in this directory. So you have to move your template for your language directly to the template directory</p>
</div>
</div>
<div class="sect3">
<h4 id="_changes_in_config_json"><a class="anchor" href="#_changes_in_config_json"></a>75.1.2. Changes in config.json</h4>
<div class="paragraph">
<p>In config.json, the fields <code>process.name</code>, <code>state.name</code> and <code>state.description</code> must not contain i18n data anymore, they must only contain string data. These data will be simply displayed on the screen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_new_file_i18n_json"><a class="anchor" href="#_new_file_i18n_json"></a>75.1.3. New file i18n.json</h4>
<div class="paragraph">
<p>The bundle shall contain a new i18n.json file in the root directory. The i18n.json file contains internationalization information for title and summary fields. We keep an i18n mechanism for these two fields in order to have the possibility to adapt the title or summary of the card without having to modify the code of the third party tool sending the card (using only one "language" for translation)</p>
</div>
<div class="paragraph">
<p>Here is an example file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
	"message":{
		"title":"Message",
		"summary":"Message received"
	},
	"chartDetail" : { "title":"A Chart"},
	"chartLine" : { "title":"Electricity consumption forecast"},
	"question" : {"title": " Planned Outage"},
	"contingencies": {"title" : " Network Contingencies ","summary":"Contingencies report for French network"},
	"processState": {
		"title":"Process state ({{status}})"
	}
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_i18n_folder"><a class="anchor" href="#_i18n_folder"></a>75.1.4. i18n folder</h4>
<div class="paragraph">
<p>The folder <code>i18n</code> and contained files has to be removed from bundle structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processes_groups_2"><a class="anchor" href="#_processes_groups_2"></a>75.1.5. Processes groups</h4>
<div class="paragraph">
<p>There is no possibility anymore to have translation for the process group name. You can just define
the name of the group in the uploaded file. Here is an example of this file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process1</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process2</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process3</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process4</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_script_to_migrate_an_existing_database"><a class="anchor" href="#_script_to_migrate_an_existing_database"></a>75.1.6. Script to migrate an existing database</h4>
<div class="paragraph">
<p>Opfab 3.0 needs two new fields in database : <code>titleTranslated</code> and <code>summaryTranslated</code>.
In order to add these two new fields to an existing database, you have to pull the image <code>migration-opfab3</code>,
go to the directory <code>OF_HOME/src/tooling/migration-opfab3</code> and execute the script <code>docker-compose.sh</code>, this way :</p>
</div>
<div class="paragraph">
<p><code>./docker-compose.sh &lt;containerNameMongoDB&gt; &lt;portMongoDB&gt; &lt;loginMongoDB&gt; &lt;passwordMongoDB&gt; &lt;pathToBundlesDirectory&gt;</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The bundles directory is the directory where you store all the "untar" bundles in the new
format with the <code>i18n.json</code> file. It is not the directory where the opfab instance stores the bundles.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file_web_ui_json_2"><a class="anchor" href="#_configuration_file_web_ui_json_2"></a>75.2. Configuration file <code>web-ui.json</code></h3>
<div class="paragraph">
<p>Some attributes have been renamed to be more consistent with their meaning.
Here are these attributes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>settings.infos.description</code> renamed <code>settings.infos.hide.description</code></p>
</li>
<li>
<p><code>settings.infos.language</code> renamed <code>settings.infos.hide.language</code></p>
</li>
<li>
<p><code>settings.infos.timezone</code> renamed <code>settings.infos.hide.timezone</code></p>
</li>
<li>
<p><code>settings.infos.tags</code> renamed <code>settings.infos.hide.tags</code></p>
</li>
<li>
<p><code>settings.infos.sounds</code> renamed <code>settings.infos.hide.sounds</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So if you use these fields in <code>web-ui.json</code> file, you have to rename them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file_common_docker_yml"><a class="anchor" href="#_configuration_file_common_docker_yml"></a>75.3. Configuration file common-docker.yml</h3>
<div class="paragraph">
<p>A new parameter named <code>operatorfabric.servicesUrls.businessconfig</code>  has to be added to your configuration file <code>common-docker.yml</code> (or equivalent)</p>
</div>
<div class="paragraph">
<p>For example the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>operatorfabric:
  businessLogActivated: true
  servicesUrls:
    users: &quot;users:8080&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>operatorfabric:
  businessLogActivated: true
  servicesUrls:
    users: &quot;users:8080&quot;
    businessconfig: &quot;businessconfig:8080&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_conf_template_file"><a class="anchor" href="#_nginx_conf_template_file"></a>75.4. Nginx.conf.template file</h3>
<div class="paragraph">
<p>In order to have a better organized file, we have modified <code>nginx.conf.template</code> file, more precisely the information
for location <code>/cardspub/cards</code>. Please report this modification to your local config.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_0_0_to_release_3_1_0"><a class="anchor" href="#_migration_guide_from_release_3_0_0_to_release_3_1_0"></a>76. Migration Guide from release 3.0.0 to release 3.1.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kafka_date_format"><a class="anchor" href="#_kafka_date_format"></a>76.1. Kafka date format</h3>
<div class="paragraph">
<p>The signature for sending card dates via Kafka have been changed to better reflect the REST API. Instead
of sending the date in seconds since epoch, you can now use the Java Instant object. The following methods are affected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startDate</code></p>
</li>
<li>
<p><code>endDate</code></p>
</li>
<li>
<p><code>lttd</code></p>
</li>
<li>
<p><code>publishDate</code></p>
</li>
<li>
<p><code>TimeSpan.setStart</code></p>
</li>
<li>
<p><code>TimeSpan.setEnd</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example the following code:</p>
</div>
<div class="paragraph">
<p><code>Card card = Card.newBuilder().setStartDate(12345L).build();</code></p>
</div>
<div class="paragraph">
<p>becomes:</p>
</div>
<div class="paragraph">
<p><code>Card card = Card.newBuilder().setStartDate(Instant.now()).build();</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_1_0_to_release_3_2_0"><a class="anchor" href="#_migration_guide_from_release_3_1_0_to_release_3_2_0"></a>77. Migration Guide from release 3.1.0 to release 3.2.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cache_configuration_for_i18n_files"><a class="anchor" href="#_cache_configuration_for_i18n_files"></a>77.1. Cache configuration for i18n files</h3>
<div class="paragraph">
<p>Add the following lines in your nginx.conf to avoid keeping in cache old translation files when migrating opfab</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  location /ui/assets/i18n/ {
    add_header Cache-Control &quot;no-cache&quot;;
    alias /usr/share/nginx/html/assets/i18n/;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>see the reference nginx configuration file : <a href="https://github.com/opfab/operatorfabric-core/blob/master/config/docker/nginx.conf" class="bare">github.com/opfab/operatorfabric-core/blob/master/config/docker/nginx.conf</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_tag_feed_filter_removal"><a class="anchor" href="#_tag_feed_filter_removal"></a>77.2. Tag feed filter removal</h3>
<div class="paragraph">
<p>The feature to filter tags in the feed has been removed. In consequence, you can remove the following parameters in your web-ui.json configuration file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>settings.tags.hide</p>
</li>
<li>
<p>settings.infos.hide.tags</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_4_0_to_release_3_5_0"><a class="anchor" href="#_migration_guide_from_release_3_4_0_to_release_3_5_0"></a>78. Migration Guide from release 3.4.0 to release 3.5.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_timezone_management_removal"><a class="anchor" href="#_timezone_management_removal"></a>78.1. Timezone management removal</h3>
<div class="paragraph">
<p>The feature to manage timeline inside opfab has been removed. In consequence, you can remove the following parameters in your web-ui.json configuration file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>i10n.supported.time-zones</p>
</li>
<li>
<p>settings.infos.hide.timezone</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_card_format_changes"><a class="anchor" href="#_kafka_card_format_changes"></a>78.2. Kafka card format changes</h3>
<div class="paragraph">
<p>The Kafka message schema has been changed. The single card used to send messages to and receive from Operator Fabric
has been split into two cards; one for sending to OpFab and one for receiving messages from OpFab. The CardCommand structure now contains a <code>card</code>  (to OpFab) and a <code>responseCard</code> (from OpFab).
You will need to change the Kafka listener to get the response card.</p>
</div>
<div class="paragraph">
<p>For example change</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@KafkaListener</span>
    <span class="directive">public</span> <span class="type">void</span> receivedResponseCard(<span class="annotation">@Payload</span> ConsumerRecord&lt;<span class="predefined-type">String</span>, CardCommand&gt; consumerRecord) {
        CardCommand cardCommand = consumerRecord.value();
        Card = cardCommand.getCard();</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="annotation">@KafkaListener</span>
    <span class="directive">public</span> <span class="type">void</span> receivedResponseCard(<span class="annotation">@Payload</span> ConsumerRecord&lt;<span class="predefined-type">String</span>, CardCommand&gt; consumerRecord) {
        CardCommand cardCommand = consumerRecord.value();
        ResponseCard = cardCommand.getResponseCard();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_redirect_to_business_application_from_a_card"><a class="anchor" href="#_redirect_to_business_application_from_a_card"></a>78.2.1. Redirect to business application from a card</h4>
<div class="paragraph">
<p>The <code>templateGateway.redirectToBusinessMenu</code> function to redirect to business application from a card has changed. The third argument of the function is now a url extension that can contain sub paths and/or parameters instead of only parameters.</p>
</div>
<div class="paragraph">
<p>You will need to change the call adding a '?' character at the beginning of the third argument.</p>
</div>
<div class="paragraph">
<p>For example change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>templateGateway.redirectToBusinessMenu('myMenu','myEntry','param1=aParam&amp;param2=anotherParam')</pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="literalblock">
<div class="content">
<pre>templateGateway.redirectToBusinessMenu('myMenu','myEntry','?param1=aParam&amp;param2=anotherParam')</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_5_0_to_release_3_6_0"><a class="anchor" href="#_migration_guide_from_release_3_5_0_to_release_3_6_0"></a>79. Migration Guide from release 3.5.0 to release 3.6.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_template_rendering"><a class="anchor" href="#_template_rendering"></a>79.1. Template rendering</h3>
<div class="paragraph">
<p>Bootstrap library has been migrate to v5.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you use bootstrap css classes in your templates, it&#8217;s strongly recommended checking your template rendering after migration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Charts library has been upgraded from version 3.2.1 to 3.7.1</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you use charts in your templates, it&#8217;s strongly recommended checking your template rendering after migration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mongo_data_migration_steps"><a class="anchor" href="#_mongo_data_migration_steps"></a>79.2. Mongo data migration steps</h3>
<div class="paragraph">
<p>This section outlines the necessary steps to migrate existing data.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you use response card feature, you need to perform these steps before starting up the OperatorFabric instance to avoid displaying wrong data in archives page.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backup your existing Mongo data.</p>
</li>
<li>
<p>Run the following scripts in the mongo shell to update the value of the new field <code>deletionDate</code> for archived cards:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.updateMany(
{&quot;deletionDate&quot;: {&quot;$exists&quot;: false}},
{&quot;$set&quot;: {&quot;deletionDate&quot;: new ISODate(&quot;1970-01-01T00:00:00Z&quot;)}}
)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_about_screen"><a class="anchor" href="#_about_screen"></a>79.3. About screen</h3>
<div class="paragraph">
<p>You do not need anymore to precise opfab version in web-ui.json to see it on about screen. So you need to remove the corresponding line. For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>      "operatorfabric": {
        "name": "OperatorFabric",
        "rank": 0,
        "version": "2.5.0.RELEASE"
      }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecated_feature"><a class="anchor" href="#_deprecated_feature"></a>79.4. Deprecated feature</h3>
<div class="sect3">
<h4 id="_method_templategateway_getspecificcardinformation"><a class="anchor" href="#_method_templategateway_getspecificcardinformation"></a>79.4.1. Method templateGateway.getSpecificCardInformation()</h4>
<div class="paragraph">
<p>Implementation of method templateGateway.getSpecificCardInformation() in usercard templates is now deprecated, replace it by usercardTemplateGateway.getSpecificCardInformation(). It is just a naming change, the behavior is the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="_restrict_recipient_dropdown_list_for_user"><a class="anchor" href="#_restrict_recipient_dropdown_list_for_user"></a>79.4.2. Restrict recipient dropdown list for user</h4>
<div class="paragraph">
<p>Using "recipientList" in state definition (in config.json) is now deprecated</p>
</div>
<div class="paragraph">
<p>If you use  "recipientList" to restrict the list of recipients shown to user, replace it with code in template as in the following example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.setDropdownEntityRecipientList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_the_list_of_recipients"><a class="anchor" href="#_set_the_list_of_recipients"></a>79.4.3. Set the list of recipients</h4>
<div class="paragraph">
<p>Using "recipientList" in state definition (in config.json) is now deprecated</p>
</div>
<div class="paragraph">
<p>If you use  "recipientList" to set the list of recipients, provide now the list of recipients when returning the card object in usercardTemplateGateway.getSpecificCardInformation() in the field entityRecipients.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          entityRecipients: ["ENTITY_FR","IT_SUPERVISOR_ENTITY"],
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_6_0_to_release_3_7_0"><a class="anchor" href="#_migration_guide_from_release_3_6_0_to_release_3_7_0"></a>80. Migration Guide from release 3.6.0 to release 3.7.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker_images_names_changed"><a class="anchor" href="#_docker_images_names_changed"></a>80.1. Docker images names changed</h3>
<div class="paragraph">
<p>From version 3.7.0 the docker names of the former "business services" are changed. Here are there old names and the new ones.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old docker name</th>
<th class="tableblock halign-left valign-top">New docker name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-cards-consultation-business-service:3.6.0.RELEASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-cards-consultation-service:3.7.0.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-cards-publication-business-service:3.6.0.RELEASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-cards-publication-service:3.7.0.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-users-business-service:3.6.0.RELEASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-users-service:3.7.0.RELEASE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-businessconfig-business-service:3.6.0.RELEASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lfeoperatorfabric/of-businessconfig-service:3.7.0.RELEASE</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You must change your docker-compose files accordingly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_third_parties_configuration"><a class="anchor" href="#_third_parties_configuration"></a>80.2. Third parties configuration</h3>
<div class="paragraph">
<p>The configuration of the third parties applications as external recipents has changed. It is now possible to configure wether the user token shall be propagated to the third party or not by setting the "propagateUserToken" boolean property.</p>
</div>
<div class="paragraph">
<p>If you have third parties configured in your 'cards-publication.yml' you should change the configuration as follows:</p>
</div>
<div class="paragraph">
<p>From:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>externalRecipients-url: "{\
           third-party1: \"http://thirdparty1/test1\", \
           third-party2: \"http://thirdparty2:8090/test2\", \
           }"</pre>
</div>
</div>
<div class="paragraph">
<p>To</p>
</div>
<div class="literalblock">
<div class="content">
<pre>external-recipients:
  recipients:
    - id: "third-party1"
      url: "http://thirdparty1/test1"
      propagateUserToken: true
    - id: "third-party2"
      url: "http://thirdparty2:8090/test2"
      propagateUserToken: true</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rename_attribute_externaldeviceid"><a class="anchor" href="#_rename_attribute_externaldeviceid"></a>80.3. Rename attribute externalDeviceId</h3>
<div class="paragraph">
<p>It is now possible to have several external device systems, therefore the attribute externalDeviceId is now renamed into externalDeviceIds and is now a list.</p>
</div>
<div class="sect3">
<h4 id="_in_the_configuration_file"><a class="anchor" href="#_in_the_configuration_file"></a>80.3.1. In the configuration file</h4>
<div class="paragraph">
<p>In the configuration file, replace</p>
</div>
<div class="literalblock">
<div class="content">
<pre>userConfigurations:
        - userLogin: operator1_fr
          externalDeviceId: CDS_1
        - userLogin: operator2_fr
          externalDeviceId: CDS_2
        - userLogin: operator3_fr
          externalDeviceId: CDS_3
        - userLogin: operator4_fr
          externalDeviceId: CDS_1</pre>
</div>
</div>
<div class="paragraph">
<p>by</p>
</div>
<div class="literalblock">
<div class="content">
<pre>userConfigurations:
        - userLogin: operator1_fr
          externalDeviceIds: ["CDS_1"]
        - userLogin: operator2_fr
          externalDeviceIds: ["CDS_2"]
        - userLogin: operator3_fr
          externalDeviceIds: ["CDS_3"]
        - userLogin: operator4_fr
          externalDeviceIds: ["CDS_1"]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changes_in_the_mongo_data_base"><a class="anchor" href="#_changes_in_the_mongo_data_base"></a>80.3.2. Changes in the Mongo data base</h4>
<div class="sect4">
<h5 id="_before_the_migration"><a class="anchor" href="#_before_the_migration"></a>80.3.2.1. Before the migration</h5>
<div class="paragraph">
<p>Before the migration to 3.7.0, one should save its current database, then add the attribute "externalDeviceIds" based on the
value of the existing attribute "externalDeviceId". To add this attribute, simply launch the commands :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var collection = db.getCollection("userConfigurations")
collection.find().forEach(function(user) {collection.updateOne({_id: user._id}, {$set: {externalDeviceIds: [user.externalDeviceId]}})})</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_once_the_migration_is_done"><a class="anchor" href="#_once_the_migration_is_done"></a>80.3.2.2. Once the migration is done</h5>
<div class="paragraph">
<p>Once the migration to 3.7.0 is done, the attribute "externalDeviceId" is not used anymore.
You can remove it by launching :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var collection = db.getCollection("userConfigurations")
collection.find().forEach(function(user) {collection.updateOne({_id: user._id}, {$unset: {"externalDeviceId": 1}})})</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deprecated_feature_2"><a class="anchor" href="#_deprecated_feature_2"></a>80.4. Deprecated feature</h3>
<div class="sect3">
<h4 id="_field_recurrence"><a class="anchor" href="#_field_recurrence"></a>80.4.1. Field recurrence</h4>
<div class="paragraph">
<p>Using "recurrence" field returned by getSpecificCardInformation() method definition is now deprecated.</p>
</div>
<div class="paragraph">
<p>If you are using the "viewCardInAgenda" and "recurrence" field, use the "timeSpans" field instead when returning the card object in usercardTemplateGateway.getSpecificCardInformation() to configure the visibility of the card in timeline and agenda.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          entityRecipients: ["ENTITY_FR","IT_SUPERVISOR_ENTITY"],
          data : {message: message}
        };

        const recurrence = {
            daysOfWeek : [1,2,3],
            hoursAndMinutes : {hours:10,minutes:44},
            durationInMinutes: 15
        }

        const mystartDate = new Date();
        const timeSpans = [{
            startDate: mystartDate.getTime(),
            endDate: mystartDate.getTime() + 7 * 24 * 3600000,
            recurrence: recurrence
        }]

        return {
            valid: true,
            card: card,
            timeSpans: timeSpans
        };</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_7_0_to_release_3_8_0"><a class="anchor" href="#_migration_guide_from_release_3_7_0_to_release_3_8_0"></a>81. Migration Guide from release 3.7.0 to release 3.8.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kafka_card_format_changes_2"><a class="anchor" href="#_kafka_card_format_changes_2"></a>81.1. Kafka card format changes</h3>
<div class="paragraph">
<p>The Kafka message schema has been changed. Two new, optional fields are added:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wktGeometry</code></p>
</li>
<li>
<p><code>wktProjection</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Make sure your Kafka consumers and producers are updated and use the latest card and responseCard definitions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_8_x_to_release_3_9_0"><a class="anchor" href="#_migration_guide_from_release_3_8_x_to_release_3_9_0"></a>82. Migration Guide from release 3.8.x to release 3.9.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_web_ui_json_config_file"><a class="anchor" href="#_web_ui_json_config_file"></a>82.1. <code>web-ui.json</code> config file</h3>
<div class="paragraph">
<p>To declare settings parameters, you now need to group all fields under <code>settings: { }</code> and you must not use a statement like this one : <code>settings.replayInterval: 10</code></p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>Replace the following invalid settings config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings.replayInterval&quot;: 10,
  &quot;settings.replayEnabled&quot;: true,
  &quot;settings&quot;: {
    &quot;about&quot;: {
      &quot;keycloak&quot;: {
        &quot;name&quot;: &quot;Keycloak&quot;,
        &quot;rank&quot;: 2,
        &quot;version&quot;: &quot;6.0.1&quot;
      },
    }
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>By this valid one :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings&quot;: {
    &quot;replayInterval&quot;: 10,
    &quot;replayEnabled&quot;: true,
    &quot;about&quot;: {
      &quot;keycloak&quot;: {
        &quot;name&quot;: &quot;Keycloak&quot;,
        &quot;rank&quot;: 2,
        &quot;version&quot;: &quot;6.0.1&quot;
      },
    }
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_9_x_to_release_3_10_0"><a class="anchor" href="#_migration_guide_from_release_3_9_x_to_release_3_10_0"></a>83. Migration Guide from release 3.9.x to release 3.10.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_card_publication_with_not_existent_process_or_state"><a class="anchor" href="#_card_publication_with_not_existent_process_or_state"></a>83.1. Card publication with not existent process or state</h3>
<div class="paragraph">
<p>OperatorFabric will refuse the publication of cards referring a not existent process or state.
To allow the publication of cards with not existent process or state you should set the <code>authorizeToSendCardWithInvalidProcessState</code> property to <code>true</code> in <code>cards-publication.yml</code> configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_web_ui_json_config_file_2"><a class="anchor" href="#_web_ui_json_config_file_2"></a>83.2. <code>web-ui.json</code> config file</h3>
<div class="sect3">
<h4 id="_settings_about_section"><a class="anchor" href="#_settings_about_section"></a>83.2.1. <code>settings.about</code> section</h4>
<div class="paragraph">
<p>The section to configure <code>about</code> screen has been moved from <code>settings</code> section to the root level. You need to change the configuration file accordingly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>Replace the following invalid config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings&quot;: {
    &quot;about&quot;: {
      &quot;keycloak&quot;: {
        &quot;name&quot;: &quot;Keycloak&quot;,
        &quot;rank&quot;: 2,
        &quot;version&quot;: &quot;6.0.1&quot;
      },
    },
    &quot;replayInterval&quot;: 10,
    &quot;replayEnabled&quot;: true,
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>By this valid one :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings&quot;: {
    &quot;replayInterval&quot;: 10,
    &quot;replayEnabled&quot;: true,
    &quot;locale&quot;: &quot;en&quot;,
    &quot;dateTimeFormat&quot;: &quot;HH:mm DD/MM/YYYY&quot;,
    &quot;dateFormat&quot;: &quot;DD/MM/YYYY&quot;,
    &quot;styleWhenNightDayModeDesactivated&quot;: &quot;NIGHT&quot;
  },
  &quot;about&quot;: {
    &quot;keycloak&quot;: {
      &quot;name&quot;: &quot;Keycloak&quot;,
      &quot;rank&quot;: 2,
      &quot;version&quot;: &quot;6.0.1&quot;
    }
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_settings_infos_hide_section"><a class="anchor" href="#_settings_infos_hide_section"></a>83.2.2. <code>settings.infos.hide</code> section</h4>
<div class="paragraph">
<p>The section to configure hidden fields for the settings screen has been moved from <code>settings.infos.hide</code> section to
<code>settingsScreen.hiddenSettings</code>. This new field is an array of string and possible values are : "description",
"language", "remoteLoggingEnabled" and "sounds". So, you need to change the configuration file accordingly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>Replace the following invalid config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settings&quot;: {
    &quot;infos&quot;: {
      &quot;hide&quot;: {
        &quot;description&quot;: true
      }
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>By this valid one :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  &quot;settingsScreen&quot;: {
    &quot;hiddenSettings&quot;:  [&quot;description&quot;]
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_feed_filtering_and_sorting"><a class="anchor" href="#_feed_filtering_and_sorting"></a>83.2.3. Feed filtering and sorting</h4>
<div class="paragraph">
<p>In feed configuration the following parameters to hide filtering and sorting options have been removed: <code>feed.card.hideAckFilter</code>, <code>feed.card.hideReadSort</code>, <code>feed.card.hideSeveritySort</code></p>
</div>
<div class="paragraph">
<p>Instead, it is possible to configure the default behaviour for sorting and acknowledgment filtering by setting the following parameters in <code>web-ui.json</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>feed.defaultSorting</code> : possible values are : "unread", "date", "severity", "startDate", "endDate"</p>
</li>
<li>
<p><code>feed.defaultAcknowledgmentFilter</code> : possible values are : "notack", "ack", "all"</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_10_x_to_release_3_11_0"><a class="anchor" href="#_migration_guide_from_release_3_10_x_to_release_3_11_0"></a>84. Migration Guide from release 3.10.x to release 3.11.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_card_publication"><a class="anchor" href="#_card_publication"></a>84.1. Card publication</h3>
<div class="paragraph">
<p>OperatorFabric will now check user perimeter when publishing cards via endpoint <code>/cards</code> (it does not concern user cards
which are always controlled). To disable perimeter validation it is possible to set the configuration parameter
<code>checkPerimeterForCardSending</code> to <code>false</code> in cards-publication service configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_templategateway_onstylechange_method"><a class="anchor" href="#_templategateway_onstylechange_method"></a>84.2. templateGateway <code>onStyleChange()</code> method</h3>
<div class="paragraph">
<p>A new <code>onStyleChange()</code> method has been added to templateGateway.
OpFab will call this method when switching day/night mode.
It may have to be implemented by a template to refresh styles and reload embedded charts when user change day/night
mode, please check your existing templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_configuration_3"><a class="anchor" href="#_nginx_configuration_3"></a>84.3. Nginx configuration</h3>
<div class="paragraph">
<p>Nginx configuration file has to be modified to allow the forwarding of query parameters to the new 'userActionLogs' API.
You have to modify <code>nginx.conf</code> file as follows:</p>
</div>
<div class="paragraph">
<p>Replace</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  location ~ "^/users/(.*)" {
    proxy_set_header Host $http_host;
    proxy_pass http://users:8080/$1;
    proxy_set_header X-Forwarded-For $remote_addr;
  }</pre>
</div>
</div>
<div class="paragraph">
<p>With</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  location ~ "^/users/(.*)" {
    proxy_set_header Host $http_host;
    proxy_pass http://users:8080/$1$is_args$args;
    proxy_set_header X-Forwarded-For $remote_addr;
  }</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_11_x_to_release_3_12_0"><a class="anchor" href="#_migration_guide_from_release_3_11_x_to_release_3_12_0"></a>85. Migration Guide from release 3.11.x to release 3.12.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_17"><a class="anchor" href="#_java_17"></a>85.1. Java 17</h3>
<div class="paragraph">
<p>OperatorFabric now runs on java 17, which means that the client library is now compiled with java 17. If you are using the client library, you may need to upgrade your application to java 17 or use client 3.11.2 which is compatible with version 3.12.0 and compiled with java 11.</p>
</div>
</div>
<div class="sect2">
<h3 id="_expiration_date"><a class="anchor" href="#_expiration_date"></a>85.2. Expiration date</h3>
<div class="paragraph">
<p>A new 'expirationDate' field has been added to the card.
Cards with an expiration date will be automatically deleted from the card feed after the expiration date is passed.</p>
</div>
<div class="paragraph">
<p>The expiration date is by default visible in the usercard screen.
You can hide the expiration date in the usercard screen by adding the new 'expirationDateVisible' value to your
usercard configuration in the config.json of your bundle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hide expiration date &#8594; "expirationDateVisible" : false</p>
<div class="literalblock">
<div class="content">
<pre>"processState": {
  "name": "Process example ",
  "description": "Process state",
  "color": "#0070C0",
  "userCard" : {
    "template" : "usercard_process",
    "lttdVisible" : false,
    "expirationDateVisible" : false,
    "recipientList" : [{"id": "ENTITY_FR", "levels": [0,1]}, {"id": "IT_SUPERVISOR_ENTITY"}]
  },</pre>
</div>
</div>
</li>
<li>
<p>Show expiration date &#8594; "expirationDateVisible" : false</p>
<div class="literalblock">
<div class="content">
<pre>"processState": {
  "name": "Process example ",
  "description": "Process state",
  "color": "#0070C0",
  "userCard" : {
    "template" : "usercard_process",
    "lttdVisible" : false,
    "expirationDateVisible" : true,
    "recipientList" : [{"id": "ENTITY_FR", "levels": [0,1]}, {"id": "IT_SUPERVISOR_ENTITY"}]
  },</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_remove_deprecated_method_templategateway_getspecificcardinformation"><a class="anchor" href="#_remove_deprecated_method_templategateway_getspecificcardinformation"></a>85.3. Remove deprecated method templateGateway.getSpecificCardInformation()</h3>
<div class="paragraph">
<p>The deprecated method 'templateGateway.getSpecificCardInformation()' in usercard templates has been removed, use 'usercardTemplateGateway.getSpecificCardInformation()' method instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_configuration_4"><a class="anchor" href="#_nginx_configuration_4"></a>85.4. Nginx configuration</h3>
<div class="paragraph">
<p>You need to modify your existing opfab nginx configuration (nginx.conf file), replace line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>proxy_pass http://users:8080/$1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>by</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>proxy_pass http://users:8080/$1$is_args$args;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_12_0_to_release_3_13_0"><a class="anchor" href="#_migration_guide_from_release_3_12_0_to_release_3_13_0"></a>86. Migration Guide from release 3.12.0 to release 3.13.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_trailing_slash"><a class="anchor" href="#_trailing_slash"></a>86.1. Trailing slash</h3>
<div class="paragraph">
<p>When calling an opfab API you cannot use anymore trailing slash on url.</p>
</div>
<div class="paragraph">
<p>If, for example, one makes a request like <a href="https://opfab/businessconfig/processes/" class="bare">opfab/businessconfig/processes/</a>, it must be replace by <a href="https://opfab/businessconfig/processes" class="bare">opfab/businessconfig/processes</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_viewcardinagenda_parameter_renamed"><a class="anchor" href="#_viewcardinagenda_parameter_renamed"></a>86.2. viewCardInAgenda Parameter renamed</h3>
<div class="paragraph">
<p>The viewCardInAgenda parameter (specified in the usercard template through getSpecificCardInformation) has been renamed viewCardInCalendar to be consistent with other parts of the software. So you may have to update your usercard templates.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_value_set_to_false_for_lttdvisible_and_expirationdatevisible"><a class="anchor" href="#_default_value_set_to_false_for_lttdvisible_and_expirationdatevisible"></a>86.3. Default value set to false for lttdVisible and expirationDateVisible</h3>
<div class="paragraph">
<p>In usercard state definition, the default value for fields <code>lttdVisible</code> and <code>expirationDateVisible</code> is now set to false.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_13_0_to_release_3_14_0"><a class="anchor" href="#_migration_guide_from_release_3_13_0_to_release_3_14_0"></a>87. Migration Guide from release 3.13.0 to release 3.14.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bundles_folder"><a class="anchor" href="#_bundles_folder"></a>87.1. Bundles folder</h3>
<div class="paragraph">
<p>Bundles are not stored directly into the business config storage path defined in configuration anymore (operatorfabric.businessconfig.storage.path) but in a subdirectory named bundles. So in order to migrate, it is needed to move your bundles directories to a subdirectory named bundles.</p>
</div>
<div class="paragraph">
<p>To help you migrate your production environment you can use the following script : <a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/tooling/migration-opfab3.13/moveBundles.sh" class="bare">github.com/opfab/operatorfabric-core/tree/develop/src/tooling/migration-opfab3.13/moveBundles.sh</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_14_0_to_release_3_15_0"><a class="anchor" href="#_migration_guide_from_release_3_14_0_to_release_3_15_0"></a>88. Migration Guide from release 3.14.0 to release 3.15.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_crossorigin_for_geojson"><a class="anchor" href="#_crossorigin_for_geojson"></a>88.1. CrossOrigin for GeoJSON</h3>
<div class="paragraph">
<p>The option <code>feed.geomap.layer.geojson.crossOrigin</code>, used to set a cross-origin option when downloading GeoJSON, has
been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_deprecated_field_from_state_definition"><a class="anchor" href="#_remove_deprecated_field_from_state_definition"></a>88.2. Remove deprecated field from state definition</h3>
<div class="paragraph">
<p>The deprecated field <code>recipientList</code> has been removed from card state definition.
To restrict the recipient list options use the method <code>usercardTemplateGateway.setDropdownEntityRecipientList</code> in template.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_use_of_groups_column_in_realtime_screen"><a class="anchor" href="#_remove_use_of_groups_column_in_realtime_screen"></a>88.3. Remove use of groups column in realtime screen</h3>
<div class="paragraph">
<p>The field <code>groups</code> has been removed from the object <code>entitiesGroups</code> of the configuration file <code>realtimescreens.json</code>.
To conform to this new structure, you have to remove this field from your configuration file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_3_15_0_to_release_4_0_0"><a class="anchor" href="#_migration_guide_from_release_3_15_0_to_release_4_0_0"></a>89. Migration Guide from release 3.15.0 to release 4.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_management_of_core_menus_and_custom_menus"><a class="anchor" href="#_management_of_core_menus_and_custom_menus"></a>89.1. Management of core menus and custom menus</h3>
<div class="paragraph">
<p>The structure of the <code>ui-menu.json</code> file has changed. Fields <code>coreMenusConfiguration</code> and <code>menus</code> do not exist anymore.</p>
</div>
<div class="paragraph">
<p>Now <code>ui-menu.json</code> file contains 4 fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>navigationBar</code> : contains the navigation bar mixing core menus and custom menus</p>
</li>
<li>
<p><code>topRightIconMenus</code> : contains only the two menu icons <code>agenda</code> and <code>usercard</code> on the top right of the screen</p>
</li>
<li>
<p><code>topRightMenus</code> : contains the core menus you want to see when you click the user, on the top right of the screen</p>
</li>
<li>
<p><code>locales</code> : contains the translations for the custom menus</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With the new structure of the file, it is now possible to mix core menus and custom menus in the navigation bar.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can find more information and a full example in the documentation :
<a href="https://opfab.github.io/documentation/current/reference_doc/#menu_entries" class="bare">opfab.github.io/documentation/current/reference_doc/#menu_entries</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_ui_configuration_2"><a class="anchor" href="#_ui_configuration_2"></a>89.2. UI Configuration</h3>
<div class="paragraph">
<p>Some fields of the <code>web-ui.json</code> file have changed and renamed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>alertMessageBusinessAutoClose</code> has been moved to the  <code>alerts</code> section and is now called <code>messageBusinessAutoClose</code></p>
</li>
<li>
<p><code>alertMessageOnBottomOfTheScreen</code> has been moved to the  <code>alerts</code> section and is now called <code>messageOnBottomOfTheScreen</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_opfabapi"><a class="anchor" href="#_opfabapi"></a>89.3. OpfabAPI</h3>
<div class="paragraph">
<p>Use of methods or attributes starting with templateGateway are now deprecated , the following table give you the new methods to use</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated method or attribute</th>
<th class="tableblock halign-left valign-top">New method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getEntityName(entityId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.users.entities.getEntityName(entityId)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getEntity(entityId)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.users.entities.getEntity(entityId)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getAllEntities()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.users.entities.getAllEntities()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.redirectToBusinessMenu(menuId, menuItemId, urlExtension)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.navigate.redirectToBusinessMenu(menuId, menuItemId, urlExtension)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.isUserAllowedToRespond()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.isUserAllowedToRespond()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.isUserMemberOfAnEntityRequiredToRespond()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.isUserMemberOfAnEntityRequiredToRespond()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getEntitiesAllowedToRespond()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getEntitiesAllowedToRespond()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getEntityUsedForUserResponse()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getEntityUsedForUserResponse()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getDisplayContext()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getDisplayContext()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.displayLoadingSpinner()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.displayLoadingSpinner()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.hideLoadingSpinner()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.hideLoadingSpinner()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.childCards</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getChildCards()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.isLocked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.isResponseLocked()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.lockAnswer = function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToResponseLock( () &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.unlockAnswer = function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToResponseUnlock( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.setLttdExpired = function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToLttdExpired( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.onStyleChange = function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToStyleChange( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.setScreenSize =  function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToScreenSize( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.onTemplateRenderingComplete =  function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToTemplateRenderingComplete( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.getUserResponse =  function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.registerFunctionToGetUserResponse( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">templateGateway.applyChildCards =  function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.listenToChildCards( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getCurrentProcess()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getProcessId()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getEditionMode()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getEditionMode()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getEndDate()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getEndDate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getExpirationDate()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getExpirationDate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getLttd()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getLttd()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getSelectedEntityRecipients()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getSelectedEntityRecipients()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getSelectedEntityForInformationRecipients()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getSelectedEntityForInformationRecipients()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getStartDate()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getStartDate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getCurrentState()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getState()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getUserEntityChildCardFromCurrentCard()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.getUserEntityChildCard()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.getSpecificCardInformation =  function () {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.registerFunctionToGetSpecificCardInformation( ()  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setDropdownEntityRecipientList(recipients)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setDropdownEntityRecipientList(recipients)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setDropdownEntityRecipientForInformationList(recipients)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setDropdownEntityRecipientForInformationList(recipients)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userCardTemplateGateway.setEntityUsedForSendingCard = function (entityID) {//do some stuff}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.listenToEntityUsedForSendingCard( (entityID)  &#8658; {//do some stuff} )</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialEndDate(endDate)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialEndDate(endDate)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialExpirationDate(expirationDate)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialExpirationDate(expirationDate)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialLttd(lttd)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialLttd(lttd)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialSelectedRecipients(recipients)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialSelectedRecipients(recipients)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialSelectedRecipientsForInformation(recipients)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialSelectedRecipientsForInformation(recipients)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialSeverity(initialSeverity)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialSeverity(initialSeverity)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercardTemplateGateway.setInitialStartDate(startDate)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentUserCard.setInitialStartDate(startDate)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_write_right_for_user_rightsenum_write"><a class="anchor" href="#_write_right_for_user_rightsenum_write"></a>89.4. Write right for user (RightsEnum.Write)</h3>
<div class="paragraph">
<p>The <code>Write</code> right has been removed. Considering <code>Receive</code> and <code>ReceiveAndWrite</code> rights, <code>Write</code> was useless
and confusing for the code.</p>
</div>
<div class="paragraph">
<p>Before upgrading to 4.0, you must replace all "Write" rights by "ReceiveAndWrite" rights. If you want to
automate it, you can do it directly in the database via the following request :</p>
</div>
<div class="paragraph">
<p><code>db.perimeter.updateMany({"stateRights.right": "Write"}, {"$set": {"stateRights.$.right": "ReceiveAndWrite"}});</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_cards_reminder"><a class="anchor" href="#_cards_reminder"></a>89.5. Cards reminder</h3>
<div class="paragraph">
<p>Cards reminder logic has been moved from front-end to back-end. The reminder logic is handled by the new "cards-reminder" service.</p>
</div>
<div class="paragraph">
<p>After upgrading to 4.0, you must call the <code>/reset</code> endpoint to populate the reminders database by processing all current cards with reminder set. For example using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2107/reset -H "Authorization:Bearer $token"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internal_technical_account"><a class="anchor" href="#_internal_technical_account"></a>89.6. Internal technical account</h3>
<div class="paragraph">
<p>The new back service for reminder and the new service regarding mail diffusion and supervision introduce the need of an internal account to communicate between opfab back services. Therefore, if you intend to utilize any of these services, it is necessary to create an Opfab technical account with ADMIN permissions and configure it within your shared YAML configuration file, for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>operatorfabric:
  internalAccount:
    login: opfab
    password: the_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>The services require knowledge of the URL to retrieve the account&#8217;s token, and this URL should be configured within operatorfabric.servicesUrls.authToken. A default value, based on OperatorFabric default installation, is set to: "http://web-ui/auth/token".</p>
</div>
</div>
<div class="sect2">
<h3 id="_port_mapping"><a class="anchor" href="#_port_mapping"></a>89.7. Port mapping</h3>
<div class="paragraph">
<p>In release 4.0, the listening port is not any more 8080 for services in docker, it is now identical to the default port mapping outside the docker.</p>
</div>
<div class="paragraph">
<p>So you need to modify your port mapping to migrate replacing the 8080 legacy port by the new port :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external-devices</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Depending on your production configuration, you may need as well to change the ports in your nginx conf file.</p>
</div>
<div class="paragraph">
<p>If you want to keep the old port 8080, you can change it via the server.port parameter in the yml config files of the services.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rabbitmq_2"><a class="anchor" href="#_rabbitmq_2"></a>89.8. RabbitMQ</h3>
<div class="paragraph">
<p>In previous versions, it was necessary to start a RabbitMQ container referencing "rabbitmq:3-management." We now highly recommend that you update your configuration to utilize "lfeoperatorfabric/of-rabbitmq:4.0.0.RELEASE" instead. This adjustment ensures that you have a qualified version that is fully compatible with OpFab.</p>
</div>
<div class="paragraph">
<p>When migrating your production environment you may be unable to start rabbitMQ with the following error in log :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2023-09-14 13:57:00.803114+00:00 [error] &lt;0.230.0&gt; Feature flags: `maintenance_mode_status`: required feature flag not enabled! It must be enabled before upgrading RabbitMQ.
2023-09-14 13:57:00.955976+00:00 [error] &lt;0.230.0&gt; Failed to initialize feature flags registry:{disabled_required_feature_flag,
2023-09-14 13:57:00.955976+00:00 [error] &lt;0.230.0&gt;                                               maintenance_mode_status}

BOOT
FAILED
===========
Error during startup: {error,failed_to_initialize_feature_flags_registry}

2023-09-14 13:57:01.022987+00:00 [error] &lt;0.230.0&gt;
2023-09-14 13:57:01.022987+00:00 [error] &lt;0.230.0&gt; BOOT FAILED
2023-09-14 13:57:01.022987+00:00 [error] &lt;0.230.0&gt; ===========
2023-09-14 13:57:01.022987+00:00 [error] &lt;0.230.0&gt; Error during startup: {error,failed_to_initialize_feature_flags_registry}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This issue arises because the persisted data (RabbitMQ queues) generated by the previous version of RabbitMQ is incompatible with the current RabbitMQ version. To address this problem, it is necessary to remove the persisted data before launching OpFab, which can be found at the path mapping /var/lib/rabbitmq/mnesia/ within the Docker container.</p>
</div>
<div class="paragraph">
<p><strong>If you have configured RabbitMQ persistence, we recommend implementing this as a preventive measure to avoid service unavailability in production.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_6"><a class="anchor" href="#_configuration_6"></a>89.9. Configuration</h3>
<div class="paragraph">
<p>The configuration has been simplified, you have now default parameters you do not need to set anymore in the back configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in all yml file you do not need to set anymore spring.application.name</p>
</li>
<li>
<p>a default kafka configuration is provided, you only have to add "kafka.consumer.group-id : opfab-command" to enable kafka</p>
</li>
<li>
<p>a default rabbit configuration is provided</p>
</li>
<li>
<p>default value are provided for "operatorfabric.servicesUrls.users" and "operatorfabric.servicesUrls.businessconfig"</p>
</li>
<li>
<p>"spring.data.mongodb.database" is not to be set anymore</p>
</li>
<li>
<p>you still need to set "management.endpoints.web.exposure.include: '*'" if you want to monitor opfab via prometheus</p>
</li>
<li>
<p>operatorfabric.businessconfig.storage.path is set by default to "/businessconfig-storage"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The nginx configuration has been simplified as well, the best is to redefine your actual nginx based on the example /config/docker/nginx.conf. The main modification is the removal of the following endpoints declaration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/archives</p>
</li>
<li>
<p>/ui</p>
</li>
<li>
<p>/ui/assets/i18n</p>
</li>
<li>
<p>/config/web-ui.json</p>
</li>
<li>
<p>/config/menu-ui.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We have also implemented data compression for the information supplied by the "businessconfig" service within the "nginx.conf" reference file. This is done by adding  in the location /businessconfig :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    gzip on;
    gzip_types application/json;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The nginx conf is not loaded anymore in /usr/share/nginx/html/opfab in the docker but in /usr/share/nginx/html/config. You need to modify your volume configuration . For example in docker compose :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    volumes:
      - &quot;./ui-config:/usr/share/nginx/html/opfab&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>becomes :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    volumes:
      - &quot;./ui-config:/usr/share/nginx/html/config&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the web-ui.json file, you do not need anymore to set :
- security.jwt.expire-claim
- security.oauth2.flow.provider
- security.oauth2.provider-realm
- security.oauth2.provider-url</p>
</div>
</div>
<div class="sect2">
<h3 id="_normalization_of_some_configuration_parameters"><a class="anchor" href="#_normalization_of_some_configuration_parameters"></a>89.10. Normalization of some configuration parameters</h3>
<div class="paragraph">
<p>Some configuration parameters have been renamed, so you have to check your config files and adapt them. Here are the
concerned parameters (old name &#8594; new name):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>daysBeforeLogExpiration &#8594; operatorfabric.users.daysBeforeLogExpiration</p>
</li>
<li>
<p>checkAuthenticationForCardSending &#8594; operatorfabric.cards-publication.checkAuthenticationForCardSending</p>
</li>
<li>
<p>authorizeToSendCardWithInvalidProcessState &#8594; operatorfabric.cards-publication.authorizeToSendCardWithInvalidProcessState</p>
</li>
<li>
<p>checkPerimeterForCardSending &#8594; operatorfabric.cards-publication.checkPerimeterForCardSending</p>
</li>
<li>
<p>external-recipients.* &#8594; operatorfabric.cards-publication.external-recipients.*</p>
</li>
<li>
<p>opfab.kafka.topics.card.topicname &#8594; operatorfabric.cards-publication.kafka.topics.card.topicname</p>
</li>
<li>
<p>opfab.kafka.topics.response-card.topicname &#8594; operatorfabric.cards-publication.kafka.topics.response-card.topicname</p>
</li>
<li>
<p>opfab.kafka.schema.registry.url &#8594; operatorfabric.cards-publication.kafka.schema.registry.url</p>
</li>
<li>
<p>delayForDeleteExpiredCardsScheduling &#8594; operatorfabric.cards-publication.delayForDeleteExpiredCardsScheduling</p>
</li>
<li>
<p>checkIfUserIsAlreadyConnected &#8594; operatorfabric.checkIfUserIsAlreadyConnected</p>
</li>
<li>
<p>spring.data.mongodb.uri -&#8594;  operatorfabric.mongodb.uri</p>
</li>
<li>
<p>spring.rabbitmq.* -&#8594; operatorfabric.rabbitmq.*</p>
</li>
<li>
<p>spring.security.oauth2.resourceserver.jwt.jwk-set-uri -&#8594;  operatorfabric.security.oauth2.resourceserver.jwt.jwk-set-uri</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_mongodb_uri"><a class="anchor" href="#_mongodb_uri"></a>89.11. Mongodb uri</h3>
<div class="paragraph">
<p>The option "authMode=scram-sha1" has to be removed from mongodb uri as SCRAM authentication is enabled by default and "authMode" option is not supported by node.js mongodb driver.
For example you should change :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> mongodb:
    uri: mongodb://root:password@mongodb:27017/operator-fabric?authSource=admin&amp;authMode=scram-sha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> mongodb:
    uri: mongodb://root:password@mongodb:27017/operator-fabric?authSource=admin</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rate_limiter_for_card_sendings"><a class="anchor" href="#_rate_limiter_for_card_sendings"></a>89.12. Rate limiter for card sendings</h3>
<div class="paragraph">
<p>External publishers are now monitored by a new module which limits how many cards they can send
<a href="#cardSendingLimitCardCount"><code>cardSendingLimitCardCount</code></a>
 in a period of time
<a href="#cardSendingLimitPeriod"><code>cardSendingLimitPeriod</code></a>
.
This is to avoid potential overloading due to external apps stuck in a card sending loop.</p>
</div>
<div class="paragraph">
<p>Default value is set to 1000 cards per hour. It can be disabled / enabled with
<a href="#activateCardSendingLimiter"><code>activateCardSendingLimiter</code></a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_4_0_0_to_release_4_1_0"><a class="anchor" href="#_migration_guide_from_release_4_0_0_to_release_4_1_0"></a>90. Migration Guide from release 4.0.0 to release 4.1.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_optimizing_nginx_configuration_for_latency_reduction"><a class="anchor" href="#_optimizing_nginx_configuration_for_latency_reduction"></a>90.1. Optimizing Nginx Configuration for Latency Reduction</h3>
<div class="paragraph">
<p>An optimization has been introduced in the Nginx configuration to reduce latency. To implement this optimization in your <code>nginx.conf</code> you need to add in <code>location /cards/</code>  the directive <code>proxy_buffering off</code></p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  location /cards/ {
    proxy_buffering off;
    proxy_set_header Host $http_host;
    proxy_pass http://cards-consultation:2104/;
    proxy_set_header X-Forwarded-For $remote_addr;
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_the_file_size_limit"><a class="anchor" href="#_updating_the_file_size_limit"></a>90.2. Updating the file size limit</h3>
<div class="paragraph">
<p>The limit of maximum file size has been updated to 100 MB. To implement this limit in your <code>nginx.conf</code> you need to add in <code>location /businessconfig/</code>  the directive <code>client_max_body_size 100M;</code></p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  location /businessconfig {
    proxy_set_header Host $http_host;
    proxy_pass http://${MY_DOCKER_HOST}:2100;
    proxy_set_header X-Forwarded-For $remote_addr;
    client_max_body_size 100M;
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_configuration_for_entity_supervision_administration"><a class="anchor" href="#_nginx_configuration_for_entity_supervision_administration"></a>90.3. Nginx Configuration for entity supervision administration</h3>
<div class="paragraph">
<p>The new 'Supervised Entities' admin page requires interaction with the supervisor API via Nginx. To enable access to the supervisor API, please incorporate the following configuration into your <code>nginx.conf</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  location ~ &quot;^/supervisor/(.*)&quot; {
    set $supervisor http://supervisor:2108;
    proxy_set_header Host $http_host;
    proxy_pass $supervisor/$1;
    proxy_set_header X-Forwarded-For $remote_addr;
  }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_supervisor_configuration_change"><a class="anchor" href="#_supervisor_configuration_change"></a>90.4. Supervisor configuration change</h3>
<div class="paragraph">
<p>The configuration of 'supervisor.defaultConfig.entitiesToSupervise' parameter has changed. The supervised entity field <code>id</code> has been renamed to <code>entityId</code>. You should modify your configuration accordingly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  supervisor:
    defaultConfig:
      entitiesToSupervise:
      - id: ENTITY1_FR
        supervisors:
        - ENTITY2_FR
      - id: ENTITY2_FR
        supervisors:
        - ENTITY1_FR</code></pre>
</div>
</div>
<div class="paragraph">
<p>should be changed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>  supervisor:
    defaultConfig:
      entitiesToSupervise:
      - entityId: ENTITY1_FR
        supervisors:
        - ENTITY2_FR
      - entityId: ENTITY2_FR
        supervisors:
        - ENTITY1_FR</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log_directories_in_docker"><a class="anchor" href="#_log_directories_in_docker"></a>90.5. Log directories in docker</h3>
<div class="paragraph">
<p>For the services cards-reminder, supervisor, cards-external-diffusion the log directory in the docker is not anymore /usr/app/logs but /var/log/opfab. So if you map the log directory in your configuration , you need to change it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_opfabapi_2"><a class="anchor" href="#_opfabapi_2"></a>90.6. OpfabAPI</h3>
<div class="paragraph">
<p>The following method is deprecated and it is recommended you use the new method:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Deprecated method or attribute</th>
<th class="tableblock halign-left valign-top">New method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getEntityUsedForUserResponse()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.currentCard.getEntitiesUsableForUserResponse()</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_4_1_0_to_release_4_2_0"><a class="anchor" href="#_migration_guide_from_release_4_1_0_to_release_4_2_0"></a>91. Migration Guide from release 4.1.0 to release 4.2.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deletion_of_parameter_displayconnectioncirclesinpreview"><a class="anchor" href="#_deletion_of_parameter_displayconnectioncirclesinpreview"></a>91.1. Deletion of parameter displayConnectionCirclesInPreview</h3>
<div class="paragraph">
<p>The parameter <code>displayConnectionCirclesInPreview</code> has been deleted. Now, in the usercard preview, users will see
which recipients entities are connected or not via badges : a blue badge if connected and a gray one if not.
This feature is provided for all users.
So you have to remove this parameter from the configuration file <code>web-ui.json</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_files_of_the_realtime_users_screen"><a class="anchor" href="#_configuration_files_of_the_realtime_users_screen"></a>91.2. Configuration files of the realtime users screen</h3>
<div class="paragraph">
<p>Previously, to configure this screen, the json file had to fit the following structure :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">realTimeScreens</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="error">&lt;</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">n</span><span class="error">&gt;</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="error">&lt;</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">o</span><span class="error">f</span> <span class="error">a</span> <span class="error">g</span><span class="error">r</span><span class="error">o</span><span class="error">u</span><span class="error">p</span> <span class="error">o</span><span class="error">f</span> <span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">&gt;</span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="error">&lt;</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="integer">1</span> <span class="error">i</span><span class="error">d</span><span class="error">&gt;</span>,
                <span class="error">&lt;</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="integer">2</span> <span class="error">i</span><span class="error">d</span><span class="error">&gt;</span>
              ]
            },
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="error">&lt;</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">o</span><span class="error">f</span> <span class="error">a</span><span class="error">n</span><span class="error">o</span><span class="error">t</span><span class="error">h</span><span class="error">e</span><span class="error">r</span> <span class="error">g</span><span class="error">r</span><span class="error">o</span><span class="error">u</span><span class="error">p</span> <span class="error">o</span><span class="error">f</span> <span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">i</span><span class="error">e</span><span class="error">s</span><span class="error">&gt;</span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="error">&lt;</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="integer">3</span> <span class="error">i</span><span class="error">d</span><span class="error">&gt;</span>,
                <span class="error">&lt;</span><span class="error">e</span><span class="error">n</span><span class="error">t</span><span class="error">i</span><span class="error">t</span><span class="error">y</span><span class="integer">4</span> <span class="error">i</span><span class="error">d</span><span class="error">&gt;</span>
              ]
            }
          ]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now entities shouldn&#8217;t be grouped in the configuration file anymore. Instead entities are grouped by a shared parent entity. The configuration file needs to be changed to the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">realTimeScreens</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="error">&lt;</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span> <span class="error">o</span><span class="error">f</span> <span class="error">t</span><span class="error">h</span><span class="error">e</span> <span class="error">s</span><span class="error">c</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">n</span><span class="error">&gt;</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;parent entity 1 id&gt;</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;parent entity 2 id&gt;</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this parent entity 1 and parent entity 2 need to be declared and the name of the parent entities will be the name of the groups.</p>
</div>
</div>
<div class="sect2">
<h3 id="_updating_the_entity_roles_in_the_database"><a class="anchor" href="#_updating_the_entity_roles_in_the_database"></a>91.3. Updating the entity roles in the database</h3>
<div class="paragraph">
<p>In this release the "roles" attribute has been added to the entity object. It defines the utility of an entity. It absorbs and broaden the logic of the attribute "entityAllowedToSendCard" which becomes deprecated.
To update the entities in your mongo database, you can execute the following script located in <code>OF_HOME/src/tooling/migration-entity-roles</code> :</p>
</div>
<div class="paragraph">
<p><code>./launchMigration.sh &lt;IP or DNSNameMongoDB&gt; &lt;portMongoDB&gt; &lt;loginMongoDB&gt; &lt;passwordMongoDB&gt;</code></p>
</div>
<div class="paragraph">
<p>This script will assign the roles "ACTIVITY_AREA", "CARD_RECEIVER" and "CARD_SENDER" to all the entities that have "entityAllowedToSendCard = true" and the role "CARD_RECEIVER" to the others. Please refer to the documentation to see the other possible roles and their effect.</p>
</div>
<div class="paragraph">
<p>After successful execution of the previous script you should execute the following script to cleanup the database removing the deprecated attribute "entityAllowedToSendCard":</p>
</div>
<div class="paragraph">
<p><code>./cleanMongoAfterMigration.sh &lt;IP or DNSNameMongoDB&gt; &lt;portMongoDB&gt; &lt;loginMongoDB&gt; &lt;passwordMongoDB&gt;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_deletion_of_deprecated_functions_in_templategatewayusercardtemplategateway"><a class="anchor" href="#_deletion_of_deprecated_functions_in_templategatewayusercardtemplategateway"></a>91.4. Deletion of deprecated functions in templateGateway/usercardTemplateGateway</h3>
<div class="paragraph">
<p>Functions in templateGateway/usercardTemplateGateway do not exist anymore, you can refer to the
migration documentation to opfab 4.0 to know which functions you have to use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_keepchildcards"><a class="anchor" href="#_card_keepchildcards"></a>91.5. Card keepChildCards</h3>
<div class="paragraph">
<p>The card field <code>keepChildCards</code> is now deprecated, use the new <code>actions</code> field (string array) including "KEEP_CHILD_CARDS" action instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feed_process_and_state_filter"><a class="anchor" href="#_feed_process_and_state_filter"></a>91.6. Feed process and state filter</h3>
<div class="paragraph">
<p>New filters have been added to feed filters to allow filtering by card process and state.
It is possible to hide the process filter by setting <code>feed.card.hideProcessFilter</code> to <code>true</code> in <code>web-ui.json</code> config file. When process filter is hidden than also state filter is hidden.
It is possible to hide just the the state filter by setting <code>feed.card.hideStateFilter</code> to <code>true</code> in <code>web-ui.json</code> config file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_settings"><a class="anchor" href="#_user_settings"></a>91.7. User settings</h3>
<div class="paragraph">
<p>A new setting to send emails in plain text instead of HTML has been added in the settings screen of the user.
This setting can be hidden in the configuration file of the web-ui by the field "settings.settingsScreen.hiddenSettings" by adding the value "emailToPlainText".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_4_2_0_to_release_4_3_0"><a class="anchor" href="#_migration_guide_from_release_4_2_0_to_release_4_3_0"></a>92. Migration Guide from release 4.2.0 to release 4.3.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_admin_group"><a class="anchor" href="#_admin_group"></a>92.1. ADMIN group</h3>
<div class="paragraph">
<p>Users belonging to 'ADMIN' group will not be automatically given admin rights anymore.
The admin rights will be set only if user is member of a group with ADMIN permission.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Before initiating the migration process, ensure that all users with administrative privileges are members of a group that has been explicitly granted the 'ADMIN' permission. Failing to do so may result in loss of the ability to administrate operator fabric
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_map_multiple_geojson_layers"><a class="anchor" href="#_map_multiple_geojson_layers"></a>92.2. Map multiple GeoJSON layers</h3>
<div class="paragraph">
<p>It is now possible to add more than one GeoJSON layer to the map. To allow the configuration of multiple layers the <code>feed.geomap.layer.geojson</code> configuration parameter in web-ui.json is now an array. for each layer it is possible to specify the url and an optional style. The style object can have styling properties for stroke, fill, image, and text styles as defined in OpenLayer flat style (<a href="https://openlayers.org/en/latest/apidoc/module-ol_style_flat.html" class="bare">openlayers.org/en/latest/apidoc/module-ol_style_flat.html</a>)
You should change your configuration for geoJSON layer to configure it as an array, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>      "layer": {
        "geojson": {
          "url": "assets/layers/geojson-layer.json"
        }
      }</pre>
</div>
</div>
<div class="paragraph">
<p>should be changed to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>      "layer": {
        "geojson": [
          {
            "url": "assets/layers/geojson-layer.json"
          }
        ]
      }</pre>
</div>
</div>
<div class="paragraph">
<p>Or adding the style:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>      "layer": {
        "geojson": [
          {
            "url": "assets/layers/geojson-layer.json",
            "style": {
              "stroke-color": "blue",
              "stroke-width": 1.5,
              "fill-color": "rgba(39, 245, 164, 0.4)"
            }
          }
        ]
      }</pre>
</div>
</div>
<div class="paragraph">
<p>If no style is defined the layer will be rendered with default Opfab style.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. currently, that means a severity, but in the future it could also be a process id, or anything identifying the signal to be played
</div>
</div>
</body>
</html>