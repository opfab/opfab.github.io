<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>OperatorFabric Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>OperatorFabric Documentation</h1>
<div class="details">
<span id="revnumber">version SNAPSHOT,</span>
<span id="revdate">23 November 2020</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#architecture">OperatorFabric Architecture</a>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_business_architecture">2. Business Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components">2.1. Business components</a></li>
<li><a href="#_business_objects">2.2. Business objects</a></li>
</ul>
</li>
<li><a href="#_technical_architecture">3. Technical Architecture</a>
<ul class="sectlevel2">
<li><a href="#_business_components_2">3.1. Business components</a></li>
<li><a href="#_technical_components">3.2. Technical components</a>
<ul class="sectlevel3">
<li><a href="#_gateway">3.2.1. Gateway</a></li>
<li><a href="#_broker">3.2.2. Broker</a></li>
<li><a href="#_authentication">3.2.3. Authentication</a></li>
<li><a href="#_database">3.2.4. Database</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_getting_started">OperatorFabric Getting Started</a>
<ul class="sectlevel1">
<li><a href="#_prerequisites">4. Prerequisites</a></li>
<li><a href="#_install_and_run_server">5. Install and run server</a></li>
<li><a href="#_examples">6. Examples</a>
<ul class="sectlevel2">
<li><a href="#_example_1_send_and_update_a_basic_card">6.1. Example 1: Send and update a basic card</a>
<ul class="sectlevel3">
<li><a href="#_anatomy_of_the_card">6.1.1. Anatomy of the card :</a></li>
<li><a href="#_update_the_card">6.1.2. Update the card</a></li>
<li><a href="#_delete_the_card">6.1.3. Delete the card</a></li>
</ul>
</li>
<li><a href="#_example_2_publish_a_new_bundle">6.2. Example 2: Publish a new bundle</a>
<ul class="sectlevel3">
<li><a href="#_package_your_bundle">6.2.1. Package your bundle</a></li>
<li><a href="#_get_a_token">6.2.2. Get a Token</a></li>
<li><a href="#_send_the_bundle">6.2.3. Send the bundle</a></li>
<li><a href="#_send_a_card">6.2.4. Send a card</a></li>
<li><a href="#_internationalization">6.2.5. Internationalization</a></li>
</ul>
</li>
<li><a href="#_example_3_process_with_state">6.3. Example 3: Process with state</a></li>
<li><a href="#_example_4_time_line">6.4. Example 4: Time Line</a></li>
<li><a href="#_example_5_card_routing_mechanism">6.5. Example 5: Card routing mechanism</a>
<ul class="sectlevel3">
<li><a href="#_card_sent_to_a_group">6.5.1. Card sent to a group</a></li>
<li><a href="#_card_sent_to_an_entity">6.5.2. Card sent to an entity</a></li>
<li><a href="#_card_sent_to_a_group_and_an_entity">6.5.3. Card sent to a group and an entity</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#troubleshooting_bundle">7. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_my_bundle_is_not_loaded">7.1. My bundle is not loaded</a>
<ul class="sectlevel3">
<li><a href="#_solution">7.1.1. Solution</a></li>
</ul>
</li>
<li><a href="#_i_cant_upload_my_bundle">7.2. I can&#8217;t upload my bundle</a>
<ul class="sectlevel3">
<li><a href="#_format_verification">7.2.1. Format verification</a>
<ul class="sectlevel4">
<li><a href="#_linux_solution">7.2.1.1. Linux solution</a></li>
</ul>
</li>
<li><a href="#_solution_2">7.2.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_bundle_is_rejected_due_to_internal_structure">7.3. My bundle is rejected due to internal structure</a>
<ul class="sectlevel3">
<li><a href="#_reason">7.3.1. Reason</a></li>
<li><a href="#_solution_3">7.3.2. Solution</a></li>
</ul>
</li>
<li><a href="#_no_template_display">7.4. No template display</a>
<ul class="sectlevel3">
<li><a href="#_verification">7.4.1. Verification</a></li>
<li><a href="#_solution_4">7.4.2. Solution</a></li>
</ul>
</li>
<li><a href="#_my_template_is_not_used">7.5. My template is not used.</a>
<ul class="sectlevel3">
<li><a href="#_solution_5">7.5.1. Solution</a></li>
</ul>
</li>
<li><a href="#_my_value_is_not_displayed_in_the_detail_template">7.6. My value is not displayed in the detail template</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_reference_documentation">OperatorFabric Reference Documentation</a>
<ul class="sectlevel1">
<li><a href="#_introduction_2">8. Introduction</a></li>
<li><a href="#_sending_cards">9. Sending cards</a>
<ul class="sectlevel2">
<li><a href="#card_structure">9.1. Card Structure</a>
<ul class="sectlevel3">
<li><a href="#_technical_information_of_the_card">9.1.1. Technical Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_mandatory_information">9.1.1.1. Mandatory information</a></li>
<li><a href="#_state_in_the_process_state">9.1.1.2. State in the process (<code>state</code>)</a></li>
<li><a href="#_recipient_recipient">9.1.1.3. Recipient (<code>recipient</code>)</a></li>
<li><a href="#_optional_information">9.1.1.4. Optional information</a></li>
<li><a href="#_business_period">9.1.1.5. Business period</a></li>
<li><a href="#_store_information">9.1.1.6. Store information</a></li>
</ul>
</li>
<li><a href="#_user_destined_information_of_the_card">9.1.2. User destined Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_in_card_format">9.1.2.1. in Card Format</a></li>
<li><a href="#_custom_part">9.1.2.2. Custom part</a></li>
</ul>
</li>
<li><a href="#_presentation_information_of_the_card">9.1.3. Presentation Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_details_details">9.1.3.1. details (<code>details</code>)</a></li>
<li><a href="#_timespans_timespans">9.1.3.2. TimeSpans (<code>timeSpans</code>)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cards_examples">9.2. Cards Examples</a>
<ul class="sectlevel3">
<li><a href="#minimal_card">9.2.1. Minimal Card</a>
<ul class="sectlevel4">
<li><a href="#_send_to_one_user">9.2.1.1. Send to One User</a></li>
<li><a href="#_send_to_several_users">9.2.1.2. Send to several users</a></li>
</ul>
</li>
<li><a href="#_regular_card">9.2.2. Regular Card</a>
<ul class="sectlevel4">
<li><a href="#_full_of_hidden_data">9.2.2.1. Full of Hidden data</a></li>
<li><a href="#_fully_useful">9.2.2.2. Fully useful</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_rendering">10. Card rendering</a>
<ul class="sectlevel2">
<li><a href="#_process_declaration_and_configuration">10.1. Process: Declaration and Configuration</a>
<ul class="sectlevel3">
<li><a href="#_bundle_as_process_declaration">10.1.1. Bundle as Process declaration</a></li>
<li><a href="#_the_config_json_file">10.1.2. The config.json file</a></li>
<li><a href="#_i18n">10.1.3. i18n</a>
<ul class="sectlevel4">
<li><a href="#_template_folder">10.1.3.1. Template folder</a></li>
<li><a href="#_processes_and_states">10.1.3.2. Processes and States</a></li>
<li><a href="#_upload">10.1.3.3. Upload</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#template_description">10.2. Templates</a>
<ul class="sectlevel3">
<li><a href="#_operatorfabric_specific_handlebars_helpers">10.2.1. OperatorFabric specific handlebars helpers</a>
<ul class="sectlevel4">
<li><a href="#numberformat">10.2.1.1. numberFormat</a></li>
<li><a href="#dateformat">10.2.1.2. dateFormat</a></li>
<li><a href="#slice">10.2.1.3. slice</a></li>
<li><a href="#now">10.2.1.4. now</a></li>
<li><a href="#preservespace">10.2.1.5. preserveSpace</a></li>
<li><a href="#bool">10.2.1.6. bool</a></li>
<li><a href="#math">10.2.1.7. math</a></li>
<li><a href="#split">10.2.1.8. split</a></li>
<li><a href="#svg">10.2.1.9. svg</a></li>
<li><a href="#i18n">10.2.1.10. i18n</a></li>
<li><a href="#sort">10.2.1.11. sort</a></li>
<li><a href="#arrayContains">10.2.1.12. arrayContains</a></li>
<li><a href="#times">10.2.1.13. times</a></li>
<li><a href="#toBreakage">10.2.1.14. toBreakage</a></li>
<li><a href="#keyValue">10.2.1.15. keyValue</a></li>
<li><a href="#_keepspacesandendofline">10.2.1.16. keepSpacesAndEndOfLine</a></li>
</ul>
</li>
<li><a href="#_charts">10.2.2. Charts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_notification">11. Card notification</a>
<ul class="sectlevel2">
<li><a href="#_sound_notification">11.1. Sound notification</a></li>
<li><a href="#_card_read">11.2. Card read</a></li>
<li><a href="#_card_acknowledgment">11.3. Card acknowledgment</a></li>
<li><a href="#_card_reminder_experimental">11.4. Card reminder (Experimental)</a></li>
</ul>
</li>
<li><a href="#response_cards">12. Response cards</a>
<ul class="sectlevel2">
<li><a href="#_steps_needed_to_use_a_response_card">12.1. Steps needed to use a response card</a>
<ul class="sectlevel3">
<li><a href="#_define_a_third_party_tool">12.1.1. Define a third party tool</a></li>
<li><a href="#_configure_the_response_in_config_json">12.1.2. Configure the response in config.json</a></li>
<li><a href="#_design_the_question_form_in_the_template">12.1.3. Design the question form in the template</a></li>
<li><a href="#_define_permissions">12.1.4. Define permissions</a></li>
</ul>
</li>
<li><a href="#_send_a_question_card">12.2. Send a question card</a></li>
<li><a href="#_integrate_child_cards">12.3. Integrate child cards</a>
<ul class="sectlevel3">
<li><a href="#_entity_name">12.3.1. Entity name</a></li>
<li><a href="#_example">12.3.2. Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_archived_cards">13. Archived Cards</a>
<ul class="sectlevel2">
<li><a href="#_key_concepts">13.1. Key concepts</a></li>
<li><a href="#_archives_screen_in_the_ui">13.2. Archives screen in the UI</a></li>
</ul>
</li>
<li><a href="#users_management">14. User management</a>
<ul class="sectlevel2">
<li><a href="#_users_groups_entities_and_perimeters">14.1. Users, groups, entities and perimeters</a>
<ul class="sectlevel3">
<li><a href="#_users">14.1.1. Users</a>
<ul class="sectlevel4">
<li><a href="#_automated_user_creation">14.1.1.1. Automated user creation</a></li>
</ul>
</li>
<li><a href="#_groups">14.1.2. Groups</a></li>
<li><a href="#_entities">14.1.3. Entities</a></li>
<li><a href="#_perimeters">14.1.4. Perimeters</a></li>
<li><a href="#_alternative_way_to_manage_groups_and_entities">14.1.5. Alternative way to manage groups and entities</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ui_customization">15. UI Customization</a>
<ul class="sectlevel2">
<li><a href="#_ui_configuration">15.1. UI configuration</a></li>
<li><a href="#menu_entries">15.2. Menu Entries</a>
<ul class="sectlevel3">
<li><a href="#_ui_menu_json_declaration">15.2.1. ui-menu.json declaration</a></li>
<li><a href="#_examples_3">15.2.2. Examples</a></li>
<li><a href="#_operator_fabric_theme">15.2.3. Operator Fabric theme</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_deployment_and_administration_of_operatorfabric">Deployment and Administration of OperatorFabric</a>
<ul class="sectlevel1">
<li><a href="#_deployment">16. Deployment</a></li>
<li><a href="#_configuration_2">17. Configuration</a>
<ul class="sectlevel2">
<li><a href="#_business_service_configuration">17.1. Business service configuration</a>
<ul class="sectlevel3">
<li><a href="#_shared_business_service_configuration">17.1.1. Shared business service configuration</a></li>
<li><a href="#_business_service_specific_configurations">17.1.2. Business service specific configurations</a>
<ul class="sectlevel4">
<li><a href="#_businessconfig_service">17.1.2.1. Businessconfig service</a></li>
<li><a href="#_users_service">17.1.2.2. Users service</a></li>
<li><a href="#_cards_publication_service">17.1.2.3. Cards-publication service</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_web_ui_configuration">17.2. Web UI Configuration</a>
<ul class="sectlevel3">
<li><a href="#_nginx_configuration">17.2.1. NGINX configuration</a></li>
<li><a href="#ui_properties">17.2.2. UI properties</a></li>
</ul>
</li>
<li><a href="#opfab_spec_conf">17.3. Security Configuration</a>
<ul class="sectlevel3">
<li><a href="#_authentication_configuration">17.3.1. Authentication configuration</a>
<ul class="sectlevel4">
<li><a href="#_nginx_configuration_2">17.3.1.1. Nginx Configuration</a></li>
<li><a href="#_configuration_file_common_yml">17.3.1.2. Configuration file common.yml</a></li>
<li><a href="#_configuration_file_web_ui_json">17.3.1.3. Configuration file web-ui.json</a></li>
<li><a href="#_oauth2_password_or_code_flows">17.3.1.4. OAuth2 PASSWORD or CODE Flows</a></li>
<li><a href="#_oauth2_implicit_flow">17.3.1.5. OAuth2 IMPLICIT Flow</a></li>
</ul>
</li>
<li><a href="#_user_creation">17.3.2. User creation</a></li>
<li><a href="#jwt_mode">17.3.3. Alternative way to manage groups (and/or entities)</a></li>
<li><a href="#custom_certificates">17.3.4. Adding certification authorities or certificates to the Java keystore</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_mongo_configuration">17.4. OperatorFabric Mongo configuration</a>
<ul class="sectlevel3">
<li><a href="#_define_time_to_live_for_archived_cards">17.4.1. Define time to live for archived cards</a></li>
</ul>
</li>
<li><a href="#_operatorfabric_kafka_configuration">17.5. OperatorFabric Kafka configuration</a></li>
</ul>
</li>
<li><a href="#_rabbitmq">18. RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#_docker_container">18.1. Docker container</a></li>
<li><a href="#_server_installation">18.2. Server installation</a>
<ul class="sectlevel3">
<li><a href="#_download_installation">18.2.1. Download &amp; Installation</a></li>
<li><a href="#_used_ports">18.2.2. Used ports</a></li>
<li><a href="#_production_configuration">18.2.3. Production configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_monitoring">19. Monitoring</a></li>
<li><a href="#_users_groups_and_entities_administration">20. Users, Groups and Entities Administration</a>
<ul class="sectlevel2">
<li><a href="#_users_2">20.1. Users</a>
<ul class="sectlevel3">
<li><a href="#_list_all_users">20.1.1. List all users</a></li>
<li><a href="#_create_a_new_user">20.1.2. Create a new User</a></li>
<li><a href="#_fetch_user_details">20.1.3. Fetch user details</a></li>
<li><a href="#_update_user_details">20.1.4. Update user details</a></li>
</ul>
</li>
<li><a href="#_groupsentities">20.2. Groups/Entities</a>
<ul class="sectlevel3">
<li><a href="#_list_groups_or_entities">20.2.1. List groups (or entities)</a></li>
<li><a href="#_create_a_new_group_or_entity">20.2.2. Create a new group (or entity)</a></li>
<li><a href="#_fetch_details_of_a_given_group_or_entity">20.2.3. Fetch details of a given group (or entity)</a></li>
<li><a href="#_update_details_of_a_group_or_entity">20.2.4. Update details of a group (or entity)</a></li>
<li><a href="#_add_a_user_to_a_group_or_entity">20.2.5. Add a user to a group (or entity)</a></li>
<li><a href="#_remove_a_user_from_a_group_or_entity">20.2.6. Remove a user from a group (or entity)</a></li>
<li><a href="#_entity_parents">20.2.7. Entity parents</a>
<ul class="sectlevel4">
<li><a href="#_add_a_new_entity_without_a_cycle_in_the_parent_declaration">20.2.7.1. Add a new Entity without a cycle in the parent declaration</a></li>
<li><a href="#_add_a_new_entity_with_a_cycle">20.2.7.2. Add a new Entity with a cycle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_service_port_table">21. Service port table</a></li>
<li><a href="#_restricted_operations_administration">22. Restricted operations (administration)</a></li>
</ul>
</li>
<li><a href="#dev_env">Development environment</a>
<ul class="sectlevel1">
<li><a href="#_requirements">23. Requirements</a>
<ul class="sectlevel2">
<li><a href="#_tools_and_libraries">23.1. Tools and libraries</a></li>
<li><a href="#_software">23.2. Software</a></li>
<li><a href="#_browser_support">23.3. Browser support</a></li>
</ul>
</li>
<li><a href="#setup_dev_env">24. Setting up your development environment</a>
<ul class="sectlevel2">
<li><a href="#_clone_repository">24.1. Clone repository</a></li>
<li><a href="#_set_up_your_environment_environment_variables_appropriate_versions_of_gradle_maven_etc">24.2. Set up your environment (environment variables &amp; appropriate versions of gradle, maven, etc)</a></li>
<li><a href="#_deploy_needed_docker_containers">24.3. Deploy needed docker containers</a>
<ul class="sectlevel3">
<li><a href="#_a_minimal_configuration_for_gradle_build">24.3.1. A Minimal Configuration for <code>gradle</code> Build</a></li>
<li><a href="#_enabling_local_quality_report_generation">24.3.2. Enabling local quality report generation</a></li>
<li><a href="#_docker_dev_env">24.3.3. Development environment</a></li>
</ul>
</li>
<li><a href="#_build_operatorfabric_with_gradle">24.4. Build OperatorFabric with Gradle</a></li>
<li><a href="#_run_operatorfabric_services_using_the_run_all_sh_script">24.5. Run OperatorFabric Services using the <code>run_all.sh</code> script</a></li>
<li><a href="#_check_services_status">24.6. Check services status</a></li>
<li><a href="#_log_into_the_ui">24.7. Log into the UI</a></li>
<li><a href="#_push_cards_to_the_feed">24.8. Push cards to the feed</a></li>
</ul>
</li>
<li><a href="#_user_interface">25. User Interface</a>
<ul class="sectlevel2">
<li><a href="#_run">25.1. Run</a>
<ul class="sectlevel3">
<li><a href="#_front_end_development">25.1.1. Front End development</a></li>
</ul>
</li>
<li><a href="#_build">25.2. Build</a></li>
<li><a href="#_test">25.3. Test</a>
<ul class="sectlevel3">
<li><a href="#_standalone_tests">25.3.1. Standalone tests</a></li>
<li><a href="#_test_during_ui_development">25.3.2. Test during UI development</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_environment_variables">26. Environment variables</a></li>
<li><a href="#_project_structure">27. Project Structure</a>
<ul class="sectlevel2">
<li><a href="#_tree_view">27.1. Tree View</a></li>
<li><a href="#_content_details">27.2. Content Details</a></li>
<li><a href="#_conventions_regarding_project_structure_and_configuration">27.3. Conventions regarding project structure and configuration</a>
<ul class="sectlevel3">
<li><a href="#_java">27.3.1. Java</a></li>
<li><a href="#_modeling">27.3.2. Modeling</a></li>
<li><a href="#_docker">27.3.3. Docker</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_development_tools">28. Development tools</a>
<ul class="sectlevel2">
<li><a href="#_scripts_bin_and_cicd">28.1. Scripts (bin and CICD)</a>
<ul class="sectlevel3">
<li><a href="#_run_all_sh">28.1.1. run_all.sh</a></li>
<li><a href="#_setup_dockerized_environment_sh">28.1.2. setup_dockerized_environment.sh</a></li>
</ul>
</li>
<li><a href="#gradle_tasks">28.2. Gradle Tasks</a>
<ul class="sectlevel3">
<li><a href="#_services">28.2.1. Services</a>
<ul class="sectlevel4">
<li><a href="#_common_tasks_for_all_sub_projects">28.2.1.1. Common tasks for all sub-projects</a></li>
<li><a href="#_core">28.2.1.2. Core</a></li>
<li><a href="#_businessconfig_service_2">28.2.1.3. Businessconfig Service</a></li>
<li><a href="#_toolsgeneric">28.2.1.4. tools/generic</a></li>
</ul>
</li>
<li><a href="#_gradle_plugins">28.2.2. Gradle Plugins</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_useful_recipes">29. Useful recipes</a>
<ul class="sectlevel2">
<li><a href="#_running_sub_project_from_jar_file">29.1. Running sub-project from jar file</a></li>
<li><a href="#_overriding_properties_when_running_from_jar_file">29.2. Overriding properties when running from jar file</a></li>
<li><a href="#_generating_docker_images">29.3. Generating docker images</a></li>
</ul>
</li>
<li><a href="#troubleshooting">30. Troubleshooting</a></li>
<li><a href="#_keycloak_configuration">31. Keycloak Configuration</a>
<ul class="sectlevel2">
<li><a href="#_add_realm">31.1. Add Realm</a></li>
<li><a href="#_setup_at_least_one_client_or_best_one_per_service">31.2. Setup at least one client (or best one per service)</a>
<ul class="sectlevel3">
<li><a href="#_create_client">31.2.1. Create client</a></li>
<li><a href="#_add_a_role_to_client">31.2.2. Add a Role to Client</a></li>
</ul>
</li>
<li><a href="#_create_users">31.3. Create Users</a>
<ul class="sectlevel3">
<li><a href="#_development_specific_configuration">31.3.1. Development-specific configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_using_oauth2_token_with_the_cli">32. Using OAuth2 token with the CLI</a>
<ul class="sectlevel2">
<li><a href="#_get_a_token_2">32.1. Get a token</a>
<ul class="sectlevel3">
<li><a href="#_curl">32.1.1. Curl</a></li>
<li><a href="#_httpie">32.1.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token">32.2. Extract token</a>
<ul class="sectlevel3">
<li><a href="#_curl_2">32.2.1. Curl</a></li>
<li><a href="#_httpie_2">32.2.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_check_a_token">32.3. Check a token</a>
<ul class="sectlevel3">
<li><a href="#_curl_3">32.3.1. Curl</a></li>
<li><a href="#_httpie_3">32.3.2. Httpie</a></li>
</ul>
</li>
<li><a href="#_extract_token_2">32.4. Extract token</a></li>
</ul>
</li>
<li><a href="#_kafka_implementation">33. Kafka Implementation</a>
<ul class="sectlevel2">
<li><a href="#_enabling_kafka">33.1. Enabling Kafka</a></li>
<li><a href="#_operatorfabric_kafka_source_code">33.2. OperatorFabric Kafka source code</a></li>
<li><a href="#_listener_deserializer">33.3. Listener / deserializer</a>
<ul class="sectlevel3">
<li><a href="#_kafka_operatorfabric_avro_schema">33.3.1. Kafka OperatorFabric AVRO schema</a></li>
</ul>
</li>
<li><a href="#_configure_kafka">33.4. Configure Kafka</a>
<ul class="sectlevel3">
<li><a href="#_setting_a_new_deserializer">33.4.1. Setting a new deserializer</a></li>
</ul>
</li>
<li><a href="#_kafka_card_producer">33.5. Kafka card producer</a></li>
<li><a href="#_response_cards">33.6. Response Cards</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_operatorfabric_community">OperatorFabric Community</a>
<ul class="sectlevel1">
<li><a href="#_license_and_developer_certificate_of_origin">34. License and Developer Certificate of Origin</a></li>
<li><a href="#_reporting_bugs_and_suggesting_enhancements">35. Reporting Bugs and Suggesting Enhancements</a></li>
<li><a href="#_contributing_code_or_documentation">36. Contributing Code or Documentation</a>
<ul class="sectlevel2">
<li><a href="#_contribution_workflow">36.1. Contribution Workflow</a>
<ul class="sectlevel3">
<li><a href="#_principles">36.1.1. Principles</a>
<ul class="sectlevel4">
<li><a href="#_develop_branch">36.1.1.1. <code>develop</code> branch</a></li>
<li><a href="#_master_branch">36.1.1.2. <code>master</code> branch</a></li>
<li><a href="#_feature_branches">36.1.1.3. Feature branches</a></li>
<li><a href="#_release_branches">36.1.1.4. Release branches</a></li>
<li><a href="#_hotfix_branches">36.1.1.5. Hotfix branches</a></li>
</ul>
</li>
<li><a href="#_examples_and_commands">36.1.2. Examples and commands</a>
<ul class="sectlevel4">
<li><a href="#_initial_state">36.1.2.1. Initial state</a></li>
<li><a href="#_starting_work_on_a_new_feature">36.1.2.2. Starting work on a new feature</a></li>
<li><a href="#_submitting_a_pull_request">36.1.2.3. Submitting a pull request</a></li>
<li><a href="#_reviewing_a_pull_request">36.1.2.4. Reviewing a Pull Request</a></li>
<li><a href="#_merging_a_pull_request">36.1.2.5. Merging a Pull Request</a></li>
<li><a href="#_creating_a_release_or_hotfix">36.1.2.6. Creating a release or hotfix</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_code_guidelines">36.2. Code Guidelines</a>
<ul class="sectlevel3">
<li><a href="#_angulartypescript_development_caution_and_guidelines">36.2.1. Angular/TypeScript development caution and guidelines</a></li>
</ul>
</li>
<li><a href="#_documentation_guidelines">36.3. Documentation Guidelines</a>
<ul class="sectlevel3">
<li><a href="#_structure">36.3.1. Structure</a></li>
<li><a href="#_conventions">36.3.2. Conventions</a></li>
</ul>
</li>
<li><a href="#_copyright_headers">36.4. Copyright Headers</a>
<ul class="sectlevel3">
<li><a href="#_header_templates">36.4.1. Header templates</a></li>
<li><a href="#_examples_4">36.4.2. Examples</a>
<ul class="sectlevel4">
<li><a href="#_creating_a_new_file">36.4.2.1. Creating a new file</a></li>
<li><a href="#_updating_a_file">36.4.2.2. Updating a file</a></li>
<li><a href="#_multiple_contributors">36.4.2.3. Multiple contributors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_project_governance">37. Project Governance</a>
<ul class="sectlevel2">
<li><a href="#_project_owner">37.1. Project Owner</a></li>
<li><a href="#_committers">37.2. Committers</a></li>
<li><a href="#_technical_steering_committee">37.3. Technical Steering Committee</a></li>
<li><a href="#_contributors">37.4. Contributors</a></li>
</ul>
</li>
<li><a href="#_communication_channels">38. Communication channels</a>
<ul class="sectlevel2">
<li><a href="#_website_opfab_org">38.1. Website: opfab.org</a></li>
<li><a href="#_lf_energy_mailing_lists">38.2. LF Energy Mailing Lists</a></li>
<li><a href="#_jira">38.3. JIRA</a></li>
</ul>
</li>
<li><a href="#code_of_conduct">39. Code of Conduct</a>
<ul class="sectlevel2">
<li><a href="#_our_pledge">39.1. Our Pledge</a></li>
<li><a href="#_our_standards">39.2. Our Standards</a></li>
<li><a href="#_enforcement_responsibilities">39.3. Enforcement Responsibilities</a></li>
<li><a href="#_scope">39.4. Scope</a></li>
<li><a href="#_enforcement">39.5. Enforcement</a></li>
<li><a href="#_attribution">39.6. Attribution</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#CICD">OperatorFabric CICD</a>
<ul class="sectlevel1">
<li><a href="#_pipeline_configuration">40. Pipeline Configuration</a>
<ul class="sectlevel2">
<li><a href="#_cicd_pipeline">40.1. CICD Pipeline</a>
<ul class="sectlevel3">
<li><a href="#_github">40.1.1. GitHub</a></li>
<li><a href="#_travis_ci">40.1.2. Travis CI</a></li>
<li><a href="#_sonarcloud">40.1.3. SonarCloud</a></li>
<li><a href="#_github_documentation">40.1.4. GitHub (documentation)</a></li>
<li><a href="#_dockerhub">40.1.5. DockerHub</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#release_process">41. Release process</a>
<ul class="sectlevel2">
<li><a href="#_version_numbers">41.1. Version numbers</a></li>
<li><a href="#_releasing_a_version">41.2. Releasing a Version</a>
<ul class="sectlevel3">
<li><a href="#_checking_the_release_notes">41.2.1. Checking the release notes</a></li>
<li><a href="#_creating_a_release_branch_and_preparing_the_release">41.2.2. Creating a release branch and preparing the release</a></li>
<li><a href="#_merging_the_release_branch_into_master">41.2.3. Merging the release branch into <code>master</code></a></li>
<li><a href="#_checking_the_docker_compose_files">41.2.4. Checking the docker-compose files</a></li>
<li><a href="#_in_jira">41.2.5. In Jira</a></li>
</ul>
</li>
<li><a href="#_advertising_the_new_release_on_the_lfe_mailing_list">41.3. Advertising the new release on the LFE mailing list</a></li>
<li><a href="#_preparing_the_next_version">41.4. Preparing the next version</a>
<ul class="sectlevel3">
<li><a href="#_in_jira_2">41.4.1. In Jira</a></li>
<li><a href="#_on_the_release_notes_repository">41.4.2. On the release-notes repository</a></li>
<li><a href="#_on_the_operatorfabric_core_repository">41.4.3. On the operatorfabric-core repository</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_resources">Resources</a>
<ul class="sectlevel1">
<li><a href="#mock_pipeline">42. Appendix A: Mock CICD Pipeline</a>
<ul class="sectlevel2">
<li><a href="#_github_2">42.1. GitHub</a></li>
<li><a href="#_travis_ci_2">42.2. Travis CI</a></li>
<li><a href="#_sonarcloud_2">42.3. SonarCloud</a></li>
<li><a href="#_github_documentation_2">42.4. GitHub (documentation)</a></li>
<li><a href="#_dockerhub_2">42.5. DockerHub</a></li>
<li><a href="#_updating_the_fork">42.6. Updating the fork</a></li>
</ul>
</li>
<li><a href="#_migration_guide_from_release_1_4_0_to_release_1_5_0">43. Migration Guide from release 1.4.0 to release 1.5.0</a>
<ul class="sectlevel2">
<li><a href="#_refactoring_of_configuration_management">43.1. Refactoring of configuration management</a>
<ul class="sectlevel3">
<li><a href="#_motivation_for_the_change">43.1.1. Motivation for the change</a></li>
<li><a href="#_changes_to_the_model">43.1.2. Changes to the model</a>
<ul class="sectlevel4">
<li><a href="#_on_the_businessconfig_model">43.1.2.1. On the Businessconfig model</a></li>
<li><a href="#_on_the_cards_model">43.1.2.2. On the Cards model</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_change_on_the_web_ui_json">43.2. Change on the web-ui.json</a></li>
<li><a href="#_changes_on_bundle_config_json">43.3. Changes on bundle config.json</a></li>
<li><a href="#_component_name">43.4. Component name</a></li>
<li><a href="#_changes_to_the_endpoints">43.5. Changes to the endpoints</a></li>
<li><a href="#_migration_steps">43.6. Migration steps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="architecture" class="sect0"><a class="anchor" href="#architecture"></a>OperatorFabric Architecture</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to describe the architecture of the solution, first by defining the business concepts it
deals with and then showing how this translates into the technical architecture.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_business_architecture"><a class="anchor" href="#_business_architecture"></a>2. Business Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is based on the concept of <strong>cards</strong>, which contain data regarding events that are relevant for the
operator.
A third party tool publishes cards and the cards are received on the screen of the operators. Depending on the type
of the cards, the operator can send back information to the third party via a "response card".</p>
</div>
<div class="sect2">
<h3 id="_business_components"><a class="anchor" href="#_business_components"></a>2.1. Business components</h3>
<div class="imageblock">
<div class="content">
<img src="../images/FunctionalDiagram.jpg" alt="functional diagram">
</div>
</div>
<div class="paragraph">
<p>To do the job, the following business components are defined :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Card Publication : this component receives the cards from third-party tools or users</p>
</li>
<li>
<p>Card Consultation : this component delivers the cards to the operators and provide access to all cards exchanged (archives)</p>
</li>
<li>
<p>Card rendering and process definition : this component stores the information for the card rendering (templates, internationalization, &#8230;&#8203;) and a light description of the process associate (states, response card, &#8230;&#8203;). This configuration data can be provided either by an administrator or by a third party tool.</p>
</li>
<li>
<p>User Management : this component is used to manage users, groups, entities and perimeters.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_business_objects"><a class="anchor" href="#_business_objects"></a>2.2. Business objects</h3>
<div class="paragraph">
<p>The business objects can be represented as follows :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/BusinessObjects.jpg" alt="business objects diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Card : the core business object which contains the data to show to the user(or operator)</p>
</li>
<li>
<p>Publisher : the emitter of the card (be it a third-party tool or an entity)</p>
</li>
<li>
<p>User : the operator receiving cards and responding via response cards</p>
</li>
<li>
<p>Group : a group (containing a list of users)</p>
</li>
<li>
<p>Entity : an entity (containing a list of users)</p>
</li>
<li>
<p>Process : the process the card is about</p>
</li>
<li>
<p>State : the step in the process</p>
</li>
<li>
<p>Perimeter : for a defined group the visibility of a card for a specific process and state</p>
</li>
<li>
<p>Card Rendering : data for card rendering</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_architecture"><a class="anchor" href="#_technical_architecture"></a>3. Technical Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The architecture is based on independent modules. All business services are accessible via REST API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/LogicalDiagram.jpg" alt="functional diagram">
</div>
</div>
<div class="sect2">
<h3 id="_business_components_2"><a class="anchor" href="#_business_components_2"></a>3.1. Business components</h3>
<div class="paragraph">
<p>We find here the business component seen before:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We have a "UI" component which stores the static pages and the UI code that is downloaded by the browser. The UI is based an <a href="https://angular.io/">Angular</a> and  <a href="https://handlebarsjs.com/">Handlebars</a> for the card templating.</p>
</li>
<li>
<p>The business component named  "Card rendering and process definition" is at the technical level known as "Businessconfig service". This service receive card rendering and process definition as a bundle. The bundle is a tar.gz file containing</p>
<div class="ulist">
<ul>
<li>
<p>json process configuration file (containing states &amp; actions)</p>
</li>
<li>
<p>templates for rendering</p>
</li>
<li>
<p>stylesheets</p>
</li>
<li>
<p>internationalization information</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Except form the UI, which is based on angular, all business components are based on <a href="https://spring.io/projects/spring-boot">SpringBoot</a> and packaged via <a href="https://www.docker.com/">Docker</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring WebFlux</a> is used to provide the card in a fluid way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_components"><a class="anchor" href="#_technical_components"></a>3.2. Technical components</h3>
<div class="sect3">
<h4 id="_gateway"><a class="anchor" href="#_gateway"></a>3.2.1. Gateway</h4>
<div class="paragraph">
<p>It provides a filtered view of the APIS and static served pages for external access through browsers or other http
compliant accesses. It provides the rooting for accessing the services from outside. It is a nginx server package with docker, this component contains the angular UI component.</p>
</div>
</div>
<div class="sect3">
<h4 id="_broker"><a class="anchor" href="#_broker"></a>3.2.2. Broker</h4>
<div class="paragraph">
<p>The broker is used to share information asynchronously across the whole services. It is implemented via <a href="https://www.rabbitmq.com/">RabbitMQ</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication"><a class="anchor" href="#_authentication"></a>3.2.3. Authentication</h4>
<div class="paragraph">
<p>The architecture provides a default authentication service via <a href="https://www.keycloak.org/">KeyCloak</a> but it can delegate it to an external provider. Authentication is done through the use of  Oauth2, three flows are supported : implicit, authorization code and password.</p>
</div>
</div>
<div class="sect3">
<h4 id="_database"><a class="anchor" href="#_database"></a>3.2.4. Database</h4>
<div class="paragraph">
<p>The cards are stored in a <a href="https://www.mongodb.com/">MongoDb</a> database. The bundles are stored in a file system.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_getting_started" class="sect0"><a class="anchor" href="#_operatorfabric_getting_started"></a>OperatorFabric Getting Started</h1>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>4. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use OperatorFabric, you need a linux OS with the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker install with 4Gb of space</p>
</li>
<li>
<p>16Gb of RAM minimal, 32 Gb recommended</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_run_server"><a class="anchor" href="#_install_and_run_server"></a>5. Install and run server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To start OperatorFabric, you first need to clone the getting started git</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/opfab/operatorfabric-getting-started.git</pre>
</div>
</div>
<div class="paragraph">
<p>Launch the <code>startserver.sh</code> in the server directory. You need to wait for all the services to start (it usually takes one minute to start), it is done when no more logs are written on the output (It could continue to log but slowly).</p>
</div>
<div class="paragraph">
<p>Test the connection to the UI: to connect to OperatorFabric, open in a browser the following page: <a href="http://localhost:2002/ui/" class="bare">localhost:2002/ui/</a> and use <code>operator1</code> as login and <code>test</code> as password.</p>
</div>
<div class="paragraph">
<p>After connection, you should see the following screen</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/empty-opfab-page.jpg" alt="empty opfab screenshot">
</div>
</div>
<div class="paragraph">
<p>To stop the server, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker-compose down &amp;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>6. Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each example, useful files and scripts are in the directory <code>client/exampleX</code>.</p>
</div>
<div class="paragraph">
<p>All examples assume you connect to the server from <code>localhost</code> (otherwise change the provided scripts)</p>
</div>
<div class="sect2">
<h3 id="_example_1_send_and_update_a_basic_card"><a class="anchor" href="#_example_1_send_and_update_a_basic_card"></a>6.1. Example 1: Send and update a basic card</h3>
<div class="paragraph">
<p>Go in directory <code>client/example1</code> and send a card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-type:application/json" --data @card.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">All pushedCards were successfully handled</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the result in the UI, you should see a card, if you click on it you&#8217;ll see the detail</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/formated-card-details.jpg" alt="detail card screenshot">
</div>
</div>
<div class="sect3">
<h4 id="_anatomy_of_the_card"><a class="anchor" href="#_anatomy_of_the_card"></a>6.1.1. Anatomy of the card :</h4>
<div class="paragraph">
<p>A card is containing information regarding the publisher, the recipients, the process, the data to show&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>More information can be found in the
<a href="#card_structure">Card Structure</a>
section of the reference documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
                        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! That's my first message</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_the_card"><a class="anchor" href="#_update_the_card"></a>6.1.2. Update the card</h4>
<div class="paragraph">
<p>We can send a new version of the card (updateCard.json):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>change the message, field data.message in the JSON File</p>
</li>
<li>
<p>the severity , field severity in the JSON File</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
                        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">:That's my second message</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can send the updated card with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="paragraph">
<p>The card should be updated on the UI.</p>
</div>
</div>
<div class="sect3">
<h4 id="_delete_the_card"><a class="anchor" href="#_delete_the_card"></a>6.1.3. Delete the card</h4>
<div class="paragraph">
<p>You can delete the card using DELETE HTTP code with reference to publisher and processInstanceId</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X DELETE http://localhost:2102/cards/defaultProcess.hello-world-1</pre>
</div>
</div>
<div class="paragraph">
<p>or use provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./deleteCard.sh</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_2_publish_a_new_bundle"><a class="anchor" href="#_example_2_publish_a_new_bundle"></a>6.2. Example 2: Publish a new bundle</h3>
<div class="paragraph">
<p>The way the card is display in the UI is defined via a Bundle containing templates and process description.</p>
</div>
<div class="paragraph">
<p>The bundle structure is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> css : stylesheets files
 i18n :   internalization files
 template :
     en : handlebar templates for detail card rendering
     ....
config.json : process description and global configuration</pre>
</div>
</div>
<div class="paragraph">
<p>The bundle is provided in the bundle directory of example2. It contains a new version of the bundle used in example1.</p>
</div>
<div class="paragraph">
<p>We just change the template and the stylesheet instead of displaying:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Message :  The message</pre>
</div>
</div>
<div class="paragraph">
<p>we display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>You received the following message

The message</pre>
</div>
</div>
<div class="paragraph">
<p>If you look at the template file (template/en/template.handlebars):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">&lt;h2&gt; You received the following message &lt;/h2&gt;

{{card.data.message}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the stylesheet css/style.css we just change the color value to red (#ff0000):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">h2</span>{
        <span class="key">color</span>:<span class="color">#ff0000</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The global configuration is defined in config.json :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [{
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ]
                        }]
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To keep the old bundle, we create a new version by setting version to 2.</p>
</div>
<div class="sect3">
<h4 id="_package_your_bundle"><a class="anchor" href="#_package_your_bundle"></a>6.2.1. Package your bundle</h4>
<div class="paragraph">
<p>Your bundle need to be package in a tar.gz file, a script is available</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./packageBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>A file name bundle.tar.gz will be created.</p>
</div>
</div>
<div class="sect3">
<h4 id="_get_a_token"><a class="anchor" href="#_get_a_token"></a>6.2.2. Get a Token</h4>
<div class="paragraph">
<p>To send the bundle you need to be authenticated. To get a token you can <strong>source</strong> the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>source ./getToken.sh</pre>
</div>
</div>
<div class="paragraph">
<p>This will run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d "username=admin&amp;password=test&amp;grant_type=password&amp;client_id=opfab-client" http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>This should return a JSON a response like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">access_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJSbXFOVTNLN0x4ck5SRmtIVTJxcTZZcTEya1RDaXNtRkw5U2NwbkNPeDBjIn0.eyJqdGkiOiIzZDhlODY3MS1jMDhjLTQ3NDktOTQyOC1hZTdhOTE5OWRmNjIiLCJleHAiOjE1NzU1ODQ0NTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiYTNhM2IxYTYtMWVlYi00NDI5LWE2OGItNWQ1YWI1YjNhMTI5IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJlbWFpbCBwcm9maWxlIiwic3ViIjoiYWRtaW4iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInByZWZlcnJlZF91c2VybmFtZSI6ImFkbWluIn0.XMLjdOJV-A-iZrtq7sobcvU9XtJVmKKv9Tnv921PjtvJ85CnHP-qXp2hYf5D8TXnn32lILVD3g8F9iXs0otMAbpA9j9Re2QPadwRnGNLIzmD5pLzjJ7c18PWZUVscbaqdP5PfVFA67-j-YmQBwxiys8psF8keJFvmg-ExOGh66lCayClceQaUUdxpeuKFDxOSkFVEJcVxdelFtrEbpoq0KNPtYk7vtoG74zO3KjNGrzLkSE_e4wR6MHVFrZVJwG9cEPd_dLGS-GmkYjB6lorXPyJJ9WYvig56CKDaFry3Vn8AjX_SFSgTB28WkWHYZknTwm9EKeRCsBQlU6MLe4Sng</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">36000</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_expires_in</span><span class="delimiter">&quot;</span></span>:<span class="integer">1800</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">refresh_token</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzZjdkZTM0OC05N2Q5LTRiOTUtYjViNi04MjExYTI3YjdlNzYifQ.eyJqdGkiOiJhZDY4ODQ4NS1hZGE0LTQwNWEtYjQ4MS1hNmNkMTM2YWY0YWYiLCJleHAiOjE1NzU1NTAyNTYsIm5iZiI6MCwiaWF0IjoxNTc1NTQ4NDU2LCJpc3MiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJhdWQiOiJodHRwOi8va2V5Y2xvYWs6ODA4MC9hdXRoL3JlYWxtcy9kZXYiLCJzdWIiOiJhM2EzYjFhNi0xZWViLTQ0MjktYTY4Yi01ZDVhYjViM2ExMjkiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoib3BmYWItY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiODc3NzZjOTktYjA1MC00NmQxLTg5YjYtNDljYzIxNTQyMDBhIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6ImVtYWlsIHByb2ZpbGUifQ.sHskPtatqlU9Z8Sfq6yvzUP_L6y-Rv26oPpykyPgzmk</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">token_type</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">bearer</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">not-before-policy</span><span class="delimiter">&quot;</span></span>:<span class="integer">0</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">session_state</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">87776c99-b050-46d1-89b6-49cc2154200a</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">scope</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">email profile</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your token is the <code>access_token</code> value in the JSON, which the script will export to a <code>$token</code> environment variable.</p>
</div>
<div class="paragraph">
<p>The sendBundle.sh script below will use of this variable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The token will be valid for 10 hours, after you will need to ask for a new one.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_send_the_bundle"><a class="anchor" href="#_send_the_bundle"></a>6.2.3. Send the bundle</h4>
<div class="paragraph">
<p>Executing the sendBundle.sh script will send the bundle.</p>
</div>
<div class="paragraph">
<p>You can now execute the script, it will send the bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendBundle.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should received the following JSON in response, describing your bundle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">statesData</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">detailsData</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span>]}],<span class="key"><span class="delimiter">&quot;</span><span class="content">responseData</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgementAllowed</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span>]}],<span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">menuLabel</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">detailsData</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span>]}],<span class="key"><span class="delimiter">&quot;</span><span class="content">responseData</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgementAllowed</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>},<span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span>]}],<span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>}},<span class="key"><span class="delimiter">&quot;</span><span class="content">menuEntries</span><span class="delimiter">&quot;</span></span>:<span class="value">null</span>}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_send_a_card"><a class="anchor" href="#_send_a_card"></a>6.2.4. Send a card</h4>
<div class="paragraph">
<p>You can send the following card to test your new bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">hello-world-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
                        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world in new version</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the new bundle, we set processVersion to "2"</p>
</div>
<div class="paragraph">
<p>To send the card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh</pre>
</div>
</div>
<div class="paragraph">
<p>You should see in the UI the detail card with the new template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_internationalization"><a class="anchor" href="#_internationalization"></a>6.2.5. Internationalization</h4>
<div class="paragraph">
<p>If you switch language to French in the UI (Settings menu on the top right of the screen), you should see the
cards in french.</p>
</div>
<div class="paragraph">
<p>OperatorFabric will use templates define in repository "template/fr" and keys define in "i18n/fr.json".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_3_process_with_state"><a class="anchor" href="#_example_3_process_with_state"></a>6.3. Example 3: Process with state</h3>
<div class="paragraph">
<p>For this example, we will set the following process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Step 1: A critical situation arises on the High Voltage grid</p>
</li>
<li>
<p>Step 2: The critical situation evolve</p>
</li>
<li>
<p>Step 3: The critical situation ends</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To model this process in OperatorFabric, we will use a "Process" with "States", we will model this in the <code>config.json</code>
of the bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [{
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin.title</span><span class="delimiter">&quot;</span></span>},
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ]
                        }]
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-update</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [{
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-update.title</span><span class="delimiter">&quot;</span></span>},
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ]
                        }]
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-end</span><span class="delimiter">&quot;</span></span> : {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [{
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : { <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-end.title</span><span class="delimiter">&quot;</span></span>},
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">endCriticalSituationTemplate</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">style</span><span class="delimiter">&quot;</span></span> ]
                        }]
                }
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see in the JSON we define a process name "criticalSituation" with 3 states: criticalSituation-begin,
criticalSituation-update and criticalSituation-end. For each state we define a title for the card, and the template
a stylesheets to use.</p>
</div>
<div class="paragraph">
<p>The title is a key which refer to an i18n found in the corresponding i18n repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ON THE GRID, SEE DETAIL FOR INSTRUCTION</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-update</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION - UPDATE</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ON THE GRID, SEE DETAIL FOR INSTRUCTION</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">criticalSituation-end</span><span class="delimiter">&quot;</span></span>:{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CRITICAL SITUATION - END</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content"> CRITICAL SITUATION ENDED</span><span class="delimiter">&quot;</span></span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The templates can be found in the template directory.</p>
</div>
<div class="paragraph">
<p>We can now send cards and simulate the process, first we send a card at the beginning of the critical situation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">alert-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">alert1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
                        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">criticalSituation-begin.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">instruction</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Critical situation on the grid : stop immediatly all maintenance on the grid</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The card refers to the process "criticalSituation" as defined in the config.json, the state attribute is put to
"criticalSituation-begin" which is the first step of the process, again as defined in the config.json. The card can be sent via provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>Two other card have be provided to continue the process</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardUpdate.json: the state is criticalSituation-update</p>
</li>
<li>
<p>cardEnd.json: the state is criticalSituation-end and severity set to "information"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can send these cards:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardUpdate.json</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardEnd.json</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_4_time_line"><a class="anchor" href="#_example_4_time_line"></a>6.4. Example 4: Time Line</h3>
<div class="paragraph">
<p>To view the card in the time line, you need to set times in the card using timeSpans attributes as in the following card:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON"> {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">scheduledMaintenance-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenance-1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">planned</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
                        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">maintenanceProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationDescription</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Maintenance operation on the International France England (IFA) Hight Voltage line </span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">operationResponsible</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">RTE</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">contactPoint</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">By Phone : +33 1 23 45 67 89 </span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">comment</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation has no impact on service</span><span class="delimiter">&quot;</span></span>
                },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">timeSpans</span><span class="delimiter">&quot;</span></span> : [
        {<span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : <span class="integer">1576080876779</span>},
        {<span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : <span class="integer">1576104912066</span>}
            ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this example, we use a new publisher called "scheduledMaintenance-publisher". You won&#8217;t need to post the
corresponding bundle to the businessconfig service as it has been loaded in advance to be available out of the box (only for the
getting started). If you want to take a look at its content you can find it under
server/businessconfig-storage/scheduledMaintenance-publisher/1.</p>
</div>
<div class="paragraph">
<p>Before sending the provided card provided, you need to set the good time values as
<a href="https://en.wikipedia.org/wiki/Epoch_(computing)">epoch</a> (ms) in the json. For each value you set, you will have a
point in the timeline. In our example, the first point represent the beginning of the maintenance operation, and the
second the end of the maintenance operation.</p>
</div>
<div class="paragraph">
<p>To get the dates in Epoch, you can use the following commands:</p>
</div>
<div class="paragraph">
<p>For the first date:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 60 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>And for the second</p>
</div>
<div class="listingblock">
<div class="content">
<pre>date -d "+ 120 minutes" +%s%N | cut -b1-13</pre>
</div>
</div>
<div class="paragraph">
<p>To send the card use the provided script in example4 directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card.json</pre>
</div>
</div>
<div class="paragraph">
<p>A second card (card2.json) is provided as example, you need again to set times values in the json file and then send it</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh card2.json</pre>
</div>
</div>
<div class="paragraph">
<p>This time the severity of the card is ALERT, you should see the point in red in the timeline</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/example4.jpg" alt="example 4 screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_5_card_routing_mechanism"><a class="anchor" href="#_example_5_card_routing_mechanism"></a>6.5. Example 5: Card routing mechanism</h3>
<div class="sect3">
<h4 id="_card_sent_to_a_group"><a class="anchor" href="#_card_sent_to_a_group"></a>6.5.1. Card sent to a group</h4>
<div class="paragraph">
<p>As we saw previously, if a card is sent to a group, then you only need to be a member of the group to receive it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_card_sent_to_an_entity"><a class="anchor" href="#_card_sent_to_an_entity"></a>6.5.2. Card sent to an entity</h4>
<div class="paragraph">
<p>If a card is sent to an entity, then you must be a member of this entity and have the process / state of the card within the user&#8217;s perimeter. As the perimeters are attached to groups, the user must therefore be a member of a group attached to this perimeter.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s send this card :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1</span><span class="delimiter">&quot;</span></span>],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-type:application/json" --data @cardSentToEntity.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntity.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">All pushedCards were successfully handled</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the result in the UI, you should not see the card.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s create this perimeter :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">getting-startedPerimeter</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">stateRights</span><span class="delimiter">&quot;</span></span> : [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Receive</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/perimeters -H "Content-type:application/json" -H "Authorization:Bearer $token" --data @perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./createPerimeter.sh perimeter.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">getting-startedPerimeter</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">stateRights</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">messageState1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Receive</span><span class="delimiter">&quot;</span></span>},{<span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">messageState2</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">right</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ReceiveAndWrite</span><span class="delimiter">&quot;</span></span>}]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s attach this perimeter to the Dispatcher group.
You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/perimeters/getting-startedPerimeter/groups -H "Content-type:application/json" -H "Authorization:Bearer $token" --data "[\"Dispatcher\"]"</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./putPerimeterForGroup.sh</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 200 Http status.</p>
</div>
<div class="paragraph">
<p>Now, if you refresh the UI or send again the card, you should see the card.</p>
</div>
</div>
<div class="sect3">
<h4 id="_card_sent_to_a_group_and_an_entity"><a class="anchor" href="#_card_sent_to_a_group_and_an_entity"></a>6.5.3. Card sent to a group and an entity</h4>
<div class="paragraph">
<p>If a card is sent to a group and an entity, then there are 2 possibilities to receive this card :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First possibility :
the user is both a member of this entity and a member of this group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s send this card (for ENTITY1 and Dispatcher group) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5_1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1 and group Dispatcher - process/state not in operator1 perimeter </span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-type:application/json" --data @cardSentToEntityAndGroup_1.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntityAndGroup_1.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">All pushedCards were successfully handled</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the result in the UI, you should see the card.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Second possibility :
the user is a member of this entity and have the process/state of the card within its perimeter. As the perimeters are attached to groups, the user must therefore be a member of a group attached to this perimeter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s send this card (for ENTITY1 and Planner group) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">message-publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span> : [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1</span><span class="delimiter">&quot;</span></span>],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>  :<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">cardExample5_2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">messageState</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">recipient</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">GROUP</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span> : <span class="integer">1553186770681</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.summary</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultProcess.title</span><span class="delimiter">&quot;</span></span>},
        <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span> : {<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World !!! Here is a message for ENTITY1 and group Planner - process/state in operator1 perimeter </span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use this command line :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -X POST http://localhost:2102/cards -H "Content-type:application/json" --data @cardSentToEntityAndGroup_2.json</pre>
</div>
</div>
<div class="paragraph">
<p>or use the provided script :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./sendCard.sh cardSentToEntityAndGroup_2.json</pre>
</div>
</div>
<div class="paragraph">
<p>The result should be a 201 Http status, and a json object such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{<span class="key"><span class="delimiter">&quot;</span><span class="content">count</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">All pushedCards were successfully handled</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the result in the UI, you should see the card.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting_bundle"><a class="anchor" href="#troubleshooting_bundle"></a>7. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_my_bundle_is_not_loaded"><a class="anchor" href="#_my_bundle_is_not_loaded"></a>7.1. My bundle is not loaded</h3>
<div class="paragraph">
<p>The server send a <code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Error detected parsing the header"]}</code>, despite correct http
headers.</p>
</div>
<div class="paragraph">
<p>The uploaded bundle is corrupted. Test your bundle in a terminal (Linux
solution).</p>
</div>
<div class="paragraph">
<p>Example for a bundle archive named <code>MyBundleToTest.tar.gz</code> giving the
mentioned error when uploaded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tar -tzf MyBundleToTest.tar.gz &gt;/dev/null
tar: This does not look like a tar archive
tar: Skipping to next header
tar: Exiting with failure status due to previous errors</pre>
</div>
</div>
<div class="sect3">
<h4 id="_solution"><a class="anchor" href="#_solution"></a>7.1.1. Solution</h4>
<div class="paragraph">
<p>Extract content if possible and compress it to a correct compressed archive
format.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i_cant_upload_my_bundle"><a class="anchor" href="#_i_cant_upload_my_bundle"></a>7.2. I can&#8217;t upload my bundle</h3>
<div class="paragraph">
<p>The server responds with a message like the following:
<code>{"status":"BAD_REQUEST","message":"unable to open submitted
file","errors":["Input is not in the .gz format"]}</code></p>
</div>
<div class="paragraph">
<p>The bundle has been compressed using an unmanaged format.</p>
</div>
<div class="sect3">
<h4 id="_format_verification"><a class="anchor" href="#_format_verification"></a>7.2.1. Format verification</h4>
<div class="sect4">
<h5 id="_linux_solution"><a class="anchor" href="#_linux_solution"></a>7.2.1.1. Linux solution</h5>
<div class="paragraph">
<p>Command line example to verify the format of a bundle archive named
<code>MyBundleToTest.tar.gz</code>(which gives the mentioned error when uploaded):</p>
</div>
<div class="literalblock">
<div class="content">
<pre> tar -tzf MyBundleToTest.tar.gz &gt;/dev/null</pre>
</div>
</div>
<div class="paragraph">
<p>which should return in such case the following messages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>gzip: stdin: not in gzip format
tar: Child returned status 1
tar: Error is not recoverable: exiting now</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2"><a class="anchor" href="#_solution_2"></a>7.2.2. Solution</h4>
<div class="paragraph">
<p>Use <code>tar.gz</code> format for the archive compression. Shell command is <code>tar -czvf
MyBundleToTest.tar.gz config.json template/ css/</code> for a bundle containing
templates and css files.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_bundle_is_rejected_due_to_internal_structure"><a class="anchor" href="#_my_bundle_is_rejected_due_to_internal_structure"></a>7.3. My bundle is rejected due to internal structure</h3>
<div class="paragraph">
<p>The server sends <code>{"status":"BAD_REQUEST","message":"Incorrect inner file
structure","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/d91ba68c-de6b-4635-a8e8-b58
fff77dfd2/config.json (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="paragraph">
<p>Where <code>$OPERATOR_FABRIC_INSTANCE_PATH</code> is the folder where businessconfig files are
stored server side.</p>
</div>
<div class="sect3">
<h4 id="_reason"><a class="anchor" href="#_reason"></a>7.3.1. Reason</h4>
<div class="paragraph">
<p>The internal file structure of your bundle is incorrect. <code>config.json</code> file and
folders need to be at the first level.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3"><a class="anchor" href="#_solution_3"></a>7.3.2. Solution</h4>
<div class="paragraph">
<p>Add or organize the files and folders of the bundle to fit the Businessconfig bundle
requirements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_no_template_display"><a class="anchor" href="#_no_template_display"></a>7.4. No template display</h3>
<div class="paragraph">
<p>The server send 404for requested template with a response like
<code>{"status":"NOT_FOUND","message":"The specified resource does not
exist","errors":["$OPERATOR_FABRIC_INSTANCE_PATH/businessconfig-storage/BUNDLE_TEST/1/te
mplate/fr/template1.handlebars (Aucun fichier ou dossier de ce type)"]}</code></p>
</div>
<div class="sect3">
<h4 id="_verification"><a class="anchor" href="#_verification"></a>7.4.1. Verification</h4>
<div class="paragraph">
<p>The previous server response is return for a request like:
<code>http://localhost:2002/businessconfig/BUNDLE_TEST/templates/template1?locale=fr&amp;version
=1</code></p>
</div>
<div class="paragraph">
<p>The bundle is lacking localized folder and doesn&#8217;t contain the requested
localization.</p>
</div>
<div class="paragraph">
<p>If you have access to the <code>businessconfig</code> micro service source code you
should list the content of
<code>$THIRDS_PROJECT/build/docker-volume/businessconfig-storage</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4"><a class="anchor" href="#_solution_4"></a>7.4.2. Solution</h4>
<div class="paragraph">
<p>Either request another l10n or add the requested one to the bundle and
re-upload it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_template_is_not_used"><a class="anchor" href="#_my_template_is_not_used"></a>7.5. My template is not used.</h3>
<div class="paragraph">
<p>It need to be declared in the config.json of the bundle.</p>
</div>
<div class="sect3">
<h4 id="_solution_5"><a class="anchor" href="#_solution_5"></a>7.5.1. Solution</h4>
<div class="paragraph">
<p>Add or verify the name of the templates declared in the <code>config.json</code> file of
the bundle.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_my_value_is_not_displayed_in_the_detail_template"><a class="anchor" href="#_my_value_is_not_displayed_in_the_detail_template"></a>7.6. My value is not displayed in the detail template</h3>
<div class="paragraph">
<p>There are several possibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the path of the data used in the template is incorrect;</p>
</li>
<li>
<p>number of pair of <code>{</code> and <code>}</code> has to follow those rules:</p>
<div class="ulist">
<ul>
<li>
<p>with no helper the good number is only 2 pairs;</p>
</li>
<li>
<p>with OperatorFabric helpers it&#8217;s 3 pairs of them.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_reference_documentation" class="sect0"><a class="anchor" href="#_operatorfabric_reference_documentation"></a>OperatorFabric Reference Documentation</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The aim of this document is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explain what OperatorFabric is about and define the concepts it relies on</p>
</li>
<li>
<p>Give a basic tour of its features from a user perspective</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>8. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform their duties, an operator has to interact with multiple applications
(perform actions, watch for alerts, etc.), which can prove difficult if
there are too many of them.</p>
</div>
<div class="paragraph">
<p>The idea is to aggregate all the notifications from all these applications
into a single screen, and to allow the operator to act on them if needed.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/feed_screenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>These notifications are materialized by <strong>cards</strong> sorted in a <strong>feed</strong> according
to their period of relevance and their severity.
When a card is selected in the feed, the right-hand pane displays the <strong>details</strong>
of the card.</p>
</div>
<div class="paragraph">
<p>In addition, the cards will also translate as events displayed on a <strong>timeline</strong>
 at the top of the screen.</p>
</div>
<div class="paragraph">
<p>Part of the value of OperatorFabric is that it makes the integration very
simple on the part of the third-party applications.
To start publishing cards to users in an OperatorFabric instance, all they
have to do is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register as a publisher through the "Businessconfig" service and provide a "bundle"
containing handlebars templates defining how cards should be rendered,
i18n info etc.</p>
</li>
<li>
<p>Publish cards as json containing card data through the card publication API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OperatorFabric will then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dispatch the cards to the appropriate users (by computing the actual users
who should receive the card from the recipients rules defined in the card)</p>
</li>
<li>
<p>Take care of the rendering of the cards</p>
</li>
<li>
<p>Display relevant information from the cards in the timeline</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A card is not only information, it could be question(s) the operator has to answer.
When the operator is responding, a  card is emitted to the sender of the initial card
and the response could be seen by other operators.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot.png" alt="Feed screen layout">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_cards"><a class="anchor" href="#_sending_cards"></a>9. Sending cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cards Publication Service exposes a REST API through which third-party applications, or "publishers" can post cards
to OperatorFabric. It then handles those cards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-stamping them with a "publishDate"</p>
</li>
<li>
<p>Sending them to the message broker (RabbitMQ) to be delivered in real time to the appropriate operators</p>
</li>
<li>
<p>Persisting them to the database (MongoDB) for later consultation</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="card_structure"><a class="anchor" href="#card_structure"></a>9.1. Card Structure</h3>
<div class="paragraph">
<p>Cards are represented as <code>Json</code>objects. The technical design of cards is described in
<a href="../api/cards/">the cards api documentation</a>
. A card correspond to the state of a Process in OperatorFabric.</p>
</div>
<div class="sect3">
<h4 id="_technical_information_of_the_card"><a class="anchor" href="#_technical_information_of_the_card"></a>9.1.1. Technical Information of the card</h4>
<div class="paragraph">
<p>Those attributes are used by OperatorFabric to manage how cards are stored, to whom and when they&#8217;re sent.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_information"><a class="anchor" href="#_mandatory_information"></a>9.1.1.1. Mandatory information</h5>
<div class="paragraph">
<p>Below, the <code>json</code> technical key is in the '()' following the title.</p>
</div>
<div class="sect5">
<h6 id="_publisher_publisher"><a class="anchor" href="#_publisher_publisher"></a>Publisher (<code>publisher</code>)</h6>
<div class="paragraph">
<p>The publisher field bears the identifier of the emitter of the card, be it an entity or an external service.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process"><a class="anchor" href="#card_process"></a>Process (<code>process</code>)</h6>
<div class="paragraph">
<p>This field indicates which process the card is attached to. This information is used to resolve the presentation
resources (bundle) used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process_version"><a class="anchor" href="#card_process_version"></a>Process Version (<code>processVersion</code>)</h6>
<div class="paragraph">
<p>The rendering of cards of a given process can evolve over time. To allow for this while making sure previous cards
remain correctly handled, OperatorFabric can manage several versions of the same process.
The <code>processVersion</code> field indicate which version of the process should be used to retrieve the presentation resources
(i18n, templates, etc.) to render this card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_process_instance_identifier_processinstanceid"><a class="anchor" href="#_process_instance_identifier_processinstanceid"></a>Process Instance Identifier (<code>processInstanceId</code>)</h6>
<div class="paragraph">
<p>A card is associated to a given process, which defines how it is rendered, but it is also more precisely associated to
a <strong>specific instance</strong> of this process. The <code>processInstanceId</code> field contains the unique identifier of the process instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_state_in_the_process_state"><a class="anchor" href="#_state_in_the_process_state"></a>9.1.1.2. State in the process (<code>state</code>)</h5>
<div class="paragraph">
<p>The card represent a specific state in the process. In addition to the process, this information is used to resolve the presentation
resources used to render the card and card details.</p>
</div>
<div class="sect5">
<h6 id="start_date"><a class="anchor" href="#start_date"></a>Start Date (<code>startDate</code>)</h6>
<div class="paragraph">
<p>Start date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_severity_severity"><a class="anchor" href="#_severity_severity"></a>Severity (<code>severity</code>)</h6>
<div class="paragraph">
<p>The severity is a core principe of the OperatorFabric Card system. There are 4 severities available.
A color is associated in the GUI to each severity. Here the details about severity and their meaning for OperatorFabric:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ALARM: represents a critical state of the associated process, need an action from the operator. In the UI, the card is red;</p>
</li>
<li>
<p>ACTION: the associated process need an action form operators in order to evolve correctly. In the UI, the card is orange;</p>
</li>
<li>
<p>COMPLIANT: the process related to the card is in a compliant status. In the UI, the card is green.;</p>
</li>
<li>
<p>INFORMATION: give information to the operator. In the UI, the card is blue.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="card_title"><a class="anchor" href="#card_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>This attribute is display as header of a card in the feed of the GUI. It&#8217;s the main User destined Information of a card. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_summary"><a class="anchor" href="#card_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>This attribute is display as a description of a card in the feed of the GUI, when the card is selected by the operator. It&#8217;s completing the information of the card title. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_recipient_recipient"><a class="anchor" href="#_recipient_recipient"></a>9.1.1.3. Recipient (<code>recipient</code>)</h5>
<div class="paragraph">
<p>Declares to whom the card is send. For more details about way recipient works see
<a href="#display_rules">Display rules</a>
. Without recipient declaration a card is useless in <code>OperatorFabric</code> system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_optional_information"><a class="anchor" href="#_optional_information"></a>9.1.1.4. Optional information</h5>
<div class="sect5">
<h6 id="end_date"><a class="anchor" href="#end_date"></a>End Date (<code>endDate</code>)</h6>
<div class="paragraph">
<p>End date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_tags_tag"><a class="anchor" href="#_tags_tag"></a>Tags (<code>tag</code>)</h6>
<div class="paragraph">
<p>Tags are intended as an additional way to filter cards in the feed of the GUI.</p>
</div>
</div>
<div class="sect5">
<h6 id="_entityrecipients_entityrecipients"><a class="anchor" href="#_entityrecipients_entityrecipients"></a>EntityRecipients (<code>entityRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to entity : all users members of the listed entities who have the right for the process/state of the card will receive it. If this field is used in conjunction with groups recipients, to receive the cards :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND one of the groups to receive the cards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND have the right for the process/state of the card.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_last_time_to_decide_lttd"><a class="anchor" href="#_last_time_to_decide_lttd"></a>Last Time to Decide (<code>lttd</code>)</h6>
<div class="paragraph">
<p>Fixes the moment until when a <code>response</code> is possible for the card. After this moment, the response button won&#8217;t be useable. When lttd time is approaching, a clock is visible on the card in the feed with the residual time.  The lttd time can be set for cards that don&#8217;t expect any response</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_business_period"><a class="anchor" href="#_business_period"></a>9.1.1.5. Business period</h5>
<div class="paragraph">
<p>We define the business period as starting form startDate to endDate.  The card will be visible on the UI if the business period overlap the user chosen period (i.e the period selected on  the timeline). If endDate is not set, the  card will be visible as soon as the startDate is before the end of the chosen period.</p>
</div>
</div>
<div class="sect4">
<h5 id="_store_information"><a class="anchor" href="#_store_information"></a>9.1.1.6. Store information</h5>
<div class="sect5">
<h6 id="_uid_uid"><a class="anchor" href="#_uid_uid"></a>uid (<code>uid</code>)</h6>
<div class="paragraph">
<p>Unique identifier of the card in the OperatorFabric system. This attribute can be sent with card, but by default it&#8217;s managed by OperatorFabric.</p>
</div>
</div>
<div class="sect5">
<h6 id="_id_id"><a class="anchor" href="#_id_id"></a>id (<code>id</code>)</h6>
<div class="paragraph">
<p>State id of the associated process, determined by <code>OperatorFabric</code> can be set arbitrarily by the <code>publisher</code>. The id is determined by 'OperatorFabric' as follow : process.processIntanceId</p>
</div>
</div>
<div class="sect5">
<h6 id="_publish_date_publishdate"><a class="anchor" href="#_publish_date_publishdate"></a>Publish Date (<code>publishDate</code>)</h6>
<div class="paragraph">
<p>Indicates when the card has been registered in <code>OperatorFabric</code> system. This is a technical information exclusively managed by <code>OperatorFabric</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_destined_information_of_the_card"><a class="anchor" href="#_user_destined_information_of_the_card"></a>9.1.2. User destined Information of the card</h4>
<div class="paragraph">
<p>There are two kind of User destined information in a card. Some are restricted to the card format, others are defined by the publisher as long as there are encoded in <code>json</code>format.</p>
</div>
<div class="sect4">
<h5 id="_in_card_format"><a class="anchor" href="#_in_card_format"></a>9.1.2.1. in Card Format</h5>
<div class="sect5">
<h6 id="_title_title"><a class="anchor" href="#_title_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>See
<a href="#card_title">Title</a>
.</p>
</div>
</div>
<div class="sect5">
<h6 id="_summary_summary"><a class="anchor" href="#_summary_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>See
<a href="#card_summary">Summary</a>
.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_part"><a class="anchor" href="#_custom_part"></a>9.1.2.2. Custom part</h5>
<div class="sect5">
<h6 id="_data_data"><a class="anchor" href="#_data_data"></a>Data (<code>data</code>)</h6>
<div class="paragraph">
<p>Determines where custom information is store. The content in this attribute, is purely <code>publisher</code> choice.
This content, as long as it&#8217;s in <code>json</code> format can be used to display details. For the way the details are
displayed, see below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must not use dot in json field names. In this case, the card will be refused with following message :
"Error, unable to handle pushed Cards: Map key xxx.xxx contains dots but no replacement was configured!""
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_presentation_information_of_the_card"><a class="anchor" href="#_presentation_information_of_the_card"></a>9.1.3. Presentation Information of the card</h4>
<div class="sect4">
<h5 id="_details_details"><a class="anchor" href="#_details_details"></a>9.1.3.1. details (<code>details</code>)</h5>
<div class="paragraph">
<p>This attribute is a string of objects containing a <code>title</code> attribute which is <code>i18n</code> key and a <code>template</code> attribute
which refers to a template name contained in the publisher bundle. The bundle in which those resources will be looked
for is the one corresponding to the
<a href="#card_process_version">version</a>
declared in the card for the current
<a href="#card_process">process</a>
.
If no resource is found, either because there is no bundle for the given version or
there is no resource for the given key, then the corresponding key is displayed in the details section of the GUI.</p>
</div>
<div class="paragraph">
<p><strong>example:</strong></p>
</div>
<div class="paragraph">
<p>The <code>TEST</code> process only has a <code>0.1</code> version uploaded in the current <code>OperatorFabric</code> system. The <code>details</code> value is
<code>[{"title":{"key":"first.tab.title"},"template":"template0"}]</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>processVersion</code> of the card is <code>2</code> then only the <code>title</code> key declared in the <code>details</code> array will be displayed
without any translation, i.e. the tab will contains <code>TEST.2.first.tab.title</code> and will be empty. If the <code>l10n</code> for
the title is not available, then the tab title will be still <code>TEST.2.first.tab.title</code> but the template will be computed
and the details section will display the template content.</p>
</div>
</div>
<div class="sect4">
<h5 id="_timespans_timespans"><a class="anchor" href="#_timespans_timespans"></a>9.1.3.2. TimeSpans (<code>timeSpans</code>)</h5>
<div class="paragraph">
<p>When the simple startDate and endDate are not enough to characterize your
process business times, you can add a list of TimeSpan to your card. TimeSpans
are rendered in the timeline component as cluster bubbles. This has no effect on the feed
content.</p>
</div>
<div class="paragraph">
<p><strong>example :</strong></p>
</div>
<div class="paragraph">
<p>to display the card two times in the timeline you can add two TimeSpan to your
card:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"publisherVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000},
        {"start" : 1546297500000}
    ]

}</pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, the card will be displayed twice in the time line. The card
start date will be ignored.</p>
</div>
<div class="paragraph">
<p>For timeSpans, you can specify an end date but it is not implemented in OperatorFabric (it was intended for future uses but it will be deprecated).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cards_examples"><a class="anchor" href="#_cards_examples"></a>9.2. Cards Examples</h3>
<div class="paragraph">
<p>Before detailing the content of cards, let&#8217;s show you what cards look like through few examples of json.</p>
</div>
<div class="sect3">
<h4 id="minimal_card"><a class="anchor" href="#minimal_card"></a>9.2.1. Minimal Card</h4>
<div class="paragraph">
<p>The OperatorFabric Card specification defines mandatory attributes, but some optional attributes are needed for cards to be useful in OperatorFabric. Let&#8217;s clarify those point through few examples of minimal cards and what happens when they&#8217;re used as if.</p>
</div>
<div class="sect4">
<h5 id="_send_to_one_user"><a class="anchor" href="#_send_to_one_user"></a>9.2.1.1. Send to One User</h5>
<div class="paragraph">
<p>The following card contains only the mandatory attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1"]

}</pre>
</div>
</div>
<div class="paragraph">
<p>This an information about the process instance <code>process-000</code> of process <code>process</code>, sent by <code>Dispatcher</code>. The title and the summary refer to <code>i18n</code> keys
defined in the associated <code>i18n</code> files of the process. This card is displayable since the first january 2019 and
should only be received by the user using the <code>operator1</code> login.</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_several_users"><a class="anchor" href="#_send_to_several_users"></a>9.2.1.2. Send to several users</h5>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group"><a class="anchor" href="#_simple_case_sending_to_a_group"></a>Simple case (sending to a group)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is a group, the <code>Dispatcher</code>. So all users who are members of this group will receive the card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group_and_an_entity"><a class="anchor" href="#_simple_case_sending_to_a_group_and_an_entity"></a>Simple case (sending to a group and an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"],
	"entityRecipients" : ["ENTITY1"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipients are a group and an entity, the <code>Dispatcher</code> group and <code>ENTITY1</code> entity. So all users who are both members
of this group and this entity will receive the card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_an_entity"><a class="anchor" href="#_simple_case_sending_to_an_entity"></a>Simple case (sending to an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"entityRecipients" : ["ENTITY1"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is an entity and there is no more groups. So all users who has the right perimeter and who are members of this entity will receive the card. More information on perimeter can be found in
&lt;&lt;'users_management,user documentation'&gt;&gt;</p>
</div>
</div>
<div class="sect5">
<h6 id="_complex_case"><a class="anchor" href="#_complex_case"></a>Complex case</h6>
<div class="paragraph">
<p>If this card need to be viewed by a user who is not in the <code>Dispatcher</code> group, it&#8217;s possible to tune more precisely the
definition of the recipient. If the <code>operator2</code> needs to see also this card, the recipient definition could be(the following code details only the recipient part):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher"],
"userRecipients": ["operator2"]</pre>
</div>
</div>
<div class="paragraph">
<p>So here, all the users of the <code>Dispatcher</code> group will receive the <code>INFORMATION</code> as should the <code>tos2-operator</code> user.</p>
</div>
<div class="paragraph">
<p>Another example, if a card is destined to the operators of <code>Dispatcher</code> and <code>Planner</code> and needs to be also seen by the <code>admin</code>, the recipient configuration looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher", "Planner"],
"userRecipients": ["admin"]</pre>
</div>
</div>
<div class="paragraph">
<p>There is and alternative way to declare recipients of card, this syntax is more complex and will be deprecated:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"recipient":{
	"type":"UNION",
	"recipients":[
		{ "type": "GROUP", "identity":"Dispatcher"},
		{ "type": "USER", "identity":"operator2"}
		]
	}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_card"><a class="anchor" href="#_regular_card"></a>9.2.2. Regular Card</h4>
<div class="paragraph">
<p>The previous cards were nearly empty regarding information carrying. In fact, cards are intended to contain more information than a title and a summary. The optional attribute <code>data</code> is here for that. This attribute is destined to contain any <code>json</code> object. The creator of the card is free to put any information needed as long as it&#8217;s in a <code>json</code> format.</p>
</div>
<div class="sect4">
<h5 id="_full_of_hidden_data"><a class="anchor" href="#_full_of_hidden_data"></a>9.2.2.1. Full of Hidden data</h5>
<div class="paragraph">
<p>For this example we will use our previous example for the <code>Dispatcher</code> group with a <code>data</code> attribute containing the definition of a <code>json</code> object containing two attributes: <code>stringExample</code> and <code>numberExample</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1"],
	"data":{
		"stringExample":"This is a not so random string of characters.",
		"numberExample":123
		}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This card contains some data but when selected in the feed nothing more than the previous example of card happen because
there is no rendering configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fully_useful"><a class="anchor" href="#_fully_useful"></a>9.2.2.2. Fully useful</h5>
<div class="paragraph">
<p>When a card is selected in the feed (of the GUI), the data is displayed in the detail panel.
The way details are formatted depends on the template contained in the bundle associated with the process as
<a href="#template_description">described here</a>
. To have an effective example without to many actions to performed, the following example will use an already existing
configuration.The one presents in the development version of OperatorFabric, for test purpose(<code>TEST</code> bundle).</p>
</div>
<div class="paragraph">
<p>At the card level, the attributes in the card telling OperatorFabric which template to use is the <code>details</code> attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"1",
	"process":"TEST",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"process.title"},
	"summary":{"key":"process.summary"},
	"userRecipients": ["operator1"]
	"data":{"rootProp":"Data displayed in the detail panel"},
	"details":[{"title":{"key":"process.detail.tab.first"}, "templateName":"template1"}]

}</pre>
</div>
</div>
<div class="paragraph">
<p>So here a single custom data is defined and it&#8217;s <code>rootProp</code>. This attribute is used by the template called by the
<code>details</code> attribute. This attribute contains an array of <code>json</code> object containing an <code>i18n</code> key and a <code>template</code>
reference. Each of those object is a tab in the detail panel of the GUI.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_rendering"><a class="anchor" href="#_card_rendering"></a>10. Card rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated above, third applications interact with OperatorFabric by sending cards.</p>
</div>
<div class="paragraph">
<p>The Businessconfig service allows them to tell OperatorFabric for each process how these cards should be rendered including translation if
several languages are supported.  Configuration is done via files zipped in a "bundle", these files are send to OperatorFabric via a REST end point.</p>
</div>
<div class="paragraph">
<p>In addition, it lets third-party applications define additional menu entries for the navbar (for example linking back
to the third-party application) that can be integrated either as iframe or external links.</p>
</div>
<div class="sect2">
<h3 id="_process_declaration_and_configuration"><a class="anchor" href="#_process_declaration_and_configuration"></a>10.1. Process: Declaration and Configuration</h3>
<div class="paragraph">
<p>To declare and configure a <code>Process</code>, OperatorFabric uses <code>bundles</code>.
This section describes their content and how to use them.
An <code>OperatorFabric Process</code> is a way to define a business configuration.
Once this bundle fully created, it must be uploaded to the server through the <code>Businessconfig service</code>.</p>
</div>
<div class="paragraph">
<p>Some examples show how to configure a <code>process</code> using a <code>bundle</code> before diving in more technical details of the configuration.
The following instructions describe tests to perform on OperatorFabric to understand how customizations are possible.
The cards used in the examples of this section are automatically sent by a script described
<a href="#card_sending_script">here</a></p>
</div>
<div class="sect3">
<h4 id="_bundle_as_process_declaration"><a class="anchor" href="#_bundle_as_process_declaration"></a>10.1.1. Bundle as Process declaration</h4>
<div class="paragraph">
<p>A bundle contains all the configuration regarding a given business process, describing for example the various steps of the process but also how the associated cards and card details should be displayed.</p>
</div>
<div class="paragraph">
<p>Bundle are technically <code>tar.gz</code> archives containing at least a descriptor file named <code>config.json</code>.
To display the card date, some <code>css files</code>, <code>i18n files</code> and <code>handlebars templates</code> must be added.</p>
</div>
<div class="paragraph">
<p>For didactic purposes, in this section, the businessconfig bundle name is <code>BUNDLE_TEST</code> (to match the parameters used by the script).
The l10n (localization) configurations are english, referred as <code>en</code> and french, referred as <code>fr</code>.</p>
</div>
<div class="paragraph">
<p>As detailed in the <code>Businessconfig core service README</code> the bundle contains at least a metadata file called <code>config.json</code>, a <code>css</code> folder, an <code>i18n</code> folder and a <code>template</code> folder.</p>
</div>
<div class="paragraph">
<p>Except for the <code>config.json file</code>, all elements are optional.</p>
</div>
<div class="paragraph">
<p>The file organization within a bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bundle
 config.json
 css
    bundleTest.css
 i18n
    en.json
    fr.json
 template
     en
        template1.handlebars
        template2.handlebars
     fr
         template1.handlebars
         template2.handlebars</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_config_json_file"><a class="anchor" href="#_the_config_json_file"></a>10.1.2. The config.json file</h4>
<div class="paragraph">
<p>It&#8217;s a description file in <code>json</code> format.
It lists the content of the bundle.</p>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uiVisibility</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">monitoring</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logging</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">state.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>
        }
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgementAllowed</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
    }
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: id of the process;</p>
</li>
<li>
<p><code>name</code>: process name (i18n key);</p>
</li>
<li>
<p><code>version</code>: enables the correct display of the card data, even for the old ones.
The server store the previous versions in its file system.
This field value should match a businessconfig configuration for a correct rendering;</p>
</li>
<li>
<p><code>states</code>: lists the available states which each declares associated actions, associated templates and if cards could be acknowledged by users;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mandatory field are <code>id</code>,'name' and <code>version</code>.</p>
</div>
<div class="paragraph">
<p>See the
<a href="../api/businessconfig/index.html">Businessconfig API documentation</a>
for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_i18n"><a class="anchor" href="#_i18n"></a>10.1.3. i18n</h4>
<div class="paragraph">
<p>There are two ways of internationalization (i18n) for businessconfig service.
First one by using l10n files located in the <code>i18n</code> folder, the second one throughout l10n name folder nested in the <code>template</code> folder.</p>
</div>
<div class="paragraph">
<p>The <code>i18n</code> folder contains one json file per l10n.</p>
</div>
<div class="paragraph">
<p>The integration of the businessconfig service into OperatorFabric need this localisation, i.e. the label displayed for the process, the state, the label displayed for the details of the card&#8230;&#8203;</p>
</div>
<div class="sect4">
<h5 id="_template_folder"><a class="anchor" href="#_template_folder"></a>10.1.3.1. Template folder</h5>
<div class="paragraph">
<p>The <code>template</code> folder must contain l10n folder for the i18n of the card details.
This is why in our example, as the bundle contains an <code>en</code> and a <code>fr</code> l10n, the <code>template</code> folder contains an <code>en</code> and a <code>fr</code> folder.</p>
</div>
<div class="sect5">
<h6 id="_i18n_file"><a class="anchor" href="#_i18n_file"></a>i18n file</h6>
<div class="paragraph">
<p>If there is no i18n file or key is missing, OperatorFabric displays i18n key, such as <code>BUNDLE_TEST.1.missing-i18n-key</code>.
In the case where the bundle declares no i18n key corresponds to <code>missing-i18n-key</code>.</p>
</div>
<div class="paragraph">
<p>The choice of i18n keys is up to the maintainer of the Businessconfig process.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>For this example, the name of the process is  <code>Bundle Test</code> and its technical name is <code>BUNDLE_TEST</code>.
The bundle provides an english and a french l10n.</p>
</div>
<div class="paragraph">
<p>Title and summary have to be localized.</p>
</div>
<div class="paragraph">
<p>Here is the content of <code>en.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the content of <code>fr.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Processus {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Cela rsume la carte: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Titre de la carte</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Processus de test</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">State de test</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menu</span><span class="delimiter">&quot;</span></span>:{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Menu du Processus de Test</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">first</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Documentation Operator Fabric</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">second</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">LF Energy</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Onglet TEST</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the i18n, after the upload of the bundle, use a <code>GET</code> request against the <code>businessconfig</code> service.
The simpler is to ask for the i18n file, as described
<a href="../api/businessconfig/index.html#/businessconfig/getI18n">here</a>
.</p>
</div>
<div class="paragraph">
<p>Set the <code>locale</code> language, the <code>version</code> of the bundle and the <code>technical name</code> of the businessconfig party to get json in the response.</p>
</div>
<div class="paragraph">
<p>For example, to check if the french l10n data of the version 1 of the <code>BUNDLE_TEST</code> businessconfig party use the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl "http://localhost:2100/businessconfig/processes/BUNDLE_TEST/i18n?locale=fr&amp;version=1" \
-H  "Authorization: Bearer ${token}"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid token for operatorfabric use.</p>
</div>
<div class="paragraph">
<p>The <code>businessconfig</code> service should answer with a 200 status associated with the following json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processes_and_states"><a class="anchor" href="#_processes_and_states"></a>10.1.3.2. Processes and States</h5>
<div class="paragraph">
<p>Each Process declares associated states.
Each state declares specific templates for card details and specific actions.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to display elements of businessconfig card data in a custom format.</p>
</div>
<div class="paragraph">
<p>Regarding the card detail customization, all the examples in this section refer to the cards generated by the script existing in the <code>Cards-Publication</code> project.
For the examples given here, run this script  with arguments detailed in the following command line:</p>
</div>
<div id="card_sending_script" class="listingblock">
<div class="content">
<pre>$OPERATOR_FABRIC_HOME/services/core/cards-publication/src/main/bin/push_card_loop.sh BUNDLE_TEST tests</pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$OPERATOR_FABRIC_HOME</code> is the root folder of OperatorFabric used to perform tests;</p>
</li>
<li>
<p><code>BUNDLE_TEST</code> is the name of the Businessconfig party;</p>
</li>
<li>
<p><code>tests</code> is the name of the process referred by published cards.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_configuration"><a class="anchor" href="#_configuration"></a>configuration</h6>
<div class="paragraph">
<p>The process entry in the configuration file is a dictionary of processes, each key maps to a process definition.
A process definition is itself a dictionary of states, each key maps to a state definition.</p>
</div>
</div>
<div class="sect5">
<h6 id="_templates"><a class="anchor" href="#_templates"></a>Templates</h6>
<div class="paragraph">
<p>For demonstration purposes, there will be two simple templates.
For more advance feature go to the section detailing the handlebars templates and associated helpers available in OperatorFabric.
As the card used in this example are created
<a href="#card_sending_script">above</a>
, the bundle template folder needs to contain 2 templates: <code>template1.handlebars</code> and <code>template2.handlebars</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples of template (i18n versions)</strong></p>
</div>
<div class="paragraph">
<p>The following templates display a l10n title and a line containing the value of the scope property <code>card.level1.level1Prop</code>.
In english, the translation of this key is '<em>This is a root property</em>'.</p>
</div>
<div class="paragraph">
<p><code>/template/en/template1.handlers</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Template Number One<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/template/fr/template1.handlers</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Patron numro Un<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The two following template examples display also a l10n title and a list of numeric values from 1 to 3.</p>
</div>
<div class="paragraph">
<p><code>/template/en/template2.handelbars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Second Template<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        {{#each card.data.level1.level1Array}}
                <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bunle-test-list-item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{this.level1ArrayProp}}<span class="tag">&lt;/li&gt;</span>
        {{/each}}
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>/template/fr/template2.handelbars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Second patron<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        {{#each card.data.level1.level1Array}}
                <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bunle-test-list-item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{this.level1ArrayProp}}<span class="tag">&lt;/li&gt;</span>
        {{/each}}
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_css"><a class="anchor" href="#_css"></a>CSS</h6>
<div class="paragraph">
<p>This folder contains regular css files.
The file name must be declared in the <code>config.json</code> file in order to be used in the templates and applied to them.</p>
</div>
<div class="sect6">
<h7 id="_examples_2"><a class="anchor" href="#_examples_2"></a>Examples</h7>
<div class="paragraph">
<p>As above, all parts of files irrelevant for our example are symbolised by a <code></code> character.</p>
</div>
<div class="paragraph">
<p><strong>Declaration of css files in <code>config.json</code> file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
        <span class="error"></span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">state1</span><span class="delimiter">&quot;</span></span> : {
                  <span class="error"></span>
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest</span><span class="delimiter">&quot;</span></span>]
        <span class="error"></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CSS Class used in <code>./template/en/template1.handlebars</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">        
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span>
        </code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, the value of <code>{{card.data.level1.level1Prop}}</code> of a test card is <code>This is a level1 property</code></p>
</div>
<div class="paragraph">
<p><strong>Style declaration in <code>./css/bundleTest.css</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.h2</span>{
        <span class="key">color</span>:<span class="color">#fd9312</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected result</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/expected-result.png" alt="Formatted root property">
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_upload"><a class="anchor" href="#_upload"></a>10.1.3.3. Upload</h5>
<div class="paragraph">
<p>To upload a bundle to the OperatorFabric server use a <code>POST</code> http request as described in the
<a href="../api/businessconfig/.html#/businessconfig/uploadBundle">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd ${BUNDLE_FOLDER}
curl -X POST "http://localhost:2100/businessconfig/processes"\
	-H  "accept: application/json"\
	-H  "Content-Type: multipart/form-data"\
	-F "file=@bundle-test.tar.gz;type=application/gzip"</pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${BUNDLE_FOLDER}</code> is the folder containing the bundle archive to be uploaded.</p>
</li>
<li>
<p><code>bundle-test.tar.gz</code> is the name of the uploaded bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command line should return a <code>200 http status</code> response with the details of the bundle in the response body such as :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [ {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">start.first.title</span><span class="delimiter">&quot;</span></span>
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">startTitle text-danger</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template1</span><span class="delimiter">&quot;</span></span>
            } ]

          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span> : [ {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">end.first.title</span><span class="delimiter">&quot;</span></span>
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">titleStyle</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">startTitle text-info</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template2</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest.css</span><span class="delimiter">&quot;</span></span> ]
            } ]
          }
      }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further help check the
<a href="#troubleshooting_bundle">Troubleshooting</a>
section which resumes how to resolve common problems.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_description"><a class="anchor" href="#template_description"></a>10.2. Templates</h3>
<div class="paragraph">
<p>Templates are <a href="https://handlebarsjs.com/">Handlebars</a> template files. Templates
are fuelled with a scope structure composed of</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>card</strong> property (See
<a href="../api/cards/index.html">card data model</a>
for more information)</p>
</li>
<li>
<p>a <strong>userContext</strong> :</p>
<div class="ulist">
<ul>
<li>
<p><strong>login</strong>: user login</p>
</li>
<li>
<p><strong>token</strong>: user jwt token</p>
</li>
<li>
<p><strong>firstName</strong>: user first name</p>
</li>
<li>
<p><strong>lastName</strong>: user last name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to Handlebars basic syntax and helpers, OperatorFabric defines the
following helpers :</p>
</div>
<div class="sect3">
<h4 id="_operatorfabric_specific_handlebars_helpers"><a class="anchor" href="#_operatorfabric_specific_handlebars_helpers"></a>10.2.1. OperatorFabric specific handlebars helpers</h4>
<div class="sect4">
<h5 id="numberformat"><a class="anchor" href="#numberformat"></a>10.2.1.1. numberFormat</h5>
<div class="paragraph">
<p>formats a number parameter using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu" class="bare">developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu</a>
mberFormat[Intl.NumberFormat].
The locale used is the current user selected one, and options are passed as hash
parameters (<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{numberFormat card.data.price style="currency" currency="EUR"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dateformat"><a class="anchor" href="#dateformat"></a>10.2.1.2. dateFormat</h5>
<div class="paragraph">
<p>formats the submitted parameters (millisecond since epoch) using
<a href="https://momentjs.com/">mement.format</a>. The locale used is the current user
selected one, the format is "format" hash parameter
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthday format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="slice"><a class="anchor" href="#slice"></a>10.2.1.3. slice</h5>
<div class="paragraph">
<p>extracts a sub array from ann array</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 0 2)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 1)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;bar&lt;/li&gt;
  &lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="now"><a class="anchor" href="#now"></a>10.2.1.4. now</h5>
<div class="paragraph">
<p>outputs the current date in millisecond from epoch. The date is computed from
application internal time service and thus may be different from the date that
one can compute from javascript api which relies on the browsers' system time.</p>
</div>
<div class="paragraph">
<p>NB: Due to Handlebars limitation you must provide at least one argument to
helpers otherwise, Handlebars will confuse a helper and a variable. In the
bellow example, we simply pass an empty string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;{{now ""}}&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;{{dateFormat (now "") format="MMMM Do YYYY, h:mm:ss a"}}&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;1551454795179&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;mars 1er 2019, 4:39:55 pm&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for a local set to <code>FR_fr</code></p>
</div>
</div>
<div class="sect4">
<h5 id="preservespace"><a class="anchor" href="#preservespace"></a>10.2.1.5. preserveSpace</h5>
<div class="paragraph">
<p>preserves space in parameter string to avoid html standard space trimming.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{preserveSpace card.data.businessId}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bool"><a class="anchor" href="#bool"></a>10.2.1.6. bool</h5>
<div class="paragraph">
<p>returns a boolean result value on an arithmetical operation (including object
equality) or boolean operation.</p>
</div>
<div class="paragraph">
<p>Arguments: - v1: left value operand - op: operator (string value) - v2: right
value operand</p>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>==</p>
</li>
<li>
<p>===</p>
</li>
<li>
<p>!=</p>
</li>
<li>
<p>!==</p>
</li>
<li>
<p>&lt;</p>
</li>
<li>
<p>&#8656;</p>
</li>
<li>
<p>&gt;</p>
</li>
<li>
<p>&gt;=</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>boolean operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp;&amp;</p>
</li>
<li>
<p>||</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (bool v1 '&lt;' v2)}}
  v1 is strictly lower than v2
{{else}}
 V2 is lower or equal to v1
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="math"><a class="anchor" href="#math"></a>10.2.1.7. math</h5>
<div class="paragraph">
<p>returns the result of a mathematical operation.</p>
</div>
<div class="paragraph">
<p>arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>v1: left value operand</p>
</li>
<li>
<p>op: operator (string value)</p>
</li>
<li>
<p>v2: right value operand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>+</p>
</li>
<li>
<p>-</p>
</li>
<li>
<p>*</p>
</li>
<li>
<p>/</p>
</li>
<li>
<p>%</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{math 1 '+' 2}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="split"><a class="anchor" href="#split"></a>10.2.1.8. split</h5>
<div class="paragraph">
<p>splits a string into an array based on a split string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (split 'my.example.string' '.')}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;my&lt;/li&gt;
  &lt;li&gt;example&lt;/li&gt;
  &lt;li&gt;string&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="svg"><a class="anchor" href="#svg"></a>10.2.1.9. svg</h5>
<div class="paragraph">
<p>outputs a svg tag with lazy loading, and missing image replacement message. The
image url is the concatenation of an arbitrary number of helper arguments</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{svg baseUri scheduledOpId "/" substation "/before/"
computationPhaseOrdinal}}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="i18n"><a class="anchor" href="#i18n"></a>10.2.1.10. i18n</h5>
<div class="paragraph">
<p>outputs a i18n result from a key and some parameters. There are two ways of
configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass an object as sole argument. The object must contain a key field (string)
and an optional parameter field (map of parameterKey &#8658; value)</p>
<div class="literalblock">
<div class="content">
<pre>{{i18n card.data.i18nTitle}}</pre>
</div>
</div>
</li>
<li>
<p>Pass a string key as sole argument and use hash parameters
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>) for i18n string
parameters.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
emergency.title=Emergency situation happened on {{date}}. Cause : {{cause}}.
--&gt;
{{i18n "emergency.title" date="2018-06-14" cause="Broken Coffee Machine"}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Emergency situation happened on 2018-06-14. Cause : Broken Cofee Machine</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sort"><a class="anchor" href="#sort"></a>10.2.1.11. sort</h5>
<div class="paragraph">
<p>sorts an array or some object&#8217;s properties (first argument) using an optional
field name (second argument) to sort the collection on this fields natural
order.</p>
</div>
<div class="paragraph">
<p>If there is no field argument provided :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an array, the original order of the array is kept ;</p>
</li>
<li>
<p>for an object, the structure is sorted by the object field name.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
users :

{"john": { "firstName": "John", "lastName": "Cleese"},
"graham": { "firstName": "Graham", "lastName": "Chapman"},
"terry": { "firstName": "Terry", "lastName": "Gilliam"},
"eric": { "firstName": "Eric", "lastName": "Idle"},
"terry": { "firstName": "Terry", "lastName": "Jones"},
"michael": { "firstName": "Michael", "lastName": "Palin"},
--&gt;

&lt;ul&gt;
{{#each (sort users)}}
    &lt;li&gt;{{this.firstName}} {{this.lastName}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (sort users "lastName")}}
    &lt;li&gt;{{this.firstName}} {{this.lastName&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="arrayContains"><a class="anchor" href="#arrayContains"></a>10.2.1.12. arrayContains</h5>
<div class="paragraph">
<p>Verify if an array contains a specified element. If the array does contain the element, it returns true. Otherwise, it returns false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p {{#if (arrayContains colors 'red')}}class="text-danger"{{/if}}&gt;test&lt;/p&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If the colors array contains 'red', the output is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p class="text-danger"&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="times"><a class="anchor" href="#times"></a>10.2.1.13. times</h5>
<div class="paragraph">
<p>Allows to perform the same action a certain number of times. Internally, this uses a for loop.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#times 3}}
  &lt;p&gt;test&lt;/p&gt;
{{/times}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="toBreakage"><a class="anchor" href="#toBreakage"></a>10.2.1.14. toBreakage</h5>
<div class="paragraph">
<p>Change the breakage of a string. The arguments that you can specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lowercase &#8658; The string will be lowercased</p>
</li>
<li>
<p>uppercase &#8658; The string will be uppercased</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>{{toBreakage key 'lowercase'}}s</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the key variable is "TEST", the output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tests</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="keyValue"><a class="anchor" href="#keyValue"></a>10.2.1.15. keyValue</h5>
<div class="paragraph">
<p>This allows to traverse a map.</p>
</div>
<div class="paragraph">
<p>Notice that this should normally be feasible by using the built-in each helper, but a client was having some troubles using it so we added this custom helper.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#keyValue studentGrades}}
  &lt;p&gt;{{key}}: {{value}}&lt;/p&gt;
{{/keyValue}}</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the studentGrades map is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  'student1': 15,
  'student2': 12,
  'student3': 9
}</pre>
</div>
</div>
<div class="paragraph">
<p>The output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt;student1: 15&lt;/p&gt;
&lt;p&gt;student2: 12&lt;/p&gt;
&lt;p&gt;student3: 9&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_keepspacesandendofline"><a class="anchor" href="#_keepspacesandendofline"></a>10.2.1.16. keepSpacesAndEndOfLine</h5>
<div class="paragraph">
<p>Convert a string to a light HTML by replacing :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>each new line character with &lt;br/&gt;</p>
</li>
<li>
<p>spaces with &amp;nbsp; when there is at least two consecutive spaces.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_charts"><a class="anchor" href="#_charts"></a>10.2.2. Charts</h4>
<div class="paragraph">
<p>The library <a href="https://www.chartjs.org/">charts.js</a> is integrate in operator fabric, it means it&#8217;s possible to show charts in cards, you can find a bundle example in the operator fabric git (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/utils/karate/businessconfig/resources/bundle_api_test">src/test/utils/karate/businessconfig/resources/bundle_test_api</a>).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_notification"><a class="anchor" href="#_card_notification"></a>11. Card notification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a user receives a card, he is notified via a resume of the card on the left panel of the UI, what is called the "feed".</p>
</div>
<div class="sect2">
<h3 id="_sound_notification"><a class="anchor" href="#_sound_notification"></a>11.1. Sound notification</h3>
<div class="paragraph">
<p>If the option is activated in the general configuration file web-ui.json, the user can choose to have a sound when a card is arriving. The configuration is to be set by the user with the settings menu.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_read"><a class="anchor" href="#_card_read"></a>11.2. Card read</h3>
<div class="paragraph">
<p>When the user receives a new card, he see it in the feed with an eye icon on the right of the card resume. When he opens the cards, the icon disappears.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgment"><a class="anchor" href="#_card_acknowledgment"></a>11.3. Card acknowledgment</h3>
<div class="paragraph">
<p>The user can set a card as "acknowledged" so he will not see it anymore by default in the feed. It is as well possible to cancel it and set a card to "unacknowledged" (a filter permit to see acknowledged cards).</p>
</div>
<div class="paragraph">
<p>To offer the possibility for the user to acknowledged card, it has to be configured in process definition. The configuration is set on a state based with the acknowledgementAllowed field set to true  (default is false). You can see examples in src/test/utils/karate/businessconfig/resources/bundle_defaultProcess/config.json</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_reminder_experimental"><a class="anchor" href="#_card_reminder_experimental"></a>11.4. Card reminder (Experimental)</h3>
<div class="paragraph">
<p>For certain process and state, it is possible to configure a reminder. The reminder "reactivate" the card in the feed at a certain time before the beginning of the start date of the first timeSpan of the card. "Reactivate" means set the card to the status "unread" and "unacknowledged".</p>
</div>
<div class="paragraph">
<p>The time for "reactivation" is defined with the parameter "secondsBeforeTimeSpanForReminder" in the card .</p>
</div>
<div class="paragraph">
<p>This function is experimental and not production ready yet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="response_cards"><a class="anchor" href="#response_cards"></a>12. Response cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within your template, you can allow the user to perform some action (respond to a form, answer a question, &#8230;&#8203;). The user fills these information and then clicks on a submit button. When he submits this action, a new card is created and emitted to a third-party tool.</p>
</div>
<div class="paragraph">
<p>This card is called "a child card" as it is attached to the card where the question came from : "the parent card". This child card is also sent to the users that have received the parent card. From the ui point of view, the information of the child cards can be integrated in real time in the parent card if configured.</p>
</div>
<div class="paragraph">
<p>The process can be represented as follows :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardSequence.jpg" alt="ResponseCardSequence">
</div>
</div>
<div class="paragraph">
<p>Notice that the response will be associated to the entity and not to the user, i.e the user responds on behalf of his entity. A user can respond more than one time to a card (a future evolution could add the possibility to limit to one response per entity).</p>
</div>
<div class="paragraph">
<p>You can view a screenshot of an example of card with responses :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot2.png" alt="ResponseCardScreenshot2">
</div>
</div>
<div class="sect2">
<h3 id="_steps_needed_to_use_a_response_card"><a class="anchor" href="#_steps_needed_to_use_a_response_card"></a>12.1. Steps needed to use a response card</h3>
<div class="sect3">
<h4 id="_define_a_third_party_tool"><a class="anchor" href="#_define_a_third_party_tool"></a>12.1.1. Define a third party tool</h4>
<div class="paragraph">
<p>The response card is to be received by a third party application for business processing. The third-party application will receive the card as an HTTP POST request. The card is in json format (the same format as when we send a card). The field data in the json contains the user response.</p>
</div>
<div class="paragraph">
<p>The url of the third party receiving the response card is to be set in the .yml of the publication service. Here is an example with two third parties configured.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>externalRecipients-url: "{\
           third-party1: \"http://thirdparty1/test1\", \
           third-party2: \"http://thirdparty2:8090/test2\", \
           }"</pre>
</div>
</div>
<div class="paragraph">
<p>The name to use for the third-party is the publisherId of the parent card.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the url, do not use localhost if you run OperatorFabric in a docker, as the publication-service will not be able to join your third party.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_response_in_config_json"><a class="anchor" href="#_configure_the_response_in_config_json"></a>12.1.2. Configure the response in config.json</h4>
<div class="paragraph">
<p>A card can have a response only if it&#8217;s in a process/state that is configured for. To do that you need to setup the good  configuration in the config.json of the concerned process. Here is an example of configuration :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id": "defaultProcess",
  "name": "Test",
  "version": "1",
  "states": {
    "questionState": {
      "name": "question.title",
      "color": "#8bcdcd",
      "response": {
        "state": "responseState",
        "externalRecipients":["externalRecipient1", "externalRecipient2"],
        "btnColor": "GREEN",
        "btnText": {
          "key": "question.button.text"
        }
      },
      "details": [
        {
          "title": {
            "key": "question.title"
          },
          "templateName": "question",
          "styles": [
            "style"
          ]
        }
      ],
      "acknowledgementAllowed": false
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We define here a state name "questionState" with a response field. Now, if we send a card with process "defaultProcess" and state "questionState" , the user will have the possibility to respond if he has the good privileges.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field "state" in the response field is used to define the state to use for the response (the child card).</p>
</li>
<li>
<p>The field "externalRecipients" define the recipients of the response card. These recipients are keys referenced in the config file of cards-publication service, in "externalRecipients-url" element. This field is optional.</p>
</li>
<li>
<p>The field "btnColor" define the color of the submit button for the response, it is optional and there is 3 possibilities : RED , GREEN , YELLOW</p>
</li>
<li>
<p>The field "btnText"is the i18n key of the title of the submit button, it is optional.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_design_the_question_form_in_the_template"><a class="anchor" href="#_design_the_question_form_in_the_template"></a>12.1.3. Design the question form in the template</h4>
<div class="paragraph">
<p>For the user to response you need to define the response form in the template with standard HTML syntax</p>
</div>
<div class="paragraph">
<p>To enable operator fabric to send the response, you need to implement a javascript function in your template called templateGateway.validyForm which return an object containing three fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>valid (<em>boolean</em>) : true if the user input is valid</p>
</li>
<li>
<p>errorMsg (<em>string</em>) : message in case of invalid user input. If valid is true this field is not necessary.</p>
</li>
<li>
<p>formData (<em>any</em>) : the user input to send in the data field of the child card. If valid is false this field is not necessary.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method will be called by OperatorFabric when user click on the button to send the response</p>
</div>
<div class="paragraph">
<p>You can find an example in the file src/test/utils/karate/businessconfig/resources/bundle_defaultProcess/template/en/question.handlebars.</p>
</div>
</div>
<div class="sect3">
<h4 id="_define_permissions"><a class="anchor" href="#_define_permissions"></a>12.1.4. Define permissions</h4>
<div class="paragraph">
<p>To respond to a card a user must have the right privileges, it is done using "perimeters". The user must be in a group that is attached to a perimeter with  a right "Write" for the concerned process/state, the state being the response state defined in the config.json.</p>
</div>
<div class="paragraph">
<p>Here is an example of definition of a perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterQuestion",
  "process" : "defaultProcess",
  "stateRights" : [
    {
      "state" : "responseState",
      "right" : "Write"
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>To configure it in OperatorFabric , you need to make a POST of this json file to the end point /users/perimeters.</p>
</div>
<div class="paragraph">
<p>To add it to a group name for example "mygroup", you need to make a PATCH request  to end point 'users/groups/mygroup/perimeters' with payload ["perimeterQuestion"]</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t want OperatorFabric to check for user perimeter when responding to a card, you can add the variable "checkPerimeterForResponseCard" and set it to false, in the config file of cards-publication and in web-ui.json.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_a_question_card"><a class="anchor" href="#_send_a_question_card"></a>12.2. Send a question card</h3>
<div class="paragraph">
<p>The question card is like a usual card except that you have the field "entitiesAllowedToRespond" to set with the entities allowed to respond to the card. If the user is not in the entity, he will not be able to respond.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1","ENTITY2"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, OperatorFabric considers that if the parent card (question card) is modified, then the child cards are deleted. If you want to keep the child cards when the parent card is changed, then you must add in the parent card the field "keepChildCards" and set it to true.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_child_cards"><a class="anchor" href="#_integrate_child_cards"></a>12.3. Integrate child cards</h3>
<div class="paragraph">
<p>For each user response, a child card containing the response is emitted and stored in OperatorFabric like a normal card. It is not directly visible on the ui but this child card can be integrated in real time to the parent card of all the users watching the card. To do that, you need  some code in the template to process child data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access child cards via the javascript method templateGateway.childCards() which returns an array of the child cards. The structure of a child card is the same as the structure of a classic card.</p>
</li>
<li>
<p>As child cards are arriving in real time, you need to define a method call templateGateway.applyChildCards() which will be called by OperatorFabric each time the list of child cards is evolving.</p>
</li>
<li>
<p>To integrate the child cards when loading the card you need to call to <em>templateGateway.applyChildCards()</em>. (OperatorFabric is not calling the method on card loading)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_entity_name"><a class="anchor" href="#_entity_name"></a>12.3.1. Entity name</h4>
<div class="paragraph">
<p>If you want to show the name of an entity that send the response, you need to get the id of the entity via the publisher field of the child card and then you  can get the name of the entity by calling <em>templateGateway.getEntityName(entityId)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a>12.3.2. Example</h4>
<div class="paragraph">
<p>You can find an example in the file src/test/utils/karate/businessconfig/resources/bundle_defaultProcess/template/en/question.handlebars.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archived_cards"><a class="anchor" href="#_archived_cards"></a>13. Archived Cards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_key_concepts"><a class="anchor" href="#_key_concepts"></a>13.1. Key concepts</h3>
<div class="paragraph">
<p>Every time a card is published, in addition to being delivered to the users
and persisted as a "current" card in MongoDB, it is also immediately
persisted in the archived cards.</p>
</div>
<div class="paragraph">
<p>Archived cards are similar in structure to current cards, but they are managed differently.
Current cards are uniquely identified by their id (made up of the publisher and the process id).
That is because if a new card is published with id as an existing card, it will replace it in the
card collection. This way, the current card reflects the current state of a process instance.
In the archived cards collection however, both cards will be kept, so that the archived cards
show all the states that a given process instance went through.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archives_screen_in_the_ui"><a class="anchor" href="#_archives_screen_in_the_ui"></a>13.2. Archives screen in the UI</h3>
<div class="paragraph">
<p>The Archives screen in the UI allows the users to query these archives with different filters.
The layout of this screen is very similar to the Feed screen: the results are displayed in a
(paginated) card list, and the user can display the associated card details by clicking a card in the list.</p>
</div>
<div class="paragraph">
<p>The results of these queries are limited to cards that the user is allowed to see, either :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because this user is direct recipient of the card,</p>
</li>
<li>
<p>because he belongs to a group (or entity) that is a recipient,</p>
</li>
<li>
<p>or because he belongs to a group that has the right to receive the card (via definition of perimeters)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a card is sent to an entity and a group, then this user must be part of both the group and the entity.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="users_management"><a class="anchor" href="#users_management"></a>14. User management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The User service manages users, groups, entities and perimeters (linked to groups).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Users</dt>
<dd>
<p>represent account information for a person destined to receive cards in the OperatorFabric instance.</p>
</dd>
<dt class="hdlist1">Groups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>has a set of perimeters to define rights for card reception in OperatorFabric.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Entities</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>can be used in a way to handle rights on card reception in OperatorFabric.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The user define here is an internal representation of the individual card recipient in <code>OperatorFabric</code> the authentication is leave to specific OAuth2 external service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is an authentication token currently valid for the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> system.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_users_groups_entities_and_perimeters"><a class="anchor" href="#_users_groups_entities_and_perimeters"></a>14.1. Users, groups, entities and perimeters</h3>
<div class="paragraph">
<p>User service manages users, groups, entities and perimeters.</p>
</div>
<div class="sect3">
<h4 id="_users"><a class="anchor" href="#_users"></a>14.1.1. Users</h4>
<div class="paragraph">
<p>Users are the individuals and mainly physical person who can log in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The access to this service has to be authorized, in the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> instance, at least to access User information and to manage Users. The membership of groups and entities are stored in the user information.</p>
</div>
<div class="sect4">
<h5 id="_automated_user_creation"><a class="anchor" href="#_automated_user_creation"></a>14.1.1.1. Automated user creation</h5>
<div class="paragraph">
<p>In case of a user does exist in a provided authentication service but he does not exist in the <code>OperatorFabric</code>
instance, when he is authenticated and connected for the first time in the <code>OperatorFabric</code> instance, the user is
automatically created in the system without attached group or entity.
The administration of the groups, entities and perimeters is dealt by the administrator manually.
More details about automated user creation
<a href="#opfab_spec_conf">here</a>
.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groups"><a class="anchor" href="#_groups"></a>14.1.2. Groups</h4>
<div class="paragraph">
<p>The notion of group is loose and can be used to simulate role in <code>OperatorFabric</code>.
Groups are used to send cards to several users without a name specifically. The information about membership to a
group is stored in the user information. A group contains a list of perimeters which define the rights of reception/writing for a couple process/state. The rules used to send cards are described in the
<a href="#card_recipients">recipients section</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_entities"><a class="anchor" href="#_entities"></a>14.1.3. Entities</h4>
<div class="paragraph">
<p>Entities are used to send cards to several users without a name specifically. The information about membership to an
entity is stored in the user information. Examples using entities can be found
<a href="#_send_to_several_users">here</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_perimeters"><a class="anchor" href="#_perimeters"></a>14.1.4. Perimeters</h4>
<div class="paragraph">
<p>Perimeters are used to define rights for reading/writing cards. A perimeter is composed of an identifier (unique), a process name and a list of state/rights couple.
Possible rights for receiving/writing cards are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receive : the rights for receiving a card</p>
</li>
<li>
<p>Write : the rights for writing a card, that is to say respond to a card or create a new card</p>
</li>
<li>
<p>ReceiveAndWrite : the rights for receiving and writing a card</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_way_to_manage_groups_and_entities"><a class="anchor" href="#_alternative_way_to_manage_groups_and_entities"></a>14.1.5. Alternative way to manage groups and entities</h4>
<div class="paragraph">
<p>The standard way to handle groups and entities in <code>OperatorFabric</code> instance is dealt on the user information.
There is an alternative way to manage groups and entities through the authentication token, the groups and entities are defined by the administrator of the authentication service.
See
<a href="#jwt_mode">here</a>
for more details to use this feature.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_customization"><a class="anchor" href="#_ui_customization"></a>15. UI Customization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ui_configuration"><a class="anchor" href="#_ui_configuration"></a>15.1. UI configuration</h3>
<div class="paragraph">
<p>To customize the UI, declare specific parameters in the <code>web-ui.json</code> file as <a href="../deployment/index.html#ui_properties">listed here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="menu_entries"><a class="anchor" href="#menu_entries"></a>15.2. Menu Entries</h3>
<div class="paragraph">
<p>The <code>ui-menu.json</code> file declares specific business menus to be displayed in the navigation bar of OperatorFabric.</p>
</div>
<div class="paragraph">
<p>A menu can target directly a link or give access to several sub-menus when clicked.
Those sub-menus can only target a link.
A targeted link can be open in an iframe or in a new tab.</p>
</div>
<div class="paragraph">
<p>Menus support i18n following the i18n OperatorFabric rules.
The ui-menu.json file contains directly the i18n dictionary for the menus.</p>
</div>
<div class="paragraph">
<p>In case of a single menu, the navigation bar displays the l10n of the <code>label</code> of the entry menu.
In this case, the <code>label</code> declared at the root level of the menu is useless and can be omitted (see example below).</p>
</div>
<div class="sect3">
<h4 id="_ui_menu_json_declaration"><a class="anchor" href="#_ui_menu_json_declaration"></a>15.2.1. ui-menu.json declaration</h4>
<div class="paragraph">
<p>A single menu or a menu with sub-menus has at least attributes named <code>id</code> and <code>entries</code>.
The <code>entries</code> attribute is an array of <code>menu entry</code>.
Note that menus with sub-menus need a <code>label</code> declaring an i18n key.</p>
</div>
<div class="paragraph">
<p>Each <code>menu entry</code> declares the attributes listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: identifier of the entry menu in the UI;</p>
</li>
<li>
<p><code>url</code>: url opening a new page in a tab in the browser;</p>
</li>
<li>
<p><code>label</code>: it&#8217;s an i18n key used to l10n the entry in the UI.</p>
</li>
<li>
<p><code>linkType</code>: Defines how to display business menu links in the navigation bar and how to open them. Possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>TAB</code>: displays only a text link. Clicking it opens the link in a new tab.</p>
</li>
<li>
<p><code>IFRAME</code>: displays only a text link. Clicking it opens the link in an iframe in the main content zone below the navigation bar.</p>
</li>
<li>
<p><code>BOTH</code>: default value. Displays a text link plus a little arrow icon. Clicking the text link opens the link in an iframe while clicking the icon opens in a new tab.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_examples_3"><a class="anchor" href="#_examples_3"></a>15.2.2. Examples</h4>
<div class="paragraph">
<p>In following example, the configuration file declares two additional business menus.
The first has only one entry, the second has two entries.
The sample contain also the i18n translations in english and in french.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_0</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.single</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title.multi</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.wikipedia.org/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">locales</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Single menu entry</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First menu entry</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu entry</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Unique menu entry</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxieme menu</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premiere menu entry</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxieme menu entry</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_fabric_theme"><a class="anchor" href="#_operator_fabric_theme"></a>15.2.3. Operator Fabric theme</h4>
<div class="paragraph">
<p>For iframes opened from menu, the associated request uses an extra parameter containing the current theme information.
Named <code>opfab_theme</code>, this parameter has a value corresponding to the current theme:<br>
<code>DAY</code>, <code>NIGHT</code> or <code>LEGACY</code>.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre> http://mysite.com/index.htm?opfab_theme=NIGHT</pre>
</div>
</div>
<div class="paragraph">
<p>Switching theme will trigger reload of open iframes.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_deployment_and_administration_of_operatorfabric" class="sect0"><a class="anchor" href="#_deployment_and_administration_of_operatorfabric"></a>Deployment and Administration of OperatorFabric</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to explain how to configure and deploy OperatorFabric.
</div>
</div>
<div class="sect1">
<h2 id="_deployment"><a class="anchor" href="#_deployment"></a>16. Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For now OperatorFabric consist of Docker images available either by compiling
the project or by using images releases from <a href="https://hub.docker.com/">Dockerhub</a></p>
</div>
<div class="paragraph">
<p>Service images are all based on <a href="https://hub.docker.com/_/openjdk">openjdk:8-jre-alpine</a>.</p>
</div>
<div class="paragraph">
<p>For simple one instance per service deployment, you can find a sample
deployment as a docker-compose file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/config/docker">here</a></p>
</div>
<div class="paragraph">
<p>To run OperatorFabric in development mode, see
<a href="#dev_env">the development environment documentation</a>
.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>17. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric has multiple services to configure.</p>
</div>
<div class="paragraph">
<p>See the
<a href="#architecture">architecture documentation</a>
for more information on the different services.</p>
</div>
<div class="paragraph">
<p>All services are SpringBoot applications and use jetty as an embedded servlet container. As such, they share some common
configuration which is described in the following documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/">Springboot documentation</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#boot-features-external-config">Springboot external configuration</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.1.2.RELEASE//reference/htmlsingle/#common-application-properties">Common application properties from Springboot documentation</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration is centralized in the <strong>config</strong> directory, the <strong>dev</strong> sub-directory is specific to development environments
while the <strong>docker</strong> sub-directory is a specific configuration meant for use in a full docker environment.</p>
</div>
<div class="sect2">
<h3 id="_business_service_configuration"><a class="anchor" href="#_business_service_configuration"></a>17.1. Business service configuration</h3>
<div class="sect3">
<h4 id="_shared_business_service_configuration"><a class="anchor" href="#_shared_business_service_configuration"></a>17.1.1. Shared business service configuration</h4>
<div class="paragraph">
<p>The configuration shared by all business services is in a yaml file, you can find an example with the file
/config/docker/common-docker.yml.
In this file you will find, among others, the parameters below :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.businessLogActivated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether or not operatorfabric should record business logs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_business_service_specific_configurations"><a class="anchor" href="#_business_service_specific_configurations"></a>17.1.2. Business service specific configurations</h4>
<div class="paragraph">
<p>Each business service has a specific yaml configuration file. It should a least contain the name of the service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
  <span class="key">application</span>:
    <span class="key">name</span>: <span class="string"><span class="content">businessconfig</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It can contain references to other services as well, for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">users</span>:
  <span class="key">ribbon</span>:
    <span class="key">listOfServers</span>: <span class="string"><span class="content">users:8080</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Examples of configuration of each business service can be found either under config/docker or config/dev depending on
the type of deployment you&#8217;re looking for.</p>
</div>
<div class="sect4">
<h5 id="_businessconfig_service"><a class="anchor" href="#_businessconfig_service"></a>17.1.2.1. Businessconfig service</h5>
<div class="paragraph">
<p>The businessconfig service has this specific property :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.businessconfig.storage.path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File path to data storage folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_users_service"><a class="anchor" href="#_users_service"></a>17.1.2.2. Users service</h5>
<div class="paragraph">
<p>The user service has these specific properties :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.user-settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of user settings objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of group objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.users.default.entities</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of entity objects to create upon startup if they don&#8217;t exist</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cards_publication_service"><a class="anchor" href="#_cards_publication_service"></a>17.1.2.3. Cards-publication service</h5>
<div class="paragraph">
<p>The cards-publication service has these specific properties :</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkPerimeterForResponseCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If false, OperatorFabric will not check that a user has write rights on a process/state to respond to a card</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.kafka.consumer.group-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set, support for receiving cards via Kafka is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.deserializer.value.delegate.class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.confluent.kafka.serializers.
KafkaAvroDeserializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deserializer used to convert the received bytes into objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.serializer.value.delegate.class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.confluent.kafka.serializers.
KafkaAvroSerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializer used to convert cards to bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.kafka.producer.bootstrap-servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:9092" class="bare">localhost:9092</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">comma seperated list of URL(s) of the broker(s) / bootstrap server(s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.kafka.topics.card.topicname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic to read the messages from</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.kafka.topics.response-card.topicname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the topic to place the response cards to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">opfab.kafka.schema.registry.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://localhost:8081" class="bare">localhost:8081</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of the schema registry. Can be set to the empty string "" is no registry is used</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_ui_configuration"><a class="anchor" href="#_web_ui_configuration"></a>17.2. Web UI Configuration</h3>
<div class="paragraph">
<p>OperatorFabric Web UI service is built on top of a <a href="https://www.nginx.com/">NGINX</a> server.
It  serves the Angular SPA to browsers and act as a reverse proxy for other services.</p>
</div>
<div class="sect3">
<h4 id="_nginx_configuration"><a class="anchor" href="#_nginx_configuration"></a>17.2.1. NGINX configuration</h4>
<div class="paragraph">
<p>An external <code>nginx.conf</code> file configures the OperatorFabric Nginx instance named <code>web-ui</code> service.
Those files are mounted as docker volumes. There are two of them in OperatorFabric, one in <code>config/dev</code> and one in <code>config/docker</code>.</p>
</div>
<div class="paragraph">
<p>The one in <code>config/dev</code> is set with
 permissive <code>CORS</code> rules to enable web development using <code>ng serve</code> within the <code>ui/main</code> project.It&#8217;s possible to use <code>ng serve</code> with the one in <code>config/docker</code> version also. To do so use the conf file named
<code>nginx-cors-permissive.conf</code> by configuring the <code>/docker-compose.yml</code> with the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- "./nginx-cors-permissive.conf:/etc/nginx/conf.d/default.conf"</pre>
</div>
</div>
<div class="paragraph">
<p>instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- "./nginx.conf:/etc/nginx/conf.d/default.conf"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The line customized in the nginx configuration file must end with  semi-colon (';') otherwise the Nginx server will stop immediately</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ui_properties"><a class="anchor" href="#ui_properties"></a>17.2.2. UI properties</h4>
<div class="paragraph">
<p>The properties lie in the <code>web-ui.json</code>.The following table describes their meaning and  how to use them. An example file can be found in the config/docker directory.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.provider-realm</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The realm name in keycloak server settings page. This is used for the log out process to know which realm should be affected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.provider-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keycloak server instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.logout-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The keycloak logout URL. Is a composition of:
 - Your keycloak instance and the <em>auth</em> keyword (ex: <a href="https://www.keycloakurl.com/auth" class="bare">www.keycloakurl.com/auth</a>), but we also support domains without <em>auth</em> (ex: <a href="https://www.keycloakurl.com/customPath" class="bare">www.keycloakurl.com/customPath</a>)
 - The realm name (Ex: dev)
 - The redirect URL (<em>redirect_uri</em>): The redirect URL after success authentification</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.flow.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>authentication mode, awailable options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE: Authorization Code Flow;</p>
</li>
<li>
<p>PASSWORD: Direct Password Flow (fallback);</p>
</li>
<li>
<p>IMPLICIT: Implicit Flow.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.flow.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provider name to display on log in button</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">security.oauth2.flow.delegate-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Url to redirect the browser to for authentication. Mandatory with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CODE flow: must be the url with protocol choice and version as query parameters;</p>
</li>
<li>
<p>IMPLICIT flow: must be the url part before <code>.well-known/openid-configuration</code> (for example in dev configuration it&#8217;s
<code><a href="http://localhost:89/auth/realms/dev" class="bare">localhost:89/auth/realms/dev</a></code>).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.time.display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUSINESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>card time display mode in the feed. Values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BUSINESS: displays card with entire business period. It the fallback if the set value is none of the values listed here;</p>
</li>
<li>
<p>BUSINESS_START: displays card with business start date;</p>
</li>
<li>
<p>PUBLICATION: displays card with publication date;</p>
</li>
<li>
<p>LTTD: displays card with lttd date;</p>
</li>
<li>
<p>NONE: nothing displayed.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.timeline.hide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, the time line is not loaded in the feed screen. If the timeline is not loaded , the time filter on the feed is filtering on business date otherwise it is filtering on publish date.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideTimeFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the time filter in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideAckFilter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the acknowledgement filter in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideReadSort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the option to sort cards by read status in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.hideSeveritySort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the option to sort cards by severity in the feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.card.secondsBeforeLttdForClockDisplay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds before lttd when a clock is activated in cards on the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.timeline.domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">["TR", "J", "7D", "W", "M", "Y"]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of domains to show on the timeline, possible domains are : "TR", "J", "7D", "W", "M", "Y".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed.notify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, new cards are notified in the OS through web-push notifications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">playSoundForAlarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Alarm cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">playSoundForAction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Action cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">playSoundForCompliant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Compliant cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">playSoundForInformation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, a sound is played when Information cards are added or updated in the feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i18n.supported.locales</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported locales (Only fr and en so far)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i10n.supported.time-zones</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of supported time zones, for instance 'Europe/Paris'.
Values should be taken from the <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">TZ database</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.page.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page size of archive filters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.process.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of processes to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archive.filters.tags.list</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tags to choose from in the corresponding filter in archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.tags.hide</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if you want to show or hide the tags filter in settings and feed page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.nightDayMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if you want to activate toggle for night or day mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.styleWhenNightDayModeDesactivated</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">style to apply if not using day night mode, possible value are DAY,NIGHT or LEGACY (black background and white timeline)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.infos.description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the user description in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.infos.language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the language in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.infos.timezone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the timezone in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.infos.tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the tags in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.infos.sounds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control if we want to hide(true) or display(false or not specified) the checkboxes for sound notifications in the settings page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.about</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>none</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>no</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Declares application names and their version into web-ui about section.<br>
Each entry is
a free key value followed by its name (a string of characters), its version (a string of characters) and its facultative rank of declaration (a number).<br>
For <code>OperatorFabric</code> value, with <code>'OperatorFabric'</code> as <code>name</code> and <code>0</code> as <code>rank</code>, the value of <code>${currentVersion}</code>
is the version of the current release, <code>1.3.0.RELEASE</code> for example.<br>
It should look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><span class="key"><span class="delimiter">&quot;</span><span class="content">operatorfabric</span><span class="delimiter">&quot;</span></span>: {
 <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">OperatorFabric</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">1.3.0.RElEASE</span><span class="delimiter">&quot;</span></span>,
 <span class="key"><span class="delimiter">&quot;</span><span class="content">rank</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.base64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">medium OperatorFabric icon</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The encoding result of converting the svg logo to Base64, use this <a href="https://base64.guru/converter/encode/image/svg">online tool</a> to encode your svg. If it is not set, a medium (32px) OperatorFabric icon is displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.height</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The height of the logo (in px) (only taken into account if logo.base64 is set).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The width of the logo (in px) (only taken into account if logo.base64 is set).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logo.limitSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If it is true, the height limit is 32(px) and the width limit is 200(px), it means that if the height is over than 32, it will be set to 32, if the width is over than 200, it is set to 200. If it is false, no limit restriction for the height and the width.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OperatorFabric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Title of the application, displayed on the browser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">navbar.hidden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">["logging","monitoring"]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lists the application menu to hide in the navbar.<br>
The <code>keys</code> used are the <code>route.path</code> declared in the <code>${OF_HOME}ui/main/src/app/app-routing.module.ts</code> file.<br>
Currently the <code>application routes</code> are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>feed</code>;</p>
</li>
<li>
<p><code>archives</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There will be two new routes with the release of the <code>[OC-936]</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logging</code>;</p>
</li>
<li>
<p><code>monitoring</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkPerimeterForResponseCard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If false, OperatorFabric will not check that a user has write rights on a process/state to respond to a card.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>User Settings default values</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.timeZone</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user time zone for users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user locale (use en if not set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.default-tags</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default user list of filtered in tags</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="opfab_spec_conf"><a class="anchor" href="#opfab_spec_conf"></a>17.3. Security Configuration</h3>
<div class="paragraph">
<p>Configure the security concern throughout several files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nginx.conf</code> of the nginx server</p>
</li>
<li>
<p><code>config/dev/common-dev.yml</code>  or <code>config/docker/common-docker.yml</code>, called common.yml in the following chapters</p>
</li>
<li>
<p><code>web-ui.json</code> served by the <code>web-ui</code> service;</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_authentication_configuration"><a class="anchor" href="#_authentication_configuration"></a>17.3.1. Authentication configuration</h4>
<div class="paragraph">
<p>There are 3 OAuth2 Authentication flows available into OperatorFabric UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>password grant: referred as <code>PASSWORD</code> mode flow;</p>
</li>
<li>
<p>code flow : referred as <code>CODE</code> mode flow;</p>
</li>
<li>
<p>implicit flow: referred as <code>IMPLICIT</code> mode flow.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_nginx_configuration_2"><a class="anchor" href="#_nginx_configuration_2"></a>17.3.1.1. Nginx Configuration</h5>
<div class="paragraph">
<p>The UI calls need some mapping to reach the Authentication Provider. In the default OperatorFabric configuration it&#8217;s a
<code>docker keycloak instance</code>, called <code>keycloak</code> in the project <code>docker-compose.yml</code> files.</p>
</div>
<div class="paragraph">
<p>There are 3 properties to configure within <code>nginx.conf</code> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$KeycloakBaseUrl</code>: the base url of keycloak;</p>
</li>
<li>
<p><code>$OperatorFabricRealm</code>: the realm configure within keycloak instance to provide authentication to OperatorFabric;</p>
</li>
<li>
<p><code>$ClientPairOFAuthentication</code>: base64 encoded string of the pair of client authentication used by OperatorFabric
to log to the Authentication Provider (keycloak). The cient-id and the client-secret are separated by a colon(':').</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Example of the <code>docker</code> configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Url of the Authentication provider
    set $KeycloakBaseUrl "http://keycloak:8080";
# Realm associated to OperatorFabric within the Authentication provider
    set $OperatorFabricRealm "dev";

# base64 encoded pair of authentication in the form of 'client-id:secret-id'
    set $ClientPairOFAuthentication "b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==" ;</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>b3BmYWItY2xpZW50Om9wZmFiLWtleWNsb2FrLXNlY3JldA==</code> is the base64 encoded string of
<code>opfab-client:opfab-keycloak-secret</code> with <code>opfab-client</code> as client-id and <code>opfab-keycloak-secret</code> its client secret.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_file_common_yml"><a class="anchor" href="#_configuration_file_common_yml"></a>17.3.1.2. Configuration file common.yml</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.oauth2.client-id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oauth2 client id used by OperatorFabric may be specific for each service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.login-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as user login or id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.expire-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as token expiration timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.provider-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keycloak instance url.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.provider-realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The realm name within the keycloak instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spring.security.oauth2.resourceserver.jwt.jwk-set-uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The url providing the certificat used to verify the jwt signature</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>example of <code>common.yml</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">operatorfabric</span>:
    <span class="key">security</span>:
        <span class="key">oauth2</span>:
            <span class="key">client-id</span>: <span class="string"><span class="content">opfab-client</span></span>
        <span class="key">jwt</span>:
            <span class="key">login-claim</span>: <span class="string"><span class="content">preferred_username</span></span>
            <span class="key">expire-claim</span>: <span class="string"><span class="content">exp</span></span>
<span class="key">spring</span>:
  <span class="key">security</span>:
    <span class="key">provider-url</span>: <span class="string"><span class="content">http://localhost:89</span></span>
    <span class="key">provider-realm</span>: <span class="string"><span class="content">dev</span></span>
    <span class="key">oauth2</span>:
      <span class="key">resourceserver</span>:
        <span class="key">jwt</span>:
          <span class="key">jwk-set-uri</span>: <span class="string"><span class="content">${spring.security.provider-url}/auth/realms/${spring.security.provider-realm}/protocol/openid-connect/certs</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>operatorfabric.security.jwt.expire-claim</code> could have been omitted because having the same value as the default one
and where <code>jwt-set-uri</code> reuses <code>provider-url</code> and <code>provider-realm</code> properties.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_configuration_file_web_ui_json"><a class="anchor" href="#_configuration_file_web_ui_json"></a>17.3.1.3. Configuration file web-ui.json</h5>
<div class="paragraph">
<p>Nginx web server serves this file. OperatorFabric creates and uses a custom Docker image containing an Nginx server with a docker volume containing this file. The two docker-compose environments contain an example of it. The path in the image to it is <code>/usr/share/nginx/html/opfab/web-ui.json</code>.</p>
</div>
<div class="paragraph">
<p>For OAuth2 security concerns into this file, there are two ways to configure it, based on the Oauth2 chosen flow.
There are several common properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.provider-realm</code>: OAuth2 provider realm under which the OpertaroFabric client is declared;</p>
</li>
<li>
<p><code>security.provider-url</code>: url of the keycloak server instance.</p>
</li>
<li>
<p><code>security.logout-url</code>: url used when a user is logged out of the UI;</p>
</li>
<li>
<p><code>security.oauth2.flow.provider</code>: name of the OAuth2 provider;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code>: url used to connect to the Authentication provider;</p>
</li>
<li>
<p><code>security.oauth2.flow.mode</code>: technical way to be authenticated by the Autentication provider.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2_password_or_code_flows"><a class="anchor" href="#_oauth2_password_or_code_flows"></a>17.3.1.4. OAuth2 PASSWORD or CODE Flows</h5>
<div class="paragraph">
<p>These two modes share the same way of declaring the delegate URL.
<code>CODE</code> is the default mode of authentication for <code>deploy</code> docker-compose environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.oauth2.flow.mode</code> to <code>PASSWORD</code> or <code>CODE</code>;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the protocol used for authentication.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_of_configuration_for_code_flow"><a class="anchor" href="#_example_of_configuration_for_code_flow"></a>Example of Configuration For CODE Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CODE</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">provider</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Opfab Keycloak</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">delegate-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/auth?response_type=code&amp;client_id=opfab-client</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">logout-url</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/ui/</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">provider-realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">provider-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property <code>dev</code> is the keycloak client realm of OperatorFabric.
For keycloak instance used for development purposes, this <code>delegate-url</code> correspond to the realm under which the client <code>opfab-client</code> is registred.
Here, the <code>client-id</code> value is <code>opfab-client</code> which is define as client under the <code>realm</code> named <code>dev</code> on the dev keycloak instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_oauth2_implicit_flow"><a class="anchor" href="#_oauth2_implicit_flow"></a>17.3.1.5. OAuth2 IMPLICIT Flow</h5>
<div class="paragraph">
<p>It had its own way of configuration.
To enable IMPLICIT Flow authentication the following properties need to be set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>security.oauth2.flow.mode</code> to <code>IMPLICIT</code>;</p>
</li>
<li>
<p><code>security.oauth2.flow.delegate-url</code> with the URL of the OAuth2 leading to the <code>.well-known/openid-configuration</code> end-point used for authentication configuration.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_of_configuration_for_implicit_flow"><a class="anchor" href="#_example_of_configuration_for_implicit_flow"></a>Example of configuration for IMPLICIT Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">operatorfabric</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">oauth2</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">mode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">IMPLICIT</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">provider</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Opfab Keycloak</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">delegate-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">logout-url</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89/auth/realms/dev/protocol/openid-connect/logout?redirect_uri=http://localhost:2002/ui/</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">provider-realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">provider-url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:89</span><span class="delimiter">&quot;</span></span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the <code>delegate-url</code> property <code>dev</code> is the keycloak client realm of OperatorFabric.
For keycloak instance used for development purposes, this <code>delegate-url</code> correspond to the realm under which the client <code>opfab-client</code> is registred.
The url look up by the implicit ui mechanism is <code><a href="http://localhost:89/auth/realms/dev/.well-known/openid-configuration" class="bare">localhost:89/auth/realms/dev/.well-known/openid-configuration</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_creation"><a class="anchor" href="#_user_creation"></a>17.3.2. User creation</h4>
<div class="paragraph">
<p>Setting automated user creation==. Creation user requires a user id. Given name and family name are optional.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.login-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used as a user login or id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.given-name-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">given-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used to set the user&#8217;s given name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.family-name-claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">family-name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jwt claim is used to set the user&#8217;s family name</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="jwt_mode"><a class="anchor" href="#jwt_mode"></a>17.3.3. Alternative way to manage groups (and/or entities)</h4>
<div class="paragraph">
<p>By default, <code>OperatorFabric</code> manages groups (and/or entities) through the user's collection in the database.
Another mode can be defined, the JWT mode. The groups (and/or entities) come from the authentication token.
The administrator of the authentication service has to set what claims define a group (and/or entity).
In the <code>Operator-Fabric</code> configuration, the opfab administrator has to set properties to retrieve those groups (and/or entities).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">default</th>
<th class="tableblock halign-left valign-top">mandatory?</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPERATOR_FABRIC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the group mode, possible values JWT or OPERATOR_FABRIC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandard.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardArray.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines an array of groups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to retrieve the claim that defines a list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimStandardList.separator</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the separator value of the list of group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.path</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path in the JWT to check if that path does exist, if it does, use the roleValue as a group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.groups.rolesClaim.rolesClaimCheckExistPath.roleValue</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the value of the group if the path exists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.entitiesIdClaim</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set the name of the field in the token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operatorfabric.security.jwt.gettingEntitiesFromToken</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean indicating if you want the entities of the user to come from the token and not mongoDB (possible values : true/false)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em>application.yml</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>operatorfabric:
  security:
    jwt:
      entitiesIdClaim: entitiesId
      gettingEntitiesFromToken: true
      groups:
        mode: JWT # value possible JWT | OPERATOR_FABRIC
        rolesClaim:
          rolesClaimStandard:
            - path: "ATTR1"
            - path: "ATTR2"
          rolesClaimStandardArray:
            - path: "resource_access/opfab-client/roles"
          rolesClaimStandardList:
            - path: "roleFieldList"
              separator: ";"
          rolesClaimCheckExistPath:
            - path: "resource_access/AAA"
              roleValue: "roleAAA"
            - path: "resource_access/BBB"
              roleValue: "roleBBB"</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>JWT example</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
  "jti": "5ff87583-10bd-4946-8753-9d58171c8b7f",
  "exp": 1572979628,
  "nbf": 0,
  "iat": 1572961628,
  "iss": "http://localhost:89/auth/realms/dev",
  "aud": [
    "AAA",
    "BBB",
    "account"
  ],
  "sub": "example_user",
  "typ": "Bearer",
  "azp": "opfab-client",
  "auth_time": 0,
  "session_state": "960cbec4-fcb2-47f2-a155-975832e61300",
  "acr": "1",
  "realm_access": {
    "roles": [
      "offline_access",
      "uma_authorization"
    ]
  },
  "resource_access": {
    "AAA": {
      "roles": [
        "role_AAA"
      ]
    },
    "BBB": {
      "roles": [
        "role_BBB"
      ]
    },
    "opfab-client": {
      "roles": [
        "USER"
      ]
    },
    "account": {
      "roles": [
        "manage-account",
        "manage-account-links",
        "view-profile"
      ]
    }
  },
  "scope": "openid ATTR2 email ATTR1 profile roleFieldList",
  "email_verified": false,
  "name": "example_firtstname example_lastname",
  "ATTR2": "roleATTR2",
  "ATTR1": "roleATTR1",
  "preferred_username": "example_user",
  "given_name": "example_firtstname",
  "entitiesId": "ENTITY1",
  "family_name": "example_lastname",
  "email": "example_user@mail.com",
  "roleFieldList": "roleA;roleB;roleC"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the result, the group will be [ATTR1, ATTR2, roleA, roleB, roleC, USER, roleBBB, roleAAA]</p>
</div>
</div>
<div class="sect3">
<h4 id="custom_certificates"><a class="anchor" href="#custom_certificates"></a>17.3.4. Adding certification authorities or certificates to the Java keystore</h4>
<div class="paragraph">
<p>If you&#8217;re using certificates (for example for Keycloak) that are not from a certification authority trusted by the JVM,
this will cause errors such as this one:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/certificate_error.png" alt="Missing certificate error message">
</div>
</div>
<div class="paragraph">
<p>If that is the case, you can pass the additional authorities or certificates that you use to the containers at runtime.</p>
</div>
<div class="paragraph">
<p>To do so, put the relevant files (*.der files for example) under <strong>src/main/docker/certificates</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>This directory should only contain the files to be added to the keystore.</p>
</li>
<li>
<p>The files can be nested inside directories.</p>
</li>
<li>
<p>Each certificate will be added with its filename as alias. For example, the certificate in file mycertificate.der
will be added under alias <strong>mycertificate</strong>. As a consequence, filenames should be unique or it will cause an error.</p>
</li>
<li>
<p>If you need to add or remove certificates while the container is already running, the container will have to be
restarted for the changes to be taken into account.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you would like certificates to be sourced from a different location, replace the volumes declarations in the deploy
docker-compose.yml file with the selected location:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>volumes:
 - "path/to/my/selected/location:/certificates_to_add"</pre>
</div>
</div>
<div class="paragraph">
<p>instead of</p>
</div>
<div class="literalblock">
<div class="content">
<pre>volumes:
 - "../../../../src/main/docker/certificates:/certificates_to_add"</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The steps described here assume you&#8217;re running OperatorFabric in docker mode using the deploy docker-compose,
but they can be adapted for single container deployments and development mode.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to check that the certificates were correctly added, you can do so with the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a bash shell in the container you want to check</p>
<div class="literalblock">
<div class="content">
<pre>docker exec -it deploy_businessconfig_1 bash</pre>
</div>
</div>
</li>
<li>
<p>Run the following command</p>
<div class="literalblock">
<div class="content">
<pre>$JAVA_HOME/bin/keytool -list -v -keystore /tmp/cacerts -storepass changeit</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also look at the default list of authorities and certificates trusted by the JVM with this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$JAVA_HOME/bin/keytool -list -v -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_mongo_configuration"><a class="anchor" href="#_operatorfabric_mongo_configuration"></a>17.4. OperatorFabric Mongo configuration</h3>
<div class="paragraph">
<p>We only use URI configuration for mongo through the usage of the <code><code>spring.data.mongodb.uris</code></code>,
it allows us to share the same configuration behavior for simple or cluster
configuration and with both spring classic and reactive mongo configuration.
See <a href="https://docs.mongodb.com/manual/reference/connection-string/">mongo connection string</a> for the complete URI syntax.</p>
</div>
<div class="sect3">
<h4 id="_define_time_to_live_for_archived_cards"><a class="anchor" href="#_define_time_to_live_for_archived_cards"></a>17.4.1. Define time to live for archived cards</h4>
<div class="paragraph">
<p>By default, archived cards will remain stored in the database forever. It is possible to have them automatically
removed after a specified duration by using the <a href="https://docs.mongodb.com/manual/core/index-ttl/">TTL index feature of mongoDB</a> on their publishDate field.</p>
</div>
<div class="paragraph">
<p>For example, to have cards expire after 10 days (864000s), enter the following commands in the mongo shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">use operator-fabric
db.archivedCards.createIndex( { &quot;publishDate&quot;: 1 }, { expireAfterSeconds: 864000 } )</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You cannot use createIndex() to change the value of expireAfterSeconds of an existing index.
Instead use the <a href="https://docs.mongodb.com/manual/reference/command/collMod/#dbcmd.collMod">collMod</a> database command in conjunction with the index collection flag. Otherwise, to
change the value of the option of an existing index, you must drop the index first and recreate.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_kafka_configuration"><a class="anchor" href="#_operatorfabric_kafka_configuration"></a>17.5. OperatorFabric Kafka configuration</h3>
<div class="paragraph">
<p>Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic. In the default configuration Kafka is disabled.
To enable Kafka you need to set the consumer group to the consumer group you assign to the OpFab Kafka consumer. This can be any group-id, as long as it isn&#8217;t used by other consumers
(unless you explicitly want multiple consumers for the same group).</p>
</div>
<div class="paragraph">
<p>You can set the group_id by uncommenting the <code>kafka.consumer.group_id</code> in the <code>cards-publication.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">opfab-command</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the consumer will consume messages from the <code>opfab</code> topic.
See <a href="https://docs.spring.io/spring-kafka/reference/html/">Spring for Apache Kafka</a> for more information on the Spring Kafka implementation.</p>
</div>
<div class="paragraph">
<p>With the default settings, the Kafka consumer expects a broker running on http//127.0.0.1:9092 and a schema registry on <a href="http://127.0.0.1:8081" class="bare">127.0.0.1:8081</a>.</p>
</div>
<div class="paragraph">
<p>Operator Fabric is also able to publish response cards to a Kafka topic. The default topic name  <code>opfab-response</code>. You can specify which response cards
are to be returned via Kafka by setting the <code>externalRecipients-url</code> in the <code>cards-publication</code> yaml file. Instead of setting <code>http://</code> URL you should set it to <code>kafka:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">externalRecipients-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{\
           processAction: \&quot;http://localhost:8090/test\&quot;, \
           mykafka: \&quot;kafka:topicname\&quot;
           }</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>topicname</code> is a placeholder for now. All response cards are returned via the same Kafka topic.</p>
</div>
<div class="paragraph">
<p>Also note enabling Kafka does not disable the REST interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rabbitmq"><a class="anchor" href="#_rabbitmq"></a>18. RabbitMQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker_container"><a class="anchor" href="#_docker_container"></a>18.1. Docker container</h3>
<div class="paragraph">
<p>In development mode, the simplest way to deploy a RabbitMQ server is to
create a RabbitMQ docker container. A <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker/rabbitmq">docker-compose file</a> is provided to allow quick setup of a convenient RabbitMQ
 server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_server_installation"><a class="anchor" href="#_server_installation"></a>18.2. Server installation</h3>
<div class="paragraph">
<p>This section is dedicated to production deployment of RabbitMQ. It is
 not complete and needs to be tailored to any specific production
 environment.</p>
</div>
<div class="sect3">
<h4 id="_download_installation"><a class="anchor" href="#_download_installation"></a>18.2.1. Download &amp; Installation</h4>
<div class="paragraph">
<p>Download and install RabbitMQ following the
<a href="https://www.rabbitmq.com/download.html">official procedure</a> for the
target environment</p>
</div>
</div>
<div class="sect3">
<h4 id="_used_ports"><a class="anchor" href="#_used_ports"></a>18.2.2. Used ports</h4>
<div class="paragraph">
<p>If RabbitMQ may not bind to the following ports, it won&#8217;t start :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>4369</strong>: epmd, a peer discovery service used by RabbitMQ nodes and
CLI tools</p>
</li>
<li>
<p><strong>5672, 5671</strong>: used by AMQP 0-9-1 and 1.0 clients without and with
TLS</p>
</li>
<li>
<p><strong>25672</strong>: used for inter-node and CLI tools communication
(Erlang distribution server port) and is allocated from a dynamic range
(limited to a single port by default, computed as AMQP port + 20000).
Unless external connections on these ports are really necessary
(e.g. the cluster uses federation or CLI tools are used on machines
outside the subnet), these ports should not be publicly exposed. See
networking guide for details.</p>
</li>
<li>
<p><strong>35672-35682</strong>: used by CLI tools (Erlang distribution client ports)
for communication with nodes and is allocated from a dynamic range
(computed as server distribution port + 10000 through server
distribution port + 10010). See networking guide for details.</p>
</li>
<li>
<p><strong>15672</strong>: HTTP API clients, management UI and rabbitmqadmin (<strong>only if
the management plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>61613, 61614</strong>: STOMP clients without and with TLS
(<strong>only if the STOMP plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>1883, 8883</strong>: (MQTT clients without and with TLS,
<em>if the MQTT plugin is enabled</em>)</p>
</li>
<li>
<p><strong>15674</strong>: STOMP-over-WebSockets clients
(<strong>only if the Web STOMP plugin is enabled</strong>)</p>
</li>
<li>
<p><strong>15675</strong>: MQTT-over-WebSockets clients
(<strong>only if the Web MQTT plugin is enabled</strong>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_production_configuration"><a class="anchor" href="#_production_configuration"></a>18.2.3. Production configuration</h4>
<div class="paragraph">
<p>See the <a href="https://www.rabbitmq.com/production-checklist.html">guide</a> for
production configuration guidelines</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>19. Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operator Fabric provides end points for monitoring via <a href="https://prometheus.io/">prometheus</a>. The monitoring is available for the four following services: user, businessconfig, cards-consultation, cards-publication. You can start a test prometheus instance via <code>config/monitoring/startPrometheus.sh</code> , the monitoring will be accessible on <a href="http://localhost:9090/" class="bare">localhost:9090/</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_users_groups_and_entities_administration"><a class="anchor" href="#_users_groups_and_entities_administration"></a>20. Users, Groups and Entities Administration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A new operator call John Doe, who has OAuth granted right to connect ot current <code>OperatorFabric</code> instance, need to receive cards within current <code>OperatorFabric</code> instance.
As a user of OperatorFabric, he needs to be added to the system with a <code>login</code> (john-doe-operator), his <code>firstName</code> (John) and his <code>lastName</code> (Doe).
As there is no <code>Administration GUI</code> for the moment, it must be performed through command line, as detailed in the Users API.</p>
</div>
<div class="sect2">
<h3 id="_users_2"><a class="anchor" href="#_users_2"></a>20.1. Users</h3>
<div class="sect3">
<h4 id="_list_all_users"><a class="anchor" href="#_list_all_users"></a>20.1.1. List all users</h4>
<div class="paragraph">
<p>First of all, list the users (who are the recipients in OperatorFabric) of the system with the following commands:</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -v http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "firstName": null,
        "groups": [
            "ADMIN"
        ],
        "entities": [
            "ENTITY1",
            "ENTITY2"
        ],
        "lastName": null,
        "login": "admin"
    },
    {
        "firstName": null,
        "groups": [
            "RTE",
            "ADMIN",
            "CORESO",
            "ReadOnly",
            "TEST"
        ],
        "lastName": null,
        "login": "operator3"
    },
    {
        "firstName": null,
        "groups": [
            "ELIA"
        ],
        "lastName": null,
        "login": "elia-operator"
    },
    {
        "firstName": null,
        "groups": [
            "CORESO"
        ],
        "lastName": null,
        "login": "coreso-operator"
    },
    {
        "firstName": null,
        "groups": [
            "Dispatcher",
            "ReadOnly",
            "TEST"
        ],
        "entities": [
            "ENTITY1"
        ],
        "lastName": null,
        "login": "operator1"
    },
    {
        "firstName": null,
        "groups": [
            "Planner",
            "ReadOnly"
        ],
        "entities": [
            "ENTITY2"
        ],
        "lastName": null,
        "login": "operator2"
    },
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_user"><a class="anchor" href="#_create_a_new_user"></a>20.1.2. Create a new User</h4>
<div class="paragraph">
<p>We are sure that no John-doe-operator exists in our OperatorFabric instance.
We can add him in our OperatorFabric instance using the following command use httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}' | http POST http://localhost:2103/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>Or here cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"Jahne","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_user_details"><a class="anchor" href="#_fetch_user_details"></a>20.1.3. Fetch user details</h4>
<div class="paragraph">
<p>It&#8217;s always a good thing to verify if all the information has been correctly recorded in the system:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http -b http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "Jahne",
    "groups": [],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_user_details"><a class="anchor" href="#_update_user_details"></a>20.1.4. Update user details</h4>
<div class="paragraph">
<p>As shown by this result, the firstName of the new operator has been misspelled.
We need
<a href="../api/users/index.html#/users/updateUser">to update the existing user</a>
with <code>john-doe-operator</code> login.
To correct this mistake, the following commands can be used:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"login":"john-doe-operator","lastName":"Doe","firstName":"John"}' | http PUT http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>or with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"login":"john-doe-operator","firstName":"John","lastName":"Doe"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groupsentities"><a class="anchor" href="#_groupsentities"></a>20.2. Groups/Entities</h3>
<div class="paragraph">
<p>All the commands below :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List groups</p>
</li>
<li>
<p>Create a new group</p>
</li>
<li>
<p>Fetch details of a given group</p>
</li>
<li>
<p>Update details of a group</p>
</li>
<li>
<p>Add a user to a group</p>
</li>
<li>
<p>Remove a user from a group</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>are available for both groups and entities. In order not to overload the documentation, we will only detail group endpoints.</p>
</div>
<div class="sect3">
<h4 id="_list_groups_or_entities"><a class="anchor" href="#_list_groups_or_entities"></a>20.2.1. List groups (or entities)</h4>
<div class="paragraph">
<p>This operator is the first member of a new group operator called the <code>OPERATORS</code>, which doesn&#8217;t exist for the moment in
the system. As shown when we
<a href="../api/users/index.html#/groups/fetchGroups">list the groups</a>
existing in the server.</p>
</div>
<div class="paragraph">
<p>Httpie</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/type"</pre>
</div>
</div>
<div class="paragraph">
<p>cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

[
    {
        "description": "The admin group",
        "name": "ADMIN group",
        "id": "ADMIN"
    },
    {
        "description": "RTE TSO Group",
        "name": "RTE group",
        "id": "RTE"
    },
    {
        "description": "ELIA TSO group",
        "name": "ELIA group",
        "id": "ELIA"
    },
    {
        "description": "CORESO Group",
        "name": "CORESO group",
        "id": "CORESO"
    },
    {
        "description": "Dispatcher Group",
        "name": "Dispatcher",
        "id": "Dispatcher"
    },
    {
        "description": "Planner Group",
        "name": "Planner",
        "id": "Planner"
    },
    {
        "description": "ReadOnly Group",
        "name": "ReadOnly",
        "id": "ReadOnly"
    }
]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_new_group_or_entity"><a class="anchor" href="#_create_a_new_group_or_entity"></a>20.2.2. Create a new group (or entity)</h4>
<div class="paragraph">
<p>Firstly, the group called <code>OPERATORS</code> has to be
<a href="../api/users/index.html#/groups/createGroup">added to the system</a>
using the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"OPERATORS","decription":"This is the brand new group of operator"}' | http POST http://localhost:2103/groups "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X POST http://localhost:2103/groups -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"OPERATORS","decription":"This is the brand new group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "perimeters": [],
    "description": null,
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_fetch_details_of_a_given_group_or_entity"><a class="anchor" href="#_fetch_details_of_a_given_group_or_entity"></a>20.2.3. Fetch details of a given group (or entity)</h4>
<div class="paragraph">
<p>The result returned seems strange, to verify if it&#8217;s the correct answer by
<a href="../api/users/index.html#/groups/fetchGroup">displaying the details of the group</a>
called <code>OPERATORS</code>, use the following command:</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "perimeters": [],
    "description": null,
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_details_of_a_group_or_entity"><a class="anchor" href="#_update_details_of_a_group_or_entity"></a>20.2.4. Update details of a group (or entity)</h4>
<div class="paragraph">
<p>The description is really null. After verification, in our first command used to create the group,
the attribute for the description is misspelled. Using the following command
<a href="../api/users/index.html#/groups/updateGroup">to update the group</a>
with the correct spelling, the new group of operator gets a proper description:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"OPERATORS","description":"This is the brand-new group of operator"}' | http -b PUT http://localhost:2103/groups/OPERATORS "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/groups/OPERATORS -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"OPERATORS","description":"This is the brand-new group of operator"}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "perimeters": []
    "description": "This is the brand-new group of operator",
    "name": null,
    "id": "OPERATORS"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_user_to_a_group_or_entity"><a class="anchor" href="#_add_a_user_to_a_group_or_entity"></a>20.2.5. Add a user to a group (or entity)</h4>
<div class="paragraph">
<p>As both new group and new user are correct it&#8217;s time
<a href="../api/users/index.html#/users/addGroupUsers">to make the user a member of the group</a>
. To achieve this, use the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '["john-doe-operator"]' | http PATCH http://localhost:2103/groups/OPERATORS/users "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PATCH http://localhost:2103/groups/OPERATORS/users -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '["john-doe-operator"]'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s verify that the changes are correctly recorded by fetching the :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": ["OPERATORS"],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"
}</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now possible to send cards either specifically to <code>john-doe-operator</code> or more generally to the <code>OPERATORS</code> group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_remove_a_user_from_a_group_or_entity"><a class="anchor" href="#_remove_a_user_from_a_group_or_entity"></a>20.2.6. Remove a user from a group (or entity)</h4>
<div class="paragraph">
<p>When John Doe is no longer in charge of hypervising cards for <code>OPERATORS</code> group, this group has to be removed from his login by using the following command:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http DELETE http://localhost:2103/groups/OPERATORS/users/john-doe-operator "Authorization:Bearer $token"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X DELETE -H "Authorization:Bearer $token" http://localhost:2103/groups/OPERATORS/users/john-doe-operator</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
	"login":"john-doe-operator","
	firstName":"John",
	"lastName":"Doe",
	"groups":[],
    "entities":[]
}</pre>
</div>
</div>
<div class="paragraph">
<p>A last command to verify that <code>OPERATORS</code> is no longer linked to <code>john-doe-operator</code>:</p>
</div>
<div class="paragraph">
<p>with httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>http http://localhost:2103/users/john-doe-operator "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>with cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/users/john-doe-operator -H "Authorization:Bearer $token" -H "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "firstName": "John",
    "groups": [],
    "entities": [],
    "lastName": "Doe",
    "login": "john-doe-operator"

}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entity_parents"><a class="anchor" href="#_entity_parents"></a>20.2.7. Entity parents</h4>
<div class="paragraph">
<p>Entities have a 'parents' attribute instead of a 'perimeters' one.
This attribute is a string array.
Each element of the array is the id of another Entity.
When adding or patching an Entity into the system, operatorFabric performs a cycle detection.
On a positive cycle detection cancels the addition or the patch.</p>
</div>
<div class="sect4">
<h5 id="_add_a_new_entity_without_a_cycle_in_the_parent_declaration"><a class="anchor" href="#_add_a_new_entity_without_a_cycle_in_the_parent_declaration"></a>20.2.7.1. Add a new Entity without a cycle in the parent declaration</h5>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["ENTITY1"]}' \
| http POST http://localhost:2103/entities "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/entities -H "Authorization:Bearer $token" -H "Content-Type:application/json" \
--data '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["ENTITY1"]}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK

{
    "id": "NEW_ENTITY",
    "parents": ["ENTITY1"],
    "name": "Last New Entity",
    "description":"This is the last new entity"
}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_a_new_entity_with_a_cycle"><a class="anchor" href="#_add_a_new_entity_with_a_cycle"></a>20.2.7.2. Add a new Entity with a cycle</h5>
<div class="paragraph">
<p>For simplicity, in this example the new entity will declare itself as a parent.
This auto-referencing triggers a cycle detection.</p>
</div>
<div class="paragraph">
<p>using httpie:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>echo '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["NEW_ENTITY"]}' | http POST http://localhost:2103/entities "Authorization:Bearer $token" "Content-Type:application/json"</pre>
</div>
</div>
<div class="paragraph">
<p>using cURL:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl http://localhost:2103/entities -H "Authorization:Bearer $token" -H "Content-Type:application/json" --data '{"id":"NEW_ENTITY","name":"Last New Entity","description":"This is the last new entity","parents": ["NEW_ENTITY"]}'</pre>
</div>
</div>
<div class="paragraph">
<p>response</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "status":"BAD_REQUEST",
    "message":"A cycle has been detected: NEW_ENTITY-&gt;NEW_ENTITY"
}</pre>
</div>
</div>
<div class="paragraph">
<p>with a <code>400</code> as http status return.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_port_table"><a class="anchor" href="#_service_port_table"></a>21. Service port table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default all service built artifacts are configured with server.port set
to 8080</p>
</div>
<div class="paragraph">
<p>If you run the services using <code>bootRun</code> Gradle task, the <code>run_all.sh</code> script or the full docker docker-compose
(found under config/docker),
the used ports are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Forwards to</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KeyCloak api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web ui and gateway  (Nginx server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Businessconfig management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cards consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mongo api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqp api port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15672</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rabbitmq api port</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_restricted_operations_administration"><a class="anchor" href="#_restricted_operations_administration"></a>22. Restricted operations (administration)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some operations are restricted to users with the <strong>ADMIN</strong> role, either because they are administration
operations with the potential to impact the OperatorFabric instance as a whole, or because they
give access to information that should be private to a user.</p>
</div>
<div class="paragraph">
<p>Below is a quick recap of these restricted operations.</p>
</div>
<div class="paragraph">
<div class="title">Users Service</div>
<p>Any action (read, create/update or delete) regarding a single user&#8217;s data (their personal info such as their first and
last name, as well as their settings) can be performed either by the user in question or by a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<p>Any action on a list of users or on the groups (or entities) (if authorization is managed in OperatorFabric) can only be performed by
a user with the ADMIN role.</p>
</div>
<div class="paragraph">
<div class="title">Businessconfig Service</div>
<p>Any write (create, update or delete) action on bundles can only be performed by a user with the ADMIN role. As such,
administrators are responsible for the quality and security of the provided bundles.
In particular, as it is possible to use scripts in templates, they should perform a security check to make sure that
there is no XSS risk.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The ADMIN role doesn&#8217;t grant any special privileges when it comes to card consultation (be they current or
archived), so a user with the ADMIN role will only see cards that have been addressed to them (or to one of their
groups (or entities)), just like any other user.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="dev_env" class="sect0"><a class="anchor" href="#dev_env"></a>Development environment</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to provide all the necessary information to developers who would like to start working on
OperatorFabric.
It will walk you through setting up the necessary tooling to be able to launch OperatorFabric in development mode,
describe the structure of the project and point out useful tools (Gradle tasks, scripts, etc.) for development purposes.
</div>
</div>
<div class="sect1">
<h2 id="_requirements"><a class="anchor" href="#_requirements"></a>23. Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the projects requirements regardless of installation options.
Please see
<a href="#setup_dev_env">Setting up your environment</a>
below for details on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setting up a development environment with these prerequisites</p>
</li>
<li>
<p>building and running OperatorFabric</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_tools_and_libraries"><a class="anchor" href="#_tools_and_libraries"></a>23.1. Tools and libraries</h3>
<div class="ulist">
<ul>
<li>
<p>Gradle 6<br></p>
</li>
<li>
<p>Java 8.0<br></p>
</li>
<li>
<p>Maven 3.5.3<br></p>
</li>
<li>
<p>Docker</p>
</li>
<li>
<p>Docker Compose with 2.1+ file format support</p>
</li>
<li>
<p>Chrome (needed for UI tests in build)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the current Jdk used for the project is Java 8.0.252-zulu.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is highly recommended to use <a href="https://sdkman.io/">sdkman</a> and
<a href="https://github.com/nvm-sh/nvm">nvm</a> to manage tools versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have installed sdkman and nvm, you can <strong>source</strong> the following
script to set up your development environment (appropriate versions of Gradle,
Java, Maven and project variables set):</p>
</div>
<div class="listingblock">
<div class="title">Set up development environment (using sdkman and nvm)</div>
<div class="content">
<pre class="CodeRay highlight"><code>source bin/load_environment_light.sh</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_software"><a class="anchor" href="#_software"></a>23.2. Software</h3>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ 3.7.6 +: AMQP messaging layer allows inter
service communication</p>
</li>
<li>
<p>MongoDB 4.0 +: Card persistent storage</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RabbitMQ is required for :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Card AMQP push</p>
</li>
<li>
<p>Multiple service sync</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MongoDB is required for :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Current Card storage</p>
</li>
<li>
<p>Archived Card storage</p>
</li>
<li>
<p>User Storage</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Installing MongoDB and RabbitMQ is not necessary as preconfigured
MongoDB and RabbitMQ are available in the form of docker-compose configuration
files at
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker">src/main/docker</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_browser_support"><a class="anchor" href="#_browser_support"></a>23.3. Browser support</h3>
<div class="paragraph">
<p>Project is supported on recent version of firefox , chromium and chrome</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup_dev_env"><a class="anchor" href="#setup_dev_env"></a>24. Setting up your development environment</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The steps below assume that you have installed and are using
<a href="https://sdkman.io/">sdkman</a> and
<a href="https://github.com/nvm-sh/nvm">nvm</a> to manage tool versions ( for java,
gradle, node and npm).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several ways to get started with <code>OperatorFabric</code>. Please look into
the section that best fits your needs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you encounter any issue, see
<a href="#troubleshooting">Troubleshooting</a>
below. In particular,
a command that hangs then fails is often a proxy issue.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following steps describe how to launch MongoDB, RabbitMQ and Keycloak
using Docker,  build OperatorFabric using gradle and run it using the
<code>run_all.sh</code> script.</p>
</div>
<div class="sect2">
<h3 id="_clone_repository"><a class="anchor" href="#_clone_repository"></a>24.1. Clone repository</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">git clone https://github.com/opfab/operatorfabric-core.git
cd operatorfabric-core</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_up_your_environment_environment_variables_appropriate_versions_of_gradle_maven_etc"><a class="anchor" href="#_set_up_your_environment_environment_variables_appropriate_versions_of_gradle_maven_etc"></a>24.2. Set up your environment (environment variables &amp; appropriate versions of gradle, maven, etc)</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">source bin/load_environment_light.sh</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
From now on, you can use environment variable <code>${OF_HOME}</code> to go back to
the home repository of <code>OperatorFabric</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_needed_docker_containers"><a class="anchor" href="#_deploy_needed_docker_containers"></a>24.3. Deploy needed docker containers</h3>
<div class="sect3">
<h4 id="_a_minimal_configuration_for_gradle_build"><a class="anchor" href="#_a_minimal_configuration_for_gradle_build"></a>24.3.1. A Minimal Configuration for <code>gradle</code> Build</h4>
<div class="paragraph">
<p>The gradle build of <code>OperatorFabric</code> needs two docker containers running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RabbitMQ;</p>
</li>
<li>
<p>MongoDB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Launch them using the <code>${OF_HOME}/src/main/docker/test-environment/docker-compose.yml</code>.</p>
</div>
<div class="paragraph">
<p>Remind that, during a gradle build the <code>test</code> task runs before the <code>assemble</code> one.
The Unit tests depend on those two software.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_local_quality_report_generation"><a class="anchor" href="#_enabling_local_quality_report_generation"></a>24.3.2. Enabling local quality report generation</h4>
<div class="paragraph">
<p>Sonarqube reporting, in addition to the two previously listed docker containers, needs a <code>SonarQube</code> docker container.
Use the <code>${OF_HOME}/src/main/docker/test-quality-environment/docker-compose.yml</code> to get them all running.</p>
</div>
<div class="paragraph">
<p>To generate the quality report, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew jacocoTestReport</code></pre>
</div>
</div>
<div class="paragraph">
<p>To export the reports into the <code>SonarQube</code> docker instance, install and use <a href="https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/">SonarScanner</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_dev_env"><a class="anchor" href="#_docker_dev_env"></a>24.3.3. Development environment</h4>
<div class="paragraph">
<p><code>OperatorFabric</code> development needs docker images of <code>MongoDB</code>, <code>RabbitMQ</code>, <code>web-ui</code> and <code>Keycloak</code> running.
The <code>web-ui</code> configuration needs a <code>nginx.conf</code>.</p>
</div>
<div class="paragraph">
<p>The <code>${OF_HOME}/config/dev/$docker-compose.sh</code> creates the <code>nginx.conf</code> file and then runs <code>docker-compose</code> in detached mode.
For this, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <code>nginx.conf</code> created, run <code>docker-compose</code> independently is possible using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}/config/dev
docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration of the <code>web-ui</code> embeds a grayscale favicon which can be useful to spot the <code>OperatorFabric</code> dev tab in the browser.
To refresh the favicon, hit <code>CTRL+F5</code> on the page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_operatorfabric_with_gradle"><a class="anchor" href="#_build_operatorfabric_with_gradle"></a>24.4. Build OperatorFabric with Gradle</h3>
<div class="paragraph">
<p>Using the wrapper in order to ensure building the project the same way from one machine to another.</p>
</div>
<div class="paragraph">
<p>To only compile and package the jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
./gradlew assemble</code></pre>
</div>
</div>
<div class="paragraph">
<p>To launch the Unit Test, compile and package the jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
docker-compose -f ${OF_HOME}/src/main/docker/test-environment/docker-compose.yml up -d
./gradlew build</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_operatorfabric_services_using_the_run_all_sh_script"><a class="anchor" href="#_run_operatorfabric_services_using_the_run_all_sh_script"></a>24.5. Run OperatorFabric Services using the <code>run_all.sh</code> script</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
docker-compose -f ${OF_HOME}/config/dev/docker-compose.yml up -d
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <code>bin/run_all.sh -h</code> for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_check_services_status"><a class="anchor" href="#_check_services_status"></a>24.6. Check services status</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${OF_HOME}
bin/run_all.sh status</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_log_into_the_ui"><a class="anchor" href="#_log_into_the_ui"></a>24.7. Log into the UI</h3>
<div class="paragraph">
<p><strong><em>URL:</em></strong> localhost:2002/ui/<br>
<strong><em>login:</em></strong> operator1<br>
<strong><em>password:</em></strong> test</p>
</div>
<div class="paragraph">
<p>The other users available in development mode are <code>operator3</code>and <code>admin</code>, both with <code>test</code> as password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It might take a little while for the UI to load even after all services are running.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Don&#8217;t forget the <strong>final slash</strong> in the URL or you will get an error, a <code>404</code> page.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_push_cards_to_the_feed"><a class="anchor" href="#_push_cards_to_the_feed"></a>24.8. Push cards to the feed</h3>
<div class="paragraph">
<p>You can check that you see cards into the feed by running the
<code>push_card_loop.sh</code> script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">services/core/cards-publication/src/main/bin/push_card_loop.sh</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_interface"><a class="anchor" href="#_user_interface"></a>25. User Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/angular/angular-cli">Angular CLI</a> version 6.0.8 has been used to generate this project.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In the following document the variable declared as <code>OF_HOME</code> is the root folder of the <code>operatorfabric-core project</code>.
</td>
</tr>
</table>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CLI
</td>
<td class="hdlist2">
<p>stands for <strong>Command Line Interface</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
SPA
</td>
<td class="hdlist2">
<p>stands for <strong>Single Page Application</strong></p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_run"><a class="anchor" href="#_run"></a>25.1. Run</h3>
<div class="sect3">
<h4 id="_front_end_development"><a class="anchor" href="#_front_end_development"></a>25.1.1. Front End development</h4>
<div class="paragraph">
<p>OperatorFabric uses 4 external services to run properly :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an event queue: RabbitMQ;</p>
</li>
<li>
<p>a no SQL database: MongoDB;</p>
</li>
<li>
<p>an authentication provider: keycloak;</p>
</li>
<li>
<p>a web server: Nginx.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those instances are available as docker images in the project.
se <code>docker-compose</code> and the <code>${OF_HOME}/config/dev/docker-compose.yml</code> to run them.
After launching docker containers, use the following command line <code>$OF_HOME/bin/run_all.sh start</code> to run the application.</p>
</div>
<div class="paragraph">
<p>Once the whole application is ready, you should have the following output in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">##########################################################
Starting users-business-service, debug port: 5009
##########################################################
pid file: $OF_HOME/services/core/users/build/PIDFILE
Started with pid: 7483

##########################################################
Starting cards-consultation-business-service, debug port: 5011
##########################################################
pid file: $OF_HOME/services/core/cards-consultation/build/PIDFILE
Started with pid: 7493

##########################################################
Starting cards-publication-business-service, debug port: 5012
##########################################################
pid file: $OF_HOME/services/core/cards-publication/build/PIDFILE
Started with pid: 7500

##########################################################
Starting businessconfig-business-service, debug port: 5008
##########################################################
pid file: $OF_HOME//services/core/businessconfig/build/PIDFILE
Started with pid: 7501</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait a moment before trying to connect to the`SPA`, leaving time for the OperatorFabricServices to boot up completely.</p>
</div>
<div class="paragraph">
<p>The <code>SPA</code>, on a local machine, is available at the following Url: <code><a href="http://localhost:2002/ui/" class="bare">localhost:2002/ui/</a></code>.</p>
</div>
<div class="paragraph">
<p>To log in you need to use a valid user among the following: <code>operator1</code>, <code>operator3</code> or <code>admin</code>.
The common password is <code>test</code> for them all.</p>
</div>
<div class="paragraph">
<p>To test the reception of cards, you can use the following script to create dummy cards:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">${OF_HOME}/services/core/cards-publication/src/main/bin/push_cards_loop.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more realistic card sending use, once Karate env correctly configured, the Karate scripts called :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${OF_HOME}/src/test/utils/karate/loadBundles.sh</code></p>
</li>
<li>
<p><code>${OF_HOME}/src/test/utils/karate/postTestCards.sh</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once logged in, after one of those scripts have been running, you should be able to see some cards displayed in <code><a href="http://localhost:2002/ui/feed" class="bare">localhost:2002/ui/feed</a></code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build"><a class="anchor" href="#_build"></a>25.2. Build</h3>
<div class="paragraph">
<p>Within the folder <code>${OF_HOME}/ui/main</code>, run <code>ng build</code> to build the project.</p>
</div>
<div class="paragraph">
<p>The build artifacts will be stored in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">${OF_HOME}/ui/main/build/distribution</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command could lead to the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See &quot;/tmp/ng-&lt;random-string&gt;/angular-errors.log&quot; for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use <code>node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code> instead to solve this problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test"><a class="anchor" href="#_test"></a>25.3. Test</h3>
<div class="sect3">
<h4 id="_standalone_tests"><a class="anchor" href="#_standalone_tests"></a>25.3.1. Standalone tests</h4>
<div class="paragraph">
<p>Run in the <code>${OF_HOME}/ui/main</code> directory the command <code>ng test --watch=false</code> to execute the unit tests
on <a href="https://jasmine.github.io">Jasmine</a> using <a href="https://karma-runner.github.io">Karma</a> to drive the browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_during_ui_development"><a class="anchor" href="#_test_during_ui_development"></a>25.3.2. Test during UI development</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the RabbitMQ, MongoDB and Keycloak docker containers are not running, launch them;</p>
</li>
<li>
<p>set your environment variables with <code>source ${OF_HOME}/bin/load_environment_light.sh</code>;</p>
</li>
<li>
<p>run the micro services using the same command as earlier: <code>${OF_HOME}/bin/run_all.sh start</code>;</p>
</li>
<li>
<p>if needed, enable a card-operation test flow using the script <code>${OF_HOME}/service/core/cards-publication/src/main/bin/push_cards_loop.sh</code>;</p>
</li>
<li>
<p>launch an angular server with the command: <code>ng serve</code>;</p>
</li>
<li>
<p>test your changes in your browser using this url: <code><a href="http://localhost:4200" class="bare">localhost:4200</a></code> which leads to <code><a href="http://localhost:4200/#/feed" class="bare">localhost:4200/#/feed</a></code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>26. Environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These variables are loaded by bin/load_environment_light.sh</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OF_HOME: OperatorFabric root dir</p>
</li>
<li>
<p>OF_CORE: OperatorFabric business services subroot dir</p>
</li>
<li>
<p>OF_INFRA: OperatorFabric infrastructure services subroot dir</p>
</li>
<li>
<p>OF_CLIENT: OperatorFabric client data definition subroot dir</p>
</li>
<li>
<p>OF_TOOLS: OperatorFabric tooling libraries subroot dir</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, you may want to configure the following variables</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker build proxy configuration (used to configure alpine apk proxy
settings)</p>
<div class="ulist">
<ul>
<li>
<p>APK_PROXY_URI</p>
</li>
<li>
<p>APK_PROXY_HTTPS_URI</p>
</li>
<li>
<p>APK_PROXY_USER</p>
</li>
<li>
<p>APK_PROXY_PASSWORD</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_structure"><a class="anchor" href="#_project_structure"></a>27. Project Structure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_tree_view"><a class="anchor" href="#_tree_view"></a>27.1. Tree View</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>project
bin
CICD
    travis
client
   cards (cards-client-data)
   src
   users (users-client-data)
config
   dev
   docker
   keycloak
services
   core
      cards-consultation (cards-consultation-business-service)
      cards-publication (cards-publication-business-service)
      src
      businessconfig (businessconfig-business-service)
      users (users-business-service)
web-ui
src
|   docs
|  asciidoc
|   |main
| |  docker
| |   headers
|   |test
| |   api
| |   cypress
| |   utils
tools
 generic
  test-utilities
  utilities
  spring
  spring-mongo-utilities
  spring-oauth2-utilities
   spring-test-utilities
   spring-utilities
 swagger-spring-generators
ui</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_content_details"><a class="anchor" href="#_content_details"></a>27.2. Content Details</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/bin">bin</a>: contains useful scripts for dev purposes</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/CICD/travis">travis</a>: scripts used by Travis for the
build process</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client">client</a>: contains REST APIs simple beans definition, may be
used by external projects</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/cards">cards (cards-client-data)</a>: simple beans regarding cards</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/src">src</a>: contains swagger templates for <a href="https://github.com/opfab/operatorfabric-core/tree/master/client">client</a>
code generation</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/client/users">users (users-client-data)</a>: simple beans regarding users</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/config">config</a>: contains external configurations for all services , keycloak and docker-compose files to help with tests and demonstrations</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services">services</a>: contains the microservices that make up
OperatorFabric</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core">core</a>: contains core business microservices</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core/cards-consultation">cards-consultation
(cards-consultation-business-service)</a>: Card consultation service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core/cards-publication">cards-publication
(cards-publication-business-service)</a>: Card publication service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core/src">src</a>: contains swagger templates for core business
microservices</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core/businessconfig">businessconfig (businessconfig-business-service)</a>:
Businessconfig-party information management service</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/services/core/users">users (users-business-service)</a>: Users management
service</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/web-ui">web-ui</a>: project based on Nginx server to serve
the OperatorFabric UI</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src">src</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs">docs</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs/asciidoc">asciidoc</a>: General documentation (Architecture,
Getting Started Guide, etc.)</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main">main</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/docker">docker</a>: contains docker-compose files to help with
tests and demonstrations</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/main/headers">headers</a>: contains license header files</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test">test</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/api">api</a> : karate code for automatic api testing (non-regression tests)</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/cypress">cypress</a> : cypress code for automatic ui testing</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/utils">utils</a> : karate code for manual testing</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools">tools</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic">generic</a>: Generic (as opposed to Spring-related)
utility code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic/test-utilities">test-utilities</a>: Test-specific
utility code</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/generic/utilities">utilities</a>: Utility code</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring">spring</a>: Spring-related utility code</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-mongo-utilities">spring-mongo-utilities</a> : Utility
code with Spring-specific dependencies, used to share common features across
MongoDB-dependent services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-oauth2-utilities">spring-oauth2-utilities</a> :
Utility code with Spring-specific dependencies, used to share common features
across OAuth2-dependent services</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-test-utilities">spring-test-utilities</a> : Utility
code with Spring-specific dependencies for testing purposes</p>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/spring/spring-utilities">spring-utilities</a> : Utility code with
Spring-specific dependencies</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/tools/swagger-spring-generators">swagger-spring-generators</a> : Spring
Boot generator for swagger, tailored for OperatorFabric needs</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/opfab/operatorfabric-core/tree/master/ui">ui</a>: Angular sources for the UI</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_conventions_regarding_project_structure_and_configuration"><a class="anchor" href="#_conventions_regarding_project_structure_and_configuration"></a>27.3. Conventions regarding project structure and configuration</h3>
<div class="paragraph">
<p>Sub-projects must conform to a few rules in order for the configured Gradle
tasks to work:</p>
</div>
<div class="sect3">
<h4 id="_java"><a class="anchor" href="#_java"></a>27.3.1. Java</h4>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/java
</td>
<td class="hdlist2">
<p>contains java source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/java
</td>
<td class="hdlist2">
<p>contains java tests source code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/resources
</td>
<td class="hdlist2">
<p>contains resource files</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/test/resources
</td>
<td class="hdlist2">
<p>contains test resource files</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_modeling"><a class="anchor" href="#_modeling"></a>27.3.2. Modeling</h4>
<div class="paragraph">
<p>Core services projects declaring REST APIS that use Swagger for their
definition must declare two files:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/swagger.yaml
</td>
<td class="hdlist2">
<p>Swagger API definition</p>
</td>
</tr>
<tr>
<td class="hdlist1">
[sub-project]/src/main/modeling/config.json
</td>
<td class="hdlist2">
<p>Swagger generator configuration</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_docker"><a class="anchor" href="#_docker"></a>27.3.3. Docker</h4>
<div class="paragraph">
<p>Services project all have docker image generated in their build cycle. See
<a href="#gradle_tasks">Gradle Tasks</a>
for details.</p>
</div>
<div class="paragraph">
<p>Per project configuration :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docker file : <strong>[sub-project]/src/main/docker/Dockerfile</strong></p>
</li>
<li>
<p>docker-compose file : <strong>[sub-project]/src/main/docker/docker-compose.yml</strong></p>
</li>
<li>
<p>runtime data : <strong>[sub-project]/src/main/docker/volume</strong> is copied to
<strong>[sub-project]/build/docker-volume/</strong> by task <strong>copyWorkingDir</strong>. The latest
can then be mounted as volume in docker containers.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_tools"><a class="anchor" href="#_development_tools"></a>28. Development tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scripts_bin_and_cicd"><a class="anchor" href="#_scripts_bin_and_cicd"></a>28.1. Scripts (bin and CICD)</h3>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
bin/load_environment_light.sh
</td>
<td class="hdlist2">
<p>sets up environment when <strong>sourced</strong> (java
version, gradle version, maven version, node version)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
bin/run_all.sh
</td>
<td class="hdlist2">
<p>runs all all services (see below)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
bin/setup_dockerized_environment.sh
</td>
<td class="hdlist2">
<p>generate docker images for all services</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_run_all_sh"><a class="anchor" href="#_run_all_sh"></a>28.1.1. run_all.sh</h4>
<div class="paragraph">
<p>Please see <code>run_all.sh -h</code> usage before running.</p>
</div>
<div class="paragraph">
<p>Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mongo running on port 27017 with user "root" and password "password"
(See src/main/docker/mongodb/docker-compose.yml for a pre configured instance).</p>
</li>
<li>
<p>rabbitmq running on port 5672 with user "guest" and password "guest"
(See src/main/docker/rabbitmq/docker-compose.yml for a pre configured
instance).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Ports configuration</strong>
 </summary><div> </p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">web-ui</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web ui and gateway  (Nginx server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Businessconfig service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card publication service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users management service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">card consultation service http (REST)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">businessconfig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-publication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cards-consultation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java debug port</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
<div class="sect3">
<h4 id="_setup_dockerized_environment_sh"><a class="anchor" href="#_setup_dockerized_environment_sh"></a>28.1.2. setup_dockerized_environment.sh</h4>
<div class="paragraph">
<p>Please see <code>setup_dockerized_environment.sh -h</code> usage before running.</p>
</div>
<div class="paragraph">
<p>Builds all sub-projects, generate docker images and volumes for docker-compose.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gradle_tasks"><a class="anchor" href="#gradle_tasks"></a>28.2. Gradle Tasks</h3>
<div class="paragraph">
<p>In this section only custom tasks are described. For more
information on tasks, refer to the output of the "tasks" gradle task and
to gradle and plugins official documentation.</p>
</div>
<div class="sect3">
<h4 id="_services"><a class="anchor" href="#_services"></a>28.2.1. Services</h4>
<div class="sect4">
<h5 id="_common_tasks_for_all_sub_projects"><a class="anchor" href="#_common_tasks_for_all_sub_projects"></a>28.2.1.1. Common tasks for all sub-projects</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>unitTest: runs unit tests</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other:</p>
<div class="ulist">
<ul>
<li>
<p>copyWorkingDir: copies [sub-project]/src/main/docker/volume to
[sub-project]/build/</p>
</li>
<li>
<p>copyDependencies: copy dependencies to build/libs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_core"><a class="anchor" href="#_core"></a>28.2.1.2. Core</h5>
<div class="ulist">
<ul>
<li>
<p>Swagger Generator tasks</p>
<div class="ulist">
<ul>
<li>
<p>debugSwaggerOperations: generate swagger code from
/src/main/modeling/config.json to build/swagger-analyse</p>
</li>
<li>
<p>swaggerHelp: display help regarding swagger configuration options for java</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_businessconfig_service_2"><a class="anchor" href="#_businessconfig_service_2"></a>28.2.1.3. Businessconfig Service</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestDataDir: prepare directory (build/test-data) for test data</p>
</li>
<li>
<p>compressBundle1Data, compressBundle2Data: generate tar.gz businessconfig party
configuration data for tests in build/test-data</p>
</li>
<li>
<p>prepareDevDataDir: prepare directory (build/dev-data) for bootRun task</p>
</li>
<li>
<p>createDevData: prepare data in build/test-data for running bootRun task
during development</p>
</li>
</ul>
</div>
</li>
<li>
<p>Other tasks</p>
<div class="ulist">
<ul>
<li>
<p>copyCompileClasspathDependencies: copy compile classpath dependencies,
catching lombok that must be sent for sonarqube</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_toolsgeneric"><a class="anchor" href="#_toolsgeneric"></a>28.2.1.4. tools/generic</h5>
<div class="ulist">
<ul>
<li>
<p>Test tasks</p>
<div class="ulist">
<ul>
<li>
<p>prepareTestData: copy test data from src/test/data/simple to
build/test-data/</p>
</li>
<li>
<p>compressTestArchive: compress the contents of /src/test/data/archive to
/build/test-data/archive.tar.gz</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gradle_plugins"><a class="anchor" href="#_gradle_plugins"></a>28.2.2. Gradle Plugins</h4>
<div class="paragraph">
<p>In addition to these custom tasks and standard Gradle tasks, OperatorFabric
uses several Gradle plugins, among which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/html/">Spring Boot Gradle Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/palantir/gradle-docker">Palantir Docker Gradle Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/avast/gradle-docker-compose-plugin/">Docker Compose Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/int128/gradle-swagger-generator-plugin">Gradle Swagger Generator Plugin</a></p>
</li>
<li>
<p><a href="https://github.com/asciidoctor/asciidoctor-gradle-plugin">Gradle Asciidoctor Plugin</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_useful_recipes"><a class="anchor" href="#_useful_recipes"></a>29. Useful recipes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_sub_project_from_jar_file"><a class="anchor" href="#_running_sub_project_from_jar_file"></a>29.1. Running sub-project from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>gradle :[sub-projectPath]:bootJar</p>
</li>
<li>
<p>or java -jar [sub-projectPath]/build/libs/[sub-project].jar</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_properties_when_running_from_jar_file"><a class="anchor" href="#_overriding_properties_when_running_from_jar_file"></a>29.2. Overriding properties when running from jar file</h3>
<div class="ulist">
<ul>
<li>
<p>java -jar [sub-projectPath]/build/libs/[sub-project].jar
spring.config.additional-location=file:[filepath]
NB : properties may be set using ".properties" file or ".yml" file. See
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">Spring
Boot configuration</a> for more info.</p>
</li>
<li>
<p>Generic property list extract :</p>
<div class="ulist">
<ul>
<li>
<p>server.port (defaults to 8080) : embedded server port</p>
</li>
</ul>
</div>
</li>
<li>
<p>:services:core:businessconfig-party-service properties list extract :</p>
<div class="ulist">
<ul>
<li>
<p>operatorfabric.businessconfig.storage.path (defaults to &quot;&quot;) : where to
save/load OperatorFabric Businessconfig  data</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_generating_docker_images"><a class="anchor" href="#_generating_docker_images"></a>29.3. Generating docker images</h3>
<div class="paragraph">
<p>To Generate all docker images run <code>bin/setup_dockerized_environment.sh</code>.</p>
</div>
<div class="paragraph">
<p>INFORMATION: If you work behind a proxy you need to specify the following
properties to
configure alpine apk package manager:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apk.proxy.uri: proxy http uri ex:
"http://somewhere:3128[<a href="http://somewhere:3128" class="bare">somewhere:3128</a>]" (defaults to blank)</p>
</li>
<li>
<p>apk.proxy.httpsuri: proxy http uri ex:
"http://somewhere:3128[<a href="http://somewhere:3128" class="bare">somewhere:3128</a>]" (defaults to apk.proxy.uri
value)</p>
</li>
<li>
<p>apk.proxy.user: proxy user</p>
</li>
<li>
<p>apk.proxy.password: proxy <strong>unescaped</strong> password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alternatively, you may configure the following environment variables :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>APK_PROXY_URI</p>
</li>
<li>
<p>APK_PROXY_HTTPS_URI</p>
</li>
<li>
<p>APK_PROXY_USER</p>
</li>
<li>
<p>APK_PROXY_PASSWORD</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a>30. Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p> <details><summary> 
<strong>Proxy error when running businessconfig-party docker-compose</strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Pulling rabbitmq (rabbitmq:3-management)...
ERROR: Get https://registry-1.docker.io/v2/: Proxy Authentication Required</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>When running docker-compose files using businessconfig-party images(such as rabbitmq,
mongodb etc.) the first time, docker will need to pull these images from
their repositories.
If the docker proxy isn&#8217;t set properly, you will see the above message.</p>
</div>
<div class="paragraph">
<p>To set the proxy, follow <a href="https://docs.docker.com/config/daemon/systemd/">these
steps from the docker documentation</a>.</p>
</div>
<div class="paragraph">
<p>If your proxy needs authentication, add your user and password as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP_PROXY=http://user:password@proxy.example.com:80/</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The password should be URL-encoded.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Gradle Metaspace error</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>Gradle task (for example gradle build) fails with the following error:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>* What went wrong:
Metaspace</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>Issue with the Gradle daemon. Stopping the daemon using <code>gradle --stop</code>
and re-launching the build should solve this issue.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>Java version not available when setting up environment</strong>
 </summary><div> 
When sourcing the <a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a>
script to set up your environment, you might get the following error message:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Stop! java 8.0.192-zulu is not available. Possible causes:
 * 8.0.192-zulu is an invalid version
 * java binaries are incompatible with Linux64
 * java has not been released yet</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select the next available version and update
<a href="https://github.com/opfab/operatorfabric-core/blob/master/bin/load_environment_light.sh">load_environment_light</a> accordingly before
sourcing it again.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The java version currently listed in the script might have been deprecated
(for security reasons) or might not be available for your operating system
(for example, 8.0.192-zulu wasn&#8217;t available for Ubuntu).</p>
</div>
<div class="paragraph">
<p>Run <code>sdk list java</code> to find out which versions are available. You will get
this kind of output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>================================================================================
Available Java Versions
================================================================================
     13.ea.16-open       9.0.4-open          1.0.0-rc-11-grl
     12.0.0-zulu         8.0.202-zulu        1.0.0-rc-10-grl
     12.0.0-open         8.0.202-amzn        1.0.0-rc-9-grl
     12.0.0-librca       8.0.202.j9-adpt     1.0.0-rc-8-grl
     11.0.2-zulu         8.0.202.hs-adpt
     11.0.2-open         8.0.202-zulufx
     11.0.2-amzn         8.0.202-librca
     11.0.2.j9-adpt      8.0.201-oracle
     11.0.2.hs-adpt  &gt; + 8.0.192-zulu
     11.0.2-zulufx       7.0.211-zulu
     11.0.2-librca       6.0.119-zulu
     11.0.2-sapmchn      1.0.0-rc-15-grl
     10.0.2-zulu         1.0.0-rc-14-grl
     10.0.2-open         1.0.0-rc-13-grl
     9.0.7-zulu          1.0.0-rc-12-grl

================================================================================
+ - local version
* - installed
&gt; - currently in use
================================================================================</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>BUILD FAILED with message <code>Execution failed for task ':ui:main-user-interface:npmInstall'.</code></strong>
 </summary><div> </p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>FAILURE: Build failed with an exception.

    What went wrong:
    Execution failed for task ':ui:main-user-interface:npmInstall'.</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>A <code>sudo</code> has been used before the <code>./gradlew assemble</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Don&#8217;t use <strong>sudo</strong> to build OperatorFabric otherwise unexpected problems could arise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl get Failed to connect to localhost:2002: Connection refused</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/ui/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>curl: (7) Failed to connect to localhost port 2002: Connexion refused</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The <code>web-ui</code> docker container stops running. Check its configuration.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by ngnix</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/thirds/</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>&lt;html&gt;
&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.17.10&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested page is not or no more mapped by the <code>nginx.conf</code> of <code>web-ui</code>.
Update it or check for the new end point of the desired page.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig</code> replaces now the former <code>thirds</code> end-point.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong>curl 404 status return by OperatorFabric</strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>curl http://localhost:2002/businessconfig/ -H "Authorization: Bearer ${token}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid OAuth2 JWT.</p>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>{"timestamp":"XXXX-XX-XXTXX:XX:XX.XXX+00:00","status":404,"error":"Not Found","message":"","path":"/businessconfig"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>XXXX-XX-XXTXX:XX:XX.XXX+00:00</code> is a time stamp corresponding to the moment when the request has been sent.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>The requested end-point is not or no more valid in <code>OperatorFabric</code>.
Check the API documentation for correct path.</p>
</div>
<div class="paragraph">
<p>For this example, <code>businessconfig/processes</code> is a correct end-point whereas <code>businessconfig</code> alone is not.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>ERROR: for web-ui</code> when running docker-compose in <code>${OF_HOME}/config/dev</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>ERROR: for web-ui  Cannot start service web-ui: OCI runtime create failed: container_linux.go:345: starting container process caused "process_linux.go:430: container init caused \"rootfs_linux.go:58: mounting \\\"/home/legallron/projects/operatorfabric-core/config/dev/nginx.conf\\\" to rootfs </code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code></code> is specific to the runtime environment.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is no <code>nginx.conf</code> file in the <code>${OF_HOME}/conf/dev</code> directory.</p>
</div>
<div class="paragraph">
<p>A first run of OperatorFabric <code>docker-compose</code> in dev config needs a <code>nginx.conf</code> file.
To create it, and run a docker-compose environment use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>If docker-compose has created a <code>nginx.conf</code> directory, delete it before running the previous commands.</p>
</div>
<div class="paragraph">
<p>Once this <code>nginx.conf</code> file created a simple <code>docker-compose up -d</code> is enough to run a dev docker-compose environment.
Sometimes a <code>nginx.conf</code> has been created as an attempt to launch the <code>web-ui</code> docker.
See the following section to resolve this.</p>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>/docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code> when running <code>${OF_HOME}/config/dev/docker-compose.sh</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
./docker-compose.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>./docker-compose.sh: ligne 7: ./nginx.conf: is a folder</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Possible causes</div>
<p>A <code>docker-compose up</code> has been run previously without <code>nginx.conf</code>.
A folder named <code>nginx.conf</code> has been created by <code>docker-compose</code>.</p>
</div>
<div class="paragraph">
<div class="title">Resolution</div>
<p>You have rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
rm -rf nginx.conf
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don&#8217;t have the rights to delete the folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/config/dev
docker run -ti --rm -v $(pwd):/current alpine # if there is no `alpine` docker available it will pull it from dockerHub
# your are now in the alpine docker container
cd /current
rm -rf nginxconf
&lt;ctrl-d&gt; # to exit the `alpine` container bash environement
./docker-compose.sh # if you want to run OperatorFabric directly after.
cd ${OF_HOME}
bin/run_all.sh start</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
<div class="paragraph">
<p> <details><summary> 
<strong><code>An unhandled exception occurred: Call retries were exceeded</code> occurs when using <code>ng build</code></strong>
 </summary><div> </p>
</div>
<div class="paragraph">
<p>When using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ${OF_HOME}/ui/main
ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following error appears:</p>
</div>
<div class="listingblock">
<div class="title">Error message</div>
<div class="content">
<pre class="CodeRay highlight"><code>Generating ES5 bundles for differential loading...
An unhandled exception occurred: Call retries were exceeded
See "/tmp/ng-&lt;random-string&gt;/angular-errors.log" for further details.</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ng-&lt;random-string&gt;</code> is a temporary folder created by Angular to build the front-end.</p>
</div>
<div class="paragraph">
<div class="title">Possible causes &amp; resolution</div>
<p>There is not enough allocated memory space to build the front-end.</p>
</div>
<div class="paragraph">
<p>Use the following command to solve the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">node --max_old_space_size=4096 node_modules/@angular/cli/bin/ng build</code></pre>
</div>
</div>
<div class="paragraph">
<p> </div></details> </p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak_configuration"><a class="anchor" href="#_keycloak_configuration"></a>31. Keycloak Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration needed for development purposes is automatically loaded from the dev-realms.json file.
However, the steps below describe how they can be reproduced from scratch on a blank Keycloak instance in case you
want to add to it.</p>
</div>
<div class="paragraph">
<p>The Keycloak Management interface is available here:  [host]:89/auth/admin
Default credentials are admin/admin.</p>
</div>
<div class="sect2">
<h3 id="_add_realm"><a class="anchor" href="#_add_realm"></a>31.1. Add Realm</h3>
<div class="ulist">
<ul>
<li>
<p>Click top left down arrow next to Master</p>
</li>
<li>
<p>Add Realm</p>
</li>
<li>
<p>Name it dev (or whatever)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup_at_least_one_client_or_best_one_per_service"><a class="anchor" href="#_setup_at_least_one_client_or_best_one_per_service"></a>31.2. Setup at least one client (or best one per service)</h3>
<div class="sect3">
<h4 id="_create_client"><a class="anchor" href="#_create_client"></a>31.2.1. Create client</h4>
<div class="ulist">
<ul>
<li>
<p>Click Clients in left menu</p>
</li>
<li>
<p>Click Create Button</p>
</li>
<li>
<p>Set client ID to "opfab-client" (or whatever)</p>
</li>
<li>
<p>Select Openid-Connect Protocol</p>
</li>
<li>
<p>Enable Authorization</p>
</li>
<li>
<p>Access Type to Confidential</p>
</li>
<li>
<p>save</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_add_a_role_to_client"><a class="anchor" href="#_add_a_role_to_client"></a>31.2.2. Add a Role to Client</h4>
<div class="ulist">
<ul>
<li>
<p>In client view, click Roles tab</p>
</li>
<li>
<p>Click Add button</p>
</li>
<li>
<p>create a USER role (or whatever)</p>
</li>
<li>
<p>save
== create a Mapper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Used to map the user name to a field that suits services</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name it sub</p>
</li>
<li>
<p>set mapper type to User Property</p>
</li>
<li>
<p>set Property to username</p>
</li>
<li>
<p>set Token claim name to sub</p>
</li>
<li>
<p>enable add to access token</p>
</li>
<li>
<p>save</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_users"><a class="anchor" href="#_create_users"></a>31.3. Create Users</h3>
<div class="ulist">
<ul>
<li>
<p>Click Users in left menu</p>
</li>
<li>
<p>Click Add User button</p>
</li>
<li>
<p>Set username to admin</p>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>Select Role Mappings tab</p>
</li>
<li>
<p>Select "opfab-client" in client roles combo (or whatever id you formerly chose)</p>
</li>
<li>
<p>Select USER  as assigned role (or whatever role you formerly created)</p>
</li>
<li>
<p>Select Credentials tab</p>
</li>
<li>
<p>set password and confirmation to "test"
*</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>repeat process for other users:
operator3, operator1, operator2</p>
</div>
<div class="sect3">
<h4 id="_development_specific_configuration"><a class="anchor" href="#_development_specific_configuration"></a>31.3.1. Development-specific configuration</h4>
<div class="paragraph">
<p>To facilitate development, in  the configuration file provided in the git (dev-realms.json) ,session are set to have
a duration of 10 hours (36000 seconds) and SSL is not required. These parameters should not be used in production.</p>
</div>
<div class="paragraph">
<p>The following parameters are set :
accessTokenLifespan : 36000
ssoSessionMaxLifespan : 36000
accessCodeLifespan" : 36000
accessCodeLifespanUserAction : 36000
sslRequired : none</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_oauth2_token_with_the_cli"><a class="anchor" href="#_using_oauth2_token_with_the_cli"></a>32. Using OAuth2 token with the CLI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_a_token_2"><a class="anchor" href="#_get_a_token_2"></a>32.1. Get a token</h3>
<div class="paragraph">
<p>End point: <code><a href="http://localhost:2002/auth/token" class="bare">localhost:2002/auth/token</a></code></p>
</div>
<div class="paragraph">
<p>Method: <code>POST</code></p>
</div>
<div class="paragraph">
<p>Body arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>client_id: <code>string</code> constant=<code>clientIdPassword</code>;</p>
</li>
<li>
<p>grant_type: <code>string</code> constant=<code>password</code>;</p>
<div class="ulist">
<ul>
<li>
<p>username: <code>string</code> any value, must match an OperatorFabric registered user name;</p>
</li>
</ul>
</div>
</li>
<li>
<p>password: <code>string</code> any value;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following examples will be for <code>admin</code> user.</p>
</div>
<div class="sect3">
<h4 id="_curl"><a class="anchor" href="#_curl"></a>32.1.1. Curl</h4>
<div class="paragraph">
<p>command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"username=admin&amp;password=test&amp;grant_type=password&amp;client_id=clientIdPassword"
http://localhost:2002/auth/token</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cC
I6MTU1MjY1OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOi
IwMmQ4MmU4NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZF
Bhc3N3b3JkIiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0
rWVtFGAZzRHj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdK
VAz0CkMKqng4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVD
SJew1rj5EiSybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZC
AYVM-mmHbjk8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw","to
ken_type":"bearer","refresh_token":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWI
iOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLCJ1c2VyX2luZm8iXSwiYXRpIjoiMDJkODJlODUtMTNmMC0
0Njc4LTk3NGQtMThlYjA2MjE1YTY1IiwiZXhwIjoxNTUyNzAxMTM4LCJhdXRob3JpdGllcyI6WyJST0x
FX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aSI6IjMwOWY2ZDllLWNmOGEtNDg0YS05ZjMxLWViOTAxYzk
4YTFkYSIsImNsaWVudF9pZCI6ImNsaWVudElkUGFzc3dvcmQifQ.jnZDt6TX2BvlmdT5JV-A7eHTJz_s
lC5fHrJFVI58ly6N7AUUfxebG_52pmuVHYULSKqTJXaLR866r-EnD4BJlzhk476FtgtVx1nazTpLFRLb
8qDCxeLrzClQBkzcxOt6VPxB3CD9QImx3bcsDwjkPxofUDmdg8AxZfGTu0PNbvO8TKLXEkeCztLFvSJM
GlN9zDzWhKxr49I-zPZg0XecgE9j4WITkFoDVwI-AfDJ3sGXDi5AN55Sz1j633QoqVjhtc0lO50WPVk5
YT7gU8HLj27EfX-6vjnGfNb8oeq189-NX100QHZM9Wgm79mIm4sRgwhpv-zzdDAkeb3uwIpb8g","exp
ires_in":1799,"scope":"read
user_info","jti":"02d82e85-13f0-4678-974d-18eb06215a65"}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie"><a class="anchor" href="#_httpie"></a>32.1.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/token username=admin password=test
grant_type=password client_id=clientIdPassword</pre>
</div>
</div>
<div class="paragraph">
<p>example of expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.HTTP/1.1 200 OK
Cache-Control: no-store
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 13:57:19 GMT
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "access_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOS
wiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yz
g3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2
NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd
3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST
8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge
8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfD
J6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q",
    "expires_in": 1799,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "refresh_token":
"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsInNjb3BlIjpbInJlYWQiLC
J1c2VyX2luZm8iXSwiYXRpIjoiNjI0MzA5YjEtN2M4Ny00Y2RjLTg0NDMtMDEyNDUxNWY4N2Y4IiwiZX
hwIjoxNTUyNzAxNDM5LCJhdXRob3JpdGllcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImp0aS
I6ImRiYzMxNTJiLTM4YTUtNGFmZC1hY2VmLWVkZTI4MjJkOTE3YyIsImNsaWVudF9pZCI6ImNsaWVudE
lkUGFzc3dvcmQifQ.Ezd8kbfNQHOOvUCNNN4UmOOkncHiT9QVEM63FiW1rq0uXDa3xfBGil8geM5MsP0
7Q2He-mynkFb8sGNDrAXTdO-8r5o4a60zWrktrMg2QH4icC1lyeZpiwZxe6675QpLpSeMlXt9PdYj-pb
14lrRookxXP5xMQuIMteZpbtby7LuuNAbNrjveZ1bZ4WMi7zltUzcYUuqHlP1AYPteGRrJVKXiuPpoDv
gwMsEk2SkgyyACI7SdZZs8IT9IGgSsIjjgTMQKzj8P6yYxNLUynEW4o5y1s2aAOV0xKrzkln9PchH9zN
qO-fkjTVRjy_LBXGq9zkn0ZeQ3BUe1GuthvGjaA",
    "scope": "read user_info",
    "token_type": "bearer"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token"><a class="anchor" href="#_extract_token"></a>32.2. Extract token</h3>
<div class="paragraph">
<p>From the previous results, the data need to be considered to be authenticated by OperatorFabric services is the content of the <code>"access_token"</code> attribute of the body response.</p>
</div>
<div class="paragraph">
<p>Once this value extracted, it need to be passed at the end of the value of the http HEADER of type <code>Authorization:Bearer</code>. Note that a space is needed between <code>Bearer</code> and token actual value.
example from previous results:</p>
</div>
<div class="sect3">
<h4 id="_curl_2"><a class="anchor" href="#_curl_2"></a>32.2.1. Curl</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1OTczOCw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4NS0xM2Y
wLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzRHj7KPga
OXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqng4kQeQm
_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5EiSybuy83
PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbjk8mF89f
L9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_2"><a class="anchor" href="#_httpie_2"></a>32.2.2. Httpie</h4>
<div class="listingblock">
<div class="content">
<pre>Authorization:Bearer
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2MDAzOSw
iYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliMS03Yzg
3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkIiwic2N
vcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2qFa5Bd3
PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lHDd8ST8
fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNXJ4Bge8
scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeApKdfDJ
6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_a_token"><a class="anchor" href="#_check_a_token"></a>32.3. Check a token</h3>
<div class="sect3">
<h4 id="_curl_3"><a class="anchor" href="#_curl_3"></a>32.3.1. Curl</h4>
<div class="paragraph">
<p>from previous example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -s -X POST -d
"token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY1
OTczOCwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiIwMmQ4MmU4
NS0xM2YwLTQ2NzgtOTc0ZC0xOGViMDYyMTVhNjUiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3Jk
Iiwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.SDg-BEzzonIVXfVBnnfq0oMbs_0rWVtFGAZzR
Hj7KPgaOXT3bUhQwPOgggZDO0lv2U1klwB94c8Cb6rErzd3yjJ8wcVcnFLO4KxrjYZZxdKVAz0CkMKqn
g4kQeQm_1UShsQXGLl48ezbjXyJn6mAl0oS4ExeiVsx_kYGEdqjyb5CiNaAzyx0J-J5jVDSJew1rj5Ei
Sybuy83PZwhluhxq0D2zPK1OSzqiezsd5kX5V8XI4MipDhaAbPYroL94banZTn9RmmAKZCAYVM-mmHbj
k8mF89fL9rKf9EUNhxOG6GE0MDqB3LLLcyQ6sYUmpqdP5Z94IkAN-FpC7k93_-RDw"
http://localhost:2002/auth/check_token</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    "sub":"admin",
    "scope":["read","user_info"],
    "active":true,"exp":1552659738,
    "authorities":["ROLE_ADMIN","ROLE_USER"],
    "jti":"02d82e85-13f0-4678-974d-18eb06215a65",
    "client_id":"clientIdPassword"
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_3"><a class="anchor" href="#_httpie_3"></a>32.3.2. Httpie</h4>
<div class="paragraph">
<p>from previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http --form POST http://localhost:2002/auth/check_token
token=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1MjY2M
DAzOSwiYXV0aG9yaXRpZXMiOlsiUk9MRV9BRE1JTiIsIlJPTEVfVVNFUiJdLCJqdGkiOiI2MjQzMDliM
S03Yzg3LTRjZGMtODQ0My0wMTI0NTE1Zjg3ZjgiLCJjbGllbnRfaWQiOiJjbGllbnRJZFBhc3N3b3JkI
iwic2NvcGUiOlsicmVhZCIsInVzZXJfaW5mbyJdfQ.VO4OZL7ycqNez0cHzM5WPuklr0r6SAOkUdUV2q
Fa5Bd3PWx3DFHAHUxkfSX0-R4OO6iG2Zu7abzToAZNVLwk107LH_lWXOMQBriGx3d2aSgCf1yx_wI3lH
Dd8ST8fxV7uNeolzywYavSpMGfgz9GXLzmnyeuPH4oy7eyPk9BwWVi0d7a_0d-EfhE1T8eaiDfymzzNX
J4Bge8scPy-93HmWpqORtJaFq1qy4QgU28N2LgHFEEEWCSzfhYXH-LngTCP3-JSNcox1hI51XBWEqoeA
pKdfDJ6o4szR71SIFCBERxCH9TyUxsFywWL3e-YnXMiP2J08eB8O4YwhYQEFqB8Q</pre>
</div>
</div>
<div class="paragraph">
<p>which gives the following example of result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Content-Type: application/json;charset=utf-8
Date: Fri, 15 Mar 2019 14:19:31 GMT
Expires: 0
Pragma: no-cache
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
transfer-encoding: chunked

{
    "active": true,
    "authorities": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "client_id": "clientIdPassword",
    "exp": 1552660039,
    "jti": "624309b1-7c87-4cdc-8443-0124515f87f8",
    "scope": [
        "read",
        "user_info"
    ],
    "sub": "admin"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_token_2"><a class="anchor" href="#_extract_token_2"></a>32.4. Extract token</h3>
<div class="paragraph">
<p>The utility <code>jq</code>, sadly not always available on some Linux distro, parses json input and extracts requested json path value(<code>access_token</code> here).
Here is a way to do so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell"> curl -d &quot;username=${user}&amp;password=${password}&amp;grant_type=password&amp;client_id=opfab-client&quot; &quot;http://localhost:2002/auth/token&quot; | jq -r .access_token</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${user}</code>: login existing on keycloak for operatorfabric;</p>
</li>
<li>
<p><code>${password}</code>: password for the previous login in keycloak;</p>
</li>
<li>
<p><code>opfab-client</code>:  is the id of the client for OperatorFabric associated to the <code>dev</code> realm in Keycloak in a <code>dev</code>(<code>${OF_HOME/config/dev</code>) or <code>docker</code>(<code>${OF_HOME/config/docker</code>) configuration of operatorFabric.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>-r</code> option, for raw, leaves the output without any quotes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_implementation"><a class="anchor" href="#_kafka_implementation"></a>33. Kafka Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Next to publishing cards to OperatorFabric using the REST API, OperatorFabric also supports publishing cards via a Kafka Topic.
In the default configuration Kafka is disabled.</p>
</div>
<div class="sect2">
<h3 id="_enabling_kafka"><a class="anchor" href="#_enabling_kafka"></a>33.1. Enabling Kafka</h3>
<div class="paragraph">
<p>To enable Kafka support you need to set the <code>kafka.consumer.group_id property</code> in the cards-publication yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">kafka</span>:
    <span class="key">consumer</span>:
      <span class="key">group-id</span>: <span class="string"><span class="content">opfab-command</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default topic from which the messages are consumed is called 'opfab'. This setting can be modified by setting 'opfab.kafka.card.topics.topicname'.</p>
</div>
<div class="paragraph">
<p>Make sure you also set the registry to either an empty string (<code>""</code>) or to the server providing the schema registry service.
With the default settings, the Kafka consumer expects a broker running on http//127.0.0.1:9092 and a schema registry on <a href="http://127.0.0.1:8081" class="bare">127.0.0.1:8081</a>.
<a href="#_cards_publication_service">Cards-publication service</a> for more settings.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.confluent.io/current/schema-registry/index.html">Schema management</a> for detailed information on using and benefits of a schema registry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operatorfabric_kafka_source_code"><a class="anchor" href="#_operatorfabric_kafka_source_code"></a>33.2. OperatorFabric Kafka source code</h3>

</div>
<div class="sect2">
<h3 id="_listener_deserializer"><a class="anchor" href="#_listener_deserializer"></a>33.3. Listener / deserializer</h3>
<div class="paragraph">
<p>Most of the OperatorFabric Kafka implementation can be found at</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>org.lfenergy.operatorfabric.cards.publication.kafka</code></dt>
<dd>
<p>for
the implementation of the deserializers and mapping of Kafka topics to OperatorFabric cards and</p>
</dd>
<dt class="hdlist1"><code>org.lfenergy.operatorfabric.autoconfigure.kafka</code> </dt>
<dd>
<p>for the various Kafka configuration options.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_kafka_operatorfabric_avro_schema"><a class="anchor" href="#_kafka_operatorfabric_avro_schema"></a>33.3.1. Kafka OperatorFabric AVRO schema</h4>
<div class="paragraph">
<p>The AVRO schema, the byte format in which messages are transferred using Kafka topics, can be found at <code>client/src/main/avro</code>.
Message are wrapped in a CardCommand object before being sent to a Kafka topic.
This object is an almost one-to-one mapping of the OperatorFabric card, see also <a href="#card_structure">Card Structure</a>. The exceptions are  <code>Process</code> and
<code>Process Instance Identifier</code>, which are moved to the top-level CardCommand.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_kafka"><a class="anchor" href="#_configure_kafka"></a>33.4. Configure Kafka</h3>
<div class="sect3">
<h4 id="_setting_a_new_deserializer"><a class="anchor" href="#_setting_a_new_deserializer"></a>33.4.1. Setting a new deserializer</h4>
<div class="paragraph">
<p>By default, OperatorFabric uses the  <code>io.confluent.kafka.serializers.KafkaAvroDeserializer</code> from <a href="https://www.confluent.io/">Confluent</a>. However, you can write your own
deserializer. To use your own deserializer, make sure
<code>spring.deserializer.value.delegate.class</code> points to your deserializer.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_card_producer"><a class="anchor" href="#_kafka_card_producer"></a>33.5. Kafka card producer</h3>
<div class="paragraph">
<p>To send a CardCommand to OperatorFabric, start by implementing a simple Kafka producer by following for example <a href="https://docs.spring.io/spring-kafka/reference/html/">Spring for Apache Kafka</a>.
Note that some properties of CardCommand or its embedded Card are required. If not set, the card will be rejected by OperatorFabric.</p>
</div>
<div class="paragraph">
<p>When you dump the card (which is about to be put on a topic) to stdout, you should see something like the line below. Do ignore the actual values from
the dump below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">command</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE_CARD</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">integrationTest</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processInstanceId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fa6ce61f-192f-11eb-a6e3-eea952defe56</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">card</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">parentCardUid</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myFirstPublisher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">publishDate</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">lttd</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">startDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1603897942000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">endDate</span><span class="delimiter">&quot;</span></span>: <span class="integer">1604070742000</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">severity</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timeSpans</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.title</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstUserTask.summary</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">userRecipients</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso1-operator</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">tso2-operator</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">groupRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">externalRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesAllowedToRespond</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">entityRecipients</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">hasBeenAcknowledged</span><span class="delimiter">&quot;</span></span>: <span class="value">null</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="char">\&quot;</span><span class="content">action</span><span class="char">\&quot;</span><span class="content">:</span><span class="char">\&quot;</span><span class="content">Just do something</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_response_cards"><a class="anchor" href="#_response_cards"></a>33.6. Response Cards</h3>
<div class="paragraph">
<p>OperatorFabric <a href="#response_cards">Response cards</a> can be sent by REST of put on a Kafka topic. The Kafka response card configuration follows the
convention to configure a REST endpoint. Instead of setting the 'http://host/api' URL, you set it to 'kafka:response-topic' in the <code>externalRecipients-url:</code>
section from the cards-publication.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">externalRecipients-url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">{\
           processAction: \&quot;http://localhost:8090/test\&quot;, \
           mykafka: \&quot;kafka:topicname\&quot;
           }</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>topicname</code> is a placeholder for now. All response cards are returned via the same Kafka topic.</p>
</div>
</div>
</div>
</div>
<h1 id="_operatorfabric_community" class="sect0"><a class="anchor" href="#_operatorfabric_community"></a>OperatorFabric Community</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The aim of this document is to present the OperatorFabric community, its code of conduct and to welcome contributors!</p>
</div>
<div class="paragraph">
<p>First of all, thank you for your interest !</p>
</div>
<div class="paragraph">
<p>We can&#8217;t stress enough that feedback, discussions, questions and contributions on OperatorFabric are very much
appreciated.
However, because the project is still in its early stages, we&#8217;re not fully equipped for any of it yet, so please bear
with us while the contribution process and tooling are sorted out.</p>
</div>
<div class="paragraph">
<p>This project is governed by the <a href="../pdf/technical-charter.pdf">OperatorFabric Technical Charter</a>.</p>
</div>
<div class="paragraph">
<p>This project applies the LF Energy Code of Conduct. By participating, you are expected to uphold this code.
Please report unacceptable behavior to <a href="mailto:opfab_AT_lists.lfenergy.org">opfab_AT_lists.lfenergy.org</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license_and_developer_certificate_of_origin"><a class="anchor" href="#_license_and_developer_certificate_of_origin"></a>34. License and Developer Certificate of Origin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OperatorFabric is an open source project licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License 2.0</a>.
By contributing to OperatorFabric, you accept and agree to the terms and conditions for your present and future
contributions submitted to OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The project also uses a mechanism known as a <a href="https://developercertificate.org/">Developer Certificate of Origin (DCO)</a>
to ensure that we are legally allowed to distribute all the code and assets for the project. A DCO is a legally binding
statement that asserts that you are the author of your contribution, and that you wish to allow OperatorFabric to use
your work.</p>
</div>
<div class="paragraph">
<p>Contributors sign-off that they adhere to these requirements by adding a <code>Signed-off-by</code> line to commit messages. All
commits to any repository of the OperatorFabric organization have to be signed-off like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This is my commit message.

Signed-off-by: John Doe &lt;john.doe@email-provider.com&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You can write it manually but Git has a -s command line option to append it automatically to your commit message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git commit -s -m 'This is my commit message'</pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the future a check will be performed during the integration, making sure all commits in the Pull Request
contain a valid <code>Signed-off-by</code> line.</p>
</div>
<div class="paragraph">
<p>These processes and templates have been adapted from the ones defined by the <a href="https://github.com/powsybl">PowSyBl</a>
project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reporting_bugs_and_suggesting_enhancements"><a class="anchor" href="#_reporting_bugs_and_suggesting_enhancements"></a>35. Reporting Bugs and Suggesting Enhancements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reporting bug and suggesting enhancements shall be done via issues on github.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_code_or_documentation"><a class="anchor" href="#_contributing_code_or_documentation"></a>36. Contributing Code or Documentation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contribution_workflow"><a class="anchor" href="#_contribution_workflow"></a>36.1. Contribution Workflow</h3>
<div class="paragraph">
<p>The project started out using a
<a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow">Feature Branch workflow</a>, but
as the project team grew and we needed to manage support to previous releases we decided to switch to a workflow
based on the
<a href="https://nvie.com/posts/a-successful-git-branching-model/">Git Flow workflow</a>, starting after version 1.3.0.RELEASE.</p>
</div>
<div class="paragraph">
<p>The principles for this workflow were first described in the blog post linked above, and this document attempts to
summarize how we adapted it to our project. Statements in quotes are from the original blog post.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this document, <strong>"repository version"</strong> refers to the version defined in the VERSION file at the root of the
project, which is a parameter for certain build tasks and for our CICD pipeline.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_principles"><a class="anchor" href="#_principles"></a>36.1.1. Principles</h4>
<div class="sect4">
<h5 id="_develop_branch"><a class="anchor" href="#_develop_branch"></a>36.1.1.1. <code>develop</code> branch</h5>
<div class="paragraph">
<p>The role of the <code>develop</code> branch is quite similar to that of the <code>master</code> branch in our previous "Feature Branch"
workflow.</p>
</div>
<div class="paragraph">
<p>The <code>develop</code> branch is where feature branches are branched off from, and where they&#8217;re merged back to. This way,
the HEAD of the <code>develop</code> branch <em>"always reflects a state with the latest delivered development changes for the next
release"</em>.</p>
</div>
<div class="paragraph">
<p>The repository version on the <code>develop</code> branch should always be <code>SNAPSHOT</code>.</p>
</div>
<div class="paragraph">
<p>The daily CRON Travis job generating the documentation and docker images for the <code>SNAPSHOT</code> version are run from
this branch (see our
<a href="#CICD">CICD documentation</a>
for details).</p>
</div>
</div>
<div class="sect4">
<h5 id="_master_branch"><a class="anchor" href="#_master_branch"></a>36.1.1.2. <code>master</code> branch</h5>
<div class="paragraph">
<p><em>"When the source code in the develop branch reaches a stable point and is ready to be released, all of the changes
should be merged back into master somehow and then tagged with a release number."</em></p>
</div>
<div class="paragraph">
<p>This means that any commit on master is a production-ready release, be it a patch, a minor or a major version.</p>
</div>
<div class="paragraph">
<p>Any commit on <code>master</code> triggers a Travis build generating and pushing documentation and docker images for the
corresponding release version. If the <code>ci_latest</code> keyword is used in the commit message, the docker images are also
tagged with <code>latest</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_feature_branches"><a class="anchor" href="#_feature_branches"></a>36.1.1.3. Feature branches</h5>
<div class="paragraph">
<p>Feature branches are used to develop new features or fix bugs <strong>for the next release</strong>. The version number for this next
release is usually not known during the developments as it is its final contents that will determine whether it&#8217;s a
major or minor version (or even a simple patch).
By contrast, hotfix branches fix bugs in existing releases and give rise to new patches.</p>
</div>
<div class="paragraph">
<p>The lifecycle of feature branches is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A new feature branch is branched off <code>develop</code> before starting work on a feature or bug.</p>
</li>
<li>
<p>Once the developments are deemed ready by the developer(s) working on the feature, a pull request should be created
for this branch.</p>
</li>
<li>
<p>New pull requests are discussed during daily meetings to assign someone from the Reviewers group to the issue.</p>
</li>
<li>
<p>The pull request author and reviewer(s) then make use of the
<a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-requests">Git Hub pull requests</a>
features (comments, proposed changes, etc.) to make changes to the PR until it meets the project requirements.</p>
</li>
<li>
<p>Once it is ready to be included in the next version, the pull request is then merged back into <code>develop</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Naming convention:</strong> Feature branches names should always start with the reference of the JIRA issue they&#8217;re addressing,
optionally followed by additional information if several branches are associated with a given JIRA issue.</p>
</div>
<div class="ulist">
<div class="title">Examples of valid feature branch names:</div>
<ul>
<li>
<p>OC-123</p>
</li>
<li>
<p>OC-123_Documentation</p>
</li>
<li>
<p>OC-123_1</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Examples of invalid feature branch names:</div>
<ul>
<li>
<p>123</p>
</li>
<li>
<p>OC123</p>
</li>
<li>
<p>SomeTextDescribingTheBranch</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Commit messages should also start with the JIRA issue ID between brackets: <code>[OC-123] My commit message</code></p>
</div>
<div class="paragraph">
<p>This allows the branch, PR and commits to be directly accessible from the JIRA issue.</p>
</div>
</div>
<div class="sect4">
<h5 id="_release_branches"><a class="anchor" href="#_release_branches"></a>36.1.1.4. Release branches</h5>
<div class="paragraph">
<p>Once developments are in a release-ready state and have been tested on the <code>develop</code> branch, a release branch should
be created off <code>develop</code> to prepare the merge into master.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>"All features that are targeted for the release-to-be-built must be merged in to develop at this point in time.
All features targeted at future releases may notthey must wait until after the release branch is branched off."</em>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By contrast to what is described in the <a href="https://nvie.com/posts/a-successful-git-branching-model/">original blog post</a>, for now we have chosen to
only create the release branch once the developments are completely ready and tested on the develop branch, so that no
fixes should be made on the release branch. This simplifies things because it means that release branches don&#8217;t have to
be merged back into <code>develop</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the <code>X.X.X.release</code> branch has been created, a new commit should be made on this branch to change the repository
version from <code>SNAPSHOT</code> to <code>X.X.X.RELEASE</code>.
Then, pushing the branch will trigger a build and a "dry-run" generation of documentation and docker images. The aim
is to detect any issue with this generation before moving to master.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>X.X.X.release</code> can be merged into <code>master</code>, triggering
The resulting merge commit on <code>master</code> should then be tagged with <code>X.X.X.RELEASE</code>.</p>
</div>
<div class="paragraph">
<p>All commits on <code>master</code> should be merge commits from <code>release</code> branches, direct pushes on master will be disabled.</p>
</div>
<div class="paragraph">
<p><strong>Naming convention:</strong> The name of a release branch should match the repository version it is meant to merge into
<code>master</code> but in lower case to avoid confusion with release tags on master.</p>
</div>
<div class="paragraph">
<p>Example: The valid branch name for the branch bringing 1.3.0.RELEASE into <code>master</code> is 1.3.0.release</p>
</div>
</div>
<div class="sect4">
<h5 id="_hotfix_branches"><a class="anchor" href="#_hotfix_branches"></a>36.1.1.5. Hotfix branches</h5>
<div class="paragraph">
<p>Work in progress: detail hotfix branches lifecycle and constraints.</p>
</div>
<div class="paragraph">
<p><strong>Naming convention:</strong> Hotfix branches names should always start with "HF_" and the reference of the JIRA issue they&#8217;re
addressing, optionally followed by additional information if several branches are associated with a given JIRA issue.</p>
</div>
<div class="ulist">
<div class="title">Examples of valid hotfix branch names:</div>
<ul>
<li>
<p>HF_OC-123</p>
</li>
<li>
<p>HF_OC-123_Documentation</p>
</li>
<li>
<p>HF_OC-123_1</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Examples of invalid hotfix branch names:</div>
<ul>
<li>
<p>123</p>
</li>
<li>
<p>OC-123</p>
</li>
<li>
<p>OC123</p>
</li>
<li>
<p>HF_SomeTextDescribingTheFix</p>
</li>
<li>
<p>SomeTextDescribingTheFix</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_and_commands"><a class="anchor" href="#_examples_and_commands"></a>36.1.2. Examples and commands</h4>
<div class="paragraph">
<p>The aim of this section is to illustrate how our workflow works on a concrete example, complete with the required
<code>git</code> commands.</p>
</div>
<div class="sect4">
<h5 id="_initial_state"><a class="anchor" href="#_initial_state"></a>36.1.2.1. Initial state</h5>
<div class="paragraph">
<p>In the initial state of our example, only <code>develop</code> and <code>master</code> exist.</p>
</div>
<div class="paragraph">
<p>The repository version in <code>master</code> is <code>1.3.0.RELEASE</code>, and the <code>develop</code> branch has just been branched off it. Commits
have been added to <code>develop</code> to change the repository version to <code>SNAPSHOT</code> and implement the changes necessary for
Git flow.</p>
</div>
</div>
<div class="sect4">
<h5 id="_starting_work_on_a_new_feature"><a class="anchor" href="#_starting_work_on_a_new_feature"></a>36.1.2.2. Starting work on a new feature</h5>
<div class="paragraph">
<p>Let&#8217;s say we want to start working on feature OC-Feature1 described in our JIRA.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout develop <i class="conum" data-value="1"></i><b>(1)</b>
git pull <i class="conum" data-value="2"></i><b>(2)</b>
git checkout -b OC-Feature1 <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check out the <code>develop</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Make sure it is up to date with the remote (=GitHub repository)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a <code>OC-Feature1</code> off the <code>develop</code> branch</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, you can start working on the feature and commit your work to the branch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git commit -m "[OC-Feature1] Developments for OC-Feature1"</pre>
</div>
</div>
<div class="paragraph">
<p>At any point during your work you can push your feature branch to the GitHub repository, to back your work up, let
others look at your work or contribute to the feature, and also to trigger a build (see above).
To do this, just run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git push</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If it&#8217;s your first push to this branch, Git will prompt you to define the remote branch to be associated with
your local branch with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git push --set-upstream origin OC-Feature1</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can re-work, squash your commits and push as many times as you want on a feature branch, but try limiting pushes so
as to make good use of the build resources provided by Travis.
Force pushes are allowed on feature branches.</p>
</div>
<div class="paragraph">
<p>To see your branch (and the status of the associated builds):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <a href="https://github.com/opfab/operatorfabric-core">operatorfabric-core repository on GitHub</a></p>
</li>
<li>
<p>Click the <code>branches</code> tab</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/branches_tab.png" alt="branches tab">
</div>
</div>
<div class="paragraph">
<p>You can see your OC-Feature1 branch, and the green check mark next to it indicates that the associated build(s) is/are
passing.</p>
</div>
<div class="paragraph">
<p>Clicking this check mark displays a pop-up describing the associated build(s), and clicking "Details" redirects you
to the build report on Travis.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/build_checkmark_popup.png" alt="build checkmark popup">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Feel free to add a copyright header (on top of the existing ones) to files you create or amend. See src/main/headers
for examples.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_submitting_a_pull_request"><a class="anchor" href="#_submitting_a_pull_request"></a>36.1.2.3. Submitting a pull request</h5>
<div class="paragraph">
<p>Once you are satisfied with the state of your developments, you can submit it as a pull request.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before submitting your branch as a pull request, please squash/fix your commits so as to reduce the number of commits
and comment them accordingly. In the end, the division of changes into commits should make the PR easier to understand
and review.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should also take a look at the
<a href="#review_checklist">review check list</a>
below to make sure your branch meets its criteria.</p>
</div>
<div class="paragraph">
<p>Once you feel your branch is ready, submit a pull request. Open pull requests are then reviewed by the core maintainers
to assign a reviewer to each of them.</p>
</div>
<div class="paragraph">
<p>To do so, go to the <code>branches</code> tab of the repository as described above.
Click the "New Pull Request" button for your branch.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/feature1_new_PR.png" alt="feature1 new PR">
</div>
</div>
<div class="paragraph">
<p>If you haven&#8217;t done so before, <strong>read through the PR checklist</strong> pasted in the comment block, and then <strong>replace it with your
own comment</strong> containing a short summary of the PR goal and any information that should go into the release notes.
It&#8217;s especially important for PRs that have a direct impact on existing OperatorFabric deployments, to alert administrators
of the impacts of deploying a new version and help them with the migration.
Whenever possible/relevant, a link to the corresponding documentation is appreciated.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/PR_comment.png" alt="PR comment">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Make sure that the base branch for the PR is <code>develop</code>, because feature branches are meant to be merged back into
<code>develop</code>. This should be the default value since <code>develop</code> is the default branch on this repository, but if not, select
it in the base branch dropdown list.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/develop_base_PR.png" alt="develop base PR">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>At this point, GitHub will tell you whether your branch could be automatically merged into <code>develop</code> or whether
there are conflicts to be fixed.</p>
</div>
<div class="sect5">
<h6 id="_case_1_github_is_able_to_automatically_merge_your_branch"><a class="anchor" href="#_case_1_github_is_able_to_automatically_merge_your_branch"></a>Case 1: GitHub is able to automatically merge your branch</h6>
<div class="imageblock">
<div class="content">
<img src="../images/feature1_PR_autom_merge_OK.png" alt="feature1 PR autom merge OK">
</div>
</div>
<div class="paragraph">
<p>This means that either your branch was up to date with develop or there were no conflicts.
In this case, just go ahead and fill in the PR title and message, then click "Create pull request".</p>
</div>
</div>
<div class="sect5">
<h6 id="_case_2_github_cant_merge_your_branch_automatically"><a class="anchor" href="#_case_2_github_cant_merge_your_branch_automatically"></a>Case 2: GitHub can&#8217;t merge your branch automatically</h6>
<div class="imageblock">
<div class="content">
<img src="../images/feature1_PR_autom_merge_KO.png" alt="feature1 PR autom merge KO">
</div>
</div>
<div class="paragraph">
<p>This means that there are conflicts with the current state of the <code>develop</code> branch on GitHub.
To fix these conflicts, you need to update your local copy of the develop branch and merge it into your feature branch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout develop <i class="conum" data-value="1"></i><b>(1)</b>
git pull <i class="conum" data-value="2"></i><b>(2)</b>
git checkout OC-Feature1 <i class="conum" data-value="3"></i><b>(3)</b>
git merge develop <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check out the <code>develop</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Make sure it is up to date with the remote (=GitHub repository)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Check out the <code>OC-Feature1</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Merge the new commits from <code>develop</code> into the feature branch</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, handle any conflicts from the merge. For example, let&#8217;s say there is a conflict on file <code>dummy1.txt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Auto-merging dummy1.txt
CONFLICT (add/add): Merge conflict in dummy1.txt
Automatic merge failed; fix conflicts and then commit the result.</pre>
</div>
</div>
<div class="paragraph">
<p>Open file <code>dummy1.txt</code>:</p>
</div>
<div class="listingblock">
<div class="title">dummy1.txt</div>
<div class="content">
<pre> &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
 Some content from feature 1.
 =======
 Some content that has been changed on develop since Feature 1 branched off.
 &gt;&gt;&gt;&gt;&gt;&gt;&gt; develop</pre>
</div>
</div>
<div class="paragraph">
<p>Update the content to reflect the changes that you want to keep:</p>
</div>
<div class="listingblock">
<div class="title">dummy1.txt</div>
<div class="content">
<pre>Some content from feature 1 and some content that has been changed on develop since Feature 1 branched off.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>git add dummy1.txt <i class="conum" data-value="1"></i><b>(1)</b>
git commit <i class="conum" data-value="2"></i><b>(2)</b>
git push <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the manually merged file to the changes to be committed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Commit the changes to finish the merge</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Push the changes to GitHub</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, if you go back to GitHub and try to create a pull request again, GitHub should indicate that it is able to merge
automatically.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/feature1_PR_autom_merge_OK.png" alt="feature1 PR autom merge OK">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reviewing_a_pull_request"><a class="anchor" href="#_reviewing_a_pull_request"></a>36.1.2.4. Reviewing a Pull Request</h5>
<div class="paragraph">
<p>As of today, only developers from the <code>reviewers</code> group can merge pull requests into <code>develop</code>, but this shouldn&#8217;t
stop anyone interested in the topic of a PR to comment and review it.</p>
</div>
<div class="sect5">
<h6 id="_reviewer_check_list"><a class="anchor" href="#_reviewer_check_list"></a>Reviewer check list</h6>
<div class="ulist">
<ul>
<li>
<p>The PR comment contains the text to insert in release note. Otherwise, it should say why this development doesn&#8217;t need
to be on the release notes.</p>
</li>
<li>
<p>Check that Travis build is passing (for both branch and PR)</p>
</li>
<li>
<p>Check that the base branch (i.e. the branch into which we want to merge changes) is correct: for feature branches
pull requests, this branch should be <code>develop</code>.</p>
</li>
<li>
<p>Look through changed files to make sure everything is relevant to the PR (no mistakenly added changes,
no secret information, no malicious changes) and to see if you have remarks on the way things are implemented</p>
</li>
<li>
<p>Check that the commit(s) message(s) is(are) relevant and follow conventions ([OC-XXX] &#8230;&#8203; )</p>
</li>
<li>
<p>If there is more than one commit, is it meaningful or do we need to squash ?</p>
</li>
<li>
<p>Meaningful and sufficient unit tests for the backend (80% coverage is the threshold)</p>
</li>
<li>
<p>Meaningful unit tests for the frontend (Angular tests can be complex to implement, we should focus on testing complex
logic and not the framework itself)</p>
</li>
<li>
<p>Check Sonar analysis on SonarCloud to see if Sonar reports any bugs or code smells on the new code</p>
</li>
<li>
<p>API testing via Karate has been updated</p>
</li>
<li>
<p>Documentation has been updated (especially if configuration is needed)</p>
</li>
<li>
<p>Configuration examples have been updated (both for dev and docker)</p>
</li>
<li>
<p>Build and run OpFab locally to see the new feature or bug fix at work. In the case of a new feature, it&#8217;s also a way
of making sure that the configuration documentation is correct and easily understandable.</p>
</li>
<li>
<p>Depending on the scope of the PR , build docker images and test in docker mode</p>
</li>
<li>
<p>Check that the copyright header has been updated on the changed files if need be, and in the case of a first-time
contributor, make sure they&#8217;re added to the AUTHORS.txt file.</p>
</li>
<li>
<p>Check dependency added to the project to see if there are compliant with opfab licencing.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_testing_environnement_for_reviewer"><a class="anchor" href="#_testing_environnement_for_reviewer"></a>Testing environnement for reviewer</h6>
<div class="paragraph">
<p>Compile and run OperatorFabric docker images is the most effective way to check any regression.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull the submitted branch on a testing machine;</p>
</li>
<li>
<p>Run a <code>docker-compose</code> with the <code>${OF_HOME}/src/main/docker/test-environment/docker-compose.yml</code> file;</p>
</li>
<li>
<p>Create <code>SNAPSHOT</code> docker images, from the <code>${OF_HOME}</code> directory with the following command: <code>./gradlew clean dockerTagSNAPSHOT</code>;</p>
</li>
<li>
<p>Stop the <code>test-environment</code> docker-compose;</p>
</li>
<li>
<p>Go to <code>${OF_HOME}/config/docker</code>;</p>
</li>
<li>
<p>Run the <code>./docker-compose.sh</code> script (or use the <code>docker-compose.yml</code> with a <code>docker-compose</code> command);</p>
</li>
<li>
<p>Go to <code>${OF_HOME}/src/test/utils/karate</code>;</p>
</li>
<li>
<p>Run the following scripts: <code>./loadBundle.sh &amp;&amp; ./setPerimeterForTest.sh &amp;&amp; ./postTestCards.sh</code>;</p>
</li>
<li>
<p>Open the front-end in a browser and look for any regression.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_merging_a_pull_request"><a class="anchor" href="#_merging_a_pull_request"></a>36.1.2.5. Merging a Pull Request</h5>
<div class="paragraph">
<p>Once the pull request meets all the criteria from the above check list, you can merge it into the <code>develop</code> branch.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the pull request page on GitHub</p>
</li>
<li>
<p>Check that the base branch for the pull request is <code>develop</code>. This information is visible at the top of the page.</p>
<div class="imageblock">
<div class="content">
<img src="../images/existing_PR_check_base.png" alt="existing PR check base">
</div>
</div>
</li>
<li>
<p>If that is not the case, you can edit the base branch by clicking the <code>Edit</code> button in the top right corner.</p>
</li>
<li>
<p>Click the <code>merge pull request</code> button at the bottom of the PR page</p>
</li>
<li>
<p>Go to the <a href="https://opfab.atlassian.net">JIRA</a> page for the corresponding issue and</p>
<div class="ulist">
<ul>
<li>
<p>Set the <code>Fix version</code> field to <code>Next Version</code></p>
</li>
<li>
<p>Set the <code>Status</code> field to <code>Done</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Go to the <a href="https://github.com/opfab/release-notes/">release-notes repository</a> and add the issue to the list with
the information provided in the PR comments.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_creating_a_release_or_hotfix"><a class="anchor" href="#_creating_a_release_or_hotfix"></a>36.1.2.6. Creating a release or hotfix</h5>
<div class="paragraph">
<p>See the
<a href="#release_process">release process</a>
described in our CICD documentation for details.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_guidelines"><a class="anchor" href="#_code_guidelines"></a>36.2. Code Guidelines</h3>
<div class="ulist">
<ul>
<li>
<p>We don&#8217;t mention specific authors by name in each file (in Javadoc or in the documentation for example), so as not
to have to maintain these mentions (since this information is tracked by git anyway).</p>
</li>
<li>
<p>For ui code, you must use a linter with rules provided in ui/main/tslint.json</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_angulartypescript_development_caution_and_guidelines"><a class="anchor" href="#_angulartypescript_development_caution_and_guidelines"></a>36.2.1. Angular/TypeScript development caution and guidelines</h4>
<div class="ulist">
<ul>
<li>
<p>Use <code>!!myVariable</code> to test if a variable is undefined or null</p>
</li>
<li>
<p>Use <code>foreach</code> to iterate over an array (instead of <code>for(let i = ..</code>) . In some cases, foreach do not work and you can use it this way <code>Array.prototype.forEach.call(myArray, element &#8658; &#8230;&#8203;. )</code> (see <a href="https://stackoverflow.com/questions/43743560/foreach-vs-array-prototype-foreach-call" class="bare">stackoverflow.com/questions/43743560/foreach-vs-array-prototype-foreach-call</a>)</p>
</li>
<li>
<p>Do not use ngFor / ngIf  with methods with computing as angular will call these methods very regularly
(around ten times per seconds), use instead variables and compute them only when necessary.</p>
</li>
<li>
<p>ngInit() :  ngInit is called when component is created, the creation is made by the parent component : be careful to check when initialization is done when calling method inside ngInit. When the context of the parent component change, it can lead to a new initialization or not.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_documentation_guidelines"><a class="anchor" href="#_documentation_guidelines"></a>36.3. Documentation Guidelines</h3>
<div class="paragraph">
<p>The aim of this section is to explain how the documentation is currently organized and to give a few guidelines on how
it should be written.</p>
</div>
<div class="sect3">
<h4 id="_structure"><a class="anchor" href="#_structure"></a>36.3.1. Structure</h4>
<div class="paragraph">
<p>All the sources for the AsciiDoc documentation published on our <a href="https://opfab.github.io/">website</a> are found under
the <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/docs/asciidoc">src/docs/asciidoc</a> folder in the
operatorfabric-core repository.</p>
</div>
<div class="paragraph">
<p>It is organized into several folders (architecture documentation, deployment documentation, etc.). Each of these
folders represent a document and contain an <strong>index.adoc</strong> file, optionally referencing other adoc files (to break it
down into sections).</p>
</div>
<div class="paragraph">
<p>In addition, an <strong>images</strong> folder contains images for all documents and a <strong>resources</strong> folder contains various appendices
that might be of use to some people but that we felt weren&#8217;t part of the main documentation.</p>
</div>
<div class="paragraph">
<p>The table below gives a short summary of the content of each document as well as advice on which ones you should focus
on depending on your profile.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Contributor
</td>
<td class="hdlist2">
<p>A developer who contributes (or wishes to) to the OperatorFabric project</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Developer
</td>
<td class="hdlist2">
<p>A developer working on an application using OperatorFabric or a businessconfig-party application posting content to
an OperatorFabric instance</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Admin
</td>
<td class="hdlist2">
<p>Someone who is in charge of deploying and maintaining OperatorFabric in production as part of an integrated
solution</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Product Owner
</td>
<td class="hdlist2">
<p>Project managers, anyone interested in using OperatorFabric for their business requirements.</p>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Documentation Structure and Intended Readers</caption>
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 44.4444%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 11.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Folder</th>
<th class="tableblock halign-left valign-top">Content</th>
<th class="tableblock halign-center valign-top">Contributor</th>
<th class="tableblock halign-center valign-top">Developer</th>
<th class="tableblock halign-center valign-top">Admin</th>
<th class="tableblock halign-center valign-top">Product Owner</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Architecture documentation</strong></p>
<p class="tableblock">Describes the business objects and concepts handled by OperatorFabric as well as the microservices architecture
behind it.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CICD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CICD Pipeline documentation</strong></p>
<p class="tableblock">Describes our CICD pipeline and release process</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">community</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OF Community documentation</strong></p>
<p class="tableblock">Everything about the OperatorFabric Community: Code of conduct, governance, contribution guidelines,
communication channels.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Deployment documentation</strong></p>
<p class="tableblock">Explains how to deploy and configure an OperatorFabric instance</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dev_env</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Development Environment documentation</strong></p>
<p class="tableblock">Explains how to set up a working development environment for OperatorFabric with all the appropriate tooling and how to
run OperatorFabric in development mode.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">docs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This folder contains the documentation that should be archived for previous releases (as of today, the release notes
and single page documentation - see below).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">getting_started</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Getting Started Guide</strong>
guides you through setting up OperatorFabric and experimenting with its main features</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Maybe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reference_doc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Reference Documentation</strong>
contains the reference documentation for each microservice. It starts off with a high-level functional documentation
and then goes into more technical details when needed.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to this asciidoctor documentation, API documentation is available in the form of SwaggerUI-generated html
pages. It is generated by the <code>generateSwaggerUI</code> Gradle task, using the swagger.yaml files from each service (for
example for the
<a href="https://github.com/opfab/operatorfabric-core/blob/master/services/core/actions/src/main/modeling/swagger.yaml">Actions API</a>
). It can be found under the <strong>build/docs/api</strong> folder for each client or service project.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conventions"><a class="anchor" href="#_conventions"></a>36.3.2. Conventions</h4>
<div class="ulist">
<ul>
<li>
<p>In addition to the "visible" structure described above, documents are broken down into coherent parts using the
<a href="https://asciidoctor.org/docs/user-manual/#include-directive">"include" feature of AsciiDoc</a>. This is done mostly to
avoid long files that are harder to edit, but it also allows us to reuse some content in different places.</p>
</li>
<li>
<p>Given the number of files this creates, we try to keep header attributes in files to a minimum. Instead, they&#8217;re
set in the configuration of the asciidoctor gradle task:</p>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">asciidoctor {

    sources {
        include <span class="string"><span class="delimiter">'</span><span class="content">*/index.adoc</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">docs/*</span><span class="delimiter">'</span></span>
    }
    resources {
        from(<span class="string"><span class="delimiter">'</span><span class="content">src/docs/asciidoc</span><span class="delimiter">'</span></span>) {
            include <span class="string"><span class="delimiter">'</span><span class="content">images/*</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">pdf/*</span><span class="delimiter">'</span></span>
        }
    }
    attributes  nofooter            : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
                revnumber           : operatorfabric.version,
                revdate             : operatorfabric.revisionDate,
                sectnums            : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
                sectnumlevels       : <span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>,
                sectanchors         : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
                toc                 : <span class="string"><span class="delimiter">'</span><span class="content">left</span><span class="delimiter">'</span></span>,
                toclevels           : <span class="string"><span class="delimiter">'</span><span class="content">4</span><span class="delimiter">'</span></span>,
                icons               : <span class="string"><span class="delimiter">'</span><span class="content">font</span><span class="delimiter">'</span></span>,
                imagesdir           : <span class="string"><span class="delimiter">'</span><span class="content">../images</span><span class="delimiter">'</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">hide-uri-scheme</span><span class="delimiter">&quot;</span></span>   : <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">source-highlighter</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">coderay</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In particular, the version and revision date are set automatically from the version defined in the
<a href="https://github.com/opfab/operatorfabric-core/blob/master/VERSION">VERSION</a> file at the root of the project and
the current date.</p>
</div>
</li>
<li>
<p>All files are created starting with level 0 titles so:</p>
<div class="ulist">
<ul>
<li>
<p>They can be generated on their own if need be.</p>
</li>
<li>
<p>They can be included at different levels in different documents using
<a href="https://asciidoctor.org/docs/user-manual/#include-partitioning">leveloffset</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In addition to being available as separate documents (architecture, reference, etc.) for the current release, the
documentation is also generated as a single page document available for all releases from the
<a href="https://opfab.github.io/pages/releases.html">releases</a> page. This is also a way to make searching the documentation
for specific terms easier, and could be used to generate a single page pdf documentation.</p>
</li>
<li>
<p>Unfortunately, this entails a little complexity for cross-references and relative links, because the path to
the content is a little different depending on whether the content is generated as different pages or as a single
page document.</p>
<div class="paragraph">
<p>For example, to link to the "Card Structure" section of the reference document from the architecture
document, one needs to use the following external cross-reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;&lt;{gradle-rootdir}/documentation/current/reference_doc/index.adoc#card_structure, Card Structure&gt;&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the case of the single-page documentation however, both the architecture content and the reference content are part
of the same document, so the cross-reference becomes a simple internal cross-reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;&lt;card_structure, Card Structure&gt;&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This is managed by using the
<a href="https://asciidoctor.org/docs/user-manual/#conditional-preprocessor-directives"><code>ifdef</code> and <code>indef</code> directives</a> to
define which link syntax should be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ifdef::single-page-doc[&lt;&lt;card_structure, Card Structure&gt;&gt;]
ifndef::single-page-doc[&lt;&lt;{gradle-rootdir}/documentation/current/reference_doc/index.adoc#card_structure, Card Structure&gt;&gt;]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The label ("Card Structure" in this example) is defined with each link because it seems that defining it in the
target file along with the ID (<code>[[my_section_id, text to display]]</code>) doesn&#8217;t work with relative links.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the same way, for relative links to external files (mostly the API documentation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ifdef::single-page-doc[link:../api/cards/index.html#/archives[here]]
ifndef::single-page-doc[link:{gradle-rootdir}/documentation/current/api/cards/index.html#/archives[here]]</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For this to work, the
<a href="https://github.com/opfab/operatorfabric-core/blob/master/src/docs/asciidoc/docs/single_page_doc.adoc">single_page_doc.adoc</a>
file needs to have <code>:single-page-doc:</code> as a header attribute.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>As you can see in the examples above, we are using custom-defined section ids as anchors rather than taking advantage
of generated ones (see <a href="https://asciidoctor.org/docs/user-manual/#auto-generated-ids">documentation</a>).
This is cumbersome but:</p>
<div class="ulist">
<ul>
<li>
<p>Generation will give a warning if duplicate ids are defined, whereas with generated ids it will silently link to the
wrong section.</p>
</li>
<li>
<p>Restructuring the document might change the generated section ID, creating broken links.</p>
</li>
<li>
<p>Its easier to find referenced text (ctrl-f on id)</p>
</li>
<li>
<p>The presence of a custom-defined ID is a sign that the content is referenced somewhere else, which you should take
into account if you&#8217;re thinking of deleting or moving this content.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The :imagesdir: attribute is set globally as <code>../images</code>, because all images are stored under <code>src/docs/asciidoc/images</code>.</p>
</li>
<li>
<p>In addition to links, it is sometimes necessary to display the actual content of files (or part of it) in
the documentation (in the case of configuration examples, for instance).
Whenever possible, this should be done by using the
<a href="https://asciidoctor.org/docs/user-manual/#include-directive">include directive</a> rather than copying the content
into the adoc file.
This way the documentation will always be up to date with the file content at the time of generation.</p>
<div class="paragraph">
<p><em>See the <strong>build.gradle</strong> include above for an example using
<a href="https://asciidoctor.org/docs/user-manual/#by-tagged-regions">tags</a> to include only part of a file.</em></p>
</div>
</li>
<li>
<p>Source-highlighting is done using <a href="http://coderay.rubychan.de/">Coderay</a>. See their documentation for supported
languages, and the AsciiDoctor documentation on
<a href="https://asciidoctor.org/docs/user-manual/#applying-source-highlighting">how to apply source-highlighting</a>.</p>
</li>
<li>
<p>Avoid long lines whenever possible (for example, try not to go beyond 120 characters). This makes editing the
documentation easier and diffs more readable.</p>
</li>
<li>
<p>Most links to other OperatorFabric documents should be relative (see above) so they automatically point to the
document in the same version rather than the latest version.
Links starting with <strong><a href="https://opfab.github.io/documentation/current/" class="bare">opfab.github.io/documentation/current/</a></strong> should only be used when we want to always refer to
the latest (release) version of the documentation.</p>
</li>
<li>
<p>If necessary, add the relevant copyright at the top of the file.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copyright_headers"><a class="anchor" href="#_copyright_headers"></a>36.4. Copyright Headers</h3>
<div class="paragraph">
<p>All source files and documentation files for the project should bear copyright headers.</p>
</div>
<div class="sect3">
<h4 id="_header_templates"><a class="anchor" href="#_header_templates"></a>36.4.1. Header templates</h4>
<div class="paragraph">
<p>In the case of source files (*.java, *.css or *.scss, *.html, *.ts, etc.), we are working with the
<a href="http://mozilla.org/MPL/2.0/">Mozilla Public License, v. 2.0</a>, so the header should be something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) YYYY-YYYY, Entity Name (website or contact info)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of documentation files (*.adoc), we use the
<a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International license</a>, so the
header should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) YYYY-YYYY, Entity Name (website or contact info)
See AUTHORS.txt
This document is subject to the terms of the Creative Commons Attribution 4.0 International license.
If a copy of the license was not distributed with this
file, You can obtain one at https://creativecommons.org/licenses/by/4.0/.
SPDX-License-Identifier: CC-BY-4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>These templates should of course be converted to comments depending on the file type. See src/main/headers for examples.</p>
</div>
<div class="paragraph">
<p>Please make sure to include the appropriate header when creating new files and to update the existing one when
making changes to a file.</p>
</div>
<div class="paragraph">
<p>In the case of a first time contribution, the GitHub username of the person making the contribution should also be
added to the AUTHORS file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples_4"><a class="anchor" href="#_examples_4"></a>36.4.2. Examples</h4>
<div class="sect4">
<h5 id="_creating_a_new_file"><a class="anchor" href="#_creating_a_new_file"></a>36.4.2.1. Creating a new file</h5>
<div class="paragraph">
<p>Let&#8217;s say a developer from entity Entity X creates a new java file in 2020. The header should read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updating_a_file"><a class="anchor" href="#_updating_a_file"></a>36.4.2.2. Updating a file</h5>
<div class="paragraph">
<p>Given an existing java file with the following header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a developer from entity Entity X edits it in 2021, the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if a developer from entity Entity X edits it in 2022, but no one from Entity X had touched it in 2021,
the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020, 2022 Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_contributors"><a class="anchor" href="#_multiple_contributors"></a>36.4.2.3. Multiple contributors</h5>
<div class="paragraph">
<p>Given an existing java file with the following header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a developer from entity Entity Y edits it in 2021, the header should now read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Copyright (c) 2020-2021, Entity X (http://www.entityX.org)
Copyright (c) 2021, Entity Y (http://www.entityY.org)
See AUTHORS.txt
This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
SPDX-License-Identifier: MPL-2.0
This file is part of the OperatorFabric project.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_governance"><a class="anchor" href="#_project_governance"></a>37. Project Governance</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_project_owner"><a class="anchor" href="#_project_owner"></a>37.1. Project Owner</h3>
<div class="paragraph">
<p>OperatorFabric is part of the <a href="https://www.lfenergy.org/">LF Energy Foundation</a>, a project of the
<a href="https://www.linuxfoundation.org/">Linux Foundation</a> that supports open source innovation projects within the energy
and electricity sectors.</p>
</div>
</div>
<div class="sect2">
<h3 id="_committers"><a class="anchor" href="#_committers"></a>37.2. Committers</h3>
<div class="paragraph">
<p>Committers are contributors who have made several valuable contributions to the project and are now relied upon to both
write code directly to the repository and screen the contributions of others. In many cases they are programmers but it
is also possible that they contribute in a different role. Typically, a committer will focus on a specific aspect of
the project, and will bring a level of expertise and understanding that earns them the respect of the community and the
project owner.</p>
</div>
</div>
<div class="sect2">
<h3 id="_technical_steering_committee"><a class="anchor" href="#_technical_steering_committee"></a>37.3. Technical Steering Committee</h3>
<div class="paragraph">
<p>The Technical Steering Committee (TSC) is composed of voting members elected by the active Committers as described in
the projects Technical Charter.</p>
</div>
<div class="paragraph">
<p>OperatorFabric TSC voting members are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/freddidierRTE">Frdric Didier</a></p>
</li>
<li>
<p><a href="https://github.com/0x62646f727465">Boris Dolley</a></p>
</li>
<li>
<p><a href="https://github.com/AlexGuironnetRTE">Alexandra Guironnet</a></p>
</li>
<li>
<p><a href="https://github.com/rlg-rte">Ronan Le Gall</a></p>
</li>
<li>
<p><a href="https://github.com/vlo-rte">Valrie Longa</a></p>
</li>
<li>
<p><a href="https://github.com/HanaeSafiRTE">Hanae Safi</a></p>
</li>
<li>
<p><a href="https://github.com/gtrimbach-RTE">Guillaume Trimbach</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Boris Dolley will chair the TSC, with Hanae Safi as his deputy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>37.4. Contributors</h3>
<div class="paragraph">
<p>Contributors include anyone in the technical community that contributes code, documentation, or other technical
artifacts to the project.</p>
</div>
<div class="paragraph">
<p>Anyone can become a contributor. There is no expectation of commitment to the project, no specific skill requirements
and no selection process. To become a contributor, a community member simply has to perform one or more actions that
are beneficial to the project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_communication_channels"><a class="anchor" href="#_communication_channels"></a>38. Communication channels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to GitHub we have set up:</p>
</div>
<div class="sect2">
<h3 id="_website_opfab_org"><a class="anchor" href="#_website_opfab_org"></a>38.1. Website: <a href="http://opfab.org" class="bare">opfab.org</a></h3>
<div class="paragraph">
<p>Our website contains all the documentation and resources we&#8217;re currently working on. Here is what we aim to provide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Architecture documentation</p>
</li>
<li>
<p>REST API documentation</p>
</li>
<li>
<p>Reference documentation for each component</p>
</li>
<li>
<p>Javadoc/Compodoc for each component</p>
</li>
<li>
<p>Tutorials and QuickStart guides and videos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>This documentation is our priority</strong> right now so future contributors can quickly find their way around the project.
Needless to say, it&#8217;s a work in progress so feel free to tell us what you feel is missing or what type of documentation
you would be interested in as a contributor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We also use this website to broadcast any news we have about the project so don&#8217;t hesitate to subscribe to the
RSS feed on the home page to be informed of any update.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_lf_energy_mailing_lists"><a class="anchor" href="#_lf_energy_mailing_lists"></a>38.2. LF Energy Mailing Lists</h3>
<div class="paragraph">
<p>Several mailing lists have been created by LF Energy for the project, please feel free to subscribe to the ones you
could be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-announce">OperatorFabric Announcements</a> (such as new releases)</p>
</li>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab">OperatorFabric General Discussion</a></p>
</li>
<li>
<p><a href="https://lists.lfenergy.org/g/opfab-dev">OperatorFabric Developers</a> for project development discussions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And if you&#8217;re interested in LF Energy in general:
<a href="https://lists.lfenergy.org/g/lfenergy">LF Energy General Discussion</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_jira"><a class="anchor" href="#_jira"></a>38.3. JIRA</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="code_of_conduct"><a class="anchor" href="#code_of_conduct"></a>39. Code of Conduct</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Code of Conduct for the OperatorFabric community is
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt">version 2.0 of the Contributor Covenant</a>.</p>
</div>
<div class="sect2">
<h3 id="_our_pledge"><a class="anchor" href="#_our_pledge"></a>39.1. Our Pledge</h3>
<div class="paragraph">
<p>We as members, contributors, and leaders pledge to make participation in our
community a harassment-free experience for everyone, regardless of age, body
size, visible or invisible disability, ethnicity, sex characteristics, gender
identity and expression, level of experience, education, socio-economic status,
nationality, personal appearance, race, religion, or sexual identity
and orientation.
We pledge to act and interact in ways that contribute to an open, welcoming,
diverse, inclusive, and healthy community.</p>
</div>
</div>
<div class="sect2">
<h3 id="_our_standards"><a class="anchor" href="#_our_standards"></a>39.2. Our Standards</h3>
<div class="paragraph">
<p>Examples of behavior that contributes to a positive environment for our
community include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Demonstrating empathy and kindness toward other people</p>
</li>
<li>
<p>Being respectful of differing opinions, viewpoints, and experiences</p>
</li>
<li>
<p>Giving and gracefully accepting constructive feedback</p>
</li>
<li>
<p>Accepting responsibility and apologizing to those affected by our mistakes,
and learning from the experience</p>
</li>
<li>
<p>Focusing on what is best not just for us as individuals, but for the
overall community</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of unacceptable behavior include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of sexualized language or imagery, and sexual attention or
advances of any kind</p>
</li>
<li>
<p>Trolling, insulting or derogatory comments, and personal or political attacks</p>
</li>
<li>
<p>Public or private harassment</p>
</li>
<li>
<p>Publishing others private information, such as a physical or email
address, without their explicit permission</p>
</li>
<li>
<p>Other conduct which could reasonably be considered inappropriate in a
professional setting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement_responsibilities"><a class="anchor" href="#_enforcement_responsibilities"></a>39.3. Enforcement Responsibilities</h3>
<div class="paragraph">
<p>Community leaders are responsible for clarifying and enforcing our standards of
acceptable behavior and will take appropriate and fair corrective action in
response to any behavior that they deem inappropriate, threatening, offensive,
or harmful.
Community leaders have the right and responsibility to remove, edit, or reject
comments, commits, code, wiki edits, issues, and other contributions that are
not aligned to this Code of Conduct, and will communicate reasons for moderation
decisions when appropriate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scope"><a class="anchor" href="#_scope"></a>39.4. Scope</h3>
<div class="paragraph">
<p>This Code of Conduct applies within all community spaces, and also applies when
an individual is officially representing the community in public spaces.
Examples of representing our community include using an official e-mail address,
posting via an official social media account, or acting as an appointed
representative at an online or offline event.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement"><a class="anchor" href="#_enforcement"></a>39.5. Enforcement</h3>
<div class="paragraph">
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be
reported to the community leaders responsible for enforcement at <strong>opfab-tsc_AT_lists.lfenergy.org</strong>.
All complaints will be reviewed and investigated promptly and fairly.
All community leaders are obligated to respect the privacy and security of the
reporter of any incident.
Enforcement Guidelines
Community leaders will follow these Community Impact Guidelines in determining
the consequences for any action they deem in violation of this Code of Conduct:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Correction</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>Use of inappropriate language or other behavior deemed
unprofessional or unwelcome in the community.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A private, written warning from community leaders, providing
clarity around the nature of the violation and an explanation of why the
behavior was inappropriate. A public apology may be requested.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Warning</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>A violation through a single incident or series
of actions.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A warning with consequences for continued behavior. No
interaction with the people involved, including unsolicited interaction with
those enforcing the Code of Conduct, for a specified period of time. This
includes avoiding interactions in community spaces as well as external channels
like social media. Violating these terms may lead to a temporary or
permanent ban.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Temporary Ban</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>A serious violation of community standards, including
sustained inappropriate behavior.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A temporary ban from any sort of interaction or public
communication with the community for a specified period of time. No public or
private interaction with the people involved, including unsolicited interaction
with those enforcing the Code of Conduct, is allowed during this period.
Violating these terms may lead to a permanent ban.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Permanent Ban</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Community Impact</dt>
<dd>
<p>Demonstrating a pattern of violation of community
standards, including sustained inappropriate behavior,  harassment of an
individual, or aggression toward or disparagement of classes of individuals.</p>
</dd>
<dt class="hdlist1">Consequence</dt>
<dd>
<p>A permanent ban from any sort of public interaction within
the community.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_attribution"><a class="anchor" href="#_attribution"></a>39.6. Attribution</h3>
<div class="paragraph">
<p>This Code of Conduct is adapted from the Contributor Covenant,
version 2.0, available at
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct.html" class="bare">www.contributor-covenant.org/version/2/0/code_of_conduct.html</a>.
Community Impact Guidelines were inspired by Mozillas code of conduct
enforcement ladder.
For answers to common questions about this code of conduct, see the FAQ at
<a href="https://www.contributor-covenant.org/faq" class="bare">www.contributor-covenant.org/faq</a>. Translations are available at
<a href="https://www.contributor-covenant.org/translations" class="bare">www.contributor-covenant.org/translations</a>.
<a href="https://www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt" class="bare">www.contributor-covenant.org/version/2/0/code_of_conduct/code_of_conduct.txt</a></p>
</div>
</div>
</div>
</div>
<h1 id="CICD" class="sect0"><a class="anchor" href="#CICD"></a>OperatorFabric CICD</h1>
<div class="openblock partintro">
<div class="content">
The aim of this document is to describe our CICD pipeline and our release process.
</div>
</div>
<div class="sect1">
<h2 id="_pipeline_configuration"><a class="anchor" href="#_pipeline_configuration"></a>40. Pipeline Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section briefly describes the organization of our CICD pipeline. If you are looking for more detailed information,
see
<a href="#mock_pipeline">this document</a>
describing the steps that were necessary to create our mock pipeline as well as the issues we ran into.</p>
</div>
<div class="paragraph">
<p>Most of the access and permissions required by our CICD plateform (Travis) are managed by tokens that are created on
each of the required services (SonarCloud, DockerHub, GitHub).
A technical user account (opfabtech) has been created for each of these services so that these tokens are not linked
to the account of any member of the team.</p>
</div>
<div class="sect2">
<h3 id="_cicd_pipeline"><a class="anchor" href="#_cicd_pipeline"></a>40.1. CICD Pipeline</h3>
<div class="sect3">
<h4 id="_github"><a class="anchor" href="#_github"></a>40.1.1. GitHub</h4>
<div class="paragraph">
<p>Work in progress</p>
</div>
</div>
<div class="sect3">
<h4 id="_travis_ci"><a class="anchor" href="#_travis_ci"></a>40.1.2. Travis CI</h4>
<div class="paragraph">
<p>We use Travis CI to manage our pipeline. As of today, it is composed of 7 stages:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
test-sonar
</td>
<td class="hdlist2">
<p>Builds the commit, runs tests and sonar analysis</p>
</td>
</tr>
<tr>
<td class="hdlist1">
test
</td>
<td class="hdlist2">
<p>Similar to <code>test-sonar</code> but without sonar analysis</p>
</td>
</tr>
<tr>
<td class="hdlist1">
doc
</td>
<td class="hdlist2">
<p>Generates the documentation (from asciidoc sources and API documentation) and pushes it to the opfab.github.io
repository to update the website.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
doc-dry-run
</td>
<td class="hdlist2">
<p>Generates the documentation without pushing it</p>
</td>
</tr>
<tr>
<td class="hdlist1">
docker-push-version
</td>
<td class="hdlist2">
<p>Builds Docker images, tags them with the current version (either <code>SNAPSHOT</code> or <code>X.X.X.RELEASE</code>) and
pushes them to DockerHub</p>
</td>
</tr>
<tr>
<td class="hdlist1">
docker-push-latest
</td>
<td class="hdlist2">
<p>Builds Docker images, tags them with <code>latest</code> and pushes them to DockerHub</p>
</td>
</tr>
<tr>
<td class="hdlist1">
docker-tag-version
</td>
<td class="hdlist2">
<p>Builds Docker images and tags them with the current version, without pushing them anywhere. This
stage can be triggered when we just want to check that the images can be built without actually updating them on DockerHub.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Among these stages, four can be considered "sensitive" because they push public content that serves as a reference for
the project (docker images, documentation and to a lesser extent, sonar analysis), meaning we don&#8217;t want it tampered with.
These stages are <code>test-sonar</code>, <code>doc</code> and the two <code>docker-push</code> stages.</p>
</div>
<div class="paragraph">
<p>These stages are triggered depending on:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>branch type</p>
</li>
<li>
<p>event type (CRON job, push or pull request)</p>
</li>
<li>
<p>commit message hooks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the table below:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
doc hook
</td>
<td class="hdlist2">
<p>stands for adding the keyword <code>ci_documentation</code> to the commit message</p>
</td>
</tr>
<tr>
<td class="hdlist1">
docker hook
</td>
<td class="hdlist2">
<p>stands for adding the keyword <code>ci_docker</code> to the commit message</p>
</td>
</tr>
<tr>
<td class="hdlist1">
latest hook
</td>
<td class="hdlist2">
<p>stands for adding the keyword <code>ci_latest</code> to the commit message</p>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">Summary of stage triggers</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 7.1435%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock">develop</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">release</p></th>
<th class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">master</p></th>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">feature or hotfix</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">pull request</p></th>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Stage</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">CRON</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">push</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">doc hook</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">docker hook</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">push</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">push</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">latest hook</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">push</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">doc hook</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">docker hook</p></th>
<th class="tableblock halign-center valign-top"><p class="tableblock">push</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>test-sonar</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">internal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>test</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">external</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>doc</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>doc-dry-run</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>docker-push-version</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>docker-push-latest</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>docker-tag-version</em></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>The <code>test-sonar</code> phase is ran for every build except those triggered by external PRs (i.e. originating from a fork
of the repository). This is because the <code>sonar-scanner</code> step it comprises requires access to an encrypted token
(to be able to push the analysis to
<a href="https://sonarcloud.io/dashboard?id=org.lfenergy.operatorfabric%3Aoperatorfabric-core">SonarCloud</a>, see below for details)
that is not shared with external PRs for security reasons, so this would cause the stage (and the build) to fail.
This is why in the case of external PRs the <code>test</code> phase is ran instead (leaving out sonar-scanner).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sonarcloud"><a class="anchor" href="#_sonarcloud"></a>40.1.3. SonarCloud</h4>
<div class="paragraph">
<p>To be allowed to push results to SonarCloud, Travis needs to be authenticated. This is done by generating a token on
SonarCloud with an account (opfabtech) that has admin rights to the organization, and then providing this token to Travis
either through the .travis.yml file or as an environment variable through Travis settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_github_documentation"><a class="anchor" href="#_github_documentation"></a>40.1.4. GitHub (documentation)</h4>
<div class="paragraph">
<p>To be allowed to push the generated documentation to the opfab.github.io, Travis needs write access to the repository.
This is done by setting up a Personal Access Token in GitHub using the technical account.
This token is then passed to Travis as an environment variable through Travis settings, and is used in the .travis.yml file.
Right now the scope of this token is maximal, it can probably be reduced (see <a href="https://opfab.atlassian.net/browse/OC-755">OC-755</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After new content is pushed to the opfab.github.io repository, it can take a few minutes before this content is
visible on the website because it needs to be built by GitHub pages, and this can take a short while
depending on how busy the service is.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dockerhub"><a class="anchor" href="#_dockerhub"></a>40.1.5. DockerHub</h4>
<div class="paragraph">
<p>To be allowed to push images to DockerHub, Travis needs to be authenticated. This is done by setting the DockerHub
login and password of the technical account as environment variables through Travis settings and referencing them in
the .travis.yml file.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release_process"><a class="anchor" href="#release_process"></a>41. Release process</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_version_numbers"><a class="anchor" href="#_version_numbers"></a>41.1. Version numbers</h3>
<div class="paragraph">
<p>We work with two types of versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X.Y.Z.RELEASE versions are stable versions</p>
</li>
<li>
<p>SNAPSHOT version represents the current state of merged developments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Version numbers for X.Y.Z.RELEASE should be understood like this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X: Major version, a major version adds new features and breaks compatibility with previous major and minor versions.</p>
</li>
<li>
<p>Y: Minor version, a minor version adds new features and does not break compatibility with previous minor versions for
the same major version.</p>
</li>
<li>
<p>Z: Patch, a patch version only contains bug fixes of current minor version</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_releasing_a_version"><a class="anchor" href="#_releasing_a_version"></a>41.2. Releasing a Version</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To release a version we use some Travis dedicated jobs. These jobs are triggered by specific commit keywords
and rely on the VERSION file at the root of this repository to know which version is being produced.
It is thus crucial to double-check the content of this file before any push (triggering the Travis jobs) is made.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before releasing a version, you need to prepare the release.</p>
</div>
<div class="sect3">
<h4 id="_checking_the_release_notes"><a class="anchor" href="#_checking_the_release_notes"></a>41.2.1. Checking the release notes</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <code>Next Release</code> from
<a href="https://opfab.atlassian.net/projects/OC?orderField=RANK&amp;selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page&amp;status=all">JIRA the release list</a>
to get the release notes (click "Release notes" under the version name at the top) listing new features, fixed bugs etc&#8230;&#8203;</p>
<div class="imageblock">
<div class="content">
<img src="../images/release_notes.png" alt="Release notes link">
</div>
</div>
</li>
<li>
<p>Make sure that the
<a href="https://github.com/opfab/release-notes/blob/master/release_notes.adoc">release_notes.adoc</a>
file lists all the issues, bugs, tags or feature requests that are relevant for OperatorFabric users along with
explanations if need be.</p>
</li>
<li>
<p>Based on the content of this version and the rules listed above, determine the version number for next version.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_release_branch_and_preparing_the_release"><a class="anchor" href="#_creating_a_release_branch_and_preparing_the_release"></a>41.2.2. Creating a release branch and preparing the release</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the <a href="https://github.com/opfab/operatorfabric-core">operatorfabric-core repository</a>, create a branch off the <code>develop</code> branch named
<code>X.X.X.release</code> (note the lowercase <code>release</code> to distinguish it from <code>X.X.X.RELEASE</code> tags).</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>git checkout -b X.X.X.release</code></pre>
</div>
</div>
</li>
<li>
<p>Cut the contents from the release_notes.adoc file from the
<a href="https://github.com/opfab/release-notes/">release-notes repository</a> and paste it to the release_notes.adoc file
found under <strong>src/docs/asciidoc/docs</strong> in the <a href="https://github.com/opfab/operatorfabric-core">operatorfabric-core repository</a>.</p>
</li>
<li>
<p>In the <a href="https://github.com/opfab/operatorfabric-core">operatorfabric-core repository</a> release-notes.adoc file, replace the <code>Version SNAPSHOT</code>
title by <code>Version X.X.X.RELEASE</code></p>
</li>
<li>
<p>In the <a href="https://opfab.atlassian.net/projects/OC?orderField=RANK&amp;selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page&amp;status=all">releases page on JIRA</a>, change the name from "Next Version" to "X.X.X.RELEASE"</p>
</li>
<li>
<p>Use the ./CICD/prepare_release_version.sh script to automatically perform all the necessary changes:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./CICD/prepare_release_version.sh -v X.X.X.RELEASE</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Current version is SNAPSHOT (based on VERSION file)
Preparing X.X.X.RELEASE
Updating version for pipeline in VERSION file
Replacing SNAPSHOT with X.X.X.RELEASE in swagger.yaml files
Using X.X.X.RELEASE for lfeoperatorfabric images in dev and docker environment docker-compose files
The following files have been updated:
 M VERSION
 M config/dev/docker-compose.yml
 M config/docker/docker-compose.yml
 M services/core/cards-publication/src/main/modeling/swagger.yaml
 M services/core/businessconfig/src/main/modeling/swagger.yaml
 M services/core/users/src/main/modeling/swagger.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>This script performs the following changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace SNAPSHOT with X.X.X.RELEASE in swagger.yaml files and the VERSION file at the root operator-fabric folder</p>
</li>
<li>
<p>Change the version from SNAPSHOT to X.X.X.RELEASE in the docker-compose files for dev and docker deployments</p>
</li>
</ul>
</div>
</li>
<li>
<p>Commit the changes with the template message:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>git add .
git commit -m "[RELEASE] X.X.X.RELEASE"</code></pre>
</div>
</div>
</li>
<li>
<p>Push the commit</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>git push --set-upstream origin X.X.X.release</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the build is correctly triggered</p>
<div class="paragraph">
<p>You can check the status of the build job triggered by the commit on
<a href="https://travis-ci.org/opfab/operatorfabric-core/branches">Travis CI</a>.
The build job should have the following three stages:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/release_branch_build.png" alt="Running build for release branch screenshot">
</div>
</div>
<div class="paragraph">
<p>Wait for the build to complete (around 20 minutes) and check that all stages have been successful.
This ensures that the code builds, tests are OK and there is no error preventing documentation or Docker images
generation.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_merging_the_release_branch_into_master"><a class="anchor" href="#_merging_the_release_branch_into_master"></a>41.2.3. Merging the release branch into <code>master</code></h4>
<div class="paragraph">
<p>Once the release branch build is passing, you should merge the release branch into <code>master</code> to bring the new
developments into <code>master</code> and trigger the CICD tasks associated with a release (Docker images for DockerHub and
documentation).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout master <i class="conum" data-value="1"></i><b>(1)</b>
git pull <i class="conum" data-value="2"></i><b>(2)</b>
git merge X.X.X.release <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check out the <code>master</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Make sure your local copy is up to date</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Merge the <code>X.X.X.release</code> branch into <code>master</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you also want the new docker images to be tagged <code>latest</code> (as should be the case for most release
versions), you should add the keyword <code>ci_latest</code> to the merge commit message.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>git tag X.X.X.RELEASE <i class="conum" data-value="1"></i><b>(1)</b>
git push <i class="conum" data-value="2"></i><b>(2)</b>
git push origin X.X.X.RELEASE <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tag the commit with the <code>X.X.X.RELEASE</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Push the commits to update the remote <code>master</code> branch</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Push the tag
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check that the build is correctly triggered</p>
<div class="paragraph">
<p>You can check the status of the build job triggered by the commit on
<a href="https://travis-ci.org/opfab/operatorfabric-core/branches">Travis CI</a>.
The build job should have the following four stages (or three if the images aren&#8217;t tagged as latest)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/master_branch_build.png" alt="Running build for master branch screenshot">
</div>
</div>
<div class="paragraph">
<p>Wait for the build to complete (around 20 minutes) and check that all stages have been successful.</p>
</div>
</li>
<li>
<p>Check that the <code>X.X.X.RELEASE</code> images have been generated and pushed to DockerHub.</p>
</li>
<li>
<p>Check that the <code>latest</code> images have been updated on DockerHub (if this has been triggered).</p>
</li>
<li>
<p>Check that the documentation has been generated and pushed to the GitHub pages website</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check the version and revision date at the top of the documents in the current documentation
(for example <a href="https://opfab.github.io/documentation/current/architecture/">the architecture documentation</a>)</p>
</li>
<li>
<p>Check that you see the X.X.X.RELEASE under the <a href="https://opfab.github.io/pages/releases.html">releases page</a>
and that the links work.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Check that the tag was correctly pushed to GitHub and is visible under the
<a href="https://github.com/opfab/operatorfabric-core/releases">releases page</a> for the repository.</p>
</li>
</ol>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_checking_the_docker_compose_files"><a class="anchor" href="#_checking_the_docker_compose_files"></a>41.2.4. Checking the docker-compose files</h4>
<div class="paragraph">
<p>While the docker-compose files should always point to the SNAPSHOT images while on the <code>develop</code> branch, on the <code>master</code>
branch they should rely on the latest RELEASE version available on DockerHub. Once the CI pipeline triggered by the
previous steps has completed successfully, and you can see X.X.X.RELEASE images for all services on DockerHub, you should:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove your locally built X.X.X.RELEASE images if any</p>
</li>
<li>
<p>Run the config/demo docker-compose file to make sure it pulls the images from DockerHub and behaves as intended.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>People who want to experiment with OperatorFabric are pointed to this docker-compose so it&#8217;s important to make sure
that it&#8217;s working correctly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_in_jira"><a class="anchor" href="#_in_jira"></a>41.2.5. In Jira</h4>
<div class="paragraph">
<p>In the "Releases" screen, release <code>X.X.X.RELEASE</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advertising_the_new_release_on_the_lfe_mailing_list"><a class="anchor" href="#_advertising_the_new_release_on_the_lfe_mailing_list"></a>41.3. Advertising the new release on the LFE mailing list</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Send an email to the <a href="mailto:opfab-announce@lists.lfenergy.org">opfab-announce@lists.lfenergy.org</a> mailing list with a link to the release notes on the website.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here is the link to the <a href="https://lists.lfenergy.org/g/main">administration website for the LFE mailing lists</a>
in case there is an issue.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_the_next_version"><a class="anchor" href="#_preparing_the_next_version"></a>41.4. Preparing the next version</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should wait for all the tasks associated with creating the X.X.X.RELEASE
version to finish and make sure that they&#8217;ve had the expected output before starting the
preparation of the next version. This is because any committed/pushed changes preparing the
new version will make rolling back or correcting any mistake on the release more complicated.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_in_jira_2"><a class="anchor" href="#_in_jira_2"></a>41.4.1. In Jira</h4>
<div class="paragraph">
<p>In the "Releases" screen create a new release called <code>Next Release</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_the_release_notes_repository"><a class="anchor" href="#_on_the_release_notes_repository"></a>41.4.2. On the release-notes repository</h4>
<div class="paragraph">
<p>Remove the items listed in the release_notes.adoc file so it&#8217;s ready for the next version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_the_operatorfabric_core_repository"><a class="anchor" href="#_on_the_operatorfabric_core_repository"></a>41.4.3. On the operatorfabric-core repository</h4>
<div class="paragraph">
<p>Now that the release branch has served its purpose, it should be deleted so as not to clutter the repository and to
avoid confusion with the actual release commit tagged on <code>master</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git branch -d X.X.X.release <i class="conum" data-value="1"></i><b>(1)</b>
git push origin --delete X.X.X.release <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Delete the branch locally</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Remove it from GitHub</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<h1 id="_resources" class="sect0"><a class="anchor" href="#_resources"></a>Resources</h1>
<div class="sect1">
<h2 id="mock_pipeline"><a class="anchor" href="#mock_pipeline"></a>42. Appendix A: Mock CICD Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We wanted to be able to test changes to this configuration or to the scripts used by the pipeline without risks to the real
master branch, to our docker images or to the documentation. We didn&#8217;t find any such "dry-run" options on Travis CI so
we decided to create a complete mock pipeline replicating the actual pipeline.
This is a short summary of the necessary steps.</p>
</div>
<div class="sect2">
<h3 id="_github_2"><a class="anchor" href="#_github_2"></a>42.1. GitHub</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create organization opfab-mock</p>
</li>
<li>
<p>Create user account opfabtechmock</p>
</li>
<li>
<p>Invite opfabtechmock to opfab-mock organization as owner (see later if this can/should be restricted)</p>
</li>
<li>
<p>Fork operatorfabric-core and opfab.github.io repos to opfab-mock organization</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_travis_ci_2"><a class="anchor" href="#_travis_ci_2"></a>42.2. Travis CI</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to travis-ci.org (not travis-ci.com)</p>
</li>
<li>
<p>Sign in with GitHub (using opfabtechmock)
This redirects to a page offering to grant access to your account to Travis CI for Open Source, click ok.</p>
<div class="paragraph">
<p>Note: This page (<a href="https://github.com/settings/applications" class="bare">github.com/settings/applications</a>) lets you review the apps that have keen granted this kind
of access and when it was last used.</p>
</div>
</li>
<li>
<p>Looking at <a href="https://travis-ci.org/account/repositories" class="bare">travis-ci.org/account/repositories</a>, the opfab-mock organization didn&#8217;t appear even after syncing
the account, so click on "review and add your authorized organizations" (this redirects to
<a href="https://github.com/settings/connections/applications/f244293c729d5066cf27" class="bare">github.com/settings/connections/applications/f244293c729d5066cf27</a>).</p>
</li>
<li>
<p>Click "grant" next to the organization.</p>
</li>
<li>
<p>After that, Travis CI for Open Source is visible here: <a href="https://github.com/organizations/opfab-mock/settings/oauth_application_policy" class="bare">github.com/organizations/opfab-mock/settings/oauth_application_policy</a>.</p>
<div class="paragraph">
<p>This allowed the opfab-mock organization to appear in the account: <a href="https://travis-ci.org/account/repositories" class="bare">travis-ci.org/account/repositories</a>
Click on opfab-mock to get to the <a href="https://travis-ci.org/organizations/opfab-mock/repositories">list of repositories for this organization</a> and toggle "operatorfabric-core" on.</p>
</div>
</li>
<li>
<p>Under the <a href="https://travis-ci.org/opfab-mock/operatorfabric-core/settings">Travis settings for the operatorfabric-core repository</a>,
create a Cron Job on branch <code>develop</code>, that runs daily and is always run.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_sonarcloud_2"><a class="anchor" href="#_sonarcloud_2"></a>42.3. SonarCloud</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to SonarCloud.io</p>
</li>
<li>
<p>Sign in with GitHub</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When switching between accounts (your own and the technical account for example), make sure to log out of
SonarCloud when you&#8217;re done using an account because otherwise it will keep the existing session (even in a new tab)
rather than sign you back in with the account you&#8217;re currently using on GitHub.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Authorize SonarCloud by sonarcloud
+ Create a new organization
<a href="https://sonarcloud.io/create-organization">from the "+" dropdown menu to the left of your profile picture</a></p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Click on "Just testing? You can create manually" on the bottom right, and not "Choose an organization on GitHub".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is because the "opfab" SonarCloud organization that we are trying to replicate is not currently linked to its GitHub
counterpart (maybe the option didn&#8217;t exist at the time), so we&#8217;re doing the same here. In the future it might be a good
idea to link them (see <a href="https://opfab.atlassian.net/browse/OC-751">OC-751</a>)as SonarCloud states that</p>
</div>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Binding an organization from SonarCloud with GitHub is an easy way to keep
them synchronized. To bind this organization to GitHub, the SonarCloud application will be installed.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>And then it warns again that</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Manual setup is not recommended, and leads to missing features like appropriate setup of
your project or analysis feedback in the Pull Request.</p>
</div>
</blockquote>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click "Analyze new project" then "Create manually" (for the same reasons as the organization).</p>
<div class="paragraph">
<p>Project key and display name : <strong>org.lfenergy.operatorfabric:operatorfabric-core-mock</strong>
Then choose "Public" and click "Set Up".</p>
</div>
</li>
<li>
<p>This redirects to the the following message :
<a href="https://sonarcloud.io/project/configuration?id=org.lfenergy.operatorfabric%3Aoperatorfabric-core-mock">We initialized your project on SonarCloud, now it&#8217;s up to you to launch analyses!</a></p>
</li>
<li>
<p>Now we need to make Sonar aware of our different branch types and of the fact that we have <code>develop</code> and not <code>master</code>
as our default branch on GitHub.
Under branches/administration:</p>
<div class="ulist">
<ul>
<li>
<p>Change the "long living branches pattern" to  <code>(master|develop)</code></p>
</li>
<li>
<p>Delete the <code>develop</code> branch if one had been created</p>
</li>
<li>
<p>Rename the main branch from <code>master</code> to <code>develop</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Now we need to provide Travis with a token to use to access SonarCloud.
To generate a token, go to <a href="https://sonarcloud.io/account/security/">Account/Security</a></p>
<div class="paragraph">
<p>There are two options to pass this token to Travis:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Option A: Define a new SONAR_TOKEN environment variable in the
<a href="https://travis-ci.org/opfab-mock/operatorfabric-core/settings">repository&#8217;s settings in Travis</a>, then use it in the
.travis.yml file as follows:</p>
<div class="listingblock">
<div class="content">
<pre>addons:
  sonarcloud:
    organization: "opfab-mock"
    token:
         secure: ${SONAR_TOKEN}</pre>
</div>
</div>
</li>
<li>
<p>Option B: Encrypt this token using the travis gem:</p>
<div class="listingblock">
<div class="content">
<pre>travis encrypt XXXXXXXXXXXXXXXXXXXXXXXXXXXX</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This has to be run at the root of the repository otherwise you get the following error: <code>Can&#8217;t figure out GitHub repo name. Ensure you&#8217;re in the repo directory, or specify the repo name via the -r option (e.g. travis &lt;command&gt; -r &lt;owner&gt;/&lt;repo&gt;)</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not use the --add option (to add the encrypted value directly to the .travis.yml file) as it changes
a lot of things in the file (remove comments, change indentation and quotes, etc.).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Paste the result (YYYY) in the .travis.yml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>addons:
  sonarcloud:
    organization: "opfab-mock"
    token:
         secure: "YYYY"</pre>
</div>
</div>
<div class="paragraph">
<p>Option A would be better as it&#8217;s not necessary to make a new commit if the token needs to be changed, but it stopped
working suddenly, maybe as a result of a travis policy change regarding encryption.
<a href="https://opfab.atlassian.net/browse/OC-752">OC-752</a> was created to investigate.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
There is still a SONAR_TOKEN environment variable defined in the Travis settings (with a dummy value)
because there is a test on its presence to decide whether sonar-scanner should be launched or
not (in the case of external PRs) (see <a href="https://opfab.atlassian.net/browse/OC-700">OC-700</a>
/ <a href="https://opfab.atlassian.net/browse/OC-507">OC-507</a>).
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Finally change the organization in .travis.yml file and the project key
in sonar-project.properties (replace the actual values with mock values).</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In travis.yml we launch the sonar-scanner command whereas the tutorials mention gradle sonarqube.
It looks like we&#8217;re following <a href="https://sonarcloud.io/documentation/analysis/scan/sonarscanner/">this</a> which says that
"The SonarScanner is the scanner to use when there is no specific scanner for your build system."
But there is a <a href="https://sonarcloud.io/documentation/analysis/scan/sonarscanner-for-gradle/">specific scanner for Gradle</a>:
</td>
</tr>
</table>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The SonarScanner for Gradle provides an easy way to start SonarCloud analysis of a Gradle project.
The ability to execute the SonarCloud analysis via a regular Gradle task makes it available anywhere Gradle is available
(CI service, etc.), without the need to manually download, setup, and maintain a SonarScanner installation.
The Gradle build already has much of the information needed for SonarCloud to successfully analyze a project.
By configuring the analysis based on that information, the need for manual configuration is reduced significantly.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>&#8594; This could make sonar easier to run locally and reduce the need for configuration
(see <a href="https://opfab.atlassian.net/browse/OC-754">OC-754</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_github_documentation_2"><a class="anchor" href="#_github_documentation_2"></a>42.4. GitHub (documentation)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a personal access token for GitHub (for the documentation). Its name is not important.</p>
<div class="paragraph">
<p>See <a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">GitHub documentation</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/perso_access_token_doc.png" alt="perso access token doc">
</div>
</div>
</li>
<li>
<p>Create a GH_DOC_TOKEN env variable
in <a href="https://travis-ci.org/opfab-mock/operatorfabric-core/settings">Travis settings for the operatorfabric-core repository</a>
, making it available to all branches.</p>
<div class="imageblock">
<div class="content">
<img src="../images/adding_gh_doc_token_travis.png" alt="adding gh doc token travis">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_dockerhub_2"><a class="anchor" href="#_dockerhub_2"></a>42.5. DockerHub</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create account opfabtechmock</p>
</li>
<li>
<p>Create organization <strong>lfeoperatorfabricmock</strong></p>
</li>
<li>
<p>Change organization name in docker config in services.gradle</p>
<div class="listingblock">
<div class="content">
<pre>docker {
    name "lfeoperatorfabricmock/of-${project.name.toLowerCase()}"
    tags 'latest', dockerVersionTag
    labels (['project':"${project.group}"])
    files( jar.archivePath
        , 'src/main/resources/bootstrap-docker.yml'
        , '../../../src/main/docker/java-config-docker-entrypoint.sh')
    buildArgs(['JAR_FILE'       : "${jar.archiveName}",
               'http_proxy'     : apk.proxy.uri,
               'https_proxy'    : apk.proxy.uri,
               'HTTP_PROXY_AUTH': "basic:*:$apk.proxy.user:$apk.proxy.password"])
    dockerfile file("src/main/docker/Dockerfile")
}</pre>
</div>
</div>
</li>
<li>
<p>Add the opfabtechmock dockerhub account credentials as DOCKER_CLOUD_USER / DOCKER_CLOUD_PWD in Travis env variables
in settings (see GH_DOC_TOKEN above).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_updating_the_fork"><a class="anchor" href="#_updating_the_fork"></a>42.6. Updating the fork</h3>
<div class="paragraph">
<p>To make the mock repositories catch up with the upstream (the real repositories) from time to time, follow
this procedure (the command line version), except you should do a rebase instead of a merge:
<a href="https://rick.cogley.info/post/update-your-forked-repository-directly-on-github/" class="bare">rick.cogley.info/post/update-your-forked-repository-directly-on-github/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_guide_from_release_1_4_0_to_release_1_5_0"><a class="anchor" href="#_migration_guide_from_release_1_4_0_to_release_1_5_0"></a>43. Migration Guide from release 1.4.0 to release 1.5.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_refactoring_of_configuration_management"><a class="anchor" href="#_refactoring_of_configuration_management"></a>43.1. Refactoring of configuration management</h3>
<div class="sect3">
<h4 id="_motivation_for_the_change"><a class="anchor" href="#_motivation_for_the_change"></a>43.1.1. Motivation for the change</h4>
<div class="paragraph">
<p>The initial situation was to have a <code>Third</code> concept that was meant to represent third-party applications that publish
content (cards) to OperatorFabric.
As such, a Businessconfig was both the sender of the message and the unit of configuration for resources for card rendering.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because of that mix of concerns, naming was not consistent across the different services in the backend and frontend as
this object could be referred to using the following terms:
* Third
* ThirdParty
* Bundle
* Publisher
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But now that we&#8217;re aiming for cards to be sent by entities, users (see Free Message feature) or external services, it
doesn&#8217;t make sense to tie the rendering of the card ("Which configuration bundle should I take the templates and
details from?") to its publisher ("Who/What emitted this card and who/where should I reply?").</p>
</div>
</div>
<div class="sect3">
<h4 id="_changes_to_the_model"><a class="anchor" href="#_changes_to_the_model"></a>43.1.2. Changes to the model</h4>
<div class="paragraph">
<p>To do this, we decided that the <code>publisher</code> of a card would now have the sole meaning of <code>emitter</code>, and that the link
to the configuration bundle to use to render a card would now be based on its <code>process</code> field.</p>
</div>
<div class="sect4">
<h5 id="_on_the_businessconfig_model"><a class="anchor" href="#_on_the_businessconfig_model"></a>43.1.2.1. On the Businessconfig model</h5>
<div class="paragraph">
<p>We used to have a <code>Businessconfig</code> object which had an array of <code>Process</code> objects as one of its properties.
Now, the <code>Process</code> object replaces the <code>Businessconfig</code> object and this new object combines the properties of the old <code>Businessconfig</code>
and <code>Process</code> objects (menuEntries, states, etc.).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In particular, this means that while in the past one bundle could "contain" several processes, now there can be only
one process by bundle.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Businessconfig</code> object used to have a <code>name</code> property that was actually its unique identifier (used to retrieve it through
the API for example).
It also had a <code>i18nLabelKey</code> property that was meant to be the i18n key to determine the display name of the
corresponding businessconfig, but so far it was only used to determine the display name of the associated menu in the navbar in
case there where several menu entries associated with this businessconfig.</p>
</div>
<div class="paragraph">
<p>Below is a summary of the changes to the <code>config.json</code> file that all this entails:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field before</th>
<th class="tableblock halign-left valign-top">Field after</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique identifier of the bundle. Used to match the <code>publisher</code> field in associated cards, should now match <code>process</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for process display name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">states.mystate.name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for state display name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">i18nLabelKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">menuLabel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I18n key for menu display name in case there are several menu entries attached to the process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processes array is a root property, states array being a property of a given process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">states array is a root property</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here is an example of a simple config.json file:</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuEntries</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 0</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.first</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.la-rache.com</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.second</span><span class="delimiter">&quot;</span></span>}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">i18nLabelKey</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">businessconfig.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>
            }
          ]
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuLabel</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menuEntries</span><span class="delimiter">&quot;</span></span>: [
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 0</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.first</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid test 1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.la-rache.com</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu.second</span><span class="delimiter">&quot;</span></span>}
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> :<span class="string"><span class="delimiter">&quot;</span><span class="content">mystate.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">template.title</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You should also make sure that the new i18n label keys that you introduce match what is defined in the i18n
folder of the bundle.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_on_the_cards_model"><a class="anchor" href="#_on_the_cards_model"></a>43.1.2.2. On the Cards model</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field before</th>
<th class="tableblock halign-left valign-top">Field after</th>
<th class="tableblock halign-left valign-top">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">publisherVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies the version of the bundle. It was renamed for consistency now that bundles are linked to processes not
publishers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is now required and should match the id field of the process (bundle) to use to render the card.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">processInstanceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is just renamed , it represent an id of an instance of the process</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These changes impact both current cards from the feed and archived cards.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The id of the card is now build as process.processInstanceId an not anymore publisherID_process.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_on_the_web_ui_json"><a class="anchor" href="#_change_on_the_web_ui_json"></a>43.2. Change on the web-ui.json</h3>
<div class="paragraph">
<p>The parameter navbar.thirdmenus.type has been removed from this file. Starting from this release the related functionality has been moved on bundle basis and it&#8217;s not more global. See "Changes on bundle config.json" for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changes_on_bundle_config_json"><a class="anchor" href="#_changes_on_bundle_config_json"></a>43.3. Changes on bundle config.json</h3>
<div class="paragraph">
<p>Under menuEntries a new subproperty has been added: linkType. This property replace the old property navbar.thirdmenus.type in web-ui.json, making possible a more fine control of the related behaviour.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_name"><a class="anchor" href="#_component_name"></a>43.4. Component name</h3>
<div class="paragraph">
<p>We also change the component name of third which is now named businessconfig.</p>
</div>
</div>
<div class="sect2">
<h3 id="_changes_to_the_endpoints"><a class="anchor" href="#_changes_to_the_endpoints"></a>43.5. Changes to the endpoints</h3>
<div class="paragraph">
<p>The <code>/third</code> endpoint becomes <code>/businessconfig/processes</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migration_steps"><a class="anchor" href="#_migration_steps"></a>43.6. Migration steps</h3>
<div class="paragraph">
<p>This section outlines the necessary steps to migrate existing data.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to perform these steps before starting up the OperatorFabric instance because starting up services with the new
version while there are still "old" bundles in the businessconfig storage will cause the businessconfig service to crash.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backup your existing bundles and existing Mongo data.</p>
</li>
<li>
<p>Edit your bundles as detailed above. In particular, if you had bundles containing several processes, you will need to
split them into several bundles. The <code>id</code> of the bundles should match the <code>process</code> field in the corresponding cards.</p>
</li>
<li>
<p>If you use navbar.thirdmenus.type in web-ui.json, rename it to navbar.businessmenus.type</p>
</li>
<li>
<p>Run the following scripts in the mongo shell to copy the value of <code>publisherVersion</code> to a new <code>processVersion</code> field and to copy the value of <code>processId</code> to a new <code>processInstanceId</code> field for all cards (current and archived):</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>+
.Current cards</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.updateMany(
{},
{ $rename: { &quot;publisherVersion&quot;: &quot;processVersion&quot;, &quot;processId&quot;: &quot;processInstanceId&quot; } }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
.Archived cards</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.updateMany(
{},
{ $rename: { &quot;publisherVersion&quot;: &quot;processVersion&quot;, &quot;processId&quot;: &quot;processInstanceId&quot; } }
)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you have no cards without process using the following mongo shell commands:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.find({ process: null})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.find({ process: null})</code></pre>
</div>
</div>
</li>
<li>
<p>If it turns out to be the case, you will need to set a process value for all these cards to finish the migration. You
can do it either manually through Compass or using a mongo shell command. For example, to set the process to "SOME_PROCESS"
for all cards with an empty process, use:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.cards.updateMany(
{ process: null },
{
$set: { &quot;process&quot;: &quot;SOME_PROCESS&quot;}
}
)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">db.archivedCards.updateMany(
{ process: null },
{
$set: { &quot;process&quot;: &quot;SOME_PROCESS&quot;}
}
)</code></pre>
</div>
</div>
</li>
<li>
<p>If you have any code or scripts that push bundles, you should update it to point to the new endpoint.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</body>
</html>