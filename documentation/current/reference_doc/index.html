<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>OperatorFabric Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OperatorFabric Reference Documentation</h1>
<div class="details">
<span id="revnumber">version 4.7.2.RELEASE,</span>
<span id="revdate">20 May 2025</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_sending_cards">2. Sending cards</a>
<ul class="sectlevel2">
<li><a href="#card_structure">2.1. Card Structure</a>
<ul class="sectlevel3">
<li><a href="#_technical_information_of_the_card">2.1.1. Technical Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_mandatory_information">2.1.1.1. Mandatory information</a></li>
<li><a href="#_optional_information">2.1.1.2. Optional information</a></li>
<li><a href="#_business_period">2.1.1.3. Business period</a></li>
<li><a href="#_store_information">2.1.1.4. Store information</a></li>
</ul>
</li>
<li><a href="#_user_destined_information_of_the_card">2.1.2. User destined Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_in_card_format">2.1.2.1. in Card Format</a></li>
<li><a href="#_custom_part">2.1.2.2. Custom part</a></li>
</ul>
</li>
<li><a href="#_presentation_information_of_the_card">2.1.3. Presentation Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_timespans_timespans">2.1.3.1. TimeSpans (<code>timeSpans</code>)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cards_examples">2.2. Cards Examples</a>
<ul class="sectlevel3">
<li><a href="#minimal_card">2.2.1. Minimal Card</a>
<ul class="sectlevel4">
<li><a href="#reception_rules">2.2.1.1. Rules for receiving cards</a></li>
<li><a href="#_send_to_one_user">2.2.1.2. Send to One User</a></li>
<li><a href="#_send_to_several_users">2.2.1.3. Send to several users</a></li>
</ul>
</li>
<li><a href="#_regular_card">2.2.2. Regular Card</a>
<ul class="sectlevel4">
<li><a href="#_full_of_hidden_data">2.2.2.1. Full of Hidden data</a></li>
<li><a href="#_fully_useful">2.2.2.2. Fully useful</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_patching_cards">2.3. Patching cards</a></li>
</ul>
</li>
<li><a href="#_card_rendering">3. Card rendering</a>
<ul class="sectlevel2">
<li><a href="#_process_declaration_and_configuration">3.1. Process: Declaration and Configuration</a>
<ul class="sectlevel3">
<li><a href="#_bundle_as_process_declaration">3.1.1. Bundle as Process declaration</a></li>
<li><a href="#_the_config_json_file">3.1.2. The config.json file</a></li>
<li><a href="#_the_i18n_json_file">3.1.3. The i18n.json file</a>
<ul class="sectlevel4">
<li><a href="#_template_folder">3.1.3.1. Template folder</a></li>
<li><a href="#_processes_and_states">3.1.3.2. Processes and States</a></li>
<li><a href="#_upload">3.1.3.3. Upload</a></li>
</ul>
</li>
<li><a href="#_processes_groups">3.1.4. Processes groups</a></li>
</ul>
</li>
<li><a href="#template_description">3.2. Templates</a>
<ul class="sectlevel3">
<li><a href="#_operatorfabric_specific_handlebars_helpers">3.2.1. OperatorFabric specific handlebars helpers</a>
<ul class="sectlevel4">
<li><a href="#arrayContains">3.2.1.1. arrayContains</a></li>
<li><a href="#arrayContainsOneOf">3.2.1.2. arrayContainsOneOf</a></li>
<li><a href="#bool">3.2.1.3. bool</a></li>
<li><a href="#conditionalAttribute">3.2.1.4. conditionalAttribute</a></li>
<li><a href="#replace">3.2.1.5. replace</a></li>
<li><a href="#dateformat">3.2.1.6. dateFormat</a></li>
<li><a href="#json">3.2.1.7. json</a></li>
<li><a href="#_keepspacesandendofline">3.2.1.8. keepSpacesAndEndOfLine</a></li>
<li><a href="#keyValue">3.2.1.9. keyValue</a></li>
<li><a href="#math">3.2.1.10. math</a></li>
<li><a href="#mergeArrays">3.2.1.11. mergeArrays</a></li>
<li><a href="#now">3.2.1.12. now</a></li>
<li><a href="#numberformat">3.2.1.13. numberFormat</a></li>
<li><a href="#padStart">3.2.1.14. padStart</a></li>
<li><a href="#preservespace">3.2.1.15. preserveSpace</a></li>
<li><a href="#slice">3.2.1.16. slice</a></li>
<li><a href="#sort">3.2.1.17. sort</a></li>
<li><a href="#split">3.2.1.18. split</a></li>
<li><a href="#times">3.2.1.19. times</a></li>
<li><a href="#toBreakage">3.2.1.20. toBreakage</a></li>
<li><a href="#objectContainsKey">3.2.1.21. objectContainsKey</a></li>
<li><a href="#findObjectByProperty">3.2.1.22. findObjectByProperty</a></li>
</ul>
</li>
<li><a href="#_naming_convention">3.2.2. Naming convention</a></li>
<li><a href="#opfab_template_style">3.2.3. OperatorFabric css styles</a>
<ul class="sectlevel4">
<li><a href="#_opfab_input">3.2.3.1. opfab-input</a></li>
<li><a href="#_opfab_textarea">3.2.3.2. opfab-textarea</a></li>
<li><a href="#_opfab_select">3.2.3.3. opfab-select</a></li>
<li><a href="#_opfab_radio_button">3.2.3.4. opfab-radio-button</a></li>
<li><a href="#_opfab_checkbox">3.2.3.5. opfab-checkbox</a></li>
<li><a href="#_opfab_table">3.2.3.6. opfab-table</a></li>
<li><a href="#_opfab_border_box">3.2.3.7. opfab-border-box</a></li>
<li><a href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success">3.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</a></li>
<li><a href="#_opfab_btn_opfab_btn_cancel">3.2.3.9. opfab-btn, opfab-btn-cancel</a></li>
<li><a href="#_opfab_dialog">3.2.3.10. opfab-dialog</a></li>
</ul>
</li>
<li><a href="#_tooltip">3.2.4. Tooltip</a></li>
<li><a href="#_multi_select">3.2.5. Multi Select</a></li>
<li><a href="#_rich_text_editor">3.2.6. Rich Text Editor</a></li>
<li><a href="#_charts">3.2.7. Charts</a></li>
<li><a href="#_custom_javascript_or_css_files">3.2.8. Custom javascript or css files</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_notification">4. Card notification</a>
<ul class="sectlevel2">
<li><a href="#_notification_configuration">4.1. Notification configuration</a></li>
<li><a href="#_sound_notification">4.2. Sound notification</a></li>
<li><a href="#_card_read">4.3. Card read</a></li>
<li><a href="#_card_acknowledgment">4.4. Card acknowledgment</a>
<ul class="sectlevel3">
<li><a href="#_acknowledgment_done_by_the_user">4.4.1. Acknowledgment done by the user</a></li>
<li><a href="#_acknowledgment_done_by_entityies">4.4.2. Acknowledgment done by entity(ies)</a></li>
<li><a href="#_displaying_the_entities_acknowledgments">4.4.3. Displaying the entities acknowledgments</a></li>
</ul>
</li>
<li><a href="#_pin_cards">4.5. Pin cards</a></li>
<li><a href="#card_reminder">4.6. Card reminder</a>
<ul class="sectlevel3">
<li><a href="#_simple_reminder">4.6.1. Simple reminder</a></li>
<li><a href="#_recurrent_reminder">4.6.2. Recurrent reminder</a>
<ul class="sectlevel4">
<li><a href="#_using_rrule_field">4.6.2.1. Using <code>rRule</code> field :</a></li>
</ul>
</li>
<li><a href="#_debugging">4.6.3. Debugging</a></li>
</ul>
</li>
<li><a href="#_hallway_mode">4.7. Hallway mode</a></li>
</ul>
</li>
<li><a href="#_email_notifications">5. Email Notifications</a>
<ul class="sectlevel2">
<li><a href="#_configuring_email_notifications">5.1. Configuring Email Notifications</a></li>
<li><a href="#_email_content">5.2. Email Content</a></li>
<li><a href="#_email_templates">5.3. Email templates</a></li>
</ul>
</li>
<li><a href="#response_cards">6. Response cards</a>
<ul class="sectlevel2">
<li><a href="#_steps_needed_to_use_a_response_card">6.1. Steps needed to use a response card</a>
<ul class="sectlevel3">
<li><a href="#define_a_third_party_tool">6.1.1. Define a third party tool</a></li>
<li><a href="#_configure_the_response_in_config_json">6.1.2. Configure the response in config.json</a></li>
<li><a href="#_design_the_question_form_in_the_template">6.1.3. Design the question form in the template</a></li>
<li><a href="#_define_permissions">6.1.4. Define permissions</a></li>
</ul>
</li>
<li><a href="#_send_a_question_card">6.2. Send a question card</a></li>
<li><a href="#_integrate_child_cards">6.3. Integrate child cards</a>
<ul class="sectlevel3">
<li><a href="#_entity_name">6.3.1. Entity name</a></li>
<li><a href="#_example">6.3.2. Example</a></li>
</ul>
</li>
<li><a href="#_lock_mechanism">6.4. Lock mechanism</a></li>
</ul>
</li>
<li><a href="#user_cards">7. User cards</a>
<ul class="sectlevel2">
<li><a href="#_configure_the_bundle">7.1. Configure the bundle</a></li>
<li><a href="#_method_registerfunctiontogetspecificcardinformation">7.2. Method registerFunctionToGetSpecificCardInformation</a></li>
<li><a href="#_define_permissions_2">7.3. Define permissions</a></li>
<li><a href="#restrict_possible_emitters">7.4. Restrict the list of possible emitter entities</a></li>
<li><a href="#set_recipients_via_code">7.5. Set the list of recipients via the template</a></li>
<li><a href="#_card_editing">7.6. Card editing</a></li>
<li><a href="#_card_copy">7.7. Card copy</a></li>
<li><a href="#_card_delete">7.8. Card delete</a></li>
<li><a href="#_send_response_automatically_experimental_feature">7.9. Send response automatically (experimental feature)</a></li>
<li><a href="#_send_a_card_on_behalf_of_the_user">7.10. send a card on behalf of the user</a></li>
<li><a href="#_misc">7.11. Misc</a></li>
</ul>
</li>
<li><a href="#_built_in_templates">8. Built-in templates</a>
<ul class="sectlevel2">
<li><a href="#_message">8.1. Message</a>
<ul class="sectlevel3">
<li><a href="#_card_template">8.1.1. Card template</a></li>
<li><a href="#_user_card_template">8.1.2. User card template</a></li>
</ul>
</li>
<li><a href="#_question">8.2. Question</a>
<ul class="sectlevel3">
<li><a href="#_card_template_2">8.2.1. Card template</a></li>
<li><a href="#_user_card_template_2">8.2.2. User card template</a></li>
</ul>
</li>
<li><a href="#_message_or_question_list">8.3. Message Or Question List</a>
<ul class="sectlevel3">
<li><a href="#_card_template_3">8.3.1. Card template</a></li>
<li><a href="#_user_card_template_3">8.3.2. User card template</a></li>
</ul>
</li>
<li><a href="#_task">8.4. Task</a>
<ul class="sectlevel3">
<li><a href="#_card_template_4">8.4.1. Card template</a></li>
<li><a href="#_user_card_template_4">8.4.2. User card template</a></li>
</ul>
</li>
<li><a href="#built-in_templates_common_usercard_attributes">8.5. Common attributes for user cards built-in templates</a></li>
</ul>
</li>
<li><a href="#business_data">9. Business Data</a>
<ul class="sectlevel2">
<li><a href="#_pushing_data">9.1. Pushing data</a></li>
<li><a href="#_calling_a_resource">9.2. Calling a resource</a></li>
</ul>
</li>
<li><a href="#_frontend_api">10. Frontend API</a>
<ul class="sectlevel2">
<li><a href="#_users_api">10.1. Users API</a>
<ul class="sectlevel3">
<li><a href="#_entities">10.1.1. Entities</a>
<ul class="sectlevel4">
<li><a href="#_function_getentityname">10.1.1.1. Function getEntityName</a></li>
<li><a href="#_function_getentity">10.1.1.2. Function getEntity</a></li>
<li><a href="#_function_getallentities">10.1.1.3. Function getAllEntities</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_businessconfig_api">10.2. BusinessConfig API</a>
<ul class="sectlevel3">
<li><a href="#_function_registerfunctiontogettags">10.2.1. Function registerFunctionToGetTags</a></li>
</ul>
</li>
<li><a href="#_handlebars_api">10.3. Handlebars API</a>
<ul class="sectlevel3">
<li><a href="#_function_registercustomhelpers">10.3.1. Function registerCustomHelpers</a></li>
</ul>
</li>
<li><a href="#_navigate_api">10.4. Navigate API</a>
<ul class="sectlevel3">
<li><a href="#_function_redirecttobusinessmenu">10.4.1. Function redirectToBusinessMenu</a></li>
<li><a href="#_function_showcarddetail">10.4.2. Function showCardDetail</a></li>
</ul>
</li>
<li><a href="#_currentcard_api">10.5. CurrentCard API</a>
<ul class="sectlevel3">
<li><a href="#_function_displayloadingspinner">10.5.1. Function displayLoadingSpinner</a></li>
<li><a href="#_function_hideloadingspinner">10.5.2. Function hideLoadingSpinner</a></li>
<li><a href="#_function_getchildcards">10.5.3. Function getChildCards</a></li>
<li><a href="#_function_getcard">10.5.4. Function getCard()</a></li>
<li><a href="#_function_isuserallowedtoedit">10.5.5. Function isUserAllowedToEdit</a></li>
<li><a href="#_function_editcard">10.5.6. Function editCard</a></li>
<li><a href="#_function_getdisplaycontext">10.5.7. Function getDisplayContext</a></li>
<li><a href="#_function_getentitiesallowedtorespond">10.5.8. Function getEntitiesAllowedToRespond</a></li>
<li><a href="#_function_getentitiesusableforuserresponse">10.5.9. Function  getEntitiesUsableForUserResponse</a></li>
<li><a href="#_function_isresponselocked">10.5.10. Function isResponseLocked</a></li>
<li><a href="#_function_isuserallowedtorespond">10.5.11. Function isUserAllowedToRespond</a></li>
<li><a href="#_function_isusermemberofanentityrequiredtorespond">10.5.12. Function isUserMemberOfAnEntityRequiredToRespond</a></li>
<li><a href="#_function_listentoresponselock">10.5.13. Function listenToResponseLock</a></li>
<li><a href="#_function_listentoresponseunlock">10.5.14. Function listenToResponseUnlock</a></li>
<li><a href="#_function_listentochildcards">10.5.15. Function listenToChildCards</a></li>
<li><a href="#_function_listentolttdexpired">10.5.16. Function listenToLttdExpired</a></li>
<li><a href="#_function_listentostylechange">10.5.17. Function listenToStyleChange</a></li>
<li><a href="#_function_listentoscreensize">10.5.18. Function listenToScreenSize</a></li>
<li><a href="#_function_listentotemplaterenderingcomplete">10.5.19. Function listenToTemplateRenderingComplete</a></li>
<li><a href="#_function_registerfunctiontogetuserresponse">10.5.20. Function registerFunctionToGetUserResponse</a></li>
</ul>
</li>
<li><a href="#_currentusercard_api">10.6. CurrentUserCard API</a>
<ul class="sectlevel3">
<li><a href="#_function_geteditionmode">10.6.1. Function getEditionMode</a></li>
<li><a href="#_function_getenddate">10.6.2. Function getEndDate</a></li>
<li><a href="#_function_getexpirationdate">10.6.3. Function getExpirationDate</a></li>
<li><a href="#_function_getlttd">10.6.4. Function getLttd</a></li>
<li><a href="#_function_getprocessid">10.6.5. Function getProcessId</a></li>
<li><a href="#_function_getselectedentityrecipients">10.6.6. Function getSelectedEntityRecipients</a></li>
<li><a href="#_function_getselectedentityforinformationrecipients">10.6.7. Function getSelectedEntityForInformationRecipients</a></li>
<li><a href="#_function_getstartdate">10.6.8. Function getStartDate</a></li>
<li><a href="#_function_getstate">10.6.9. Function getState</a></li>
<li><a href="#_function_getuserentitychildcard">10.6.10. Function getUserEntityChildCard</a></li>
<li><a href="#_function_listentoentityusedforsendingcard">10.6.11. Function listenToEntityUsedForSendingCard</a></li>
<li><a href="#_function_registerfunctiontobecalledbeforecardsending">10.6.12. Function  registerFunctionToBeCalledBeforeCardSending</a></li>
<li><a href="#_function_registerfunctiontogetspecificcardinformation">10.6.13. Function registerFunctionToGetSpecificCardInformation</a></li>
<li><a href="#_function_setdropdownentityrecipientlist">10.6.14. Function setDropdownEntityRecipientList</a></li>
<li><a href="#_function_setdropdownentityrecipientforinformationlist">10.6.15. Function setDropdownEntityRecipientForInformationList</a></li>
<li><a href="#_function_setinitialenddate">10.6.16. Function setInitialEndDate</a></li>
<li><a href="#_function_setinitialexpirationdate">10.6.17. Function setInitialExpirationDate</a></li>
<li><a href="#_function_setinitiallttd">10.6.18. Function setInitialLttd</a></li>
<li><a href="#_function_setinitialselectedrecipients">10.6.19. Function setInitialSelectedRecipients</a></li>
<li><a href="#_function_setinitialselectedrecipientsforinformation">10.6.20. Function setInitialSelectedRecipientsForInformation</a></li>
<li><a href="#_function_setselectedrecipients">10.6.21. Function setSelectedRecipients</a></li>
<li><a href="#_function_setselectedrecipientsforinformation">10.6.22. Function setSelectedRecipientsForInformation</a></li>
<li><a href="#_function_setinitialseverity">10.6.23. Function setInitialSeverity</a></li>
<li><a href="#_function_setinitialkeepchildcards">10.6.24. Function setInitialKeepChildCards</a></li>
<li><a href="#_function_setinitialstartdate">10.6.25. Function setInitialStartDate</a></li>
</ul>
</li>
<li><a href="#_utils_api">10.7. Utils API</a>
<ul class="sectlevel3">
<li><a href="#_function_escapehtml">10.7.1. Function escapeHtml</a></li>
</ul>
</li>
<li><a href="#_alertmessage_api">10.8. AlertMessage API</a>
<ul class="sectlevel3">
<li><a href="#_function_show">10.8.1. Function show</a></li>
</ul>
</li>
<li><a href="#_ui_api">10.9. UI API</a>
<ul class="sectlevel3">
<li><a href="#_function_getcurrentvisibleperiod">10.9.1. Function getCurrentVisiblePeriod</a></li>
</ul>
</li>
<li><a href="#_cards_api">10.10. Cards API</a>
<ul class="sectlevel3">
<li><a href="#_function_getcards">10.10.1. Function getCards</a></li>
<li><a href="#_function_sendresponsecard">10.10.2. Function sendResponseCard</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_archived_cards">11. Archived Cards</a>
<ul class="sectlevel2">
<li><a href="#_key_concepts">11.1. Key concepts</a></li>
<li><a href="#_archives_screen_in_the_ui">11.2. Archives screen in the UI</a></li>
</ul>
</li>
<li><a href="#geomap">12. Geographical map</a></li>
<li><a href="#_monitoring">13. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_export_configuration">13.1. Export configuration</a></li>
<li><a href="#_process_monitoring">13.2. Process monitoring</a></li>
</ul>
</li>
<li><a href="#users_management">14. User management</a>
<ul class="sectlevel2">
<li><a href="#_users_groups_entities_and_perimeters">14.1. Users, groups, entities and perimeters</a>
<ul class="sectlevel3">
<li><a href="#_users">14.1.1. Users</a>
<ul class="sectlevel4">
<li><a href="#_automated_user_creation">14.1.1.1. Automated user creation</a></li>
</ul>
</li>
<li><a href="#_entities_2">14.1.2. Entities</a></li>
<li><a href="#_permissions">14.1.3. Permissions</a></li>
<li><a href="#_groups">14.1.4. Groups</a></li>
<li><a href="#_perimeters">14.1.5. Perimeters</a></li>
<li><a href="#_alternative_way_to_manage_groups_and_entities">14.1.6. Alternative way to manage groups and entities</a></li>
</ul>
</li>
<li><a href="#_currently_connected_users">14.2. Currently connected users</a></li>
<li><a href="#_real_time_users">14.3. Real time users</a></li>
<li><a href="#_activity_area">14.4. Activity area</a></li>
<li><a href="#_user_actions_logs">14.5. User actions logs</a></li>
</ul>
</li>
<li><a href="#_ui_customization">15. UI Customization</a>
<ul class="sectlevel2">
<li><a href="#_ui_configuration">15.1. UI configuration</a></li>
<li><a href="#menu_entries">15.2. Menu Entries</a>
<ul class="sectlevel3">
<li><a href="#core_menu_config">15.2.1. Core menus</a></li>
<li><a href="#_custom_business_menus">15.2.2. Custom business menus</a></li>
<li><a href="#_custom_screen_menus">15.2.3. Custom screen menus</a></li>
</ul>
</li>
<li><a href="#card_list_custom_screen">15.3. Card List Custom Screen</a>
<ul class="sectlevel3">
<li><a href="#_cell_size">15.3.1. Cell size</a></li>
<li><a href="#_tooltips">15.3.2. Tooltips</a></li>
<li><a href="#_acknowledgment">15.3.3. Acknowledgment</a></li>
<li><a href="#_response_buttons">15.3.4. Response buttons</a></li>
<li><a href="#_card_data_fields">15.3.5. Card data fields</a></li>
<li><a href="#_current_user_child_card_field">15.3.6. Current user child card field</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_supervisor">16. Supervisor</a>
<ul class="sectlevel2">
<li><a href="#_entities_connection">16.1. Entities connection</a></li>
<li><a href="#_card_acknowledgement">16.2. Card acknowledgement</a></li>
</ul>
</li>
<li><a href="#_external_devices_service">17. External Devices Service</a>
<ul class="sectlevel2">
<li><a href="#_specification">17.1. Specification</a></li>
<li><a href="#_implementation">17.2. Implementation</a>
<ul class="sectlevel3">
<li><a href="#_architecture">17.2.1. Architecture</a></li>
<li><a href="#_configuration_2">17.2.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_configuration_3">17.3. Configuration</a></li>
<li><a href="#_connection_management">17.4. Connection Management</a></li>
<li><a href="#_configuration_management">17.5. Configuration Management</a></li>
<li><a href="#_drivers">17.6. Drivers</a>
<ul class="sectlevel3">
<li><a href="#_modbus_driver">17.6.1. Modbus Driver</a></li>
<li><a href="#_adding_new_drivers">17.6.2. Adding new drivers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_external_applications_integration">18. External Applications Integration</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explain what OperatorFabric is about and define the concepts it relies on</p>
</li>
<li>
<p>Give a basic tour of its features from a user perspective</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform their duties, an operator has to interact with multiple applications
(perform actions, watch for alerts, etc.), which can prove difficult if
there are too many of them.</p>
</div>
<div class="paragraph">
<p>The idea is to aggregate all the notifications from all these applications
into a single screen, and to allow the operator to act on them if needed.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/feed_screenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>These notifications are materialized by <strong>cards</strong> sorted in a <strong>feed</strong> according
to their period of relevance and their severity.
When a card is selected in the feed, the right-hand pane displays the <strong>details</strong>
of the card.</p>
</div>
<div class="paragraph">
<p>In addition, the cards will also translate as events displayed on a <strong>timeline</strong>
 at the top of the screen.</p>
</div>
<div class="paragraph">
<p>Part of the value of OperatorFabric is that it makes the integration very
simple on the part of the third-party applications.
To start publishing cards to users in an OperatorFabric instance, all they
have to do is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register as a publisher through the "Businessconfig" service and provide a "bundle"
containing handlebars templates defining how cards should be rendered,
i18n info etc.</p>
</li>
<li>
<p>Publish cards as json containing card data through the card publication API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OperatorFabric will then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dispatch the cards to the appropriate users (by computing the actual users
who should receive the card from the recipients rules defined in the card)</p>
</li>
<li>
<p>Take care of the rendering of the cards</p>
</li>
<li>
<p>Display relevant information from the cards in the timeline</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A card is not only information, it could be question(s) the operator has to answer.
When the operator is responding, a  card is emitted to the sender of the initial card
and the response could be seen by other operators.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>It is also possible for users to directly send card to other users using predefined card templates.</p>
</div>
<div class="paragraph">
<p>OperatorFabric user interface is running on a browser (recent version of chrome, firefox and edge are supported).</p>
</div>
<div class="paragraph">
<p>The supported screen resolutions are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resolutions greater than or equals to 1680x1050.</p>
</li>
<li>
<p>Resolutions with a width between 450-900px and a minimum height of 700px.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_cards"><a class="anchor" href="#_sending_cards"></a>2. Sending cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cards Publication Service exposes a REST API through which third-party applications, or "publishers" can post cards
to OperatorFabric. It then handles those cards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-stamping them with a "publishDate"</p>
</li>
<li>
<p>Sending them to the message broker (RabbitMQ) to be delivered in real time to the appropriate operators</p>
</li>
<li>
<p>Persisting them to the database (MongoDB) for later consultation</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="card_structure"><a class="anchor" href="#card_structure"></a>2.1. Card Structure</h3>
<div class="paragraph">
<p>Cards are represented as <code>Json</code> objects. The technical design of cards is described in
<a href="/documentation/current/api/cards/">the cards api documentation</a>
. A card correspond to the state of a Process in OperatorFabric.</p>
</div>
<div class="sect3">
<h4 id="_technical_information_of_the_card"><a class="anchor" href="#_technical_information_of_the_card"></a>2.1.1. Technical Information of the card</h4>
<div class="paragraph">
<p>Those attributes are used by OperatorFabric to manage how cards are stored, to whom and when they&#8217;re sent.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_information"><a class="anchor" href="#_mandatory_information"></a>2.1.1.1. Mandatory information</h5>
<div class="paragraph">
<p>Below, the <code>json</code> technical key is in the '()' following the title.</p>
</div>
<div class="sect5">
<h6 id="_publisher_publisher"><a class="anchor" href="#_publisher_publisher"></a>Publisher (<code>publisher</code>)</h6>
<div class="paragraph">
<p>The publisher field bears the identifier of the emitter of the card, be it an entity or an external service.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process"><a class="anchor" href="#card_process"></a>Process (<code>process</code>)</h6>
<div class="paragraph">
<p>This field indicates which process the card is attached to. This information is used to resolve the presentation
resources (bundle) used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process_version"><a class="anchor" href="#card_process_version"></a>Process Version (<code>processVersion</code>)</h6>
<div class="paragraph">
<p>The rendering of cards of a given process can evolve over time. To allow for this while making sure previous cards
remain correctly handled, OperatorFabric can manage several versions of the same process.
The <code>processVersion</code> field indicate which version of the process should be used to retrieve the presentation resources
(i18n, templates, etc.) to render this card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_process_instance_identifier_processinstanceid"><a class="anchor" href="#_process_instance_identifier_processinstanceid"></a>Process Instance Identifier (<code>processInstanceId</code>)</h6>
<div class="paragraph">
<p>A card is associated to a given process, which defines how it is rendered, but it is also more precisely associated to
a <strong>specific instance</strong> of this process. The <code>processInstanceId</code> field contains the unique identifier of the process instance.</p>
</div>
</div>
<div class="sect5">
<h6 id="_state_in_the_process_state"><a class="anchor" href="#_state_in_the_process_state"></a>State in the process (<code>state</code>)</h6>
<div class="paragraph">
<p>The card represents a specific state in the process. In addition to the process, this information is used to resolve the presentation
resources used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="start_date"><a class="anchor" href="#start_date"></a>Start Date (<code>startDate</code>)</h6>
<div class="paragraph">
<p>Start date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_severity_severity"><a class="anchor" href="#_severity_severity"></a>Severity (<code>severity</code>)</h6>
<div class="paragraph">
<p>The severity is a core principe of the OperatorFabric Card system. There are 4 severities available.
A color is associated in the GUI to each severity. Here the details about severity and their meaning for OperatorFabric:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ALARM: represents a critical state of the associated process, need an action from the operator. In the UI, the card is red;</p>
</li>
<li>
<p>ACTION: the associated process need an action form operators in order to evolve correctly. In the UI, the card is orange;</p>
</li>
<li>
<p>COMPLIANT: the process related to the card is in a compliant status. In the UI, the card is green.;</p>
</li>
<li>
<p>INFORMATION: give information to the operator. In the UI, the card is blue.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="card_title"><a class="anchor" href="#card_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>This attribute is display as header of a card in the feed of the GUI. It&#8217;s the main User destined Information of a card. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_summary"><a class="anchor" href="#card_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>This attribute is display as a description of a card in the feed of the GUI, when the card is selected by the operator. It&#8217;s completing the information of the card title. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_information"><a class="anchor" href="#_optional_information"></a>2.1.1.2. Optional information</h5>
<div class="sect5">
<h6 id="end_date"><a class="anchor" href="#end_date"></a>End Date (<code>endDate</code>)</h6>
<div class="paragraph">
<p>End date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_expiration_date_expirationdate"><a class="anchor" href="#_expiration_date_expirationdate"></a>Expiration Date (<code>expirationDate</code>)</h6>
<div class="paragraph">
<p>Expiration date of the active period of the card (process business time). When the expiration date has passed, the card will be automatically removed from the card feed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tags_tag"><a class="anchor" href="#_tags_tag"></a>Tags (<code>tag</code>)</h6>
<div class="paragraph">
<p>Tags are intended as an additional way to filter cards in the feed of the GUI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Grouping cards is an experimental feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tags can also be used to group cards together in the card feed. When <code>feed.enableGroupedCards</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file, cards that have the same tags are grouped together. In the feed window, only the top card will be visible and can be clicked to show  cards with the same tags.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/grouped-cards.png" alt="Closed grouped cards"></span>
<span class="image"><img src="../images/grouped-cards2.png" alt="Open grouped cards"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_entityrecipients_entityrecipients"><a class="anchor" href="#_entityrecipients_entityrecipients"></a>EntityRecipients (<code>entityRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to entity : all users members of the listed entities who have the right for the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_grouprecipients_grouprecipients"><a class="anchor" href="#_grouprecipients_grouprecipients"></a>GroupRecipients (<code>groupRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to groups : all users members of the groups will receive it. If this field is used in conjunction with entityRecipients, to receive the cards :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND one of the groups to receive the cards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND have the right for the process/state of the card.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_userrecipients_userrecipients"><a class="anchor" href="#_userrecipients_userrecipients"></a>UserRecipients (<code>userRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards directly to users without using groups or entities for card routing.</p>
</div>
</div>
<div class="sect5">
<h6 id="_last_time_to_decide_lttd"><a class="anchor" href="#_last_time_to_decide_lttd"></a>Last Time to Decide (<code>lttd</code>)</h6>
<div class="paragraph">
<p>Fixes the moment until when a <code>response</code> is possible for the card. After this moment, the response button won&#8217;t be usable. When lttd time is approaching, a clock is visible on the card in the feed with the residual time.  The lttd time can be set for cards that don&#8217;t expect any response</p>
</div>
</div>
<div class="sect5">
<h6 id="_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"><a class="anchor" href="#_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"></a>SecondsBeforeTimeSpanForReminder (<code>secondsBeforeTimeSpanForReminder</code>)</h6>
<div class="paragraph">
<p>Fixes the time for remind before the event define by the card see
<a href="/documentation/current/reference_doc/index.html#card_reminder">Card reminder</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_publisher_type_publishertype"><a class="anchor" href="#_publisher_type_publishertype"></a>Publisher type (<code>publisherType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The sender is an external service</p>
</li>
<li>
<p>ENTITY - The sender of the card is the user on behalf of the entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_representative_representative"><a class="anchor" href="#_representative_representative"></a>Representative (<code>representative</code>)</h6>
<div class="paragraph">
<p>Used in case of sending card as a representative of an entity or a publisher (unique ID of the entity or publisher)</p>
</div>
</div>
<div class="sect5">
<h6 id="_representative_type_representativetype"><a class="anchor" href="#_representative_type_representativetype"></a>Representative Type (<code>representativeType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The representative is an external service</p>
</li>
<li>
<p>ENTITY - The representative is an entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_geographical_information_wktgeometry_and_wktprojection"><a class="anchor" href="#_geographical_information_wktgeometry_and_wktprojection"></a>Geographical information (<code>wktGeometry</code> and <code>wktProjection</code>)</h6>
<div class="paragraph">
<p>You can add geographical location in  <code>wktGeometry</code> and the projection in <code>wktProjection</code>  fields.</p>
</div>
<div class="paragraph">
<p>When <code>feed.enableMap</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file and the card is visible in the line feed, a geographical map will be drawn. When the card has set its wktGeometry, the location will be highlighted on the card. Two geometrical shapes are supported <code>POINT</code>, which will show a circle on the map, and <code>POLYGON</code> which will draw the specified area on the map.  For example show a circle based on the card location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POINT (5.8946407 51.9848624)&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example to highlight an area on the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POLYGON ((5.5339097 52.0233042,  5.7162495 51.7603784, 5.0036701 51.573684, 4.8339214 52.3547498, 5.5339097 52.0233042))&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specifications of the Well-known Text Representation of coordinate reference systems
can be found at <a href="https://www.ogc.org/standards/wkt-crs">WKT Specification</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the POINT and POLYGON are supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_actions_actions"><a class="anchor" href="#_actions_actions"></a>Actions (<code>actions</code>)</h6>
<div class="paragraph">
<p>A list of predetermined actions that will be executed upon receiving the card. The available actions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KEEP_CHILD_CARDS : used to keep child cards when the parent card is modified.</p>
</li>
<li>
<p>PROPAGATE_READ_ACK_TO_PARENT_CARD : used only for response cards. When receiving the child card, the status of the parent card should be considered as 'unread' and 'not acknowledged' until the user reads or acknowledge it again.</p>
</li>
<li>
<p>KEEP_EXISTING_ACKS_AND_READS : used to keep existing reads and acks when updating a card</p>
</li>
<li>
<p>STORE_ONLY_IN_ARCHIVES : used to store the card only in archivedCards collection and not in cards collection. No notification will be sent to UI, so the card will not be displayed in the feed and in monitoring screen.</p>
</li>
<li>
<p>NOT_NOTIFIED : when this action is set, the card is not visible in the card feed except for the publisher but it is visible in all the other screens : monitoring screen / agenda / timeline.
The card is visible in the feed when the card will be reminded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_business_period"><a class="anchor" href="#_business_period"></a>2.1.1.3. Business period</h5>
<div class="paragraph">
<p>We define the business period as starting form startDate to endDate.  The card will be visible on the UI if the business period overlap the user chosen period (i.e. the period selected on  the timeline). If endDate is not set, the card will be visible as soon as the startDate is between start and end date of the chosen period.</p>
</div>
</div>
<div class="sect4">
<h5 id="_store_information"><a class="anchor" href="#_store_information"></a>2.1.1.4. Store information</h5>
<div class="sect5">
<h6 id="_uid_uid"><a class="anchor" href="#_uid_uid"></a>uid (<code>uid</code>)</h6>
<div class="paragraph">
<p>Unique identifier of the card in the OperatorFabric system. This attribute is always set by OperatorFabric.</p>
</div>
</div>
<div class="sect5">
<h6 id="_id_id"><a class="anchor" href="#_id_id"></a>id (<code>id</code>)</h6>
<div class="paragraph">
<p>State id of the associated process, determined by <code>OperatorFabric</code> can be set arbitrarily by the <code>publisher</code>. The id is determined by 'OperatorFabric' as follows : process.processInstanceId</p>
</div>
</div>
<div class="sect5">
<h6 id="_publish_date_publishdate"><a class="anchor" href="#_publish_date_publishdate"></a>Publish Date (<code>publishDate</code>)</h6>
<div class="paragraph">
<p>Indicates when the card has been registered in <code>OperatorFabric</code> system. This is technical information exclusively managed by <code>OperatorFabric</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_destined_information_of_the_card"><a class="anchor" href="#_user_destined_information_of_the_card"></a>2.1.2. User destined Information of the card</h4>
<div class="paragraph">
<p>There are two kind of User destined information in a card. Some are restricted to the card format, others are defined by the publisher as long as there are encoded in <code>json</code> format.</p>
</div>
<div class="sect4">
<h5 id="_in_card_format"><a class="anchor" href="#_in_card_format"></a>2.1.2.1. in Card Format</h5>
<div class="sect5">
<h6 id="_title_title"><a class="anchor" href="#_title_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>See
<a href="/documentation/current/reference_doc/index.html#card_title">Title</a>
.</p>
</div>
</div>
<div class="sect5">
<h6 id="_summary_summary"><a class="anchor" href="#_summary_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>See
<a href="/documentation/current/reference_doc/index.html#card_summary">Summary</a>
.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_part"><a class="anchor" href="#_custom_part"></a>2.1.2.2. Custom part</h5>
<div class="sect5">
<h6 id="_data_data"><a class="anchor" href="#_data_data"></a>Data (<code>data</code>)</h6>
<div class="paragraph">
<p>Determines where custom information is store. The content in this attribute, is purely <code>publisher</code> choice.
This content, as long as it&#8217;s in <code>json</code> format can be used to display details. For the way the details are
displayed, see below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must not use dot in json field names. In this case, the card will be refused with following message :
"Error, unable to handle pushed Cards: Map key xxx.xxx contains dots but no replacement was configured!""
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_presentation_information_of_the_card"><a class="anchor" href="#_presentation_information_of_the_card"></a>2.1.3. Presentation Information of the card</h4>
<div class="sect4">
<h5 id="_timespans_timespans"><a class="anchor" href="#_timespans_timespans"></a>2.1.3.1. TimeSpans (<code>timeSpans</code>)</h5>
<div class="paragraph">
<p>When the simple startDate and endDate are not enough to characterize your
process business times, you can add a list of TimeSpan to your card. TimeSpans
are rendered in the timeline component as cluster bubbles. This has no effect on the feed
content.</p>
</div>
<div class="paragraph">
<p><strong>example :</strong></p>
</div>
<div class="paragraph">
<p>to display the card two times in the timeline you can add two TimeSpan to your
card:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"publisherVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000},
        {"start" : 1546297500000}
    ]

}</pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, the card will be displayed twice in the timeline. The card
start date will be ignored.</p>
</div>
<div class="paragraph">
<p>For timeSpans, you can specify an end date, but it is not implemented in OperatorFabric (it was intended for future uses, but it will be deprecated).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cards_examples"><a class="anchor" href="#_cards_examples"></a>2.2. Cards Examples</h3>
<div class="paragraph">
<p>Before detailing the content of cards, let&#8217;s show you what cards look like through few examples of json.</p>
</div>
<div class="sect3">
<h4 id="minimal_card"><a class="anchor" href="#minimal_card"></a>2.2.1. Minimal Card</h4>
<div class="paragraph">
<p>The OperatorFabric Card specification defines mandatory attributes, but some optional attributes are needed for cards to be useful in OperatorFabric. Let&#8217;s clarify those point through few examples of minimal cards and what happens when they&#8217;re used as if.</p>
</div>
<div class="sect4">
<h5 id="reception_rules"><a class="anchor" href="#reception_rules"></a>2.2.1.1. Rules for receiving cards</h5>
<div class="paragraph">
<p>Whatever the recipient(s) of the card (user directly, group and/or entity), the user must have the receive right on the process/state of the card to receive it (<code>Receive</code> or <code>ReceiveAndWrite</code>).
So the rules for receiving cards are :</p>
</div>
<div class="paragraph">
<p>1) If the card is sent to user1, the card is received and visible for user1 if he has the receive right for the corresponding process/state</p>
</div>
<div class="paragraph">
<p>2) If the card is sent to GROUP1 (or ENTITY1_FR), the card is received and visible for user if <strong>all</strong> the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of GROUP1 (or ENTITY1_FR)</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3) If the card is sent to ENTITY1_FR and GROUP1, the card is received and visible for user if <strong>all</strong> the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of ENTITY1_FR (either directly or through one of its children entities)</p>
</li>
<li>
<p>he&#8217;s a member of GROUP1</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this chapter, when we talk about receive right, it means <code>Receive</code> or <code>ReceiveAndWrite</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_one_user"><a class="anchor" href="#_send_to_one_user"></a>2.2.1.2. Send to One User</h5>
<div class="paragraph">
<p>The following card contains only the mandatory attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"]

}</pre>
</div>
</div>
<div class="paragraph">
<p>This an information about the process instance <code>process-000</code> of process <code>process</code>, sent by <code>TEST_PUBLISHER</code>. The title and the summary refer to <code>i18n</code> keys
defined in the associated <code>i18n</code> file of the process. This card is displayable since the first january 2019 and
should only be received by the user using the <code>operator1_fr</code> login (provided that this user has receive right on this process/state).</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_several_users"><a class="anchor" href="#_send_to_several_users"></a>2.2.1.3. Send to several users</h5>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group"><a class="anchor" href="#_simple_case_sending_to_a_group"></a>Simple case (sending to a group)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is a group, the <code>Dispatcher</code>. So all users who are members of this group and who have receive right on the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_an_entity"><a class="anchor" href="#_simple_case_sending_to_an_entity"></a>Simple case (sending to an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is an entity, <code>ENTITY1_FR</code>, and there is no group recipient anymore. So all users who are members of this entity and who have a receive right for the process/state of the card will receive it. More information on perimeters can be found in
<a href="/documentation/current/reference_doc/index.html#users_management">user documentation</a></p>
</div>
<div class="paragraph">
<p>Example :
Given this perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id" : "perimeter1",
    "process" : "process",
    "stateRights" : [
        {
            "state" : "myState",
            "right" : "Receive"
        },
        {
            "state" : "myState2",
            "right" : "ReceiveAndWrite"
        }
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Given this group :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Perimeters can only be linked to groups, so let&#8217;s link the perimeter <code>perimeter1</code> to the group <code>group1</code>. You can do this with this command line for example ($token is your access token) :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/perimeters/perimeter1/groups -H "Content-type:application/json" -H "Authorization:Bearer $token" --data "[\"group1\"]"</pre>
</div>
</div>
<div class="paragraph">
<p>Then you can see <code>group1</code> is now :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example",
    "perimeters": ["perimeter1"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the connected user is a member of <code>group1</code>, then he has a <code>Receive</code> right on process/state
<code>process/myState</code> (and also on`process/myState2`). So if the user is also a member of <code>ENTITY1_FR</code>
then he will receive the card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group_and_an_entity"><a class="anchor" href="#_simple_case_sending_to_a_group_and_an_entity"></a>Simple case (sending to a group and an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"],
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipients are a group and an entity, the <code>Dispatcher</code> group and <code>ENTITY1_FR</code> entity. To receive the card, the user must be a member of both ENTITY1_FR and GROUP1 and must have the receive right for the corresponding process/state.</p>
</div>
</div>
<div class="sect5">
<h6 id="_complex_case"><a class="anchor" href="#_complex_case"></a>Complex case</h6>
<div class="paragraph">
<p>If this card need to be viewed by a user who is not in the <code>Dispatcher</code> group, it&#8217;s possible to tune more precisely the
definition of the recipient. If the <code>operator2_fr</code> needs to see also this card, the recipient definition could be(the following code details only the recipient part):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher"],
"userRecipients": ["operator2_fr"]</pre>
</div>
</div>
<div class="paragraph">
<p>So here, all the users of the <code>Dispatcher</code> group will receive the <code>INFORMATION</code> as should the <code>tos2-operator</code> user.</p>
</div>
<div class="paragraph">
<p>Another example, if a card is destined to the operators of <code>Dispatcher</code> and <code>Planner</code> and needs to be also seen by the <code>admin</code>, the recipient configuration looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher", "Planner"],
"userRecipients": ["admin"]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_card"><a class="anchor" href="#_regular_card"></a>2.2.2. Regular Card</h4>
<div class="paragraph">
<p>The previous cards were nearly empty regarding information carrying. In fact, cards are intended to contain more information than a title and a summary. The optional attribute <code>data</code> is here for that. This attribute is destined to contain any <code>json</code> object. The creator of the card is free to put any information needed as long as it&#8217;s in a <code>json</code> format.</p>
</div>
<div class="sect4">
<h5 id="_full_of_hidden_data"><a class="anchor" href="#_full_of_hidden_data"></a>2.2.2.1. Full of Hidden data</h5>
<div class="paragraph">
<p>For this example we will use our previous example for the <code>Dispatcher</code> group with a <code>data</code> attribute containing the definition of a <code>json</code> object containing two attributes: <code>stringExample</code> and <code>numberExample</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"],
	"data":{
		"stringExample":"This is a not so random string of characters.",
		"numberExample":123
		}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This card contains some data but when selected in the feed nothing more than the previous example of card happen because
there is no rendering configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fully_useful"><a class="anchor" href="#_fully_useful"></a>2.2.2.2. Fully useful</h5>
<div class="paragraph">
<p>When a card is selected in the feed (of the GUI), the data is displayed in the detail panel.
The way details are formatted depends on the template contained in the bundle associated with the process as
<a href="/documentation/current/reference_doc/index.html#template_description">described here</a>
. To have an effective example without too many actions to perform, the following example will use an already existing
configuration. You can find the corresponding bundle of the following example in the test directory of OperatorFabric
(src/test/resources/bundles).</p>
</div>
<div class="paragraph">
<p>At the card level, the attributes in the card telling OperatorFabric which template to use are the <code>process</code> and <code>state</code>
attributes, the <code>templateName</code> can be retrieved from the definition of the bundle.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"1",
	"process":"defaultProcess",
	"processInstanceId":"process-000",
	"state":"messageState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"message.title"},
	"summary":{"key":"message.summary"},
	"userRecipients": ["operator1_fr"],
	"data":{"message":"Data displayed in the detail panel"},

}</pre>
</div>
</div>
<div class="paragraph">
<p>So here a single custom data is defined, and it&#8217;s <code>message</code>. This attribute is used by the template called by the
<code>templateName</code> attribute.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_patching_cards"><a class="anchor" href="#_patching_cards"></a>2.3. Patching cards</h3>
<div class="paragraph">
<p>The Cards Publication Service exposes a REST API endpoint through which a card can be patched.
You can find more information in
<a href="/documentation/current/api/cards/">the cards api documentation</a>
. For example, fields like severity, title, summary or data etc&#8230;&#8203; can be patched. However, the fields <code>process</code> and
<code>processInstanceId</code> can not be patched as they are used to identify the card.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_rendering"><a class="anchor" href="#_card_rendering"></a>3. Card rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated above, third applications interact with OperatorFabric by sending cards.</p>
</div>
<div class="paragraph">
<p>The Businessconfig service allows them to tell OperatorFabric for each process how these cards should be rendered including translation if
several languages are supported.  Configuration is done via files zipped in a "bundle", these files are send to OperatorFabric via a REST end point.</p>
</div>
<div class="paragraph">
<p>In addition, it lets third-party applications define additional menu entries for the navbar (for example linking back
to the third-party application) that can be integrated either as iframe or external links.</p>
</div>
<div class="sect2">
<h3 id="_process_declaration_and_configuration"><a class="anchor" href="#_process_declaration_and_configuration"></a>3.1. Process: Declaration and Configuration</h3>
<div class="paragraph">
<p>To declare and configure a <code>Process</code>, OperatorFabric uses <code>bundles</code>.
This section describes their content and how to use them.
An <code>OperatorFabric Process</code> is a way to define a business configuration.
Once this bundle fully created, it must be uploaded to the server through the <code>Businessconfig service</code>.</p>
</div>
<div class="paragraph">
<p>Some examples show how to configure a <code>process</code> using a <code>bundle</code> before diving in more technical details of the configuration.
The following instructions describe tests to perform on OperatorFabric to understand how customizations are possible.</p>
</div>
<div class="sect3">
<h4 id="_bundle_as_process_declaration"><a class="anchor" href="#_bundle_as_process_declaration"></a>3.1.1. Bundle as Process declaration</h4>
<div class="paragraph">
<p>A bundle contains all the configuration regarding a given business process, describing for example the various steps of the process but also how the associated cards and card details should be displayed.</p>
</div>
<div class="paragraph">
<p>Bundle are technically <code>tar.gz</code> archives containing at least a descriptor file named <code>config.json</code>.
To display the card date, some <code>css files</code>, <code>i18n file</code> and <code>handlebars templates</code> must be added.</p>
</div>
<div class="paragraph">
<p>For didactic purposes, in this section, the businessconfig bundle name is <code>BUNDLE_TEST</code> (to match the parameters used by the script).
The l10n (localization) configurations is English.</p>
</div>
<div class="paragraph">
<p>As detailed in the <code>Businessconfig core service README</code> the bundle contains at least a metadata file called <code>config.json</code>, a file <code>i18n.json</code>, a <code>css</code> folder and a <code>template</code> folder.</p>
</div>
<div class="paragraph">
<p>Except for the <code>config.json file</code>, all elements are optional.</p>
</div>
<div class="paragraph">
<p>The file organization within a bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bundle
├── config.json
├── i18n.json
├── css
│   └── bundleTest.css
└── template
    ├── template1.handlebars
    └── template2.handlebars</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_config_json_file"><a class="anchor" href="#_the_config_json_file"></a>3.1.2. The config.json file</h4>
<div class="paragraph">
<p>It&#8217;s a description file in <code>json</code> format.
It lists the content of the bundle.</p>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uiVisibility</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">monitoring</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logging</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">state.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Never</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: id of the process;</p>
</li>
<li>
<p><code>name</code>: process name;</p>
</li>
<li>
<p><code>version</code>: enables the correct display of the card data, even for the old ones.
The server store the previous versions in its file system.
This field value should match a businessconfig configuration for a correct rendering;</p>
</li>
<li>
<p><code>states</code>: lists the available states which each declares associated actions, associated templates and if cards could be acknowledged by users;</p>
</li>
<li>
<p><code>uiVisibility</code>: in the monitoring, logging and calendar screens, not all the cards are visible, it depends on the business process they are part of. For a card to be visible in these screens, the corresponding parameter must be set to true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mandatory field are <code>id</code>,<code>name</code> and <code>version</code>.</p>
</div>
<div class="paragraph">
<p>See the
<a href="/documentation/current/api/businessconfig/index.html">Businessconfig API documentation</a>
for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_i18n_json_file"><a class="anchor" href="#_the_i18n_json_file"></a>3.1.3. The i18n.json file</h4>
<div class="paragraph">
<p>This file contains internationalization information, in particular the translation for title and summary fields
If there is no i18n file or key is missing, OperatorFabric displays i18n key, such as <code>BUNDLE_TEST.1.missing-i18n-key</code>.
In the case where the bundle declares no i18n key corresponds to <code>missing-i18n-key</code>.</p>
</div>
<div class="paragraph">
<p>The choice of i18n keys is up to the maintainer of the Businessconfig process.</p>
</div>
<div class="sect4">
<h5 id="_template_folder"><a class="anchor" href="#_template_folder"></a>3.1.3.1. Template folder</h5>
<div class="paragraph">
<p>The <code>template</code> folder contains one template file for each process/state. They will be used for the card details rendering.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>For this example, the name of the process is  <code>Bundle Test</code> and its technical name is <code>BUNDLE_TEST</code>.
The bundle provides an english l10n.</p>
</div>
<div class="paragraph">
<p>Title and summary have to be localized.</p>
</div>
<div class="paragraph">
<p>Here is the content of <code>i18n.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span> 
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the i18n, after the upload of the bundle, use a <code>GET</code> request against the <code>businessconfig</code> service.
The simpler is to ask for the i18n file, as described
<a href="/documentation/current/api/businessconfig/index.html#/businessconfig/getI18n">here</a>
.</p>
</div>
<div class="paragraph">
<p>Set the <code>version</code> of the bundle and the <code>technical name</code> of the businessconfig party to get json in the response.</p>
</div>
<div class="paragraph">
<p>For example, to check if the french l10n data of the version 1 of the <code>BUNDLE_TEST</code> businessconfig party use the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl "http://localhost:2100/businessconfig/processes/BUNDLE_TEST/i18n?version=1" \
-H  "Authorization: Bearer ${token}"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid token for OperatorFabric use.</p>
</div>
<div class="paragraph">
<p>The <code>businessconfig</code> service should answer with a 200 status associated with the following json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span> 
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processes_and_states"><a class="anchor" href="#_processes_and_states"></a>3.1.3.2. Processes and States</h5>
<div class="paragraph">
<p>Each Process declares associated states.
Each state declares specific templates for card details and specific actions.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to display elements of businessconfig card data in a custom format.</p>
</div>
<div class="sect5">
<h6 id="_configuration"><a class="anchor" href="#_configuration"></a>configuration</h6>
<div class="paragraph">
<p>The process entry in the configuration file is a dictionary of processes, each key maps to a process definition.
A process definition is itself a dictionary of states, each key maps to a state definition.</p>
</div>
</div>
<div class="sect5">
<h6 id="_templates"><a class="anchor" href="#_templates"></a>Templates</h6>
<div class="paragraph">
<p>For demonstration purposes, there will be two simple templates.
For more advance feature go to the section detailing the handlebars templates and associated helpers available in OperatorFabric.
As the card used in this example are created above, the bundle template folder needs to contain 2 templates: <code>template1.handlebars</code> and <code>template2.handlebars</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples of template (i18n versions)</strong></p>
</div>
<div class="paragraph">
<p>The following template displays a title and a line containing the value of the scope property <code>card.level1.level1Prop</code>.
The value of this key is '<em>This is a root property</em>'.</p>
</div>
<div class="paragraph">
<p><code>/template/template1.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Template Number One<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following template example displays also a title and a list of numeric values from 1 to 3.</p>
</div>
<div class="paragraph">
<p><code>/template/template2.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Second Template<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        {{#each card.data.level1.level1Array}}
                <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bunle-test-list-item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{this.level1ArrayProp}}<span class="tag">&lt;/li&gt;</span>
        {{/each}}
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_css"><a class="anchor" href="#_css"></a>CSS</h6>
<div class="paragraph">
<p>This folder contains regular css files.
The file name must be declared in the <code>config.json</code> file in order to be used in the templates and applied to them.</p>
</div>
<div class="sect6">
<h7 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h7>
<div class="paragraph">
<p>As above, all parts of files irrelevant for our example are symbolised by a <code>…</code> character.</p>
</div>
<div class="paragraph">
<p><strong>Declaration of css files in <code>config.json</code> file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
        <span class="error">…</span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">state1</span><span class="delimiter">&quot;</span></span> : {
                  <span class="error">…</span>
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest</span><span class="delimiter">&quot;</span></span>]
                  }
              }
        <span class="error">…</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CSS Class used in <code>./template/template1.handlebars</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">        …
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span>
        …</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, the value of <code>{{card.data.level1.level1Prop}}</code> of a test card is <code>This is a level1 property</code></p>
</div>
<div class="paragraph">
<p><strong>Style declaration in <code>./css/bundleTest.css</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.h2</span>{
        <span class="key">color</span>:<span class="color">#fd9312</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected result</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/expected-result.png" alt="Formatted root property">
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_upload"><a class="anchor" href="#_upload"></a>3.1.3.3. Upload</h5>
<div class="paragraph">
<p>To upload a bundle to the OperatorFabric server use a <code>POST</code> http request as described in the
<a href="/documentation/current/api/businessconfig/.html#/businessconfig/uploadBundle">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${BUNDLE_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processes&quot;\
        -H  &quot;accept: application/json&quot;\
        -H  &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@bundle-test.tar.gz;type=application/gzip&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${BUNDLE_FOLDER}</code> is the folder containing the bundle archive to be uploaded.</p>
</li>
<li>
<p><code>bundle-test.tar.gz</code> is the name of the uploaded bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command line should return a <code>200 http status</code> response with the details of the bundle in the response body such as :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template1</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template2</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest.css</span><span class="delimiter">&quot;</span></span> ]
          }
      }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further help check the
<a href="/documentation/current/getting_started/index.html#troubleshooting_bundle">Troubleshooting</a>
section which resumes how to resolve common problems.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processes_groups"><a class="anchor" href="#_processes_groups"></a>3.1.4. Processes groups</h4>
<div class="paragraph">
<p>OperatorFabric offers the possibility of defining process groups. These groups have an impact only on the UI, for
example on the notification configuration screen, by offering a more organized view of all the processes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A process can only belong to one process group.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To define processes groups, you have to upload a file via a <code>POST</code> http request as described in the</p>
</div>
<div class="paragraph">
<p><a href="/documentation/current/api/businessconfig/index.html#/default/uploadProcessgroups">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${PROCESSES_GROUPS_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processgroups&quot;\
        -H &quot;accept: application/json&quot;\
        -H &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@processesGroups.json&quot;\
        -H &quot;Authorization: Bearer ${token}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${PROCESSES_GROUPS_FOLDER}</code> is the folder containing the processes groups file to upload.</p>
</li>
<li>
<p><code>processesGroups.json</code> is the name of the uploaded file.</p>
</li>
<li>
<p><code>${token}</code> is a valid token for OperatorFabric use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of content for uploaded file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process1</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process2</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process3</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process4</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These command line should return a <code>201 http status</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_description"><a class="anchor" href="#template_description"></a>3.2. Templates</h3>
<div class="paragraph">
<p>Templates are <a href="https://handlebarsjs.com/">Handlebars</a> template files. Templates
are then filled with data coming from two sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>card</strong> property (See
<a href="/documentation/current/api/cards/index.html">card data model</a>
for more information)</p>
</li>
<li>
<p>a <strong>userContext</strong> :</p>
<div class="ulist">
<ul>
<li>
<p><strong>login</strong>: user login</p>
</li>
<li>
<p><strong>token</strong>: user jwt token</p>
</li>
<li>
<p><strong>firstName</strong>: user first name</p>
</li>
<li>
<p><strong>lastName</strong>: user last name</p>
</li>
<li>
<p><strong>groups</strong> : user groups as an array of groups ID</p>
</li>
<li>
<p><strong>entities</strong> : user entities as an array of entities ID</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use these data in the template , you need to reference them inside double braces. For example if you want to display the user login:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Your login is : {{userContext.login}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display specific business data from the card, write for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>My data : {{card.data.mydataField}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look to  <a href="https://handlebarsjs.com/" class="bare">handlebarsjs.com/</a> for more information on the templating mechanism.</p>
</div>
<div class="paragraph">
<p>In addition to Handlebars basic syntax and helpers, OperatorFabric defines the
following helpers :</p>
</div>
<div class="sect3">
<h4 id="_operatorfabric_specific_handlebars_helpers"><a class="anchor" href="#_operatorfabric_specific_handlebars_helpers"></a>3.2.1. OperatorFabric specific handlebars helpers</h4>
<div class="sect4">
<h5 id="arrayContains"><a class="anchor" href="#arrayContains"></a>3.2.1.1. arrayContains</h5>
<div class="paragraph">
<p>Verify if an array contains a specified element. If the array does contain the element, it returns true. Otherwise, it returns false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p {{#if (arrayContains colors 'red')}}class="text-danger"{{/if}}&gt;test&lt;/p&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If the colors array contains 'red', the output is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p class="text-danger"&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="arrayContainsOneOf"><a class="anchor" href="#arrayContainsOneOf"></a>3.2.1.2. arrayContainsOneOf</h5>
<div class="paragraph">
<p>If the first array contains at least one element of the second array, return true. Otherwise, return false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (arrayContainsOneOf arr1 arr2)}}
  &lt;p&gt;Arr1 contains at least one element of arr2&lt;/p&gt;
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bool"><a class="anchor" href="#bool"></a>3.2.1.3. bool</h5>
<div class="paragraph">
<p>returns a boolean result value on an arithmetical operation (including object
equality) or boolean operation.</p>
</div>
<div class="paragraph">
<p>Arguments: - v1: left value operand - op: operator (string value) - v2: right
value operand</p>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>==</p>
</li>
<li>
<p>===</p>
</li>
<li>
<p>!=</p>
</li>
<li>
<p>!==</p>
</li>
<li>
<p>&lt;</p>
</li>
<li>
<p>&#8656;</p>
</li>
<li>
<p>&gt;</p>
</li>
<li>
<p>&gt;=</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>boolean operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp;&amp;</p>
</li>
<li>
<p>||</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (bool v1 '&lt;' v2)}}
  v1 is strictly lower than v2
{{else}}
 V2 is lower or equal to v1
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditionalAttribute"><a class="anchor" href="#conditionalAttribute"></a>3.2.1.4. conditionalAttribute</h5>
<div class="paragraph">
<p>Adds the specified attribute to an HTML element if the given condition is truthy.
This is useful for attributes such as <code>checked</code> where it is the presence or absence of the attribute that matters (i.e.
an checkbox with <code>checked=false</code> will still be checked).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;input type="checkbox" id="optionA" {{conditionalAttribute card.data.optionA 'checked'}}&gt;&lt;/input&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="replace"><a class="anchor" href="#replace"></a>3.2.1.5. replace</h5>
<div class="paragraph">
<p>Replaces all the occurrences in a given string
You should specify the substring to find, what to replace it with and the input string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{replace "&amp;lt;p&amp;gt;" "&lt;p&gt;"  this.value}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dateformat"><a class="anchor" href="#dateformat"></a>3.2.1.6. dateFormat</h5>
<div class="paragraph">
<p>formats the submitted parameters (millisecond since epoch) using
<a href="https://date-fns.org//">date-fns format</a>. The locale used is the current user
selected one, the format is "format" hash parameter
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthday format="MMMM Do yyyy, h:mm:ss a"}}</pre>
</div>
</div>
<div class="paragraph">
<p><em>Note</em><br>
You can also pass a milliseconds value as a string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthdayAsString format="MMMM Do yyyy, h:mm:ss a"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="json"><a class="anchor" href="#json"></a>3.2.1.7. json</h5>
<div class="paragraph">
<p>Convert the element in json, this can be useful to use the element as a javascript object in the template. For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var myAttribute = {{json data.myAttribute}};</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_keepspacesandendofline"><a class="anchor" href="#_keepspacesandendofline"></a>3.2.1.8. keepSpacesAndEndOfLine</h5>
<div class="paragraph">
<p>Convert a string to a light HTML by replacing :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>each new line character with &lt;br/&gt;</p>
</li>
<li>
<p>spaces with &amp;nbsp; when there is at least two consecutive spaces.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="keyValue"><a class="anchor" href="#keyValue"></a>3.2.1.9. keyValue</h5>
<div class="paragraph">
<p>This allows to traverse a map.</p>
</div>
<div class="paragraph">
<p>Notice that this should normally be feasible by using the built-in each helper, but a client was having some troubles using it so we added this custom helper.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#keyValue studentGrades}}
  &lt;p&gt; {{index}} - {{key}}: {{value}} &lt;/p&gt;
{{/keyValue}}</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the studentGrades map is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  'student1': 15,
  'student2': 12,
  'student3': 9
}</pre>
</div>
</div>
<div class="paragraph">
<p>The output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt; 0 - student1: 15&lt;/p&gt;
&lt;p&gt; 1 - student2: 12&lt;/p&gt;
&lt;p&gt; 2 - student3: 9&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="math"><a class="anchor" href="#math"></a>3.2.1.10. math</h5>
<div class="paragraph">
<p>returns the result of a mathematical operation.</p>
</div>
<div class="paragraph">
<p>arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>v1: left value operand</p>
</li>
<li>
<p>op: operator (string value)</p>
</li>
<li>
<p>v2: right value operand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>+</p>
</li>
<li>
<p>-</p>
</li>
<li>
<p>*</p>
</li>
<li>
<p>/</p>
</li>
<li>
<p>%</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{math 1 '+' 2}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mergeArrays"><a class="anchor" href="#mergeArrays"></a>3.2.1.11. mergeArrays</h5>
<div class="paragraph">
<p>Return an array that is a merge of the two arrays.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#each (mergeArrays arr1 arr2)}}
  &lt;p&gt;{{@index}} element: {{this}}&lt;/p&gt;
{{/each}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="now"><a class="anchor" href="#now"></a>3.2.1.12. now</h5>
<div class="paragraph">
<p>outputs the current date in millisecond from epoch. The date is computed from
application internal time service and thus may be different from the date that
one can compute from javascript api which relies on the browsers' system time.</p>
</div>
<div class="paragraph">
<p>NB: Due to Handlebars limitation you must provide at least one argument to
helpers otherwise, Handlebars will confuse a helper and a variable. In the
bellow example, we simply pass an empty string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;{{now ""}}&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;{{dateFormat (now "") format="MMMM Do YYYY, h:mm:ss a"}}&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;1551454795179&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;mars 1er 2019, 4:39:55 pm&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for a local set to <code>FR_fr</code></p>
</div>
</div>
<div class="sect4">
<h5 id="numberformat"><a class="anchor" href="#numberformat"></a>3.2.1.13. numberFormat</h5>
<div class="paragraph">
<p>formats a number parameter using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/NumberFormat">Intl.NumberFormat</a>.
The locale used is the current user selected one, and options are passed as hash
parameters (<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{numberFormat card.data.price style="currency" currency="EUR"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="padStart"><a class="anchor" href="#padStart"></a>3.2.1.14. padStart</h5>
<div class="paragraph">
<p>pads the start of a string with a specific string to a certain length using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/String/padStart">String.prototype.padStart()</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{padStart card.data.byhour 2 '0'}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="preservespace"><a class="anchor" href="#preservespace"></a>3.2.1.15. preserveSpace</h5>
<div class="paragraph">
<p>preserves space in parameter string to avoid html standard space trimming.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{preserveSpace card.data.businessId}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="slice"><a class="anchor" href="#slice"></a>3.2.1.16. slice</h5>
<div class="paragraph">
<p>extracts a sub array from ann array</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 0 2)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 1)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;bar&lt;/li&gt;
  &lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sort"><a class="anchor" href="#sort"></a>3.2.1.17. sort</h5>
<div class="paragraph">
<p>sorts an array or some object&#8217;s properties (first argument) using an optional
field name (second argument) to sort the collection on this fields natural
order.</p>
</div>
<div class="paragraph">
<p>If there is no field argument provided :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an array, the original order of the array is kept ;</p>
</li>
<li>
<p>for an object, the structure is sorted by the object field name.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
users :

{"john": { "firstName": "John", "lastName": "Cleese"},
"graham": { "firstName": "Graham", "lastName": "Chapman"},
"terry": { "firstName": "Terry", "lastName": "Gilliam"},
"eric": { "firstName": "Eric", "lastName": "Idle"},
"terry": { "firstName": "Terry", "lastName": "Jones"},
"michael": { "firstName": "Michael", "lastName": "Palin"},
--&gt;

&lt;ul&gt;
{{#each (sort users)}}
    &lt;li&gt;{{this.firstName}} {{this.lastName}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (sort users "lastName")}}
    &lt;li&gt;{{this.firstName}} {{this.lastName&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="split"><a class="anchor" href="#split"></a>3.2.1.18. split</h5>
<div class="paragraph">
<p>splits a string into an array based on a split string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (split 'my.example.string' '.')}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;my&lt;/li&gt;
  &lt;li&gt;example&lt;/li&gt;
  &lt;li&gt;string&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="times"><a class="anchor" href="#times"></a>3.2.1.19. times</h5>
<div class="paragraph">
<p>Allows to perform the same action a certain number of times. Internally, this uses a for loop.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#times 3}}
  &lt;p&gt;test&lt;/p&gt;
{{/times}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="toBreakage"><a class="anchor" href="#toBreakage"></a>3.2.1.20. toBreakage</h5>
<div class="paragraph">
<p>Change the breakage of a string. The arguments that you can specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lowercase &#8658; The string will be lowercased</p>
</li>
<li>
<p>uppercase &#8658; The string will be uppercased</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>{{toBreakage key 'lowercase'}}s</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the key variable is "TEST", the output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tests</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="objectContainsKey"><a class="anchor" href="#objectContainsKey"></a>3.2.1.21. objectContainsKey</h5>
<div class="paragraph">
<p>Verify if a JavaScript object contains the specified key. It returns true if it contains it, false otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{objectContainsKey card.data.myObject 'myKey' }}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="findObjectByProperty"><a class="anchor" href="#findObjectByProperty"></a>3.2.1.22. findObjectByProperty</h5>
<div class="paragraph">
<p>Searching directly an object in a list using the value of a property. Returns the object if it contains it, null otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#with (findObjectByProperty card.data.myObjectsList propertyName propertyValue)}}
  &lt;p&gt;Property value of found object: {{this.propertyName}}&lt;/p&gt;
{{/with}}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_naming_convention"><a class="anchor" href="#_naming_convention"></a>3.2.2. Naming convention</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please do not prefix <code>id</code> attributes of DOM elements or css class names of your templates with "opfab". Indeed, so that there is no confusion between the elements of OperatorFabric and those of your templates, we have prefixed all our <code>id</code> attributes and css classes with "opfab".
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="opfab_template_style"><a class="anchor" href="#opfab_template_style"></a>3.2.3. OperatorFabric css styles</h4>
<div class="paragraph">
<p>OperatorFabric defines several css classes that you should use so your templates don&#8217;t clash with the rest of the OperatorFabric look and feel. These styles are especially useful for templates used in user card or card with responses.</p>
</div>
<div class="paragraph">
<p>Your can find example using these classes in the OperatorFabric core repository (<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles">src/test/resources/bundles</a>).</p>
</div>
<div class="paragraph">
<p>The following css styles are available.</p>
</div>
<div class="sect4">
<h5 id="_opfab_input"><a class="anchor" href="#_opfab_input"></a>3.2.3.1. opfab-input</h5>
<div class="paragraph">
<p>An input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-input"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;input id="my_input" name="my_input"&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_textarea"><a class="anchor" href="#_opfab_textarea"></a>3.2.3.2. opfab-textarea</h5>
<div class="paragraph">
<p>A text area input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-textarea"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;textarea id="my_textearea_input" name="my_textearea_input"&gt; &lt;/textarea&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_select"><a class="anchor" href="#_opfab_select"></a>3.2.3.3. opfab-select</h5>
<div class="paragraph">
<p>A select input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-select" style="position:relative"&gt;
      &lt;label&gt; My select label &lt;/label&gt;
      &lt;select id="my_select" name="my_select"&gt;
          &lt;option  value="option1"&gt; Option 1 &lt;/option&gt;
          &lt;option  value="option2"&gt; Option 2&lt;/option&gt;
      &lt;/select&gt;
  &lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The use of <code>position:relative</code> is important here to avoid strange positioning of the label.</p>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_radio_button"><a class="anchor" href="#_opfab_radio_button"></a>3.2.3.4. opfab-radio-button</h5>
<div class="paragraph">
<p>A radio button input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-radio-button"&gt;
      &lt;span&gt; My radio choice &lt;/span&gt;
      &lt;input type="radio" id="my_radio_button"&gt;
      &lt;span class="opfab-radio-button-checkmark"&gt;&lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_checkbox"><a class="anchor" href="#_opfab_checkbox"></a>3.2.3.5. opfab-checkbox</h5>
<div class="paragraph">
<p>A checkbox input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-checkbox"&gt;
    My checkbox text
    &lt;input type="checkbox" id="my_checkbox" name="my_checkbox" &gt;
    &lt;span class="opfab-checkbox-checkmark"&gt; &lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_table"><a class="anchor" href="#_opfab_table"></a>3.2.3.6. opfab-table</h5>
<div class="paragraph">
<p>An HTML table, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-table"&gt;
    &lt;table&gt;
        .....
    &lt;/table&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_border_box"><a class="anchor" href="#_opfab_border_box"></a>3.2.3.7. opfab-border-box</h5>
<div class="paragraph">
<p>A box with a label, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-border-box"&gt;
    &lt;label&gt;  My box name  &lt;/label&gt;
    &lt;div&gt; My box text &lt;/div&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_color_danger_opfab_color_warning_and_opfab_color_success"><a class="anchor" href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success"></a>3.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</h5>
<div class="paragraph">
<p>Some styles for text standard colors, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;span class="opfab-color-danger"&gt; my text in color &lt;/span&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_btn_opfab_btn_cancel"><a class="anchor" href="#_opfab_btn_opfab_btn_cancel"></a>3.2.3.9. opfab-btn, opfab-btn-cancel</h5>
<div class="paragraph">
<p>Styles for buttons, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;button type="button" class="opfab-btn"&gt;OK&lt;/button&gt;
  &lt;button type="button" class="opfab-btn-cancel"&gt;CANCEL&lt;/button&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_dialog"><a class="anchor" href="#_opfab_dialog"></a>3.2.3.10. opfab-dialog</h5>
<div class="paragraph">
<p>Styles for dialog box, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;dialog class="opfab-dialog"&gt;
    &lt;p&gt;This is a dialog box, you can set the text you want.&lt;/p&gt;
    &lt;form method="dialog" style="text-align: center"&gt;
        &lt;button class="opfab-btn"&gt;OK&lt;/button&gt;
    &lt;/form&gt;
  &lt;/dialog&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tooltip"><a class="anchor" href="#_tooltip"></a>3.2.4. Tooltip</h4>
<div class="paragraph">
<p>OperatorFabric provides a css tooltip component. To use it, you must use the <code>opfab-tooltip</code> class style. You can define
where the tooltip will be displayed using <code>left</code>, <code>top</code> or <code>bottom</code> (by default, it is displayed on the right). For
example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="opfab-tooltip"&gt;Some tooltip text
    &lt;div class="opfab-tooltip-content"&gt;Here is an example of tooltip&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>or for a tooltip displayed on the left :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="opfab-tooltip"&gt;Some tooltip text
    &lt;div class="opfab-tooltip-content left"&gt;Here is an example of tooltip&lt;/div&gt;
&lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_select"><a class="anchor" href="#_multi_select"></a>3.2.5. Multi Select</h4>
<div class="paragraph">
<p>OperatorFabric provides a multiselect component based on <a href="https://sa-si-dev.github.io/virtual-select/#/">Virtual Select</a>. To use it, one must use the OperatorFabric style and provide javascript to initialize the component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY MULTI SELECT   &lt;/label&gt;
        &lt;div id="my-multiselect"&gt;&lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;
  myMultiSelect = opfab.multiSelect.init({
                id: "my-multiselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: true,
                search: true
            });


  opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(() =&gt; {

        const selectedValues = myMultiSelect.getSelectedValues();
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can set selected values via method setSelectedValues();</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  myMultiSelect.setSelectedValues(['A','B']);</pre>
</div>
</div>
<div class="paragraph">
<p>If you want to set the options list after init, use setOptions method :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  var options = [
    { label: 'Options 1', value: '1' },
    { label: 'Options 2', value: '2' },
    { label: 'Options 3', value: '3' },
  ];

  myMultiSelect.setOptions(options);</pre>
</div>
</div>
<div class="paragraph">
<p>You can enable (or disable) the multiselect component using enable (or disable) method :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  myMultiSelect.enable();
  myMultiSelect.disable();</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It strongly advice to NOT use directly virtual select (always use OperatorFabric js object and css) otherwise you will not be guaranteed compatibility when upgrading.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to use the component also as single value select. The advantage over a standard select is the possibility to benefit of the searching feature. To use the component as single select, initialize it with the <code>multiple</code> property set to false:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY SINGLE SELECT   &lt;/label&gt;
        &lt;div id="my-singleselect"&gt;
        &lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;

  opfab.multiSelect.init({
                id: "my-singleselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: false,
                search: true
            });


   opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(()  =&gt; {

        const selectedValues = document.getElementById('my-singleselect').value;

      ....</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rich_text_editor"><a class="anchor" href="#_rich_text_editor"></a>3.2.6. Rich Text Editor</h4>
<div class="paragraph">
<p>OperatorFabric provides a rich text editor component based on <a href="https://github.com/quilljs/quill" class="bare">github.com/quilljs/quill</a>.
The component provides the following text formatting tools :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Headings</p>
</li>
<li>
<p>Color</p>
</li>
<li>
<p>Bold</p>
</li>
<li>
<p>Underline</p>
</li>
<li>
<p>Italics</p>
</li>
<li>
<p>Link</p>
</li>
<li>
<p>Align</p>
</li>
<li>
<p>Bullet list</p>
</li>
<li>
<p>Ordered list</p>
</li>
<li>
<p>Indent</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the rich text editor component just add a &lt;opfab-richtext-editor&gt; tag in the template using the OperatorFabric style. From javascript it is then possible to get formatted text content.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        &lt;div class="opfab-textarea"&gt;
            &lt;label&gt; MESSAGE &lt;/label&gt;
            &lt;opfab-richtext-editor id="quill"&gt;{{card.data.richMessage}}&lt;/opfab-richtext-editor&gt;
        &lt;/div&gt;

 &lt;script&gt;

  const quillEditor = document.getElementById('quill');

  opfab.currentUserCard.registerFunctionToGetSpecificCardInformation(() =&gt; {

        const editorContent = quillEditor.getContents();
        const editorHtml = quillEditor.getHtml();
  ...</pre>
</div>
</div>
<div class="paragraph">
<p>The editor use a custom JSON format called Delta to store the formatted content. To get the JSON content as a string you can call the <code>getContents()</code> method. To get the HTML formatted text you can call the <code>getHtml()</code> method.</p>
</div>
<div class="paragraph">
<p>To set the initial content of the editor you can either call the <code>setContents(delta)</code> method from javascript  providing the content as Delta JSON string or directly in the template by putting the Delta JSON string as content of the &lt;opfab-richtext-editor&gt; tag.</p>
</div>
<div class="paragraph">
<p>Opfab provides a utility to obtain the Delta JSON representation of a rich text. This utility is available at the following link : <a href="http://localhost:2002/#/devtools/richtext" class="bare">localhost:2002/#/devtools/richtext</a>
The tool allows you to convert a rich text formatted using the visual editor into the corresponding Delta JSON format.</p>
</div>
<div class="paragraph">
<p>It is possible to disable/enable the editor by calling the <code>enable(enabled: boolean)</code> method.</p>
</div>
<div class="paragraph">
<p>To show the rich message in an HTML element you can call the <code>opfab.richTextEditor.showRichMessage(element)</code> method. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;span id="richMessage"&gt;{{card.data.richMessage}}&lt;/span&gt;

&lt;script&gt;

  opfab.richTextEditor.showRichMessage(document.getElementById("richMessage"));

  ...
&lt;/script&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_charts"><a class="anchor" href="#_charts"></a>3.2.7. Charts</h4>
<div class="paragraph">
<p>The library <a href="https://www.chartjs.org/">charts.js</a> is integrated in OperatorFabric, it means it&#8217;s possible to show charts in cards, you can find a bundle example in the operator fabric git (<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/defaultProcess_V1">src/test/resources/bundle/defaultProcess_V1</a>).</p>
</div>
<div class="paragraph">
<p>The version of chartjs integrated in OperatorFabric is v3.7.1.</p>
</div>
</div>
<div class="sect3">
<h4 id="_custom_javascript_or_css_files"><a class="anchor" href="#_custom_javascript_or_css_files"></a>3.2.8. Custom javascript or css files</h4>
<div class="paragraph">
<p>It is possible to configure Opfab to load custom javascript or css files at startup. This allows to share common functions, business logic and styling between templates.
The list of URLs of javascript files to be loaded can be configured using <code>customJsToLoad</code> parameter in <code>web-ui.json</code> file.
The list of URLs of css files to be loaded can be configured using <code>customCssToLoad</code> parameter in <code>web-ui.json</code> file.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_notification"><a class="anchor" href="#_card_notification"></a>4. Card notification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a user receives a card, he is notified via a resume of the card on the left panel of the UI, what is called the "feed".</p>
</div>
<div class="sect2">
<h3 id="_notification_configuration"><a class="anchor" href="#_notification_configuration"></a>4.1. Notification configuration</h3>
<div class="paragraph">
<p>For each process/state, the user can choose to be notified or not when receiving a card. If he chooses not to be
notified then the card will not be visible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the feed or the timeline</p>
</li>
<li>
<p>in the monitoring screen</p>
</li>
<li>
<p>in the calendar screen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it will be visible in the archives screen.</p>
</div>
<div class="paragraph">
<p>In order to have a better visual organization of the processes in the UI, you can define processes groups.
You can find more information
<a href="/documentation/current/reference_doc/index.html#_processes_groups">here</a></p>
</div>
<div class="paragraph">
<p>Some process/state may be non-filterable. In this case, the corresponding checkbox is disabled (and checked).
To make a process/state filterable or not, the admin must modify the "filtering notification allowed" field, in the
corresponding perimeter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sound_notification"><a class="anchor" href="#_sound_notification"></a>4.2. Sound notification</h3>
<div class="paragraph">
<p>If the option is activated in the general configuration file web-ui.json, the user can choose to have a sound played
when they receive a card (either by the browser or by an external device if configured).
This can be managed by the user in the settings screen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To customize the sounds played by the browser, see <code>config/docker/custom-sounds/README.adoc</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_card_read"><a class="anchor" href="#_card_read"></a>4.3. Card read</h3>
<div class="paragraph">
<p>When the user receives a new card, he can see it in the feed with a bold title and card resume. Once the card is opened, the text is not bold anymore and becomes grey.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgment"><a class="anchor" href="#_card_acknowledgment"></a>4.4. Card acknowledgment</h3>
<div class="sect3">
<h4 id="_acknowledgment_done_by_the_user"><a class="anchor" href="#_acknowledgment_done_by_the_user"></a>4.4.1. Acknowledgment done by the user</h4>
<div class="paragraph">
<p>The user can set a card as "acknowledged," so he will not see it any more by default in the feed. It is as well possible to cancel it and set a card to "unacknowledged" (a filter permit to see acknowledged cards).</p>
</div>
<div class="paragraph">
<p>To offer the possibility for the user to acknowledge card, it has to be configured in process definition.
The configuration is done on a state by setting the <code>acknowledgmentAllowed</code> field. Allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Never": acknowledgement not allowed</p>
</li>
<li>
<p>"Always": acknowledgement allowed (default value)</p>
</li>
<li>
<p>"OnlyWhenResponseDisabledForUser": acknowledgement allowed only when
the response is disabled for the user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to cancel a card acknowledgment unless process state configuration has the <code>cancelAcknowledgmentAllowed</code> field set to false.</p>
</div>
<div class="paragraph">
<p>When the user acknowledges a card, the card detail is closed unless process state configuration has the <code>closeCardWhenUserAcknowledges</code> field set to false.</p>
</div>
<div class="paragraph">
<p>You can see examples in src/test/resources/bundles/defaultProcess_V1/config.json</p>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment_done_by_entityies"><a class="anchor" href="#_acknowledgment_done_by_entityies"></a>4.4.2. Acknowledgment done by entity(ies)</h4>
<div class="paragraph">
<p>A card can also be set as acknowledged if a member (or several) of the entity of the user has acknowledged it.
A user can be member of several entities, so you can configure if acknowledgment done by only one entity
(of the user) suffices for the card to appear as acknowledged or if all entities must acknowledge the card.</p>
</div>
<div class="paragraph">
<p>To configure how a card is considered as acknowledged for the user, it has to be configured in process definition.
The configuration is done on a state by setting the <code>consideredAcknowledgedForUserWhen</code> field. Allowed values are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"UserHasAcknowledged" : the card is set as acknowledged if the user acknowledges it</p>
</li>
<li>
<p>"AllEntitiesOfUserHaveAcknowledged" : the card is set as acknowledged if all the entities of the user acknowledge it</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_displaying_the_entities_acknowledgments"><a class="anchor" href="#_displaying_the_entities_acknowledgments"></a>4.4.3. Displaying the entities acknowledgments</h4>
<div class="paragraph">
<p>The entities acknowledgments can be displayed in the footer of the card. You can choose to display it (or not) via the option
<code>showAcknowledgmentFooter</code> in a state definition. Allowed values are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"OnlyForEmittingEntity" (default value) : the entities acknowledgments are displayed only for the members of the entity
that has created the card</p>
</li>
<li>
<p>"OnlyForUsersAllowedToEdit" : the entities acknowledgments are displayed for the users allowed to edit the card</p>
</li>
<li>
<p>"ForAllUsers" : the entities acknowledgments are displayed for the members of all the entities</p>
</li>
<li>
<p>"Never" : The entities acknowledgments are displayed to no one</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can enable the display of entities acknowledgments in user&#8217;s settings by selecting the "Always show acknowledgments in card details" option. When this option is set, the entities acknowledgments will be displayed regardless of <code>showAcknowledgmentFooter</code> in card state definition, unless it is set to 'NEVER'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pin_cards"><a class="anchor" href="#_pin_cards"></a>4.5. Pin cards</h3>
<div class="paragraph">
<p>It is possible to configure the state of a process so that cards are automatically "pinned" when acknowledged. Pinned cards are displayed in Feed page as small boxes with the title of the card just under the timeline Pinned cards are still visible even if the card is no more visible in the feed. A pinned card remains visible until card end date. If no end date, card will always be visible unless it is updated or deleted.</p>
</div>
<div class="paragraph">
<p>To configure a process state to automatically pin cards set the <code>automaticPinWhenAcknowledged</code> property to true in state definition.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"pinnedState": {
      "name": "⚠️ Network Contingencies ⚠️",
      "description": "Contingencies state",
      "templateName": "contingencies",
      "styles": [
        "contingencies"
      ],
      "acknowledgmentAllowed": "Always",
      "type" : "INPROGRESS",
      "automaticPinWhenAcknowledged" : true
    }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="card_reminder"><a class="anchor" href="#card_reminder"></a>4.6. Card reminder</h3>
<div class="paragraph">
<p>For certain process and state, it is possible to configure a reminder. The reminder triggers the resending of the card at a certain time with status "unread" and "unacknowledged" and publishDate updated.</p>
</div>
<div class="paragraph">
<p>The time for "reactivation" is defined with the parameter "secondsBeforeTimeSpanForReminder" in the card.</p>
</div>
<div class="paragraph">
<p>The reminder is done related to the timespans value <code>startDate</code>.</p>
</div>
<div class="sect3">
<h4 id="_simple_reminder"><a class="anchor" href="#_simple_reminder"></a>4.6.1. Simple reminder</h4>
<div class="paragraph">
<p>If a timespan is present, a reminder will arise at <code>startDate - secondsBeforeTimeSpanForReminder</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recurrent_reminder"><a class="anchor" href="#_recurrent_reminder"></a>4.6.2. Recurrent reminder</h4>
<div class="paragraph">
<p>It is possible to set a recurrent reminder for a card.</p>
</div>
<div class="sect4">
<h5 id="_using_rrule_field"><a class="anchor" href="#_using_rrule_field"></a>4.6.2.1. Using <code>rRule</code> field :</h5>
<div class="paragraph">
<p><code>rRule</code> field defines a regular event (as defined in the RFC 5545). It is defined with the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>freq : frequency of the recurrence (possible values : 'SECONDLY', 'MINUTELY', 'HOURLY', 'DAILY', 'WEEKLY', 'MONTHLY', 'YEARLY')</p>
</li>
<li>
<p>byweekday : list of days of the week when the event arises (possible values : 'MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU')</p>
</li>
<li>
<p>bymonth : list of months of the year when the event arises (possible values : number from 1 to 12, 1 being January and 12 being December)</p>
</li>
<li>
<p>byhour : list of hours of the day for the recurrence (from 0 to 23)</p>
</li>
<li>
<p>byminute : list of minutes within an hour for the recurrence (from 0 to 59)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reminder will arise for each <code>recurrent date of event - secondsBeforeTimeSpanForReminder</code> starting from startDate.</p>
</div>
<div class="sect5">
<h6 id="_recurrent_reminder_example_using_rrule_field"><a class="anchor" href="#_recurrent_reminder_example_using_rrule_field"></a>Recurrent reminder example using <code>rRule</code> field :</h6>
<div class="literalblock">
<div class="content">
<pre>rRule : {
    freq : 'DAILY',
    byweekday : ['TU', 'WE'],
    bymonth : [1, 3],
    byhour : [11],
    byminute : [30]
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debugging"><a class="anchor" href="#_debugging"></a>4.6.3. Debugging</h4>
<div class="paragraph">
<p>When a card with a reminder set is sent, the log of the "cards-reminder" service will contain a line with the date when the reminder will arise . For example :</p>
</div>
<div class="paragraph">
<p><code>2020-11-22T21:00:36.011Z Reminder Will remind card conferenceAndITIncidentExample.0cf5537b-f0df-4314-f17f-2797ccd8e4e9 at
                         Sun Nov 22 2020 22:55:00 GMT+0100 (heure normale d’Europe centrale)</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hallway_mode"><a class="anchor" href="#_hallway_mode"></a>4.7. Hallway mode</h3>
<div class="paragraph">
<p>Hallway mode allows to automatically displays the details of the most recent card received on Feed page.
Users can enable hallway mode in their user settings by selecting the <code>Automatically open the most recent card</code> checkbox.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_email_notifications"><a class="anchor" href="#_email_notifications"></a>5. Email Notifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpFab can send card notifications via email. These notifications are sent when a new card is published for a user and remains unread for a configured period. The email subject includes the card title, summary, and start and end dates.</p>
</div>
<div class="sect2">
<h3 id="_configuring_email_notifications"><a class="anchor" href="#_configuring_email_notifications"></a>5.1. Configuring Email Notifications</h3>
<div class="paragraph">
<p>Users can enable email notifications in their user settings. They must provide an email address for receiving notifications and select the processes/states they want to be notified about.
Users can specify the desired timezone for displaying dates and times in emails. To do this, they must fill in
the "timezone for mails" field in the user settings screen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_email_content"><a class="anchor" href="#_email_content"></a>5.2. Email Content</h3>
<div class="paragraph">
<p>The email body contains a link to the card details in OpFab. In the config.json file containing the state definition, the "emailBodyTemplate" field allows to define a template specific to the email body content.
This template can use handlebars helpers for formatting but can&#8217;t run javascript. If no template is specified, the mail is sent with just the link to the card in the body.</p>
</div>
</div>
<div class="sect2">
<h3 id="_email_templates"><a class="anchor" href="#_email_templates"></a>5.3. Email templates</h3>
<div class="paragraph">
<p>In email handlebars templates it is possible to refer card fields by prefixing with "card" prefix. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div id="apogee-contingencies"&gt;
  {{#card.data.networkContingencies}}</pre>
</div>
</div>
<div class="paragraph">
<p>A specific handlebars helper <code>deltaToHtml</code> allows to display rich text content from a card containing the 'richMessage' field with the following syntax:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{ deltaToHtml card.data.richMessage }}}</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure to encapsulate the expression within three curly braces to prevent HTML escaping.</p>
</div>
<div class="paragraph">
<p>It is also possible to configure custom parameters to be used in handlebars email templates.
The custom parameter can be added in cards-external-diffusion configuration under the "defaultConfig.customConfig" section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cardsExternalDiffusion:
    adminPort: 2106
    activeOnStartup: true
    defaultConfig:
      mailFrom: opfab@localhost.it
      subjectPrefix: 'Opfab card received '
      customConfig:
             myParam1: 'myValue1'
             myParam2: 'myValue2'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom parameters can then be referred in handlebars template prefixed with "config", for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#config.myParam1}}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="response_cards"><a class="anchor" href="#response_cards"></a>6. Response cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within your template, you can allow the user to perform some actions (respond to a form, answer a question, &#8230;&#8203;).
The user fills these information and then clicks on a submit button. When he submits this action, a new card is created
and emitted to a third-party tool.</p>
</div>
<div class="paragraph">
<p>This card is called "a child card" as it is attached to the card where the question came from : "the parent card". This
child card is also sent to the users that have received the parent card. From the ui point of view, the information of
the child cards can be integrated in real time in the parent card if configured.</p>
</div>
<div class="paragraph">
<p>The process can be represented as follows :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardSequence.jpg" alt="ResponseCardSequence">
</div>
</div>
<div class="paragraph">
<p>Notice that the response will be associated to the entity and not to the user, i.e the user responds on behalf of his
entity. A user can respond more than one time to a card (a future evolution could add the possibility to limit to one
response per entity).</p>
</div>
<div class="paragraph">
<p>You can view a screenshot of an example of card with responses :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot2.png" alt="ResponseCardScreenshot2">
</div>
</div>
<div class="sect2">
<h3 id="_steps_needed_to_use_a_response_card"><a class="anchor" href="#_steps_needed_to_use_a_response_card"></a>6.1. Steps needed to use a response card</h3>
<div class="sect3">
<h4 id="define_a_third_party_tool"><a class="anchor" href="#define_a_third_party_tool"></a>6.1.1. Define a third party tool</h4>
<div class="paragraph">
<p>The response card is to be received by a third party application for business processing. The third-party application
will receive the card as an HTTP POST request. The card is in json format (the same format as when we send a card).
The field data in the json contains the user response.</p>
</div>
<div class="paragraph">
<p>The url of the third party receiving the response card is to be set in the .yml of the publication service. It is also
possible to configure whether the user token shall be propagated to the third party or not by setting the
"propagateUserToken" boolean property. Here is an example with two third parties configured.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>operatorfabric:
  cards-publication:
    external-recipients:
      recipients:
        - id: "third-party1"
          url: "http://thirdparty1/test1"
          propagateUserToken: true
        - id: "third-party2"
          url: "http://thirdparty2:8090/test2"
          propagateUserToken: false</pre>
</div>
</div>
<div class="paragraph">
<p>The name to use for the third-party is the publisherId of the parent card.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the url, do not use localhost if you run OperatorFabric in a docker, as the publication-service will not be able to
join your third party.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_response_in_config_json"><a class="anchor" href="#_configure_the_response_in_config_json"></a>6.1.2. Configure the response in config.json</h4>
<div class="paragraph">
<p>A card can have a response only if it&#8217;s in a process/state that is configured for. To do that you need to define the
appropriate configuration in the config.json of the concerned process. Here is an example of configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id": "defaultProcess",
  "name": "Test",
  "version": "1",
  "states": {
    "questionState": {
      "name": "question.title",
      "color": "#8bcdcd",
      "response": {
        "state": "responseState",
        "externalRecipients":["externalRecipient1", "externalRecipient2"]
      },
      "templateName": "question",
      "styles": [
        "style"
      ],
      "acknowledgmentAllowed": "Never",
      "showDetailCardHeader" : true
    },
    "responseState": {
      "name" : "response.title",
      "isOnlyAChildState" : true
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We define here a state name "questionState" with a response field. Now, if we send a card with process "defaultProcess"
and state "questionState", the user will have the possibility to respond if he has the required privileges.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field "state" in the response field is used to define the state to use for the response (the child card).</p>
</li>
<li>
<p>The field "externalRecipients" define the recipients of the response card. These recipients are the ids of the objects referenced in
the config file of cards-publication service, in "external-recipients" element. This field is optional.</p>
</li>
<li>
<p>The field "emittingEntityAllowedToRespond" in the response field is used to allow the emitting entity to respond to a card. To be able to respond, however, the emitting entity has to be one of the recipients of the card. Default value is false.</p>
</li>
<li>
<p>The field "showDetailCardHeader" permits to display the card header or not. This header contains the list of entities
that have already responded or not, and a countdown indicating the time remaining to respond, if necessary.</p>
</li>
<li>
<p>The field "isOnlyAChildState" indicates whether the state is only used for child cards or not. If yes, the state
is displayed neither in the feed notification configuration screen nor in archives screen filters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The state to be used for the response can also be set dynamically based on the contents of the card or the
response by returning it in the method registered by <code>opfab.currentCard.registerFunctionToGetUserResponse</code> (see below for details).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_design_the_question_form_in_the_template"><a class="anchor" href="#_design_the_question_form_in_the_template"></a>6.1.3. Design the question form in the template</h4>
<div class="paragraph">
<p>For the user to response you need to define the response form in the template with standard HTML syntax</p>
</div>
<div class="paragraph">
<p>To enable OperatorFabric to send the response, you need to implement a javascript function in your template
which returns an object containing the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>valid (<em>boolean</em>) : true if the user input is valid</p>
</li>
<li>
<p>errorMsg (<em>string</em>) : message in case of invalid user input. If valid is true this field is not necessary.</p>
</li>
<li>
<p>responseCard:</p>
<div class="ulist">
<ul>
<li>
<p>data (<em>any</em>) : the user input to send in the data field of the child card.</p>
</li>
<li>
<p>state : name of the response state to use. This field is not mandatory, if it is not set the state defined in
<code>config.json</code> will be used for the response.</p>
</li>
<li>
<p>publisher (<em>string</em>) : the id of the Entity to be used as publisher of the response. This field is not mandatory, if it is not set the publisher will be the user entity, in case the user belongs to a single entity, or it will be choosen by the user between his available entities.</p>
</li>
<li>
<p>severity (<em>string</em>) : an optional field used to define the severity of the response card. The default value is "INFORMATION".</p>
</li>
<li>
<p>actions (<em>string array</em>) : an optional field used to define a set of predetermined actions that will be executed upon receiving the response card. The available actions include:</p>
<div class="ulist">
<ul>
<li>
<p>PROPAGATE_READ_ACK_TO_PARENT_CARD : when receiving the child card, the status of the parent card should be considered as 'unread' and 'not acknowledged' until the user reads or acknowledge it again.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method is to be registered via <code>opfab.currentCard.registerFunctionToGetUserResponse</code>, the method will be called by OperatorFabric when the user clicks on the button to send the response.</p>
</div>
<div class="paragraph">
<p>In the example below, the <code>getUserResponse</code> creates a <code>responseCard</code> object by retrieving the user&#8217;s inputs from the HTML.
In addition, if the user choses the refusal option, it overrides the response state defined in the <code>config.json</code> with another
state. It is also possible to dynamically set the severity of the response with a logic from the template. Here the severity of the response depends on the number of choices selected by the user.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">    <span class="keyword">function</span> <span class="function">fetchResponseCardData</span>() {

        const answer = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">opfab-toggle</span><span class="delimiter">'</span></span>).checked;
        let reason = <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>;
        <span class="comment">// answer = true means refusal in the toggle</span>
        <span class="keyword">if</span> (answer) {
            reason = document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">#answer-select</span><span class="delimiter">'</span></span>).value;
        }

        const comment = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">comment</span><span class="delimiter">'</span></span>).value;

        const result = {
            <span class="key">valid</span>: <span class="predefined-constant">true</span>,
            <span class="key">responseCard</span>:{
                <span class="key">data</span>: {
                <span class="key">propositionRefused</span>: answer,
                <span class="key">reason</span>: reason, 
                <span class="key">comment</span>: comment
                }
            } 
        };

        <span class="comment">// If the user choses to answer no, we decide to move the process to a specific state, for example to ask a follow-up question (what's their preferred option).</span>
        <span class="keyword">if</span> (answer){
            result.responseCard[<span class="string"><span class="delimiter">'</span><span class="content">state</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">refuseResponseState</span><span class="delimiter">'</span></span>;
            result.responseCard[<span class="string"><span class="delimiter">'</span><span class="content">severity</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>
        }  <span class="keyword">else</span> {
            result.responseCard[<span class="string"><span class="delimiter">'</span><span class="content">severity</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>
        }
        <span class="keyword">return</span> result
    }
            opfab.currentCard.registerFunctionToGetUserResponse(fetchResponseCardData);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_define_permissions"><a class="anchor" href="#_define_permissions"></a>6.1.4. Define permissions</h4>
<div class="paragraph">
<p>To respond to a card a user must have the right privileges, it is done using "perimeters". The user must be in a group
that is attached to a perimeter with  a right "ReceiveAndWrite" for the concerned process/state, the state being the response
state defined in the config.json.</p>
</div>
<div class="paragraph">
<p>Here is an example of definition of a perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterQuestion",
  "process" : "defaultProcess",
  "stateRights" : [
    {
      "state" : "responseState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>To configure it in OperatorFabric , you need to make a POST of this json file to the end point /users/perimeters.</p>
</div>
<div class="paragraph">
<p>To add it to a group name for example "mygroup", you need to make a PATCH request  to endpoint
'users/groups/mygroup/perimeters' with payload ["perimeterQuestion"]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_a_question_card"><a class="anchor" href="#_send_a_question_card"></a>6.2. Send a question card</h3>
<div class="paragraph">
<p>The question card is like a usual card except that you have the field "entitiesAllowedToRespond" to set with the
entities allowed to respond to the card. If the user is not in the entity, he will not be able to respond.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, OperatorFabric considers that if the parent card (question card) is modified, then the child cards
are deleted. If you want to keep the child cards when the parent card is changed, then you must add in the parent
card the field "actions" as a string array containing the "KEEP_CHILD_CARDS" action.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The header in the card details will list the entities from which a response is expected, color-coding them depending
on whether they&#8217;ve already responded (green) or not (orange).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also set the property <code>entitiesRequiredToRespond</code> to differentiate between entities can respond
(<code>entitiesAllowedToRespond</code>) and those who must respond (<code>entitiesRequiredToRespond</code>).
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR","ENTITY3_FR"],
"entitiesRequiredToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>entitiesRequiredToRespond</code> is set and not empty, the card detail header will use this list instead of
<code>entitiesAllowedToRespond</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If set, <code>entitiesRequiredToRespond</code> does not have to be a subset of <code>entitiesAllowedToRespond</code>. To determine
if a user has the right to respond, OperatorFabric consider the union of the two lists.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_child_cards"><a class="anchor" href="#_integrate_child_cards"></a>6.3. Integrate child cards</h3>
<div class="paragraph">
<p>For each user response, a child card containing the response is emitted and stored in OperatorFabric like a normal card. It is not directly visible on the ui but this child card can be integrated in real time to the parent card of all the users watching the card. To do that, you need some code in the template to process child data:</p>
</div>
<div class="paragraph">
<p>You shall give a reference to a method for processing the child cards via <em>opfab.currentCard.listenToChildCards</em> .</p>
</div>
<div class="paragraph">
<p>The defined method shall have an array of child cards as a parameter and will be called by OperatorFabric when loading the card and every time the list of child cards changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.currentCard.listenToChildCards( (childCards) =&gt; { // process child cards });</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_entity_name"><a class="anchor" href="#_entity_name"></a>6.3.1. Entity name</h4>
<div class="paragraph">
<p>If you want to show the name of an entity that send the response, you need to get the id of the entity via the publisher
field of the child card and then you  can get the name of the entity by calling <em>opfab.users.entities.getEntityName(entityId)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a>6.3.2. Example</h4>
<div class="paragraph">
<p>You can find an example in the file <a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lock_mechanism"><a class="anchor" href="#_lock_mechanism"></a>6.4. Lock mechanism</h3>
<div class="paragraph">
<p>When a user has never answered to a response card, the button will be marked as "VALIDATE ANSWER" and the card will be
unlocked.
When the user responds for the first time (and the response succeeds), the button will then be marked as "MODIFY ANSWER"
and the information that the card has been locked can be sent to the third template (see opfab.currentCard.listenToResponseLock in frontend API).</p>
</div>
<div class="paragraph">
<p>Once a user has responded to a response card, its entity status will be considered as "already answered" for this card.
Then all the users having the same entity will be in this status for this card.</p>
</div>
<div class="paragraph">
<p>From there, as soon as they will open this card the button will be marked as "MODIFY ANSWER" and this information (i.e. that this entity has already responded) is accessible to the card template (see opfab.currentCard.isResponseLocked in frontend API).</p>
</div>
<div class="paragraph">
<p>The user can then click on "MODIFY ANSWER" and the button will come back to its initial state ("VALIDATE ANSWER") and the information that the user wants to modify its initial answer can be sent to the card template (see opfab.currentCard.listenToResponseUnlock in frontend API).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user_cards"><a class="anchor" href="#user_cards"></a>7. User cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the <code>Create card</code> menu, the user can send cards to entities. This feature needs to be configured.</p>
</div>
<div class="sect2">
<h3 id="_configure_the_bundle"><a class="anchor" href="#_configure_the_bundle"></a>7.1. Configure the bundle</h3>
<div class="paragraph">
<p>A card is related to a process and a state, if you want users to be able to emit a card for a specific process and
state, you need to define it in the bundle for this process.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"id": "conferenceAndITIncidentExample",
"name": "conferenceAndITIncidentExample.label",
"version": "1",
"states": {
  "messageState": {
    "name": "message.title",
    "userCard" : {
      "template" : "usercard_message",
      "severityVisible" : true,
      "startDateVisible" : true,
      "endDateVisible" : true,
      "expirationDateVisible" : false,
      "lttdVisible" : false,
    },
    "templateName": "message",
    "styles": [],
    "acknowledgmentAllowed": "Always"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the field userCard states that we have a template called <code>usercard_message</code> that defines how
the specific business input fields for this user card will be displayed in the card sending form that will be
presented to the user (through the <code>Create Card</code> menu).</p>
</div>
<div class="paragraph">
<p>This template works the same as templates for card presentation. Here is an example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="opfab-textarea"&gt;
    &lt;label&gt; MESSAGE &lt;/label&gt;
    &lt;textarea id="message" name="message" placeholder="Write something.."
        style="width:100%"&gt; {{card.data.message}} &lt;/textarea&gt;
&lt;/div&gt;


&lt;script&gt;
    opfab.currentCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }
&lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The first part defines the HTML for the business-specific input fields. It should only include the form
fields specific to your process, because the generic fields (like startDate , endDate , severity &#8230;&#8203; ) are presented
by default. It is possible to hide certain generic fields, by setting their visibility to false in the config.json
(for example field <code>severityVisible</code>).</p>
</div>
<div class="paragraph">
<p>Please note that you should use an OpFab css class so the "business-specific" part of the form has the same look and
feel (See
<a href="/documentation/current/reference_doc/index.html#opfab_template_style">OperatorFabric Style</a>
for more information)</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be aware that as we have a preview of the card, the application loads the html related to the usercard (build with the
usercard template) and the html related to the card in preview (build with the card template) into the browser at the
same time. This implies that you MUST NOT name the elements with the same names in both templates. This rule applies
to HTML elements identifiers(id), global JavaScript variables and JavaScript function names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the card has been sent, users with the appropriate rights can edit it. If they choose to do so, they&#8217;re presented
with the same input form as for the card creation, but the fields are pre-filled with the current data of the card.
This way, they can only change what they need without having to re-create the card from scratch.
That&#8217;s what the reference to <code>{{card.data.message}}</code> is for. It means that this text-area input field should be filled
with the value of the field <code>message</code> from the card&#8217;s data.</p>
</div>
<div class="paragraph">
<p>The second part is a javascript method you need to implement to allow OperatorFabric to get your specific data .</p>
</div>
<div class="paragraph">
<p>To have a better understanding of this feature, we encourage you to have a look at the examples in the OperatorFabric
core repository under (<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/conferenceAndITIncidentExample">src/test/resources/bundles/conferenceAndITIncidentExample</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_registerfunctiontogetspecificcardinformation"><a class="anchor" href="#_method_registerfunctiontogetspecificcardinformation"></a>7.2. Method registerFunctionToGetSpecificCardInformation</h3>
<div class="paragraph">
<p>The following card fields can be set via the object <code>card</code> in the object returned by the method register via
registerFunctionToGetSpecificCardInformation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>title</p>
</li>
<li>
<p>summary</p>
</li>
<li>
<p>startDate (epoch date in ms)</p>
</li>
<li>
<p>endDate (epoch date in ms)</p>
</li>
<li>
<p>expirationDate (epoch date in ms)</p>
</li>
<li>
<p>lttd (epoch date in ms)</p>
</li>
<li>
<p>secondsBeforeTimeSpanForReminder</p>
</li>
<li>
<p>severity (in case it is not visible from the user , when <code>severityVisible</code> set to false in <code>config.json</code>)</p>
</li>
<li>
<p>data</p>
</li>
<li>
<p>entityRecipients</p>
</li>
<li>
<p>entitiesAllowedToEdit</p>
</li>
<li>
<p>entitiesAllowedToRespond</p>
</li>
<li>
<p>entitiesRequiredToRespond</p>
</li>
<li>
<p>groupRecipients</p>
</li>
<li>
<p>externalRecipients (used to send cards to third party , see
<a href="/documentation/current/reference_doc/index.html#define_a_third_party_tool">Define a third party tool</a>
for more information).</p>
</li>
<li>
<p>rRule (used to define a card with recurrence, see
<a href="/documentation/current/reference_doc/index.html#_using_rrule_field">Using rRule field</a>
for more information).</p>
</li>
<li>
<p>tags (list of strings)</p>
</li>
<li>
<p>wktGeometry (string)</p>
</li>
<li>
<p>wktProjection (string)</p>
</li>
<li>
<p>actions (list of card actions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you send a card to an ExternalRecipient, when the user delete it, the external recipient will receive the information via an HTTP DELETE request with the id of the deleted card at the end of the request (example : <a href="http://myexternal_app/myendpoint/ID_CARD" class="bare">myexternal_app/myendpoint/ID_CARD</a>).</p>
</div>
<div class="paragraph">
<p>If you want the card to be visible in the calendar feature, you need to set 'timeSpans' field (as array of TimeSpans objects) in the object returned by the method.
You can find an example in the file:
<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/taskExample/template/usercard_task.handlebars">src/test/resources/bundles/taskExample/template/usercard_task.handlebars</a>.</p>
</div>
<div class="paragraph">
<p>If not using 'timeSpans' it&#8217;s possible to set the 'viewCardInCalendar' field to true, the card will be visible using card&#8217;s startDate and endDate as default timeSpan.</p>
</div>
<div class="paragraph">
<p>If the form is not filled correctly by the user, you can provide an error message (see example above).
Again, have a look to the examples provided.</p>
</div>
</div>
<div class="sect2">
<h3 id="_define_permissions_2"><a class="anchor" href="#_define_permissions_2"></a>7.3. Define permissions</h3>
<div class="paragraph">
<p>To send a user card, the user must be member of a group that has a perimeter defining the right <code>ReceiveAndWrite</code>
or <code>Write</code> for the chosen process and state. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterUserCard",
  "process" : "conferenceAndITIncidentExample",
  "stateRights" : [
    {
      "state" : "messageState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using the <code>ReceiveAndWrite</code> right instead of the <code>Write</code> right allows the user to receive the card they sent and
edit or delete it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="restrict_possible_emitters"><a class="anchor" href="#restrict_possible_emitters"></a>7.4. Restrict the list of possible emitter entities</h3>
<div class="paragraph">
<p>When sending a user card, if the user is member of multiple entities, it is possible to choose the emitter entity from all the available user entities. To limit the list of available emitter entities, it is possible to configure the property <code>publisherList</code> in userCard state definition with the list of allowed publisher entities.
For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"processState": {
      "name": "Process example ",
      "description": "Process state",
      "userCard" : {
        "template" : "usercard_process",
        "expirationDateVisible" : true,
        "publisherList": [{"id":"ENTITY_FR", "levels":[1]},{"id":"IT_SUPERVISOR_ENTITY"}]
      }</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available publisher entities will contain all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect2">
<h3 id="set_recipients_via_code"><a class="anchor" href="#set_recipients_via_code"></a>7.5. Set the list of recipients via the template</h3>
<div class="paragraph">
<p>To do that, you have to provide the list of recipients when returning the card object in the field <code>entityRecipients</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          entityRecipients: ["ENTITY_FR","IT_SUPERVISOR_ENTITY"],
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        }
  });</pre>
</div>
</div>
<div class="paragraph">
<p>When recipient dropdown is not visible to the user (attribute <code>recipientVisible</code> set to <code>false</code> in state definition in config.json) the final recipients list will be the one defined in the template, otherwise it will be the union of user selection and template <code>entityRecipients</code> definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_editing"><a class="anchor" href="#_card_editing"></a>7.6. Card editing</h3>
<div class="paragraph">
<p>Once a user card has been sent it can be edited by a user member of the publisher entity who has write access for the process/state of the card.
It is possible to allow other entities to edit the card by specifying the 'entitiesAllowedToEdit' card field.
It is possible to hide card edit button on UI by setting 'editCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_copy"><a class="anchor" href="#_card_copy"></a>7.7. Card copy</h3>
<div class="paragraph">
<p>A user can copy a card and send it if he has write access for the process/state of the card. Before sending the card, the user can modify it if he wants.
It is possible to hide card copy button on UI by setting 'copyCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_delete"><a class="anchor" href="#_card_delete"></a>7.8. Card delete</h3>
<div class="paragraph">
<p>Once a user card has been sent it can be deleted by a user member of the publisher entity who has write access for the process/state of the card.
It is possible to hide card delete button on UI by setting 'deleteCardEnabledOnUserInterface' to false in card&#8217;s process/state definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="_send_response_automatically_experimental_feature"><a class="anchor" href="#_send_response_automatically_experimental_feature"></a>7.9. Send response automatically (experimental feature)</h3>
<div class="paragraph">
<p>It is possible to configure a template to automatically send a response when sending a user card expecting an answers from one of the entities of the emitting user.
The response card will be sent only if the user is enabled to respond to the card.</p>
</div>
<div class="paragraph">
<p>To enable the automated response the template should add a <code>childCard</code> field to the object returned by
 <code>getSpecificCardInformation</code> method. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> &lt;script&gt;
     opfab.currentUserCard.registerFunctionToGetSpecificCardInformation( () =&gt;  {
        const card = {...}

        childCard : {
          summary : {key : "example.summary"},
          title : {key : "example.title"},
          state : "mystateForResponse"
          data : {
                  // specific child  card date
                  }
          };
        ...
        return {
            valid: true,
            card: card,
            childCard: childCard
        };

    });
  &lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The card preview will display the card detail with the automated response as it will be displayed in Feed page.</p>
</div>
<div class="paragraph">
<p>When editing a user card, the template can get the response sent by current user by calling the
<em>opfab.currentUserCard.getUserEntityChildCard</em> function.</p>
</div>
<div class="paragraph">
<p>By default, the publisher of the childCard is the publisher of the parent card. In the template, it is possible to
set another value for the publisher of the childCard, provided that the user is a member of the entity publisher you
want to set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_send_a_card_on_behalf_of_the_user"><a class="anchor" href="#_send_a_card_on_behalf_of_the_user"></a>7.10. send a card on behalf of the user</h3>
<div class="paragraph">
<p>By default, when the user sends a card via the usercard interface, the card is sent on behalf of the entity of the user.
If you want to send a card on behalf of the user himself, you have to set the field <code>publisherType</code> to <code>USER</code> in the
usercard template, via the function <code>registerFunctionToGetSpecificCardInformation</code>. This way, the user will be set as
publisher instead of his entity.
In order to prevent the user from seeing the publisher entity multiselect, you should set the field publisherVisible to
false in the state configuration, in the file <code>config.json</code> of the corresponding bundle.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc"><a class="anchor" href="#_misc"></a>7.11. Misc</h3>
<div class="paragraph">
<p>When a user send a card, the card is also sent to the members of the entity that publish the card (and therefore also to
the sender himself), whatever the user chooses in the recipient list.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_in_templates"><a class="anchor" href="#_built_in_templates"></a>8. Built-in templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of coding your own templates for cards or user cards, you can use opfab built-in templates if it suits your needs.</p>
</div>
<div class="sect2">
<h3 id="_message"><a class="anchor" href="#_message"></a>8.1. Message</h3>
<div class="sect3">
<h4 id="_card_template"><a class="anchor" href="#_card_template"></a>8.1.1. Card template</h4>
<div class="paragraph">
<p>If you want to show only a simple message, you can use the message built-in template, to do that just put in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in template supposes the message is stored in the card in field <code>data.message</code>.</p>
</div>
<div class="paragraph">
<p>You can change the text header by providing the message-header attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-card  message-header=&quot;a new header&quot;&gt; &lt;/opfab-message-card&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template"><a class="anchor" href="#_user_card_template"></a>8.1.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card for a simple message, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-usercard&gt; &lt;/opfab-message-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message will be stored in the field <code>data.message</code> of the card</p>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
<a href="/documentation/current/reference_doc/index.html#built-in_templates_common_usercard_attributes">common attributes for user cards</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_question"><a class="anchor" href="#_question"></a>8.2. Question</h3>
<div class="sect3">
<h4 id="_card_template_2"><a class="anchor" href="#_card_template_2"></a>8.2.1. Card template</h4>
<div class="paragraph">
<p>If you want to show a question and see user responses, you can use the question built-in template, to do that just put in your handlebar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-card keepResponseHistoryInCard=&quot;false&quot;&gt; &lt;/opfab-question-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in template supposes the question is stored in the card in the field <code>data.question</code>.</p>
</div>
<div class="paragraph">
<p>To keep response history in card data, set the <code>keepResponseHistoryInCard</code> attribute to true. In the card details, you will find all response history along with their corresponding response dates.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template_2"><a class="anchor" href="#_user_card_template_2"></a>8.2.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card for a simple question, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-question-usercard&gt; &lt;/opfab-question-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The question will be stored in the field <code>data.question</code> of the card</p>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
<a href="/documentation/current/reference_doc/index.html#built-in_templates_common_usercard_attributes">common attributes for user cards</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_message_or_question_list"><a class="anchor" href="#_message_or_question_list"></a>8.3. Message Or Question List</h3>
<div class="sect3">
<h4 id="_card_template_3"><a class="anchor" href="#_card_template_3"></a>8.3.1. Card template</h4>
<div class="paragraph">
<p>If you want to show a message or a question and the answers, you can use the message or question list built-in template, to do that just put in your handlebar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-or-question-list-card&gt; &lt;/opfab-message-or-question-list-card&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in template supposes the message or question is stored in the card in the field <code>data.message</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template_3"><a class="anchor" href="#_user_card_template_3"></a>8.3.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card where you can select a list of messages or questions linked to a json file, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-or-question-list-usercard businessData=&quot;businessDataFileName&quot;&gt; &lt;/opfab-message-or-question-list-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message will be stored in the field <code>data.message</code> of the card
You need to set the json file name with the <code>businessData</code> attribute
If you want to use the template as is, the json file must follow this structure :</p>
</div>
<div class="paragraph">
<p>`{   "possibleRecipients": [
    {"id": "ENTITY1_FR"},
    {"id": "ENTITY2_FR"}
    ],</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"messagesList": [{
    "id": "Warning",
    "title": "Warning about the state of the grid",
    "summary": "Warning about the state of the grid : a problem has been detected",
    "message": "A problem has been detected, please put maintenance work on hold and be on stand by",
    "question": false,
    "severity": "ALARM",
    "publishers":  [
        "ENTITY1_FR",
        "ENTITY2_FR",
        "ENTITY3_FR"
    ]
    "recipients" : [
        "ENTITY1_FR",
        "ENTITY2_FR"
    ]
},
{
    "id": "Confirmation",
    "title": "Confirmation the issues have been fixed",
    "message": "Please confirm the issues in your area have been fixed",
    "question": true,
    "severity": "ACTION",
    "recipients" : [
        "ENTITY1_FR"
    ]
}]</pre>
</div>
</div>
<div class="paragraph">
<p>}`</p>
</div>
<div class="paragraph">
<p>The <code>possibleRecipients</code> field is optional. If specified and not empty, the list of possible recipients will be restricted to the specified list. If not specified or empty, the possible recipients list will not be restricted.</p>
</div>
<div class="paragraph">
<p>The <code>severity</code> field is optional. If not specified, the card will take a default severity value depending on 'question'
field value : "ACTION" if question is true, "INFORMATION" if question is false.</p>
</div>
<div class="paragraph">
<p>The <code>publishers</code> field is optional. It is used to restrict the possible publishers of the message. If specified, the
message option is available only for the specified entities. If not specified or empty, there are no restrictions.</p>
</div>
<div class="paragraph">
<p>The <code>summary</code> field is optional. If specified, considering 'xxx' is the value of the field, so the summary you will see
in the feed will be 'Message received : xxx'. If left empty the summary input field in user card will be displayed with no initial value and the summary in the feed will be 'Message received'. If not specified, the summary input field will not be displayed in user card form and the summary will be 'Message received'.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_task"><a class="anchor" href="#_task"></a>8.4. Task</h3>
<div class="sect3">
<h4 id="_card_template_4"><a class="anchor" href="#_card_template_4"></a>8.4.1. Card template</h4>
<div class="paragraph">
<p>If you want to set a reminder for a single or recurring future event, you can use the task built-in template, to do that just put in your handlebar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-task-card&gt;&lt;/opfab-task-card&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_card_template_4"><a class="anchor" href="#_user_card_template_4"></a>8.4.2. User card template</h4>
<div class="paragraph">
<p>If you want to create a user card for a task, just add in your handlebar file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-task-usercard&gt;&lt;/opfab-task-usercard&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The description of the task will be stored in the fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>data.taskTitle</code></p>
</li>
<li>
<p><code>data.richTaskDescription</code></p>
</li>
<li>
<p><code>data.minutesForReminder</code></p>
</li>
<li>
<p><code>data.durationInMinutes</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>of the card.</p>
</div>
<div class="paragraph">
<p>By using attributes you can set some parameters regarding recipients, see
<a href="/documentation/current/reference_doc/index.html#built-in_templates_common_usercard_attributes">common attributes for user cards</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="built-in_templates_common_usercard_attributes"><a class="anchor" href="#built-in_templates_common_usercard_attributes"></a>8.5. Common attributes for user cards built-in templates</h3>
<div class="paragraph">
<p>For each user card templates, you can set :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The initial severity</p>
</li>
<li>
<p>The entity recipient list</p>
</li>
<li>
<p>The initial selected recipients</p>
</li>
<li>
<p>The entity recipient for information list</p>
</li>
<li>
<p>The initial selected recipients for information</p>
</li>
<li>
<p>The external recipients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;opfab-message-usercard
    initialSeverity=&quot;INFORMATION&quot;
    entityRecipientList='[{&quot;id&quot;: &quot;ENTITY_FR&quot;, &quot;levels&quot;: [0, 1]}, {&quot;id&quot;: &quot;ENTITY_IT&quot;},{&quot;id&quot;: &quot;IT_SUPERVISOR_ENTITY&quot;}]'
    initialSelectedRecipients='[&quot;ENTITY1_FR&quot;, &quot;ENTITY2_FR&quot;, &quot;ENTITY3_FR&quot;]'
    entityRecipientForInformationList='[{&quot;id&quot;: &quot;ENTITY_FR&quot;, &quot;levels&quot;: [0, 1]},{&quot;id&quot;: &quot;IT_SUPERVISOR_ENTITY&quot;}]'
    initialSelectedRecipientsForInformation='[&quot;ENTITY4_FR&quot;]'
    externalRecipients='[&quot;externalRecipient1&quot;, &quot;externalRecipient2&quot;]'&gt;
&lt;/opfab-message-usercard&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="business_data"><a class="anchor" href="#business_data"></a>9. Business Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the API, it is now possible to store business data and then call it from the templates. This storage system is intended for light documents and should not be treated as a database.</p>
</div>
<div class="sect2">
<h3 id="_pushing_data"><a class="anchor" href="#_pushing_data"></a>9.1. Pushing data</h3>
<div class="paragraph">
<p>It is expected for the data being pushed to be compliant with the <code>json</code> format. The different methods are detailed in the (<a href="https://opfab.github.io/documentation/current/api/businessconfig/#/default/getBusinessData">API documentation</a>). The default limit of file size accepted is 100 MB, it can be updated in the nginx configuation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calling_a_resource"><a class="anchor" href="#_calling_a_resource"></a>9.2. Calling a resource</h3>
<div class="paragraph">
<p>Once a resource has been stored, it is possible to call it from the template of a card. See in this template (<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/conferenceAndITIncidentExample/template/usercard_incidentInProgress.handlebars">usercard_incidentInProgress.handlebars</a>) how the resource <code>services</code> is called with the method <code>opfab.businessconfig.businessData.get()</code></p>
</div>
<div class="paragraph">
<p>This prevents writing directly in the template&#8217;s code long lists and allows easy data duplication between templates.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frontend_api"><a class="anchor" href="#_frontend_api"></a>10. Frontend API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The frontend API is intended to provide a way for template to communicate with the core opfab code. It&#8217;s divided as follows :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users API : API to get information about users and entities</p>
</li>
<li>
<p>BusinessConfig API : API to get business configuration information</p>
</li>
<li>
<p>Navigate API : API to ask opfab to navigate to a specific view</p>
</li>
<li>
<p>CurrentCard API : API to get information regarding the current card</p>
</li>
<li>
<p>CurrentUserCard API : API to get information regarding the current user card (card in creation or edition)</p>
</li>
<li>
<p>Cards API : API to get or send cards</p>
</li>
<li>
<p>Utils API : utilities functions</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_users_api"><a class="anchor" href="#_users_api"></a>10.1. Users API</h3>
<div class="sect3">
<h4 id="_entities"><a class="anchor" href="#_entities"></a>10.1.1. Entities</h4>
<div class="paragraph">
<p>Entity object contains the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'id' : id of the entity</p>
</li>
<li>
<p>'name' : name of the entity</p>
</li>
<li>
<p>'description' : description of the entity</p>
</li>
<li>
<p>'parents' : list of parent entities</p>
</li>
<li>
<p>'labels' : list of labels associated to the entity</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_function_getentityname"><a class="anchor" href="#_function_getentityname"></a>10.1.1.1. Function getEntityName</h5>
<div class="paragraph">
<p>Obtain the name of an entity :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const myEntityName = opfab.users.entities.getEntityName('myEntityId');</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_function_getentity"><a class="anchor" href="#_function_getentity"></a>10.1.1.2. Function getEntity</h5>
<div class="paragraph">
<p>Obtain a specific entity :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const myEntity = opfab.users.entities.getEntity('myEntityId');</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_function_getallentities"><a class="anchor" href="#_function_getallentities"></a>10.1.1.3. Function getAllEntities</h5>
<div class="paragraph">
<p>Obtain all entities as an array :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const entities = opfab.users.entities.getAllEntities();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_businessconfig_api"><a class="anchor" href="#_businessconfig_api"></a>10.2. BusinessConfig API</h3>
<div class="sect3">
<h4 id="_function_registerfunctiontogettags"><a class="anchor" href="#_function_registerfunctiontogettags"></a>10.2.1. Function registerFunctionToGetTags</h4>
<div class="paragraph">
<p>It is possible to register at startup the function to be used to retrieve the list of tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.businessconfig.registerFunctionToGetTags(function);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The registered function must take as input parameter the screen name. The possible values for screen name are : 'archive', 'logging', 'processMonitoring'.</p>
</div>
<div class="paragraph">
<p>An example of usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/blob//config/docker/externalJs/loadTags.js">config/docker/externalJs/loadTags.js</a>.</p>
</div>
<div class="paragraph">
<p>If no custom function is registered or if the registered function returns <code>undefined</code>, then Opfab will take the tags values configured in web-ui.json.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handlebars_api"><a class="anchor" href="#_handlebars_api"></a>10.3. Handlebars API</h3>
<div class="sect3">
<h4 id="_function_registercustomhelpers"><a class="anchor" href="#_function_registercustomhelpers"></a>10.3.1. Function registerCustomHelpers</h4>
<div class="paragraph">
<p>It is possible to register at startup the function to be used to retrieve a list of custom handlebars helpers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.handlebars.registerCustomHelpers([function]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function takes as argument a list of functions that will be registered as handlebars helpers, each helper will be registered with the same name of the helper function.</p>
</div>
<div class="paragraph">
<p>To avoid conflict with existing helpers, it is recommended to prefix your helper (For example : myapp_xxx)</p>
</div>
<div class="paragraph">
<p>An example of usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/blob//config/docker/externalJs/handlebarsExample.js">config/docker/externalJs/handlebarsExample.js</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_navigate_api"><a class="anchor" href="#_navigate_api"></a>10.4. Navigate API</h3>
<div class="sect3">
<h4 id="_function_redirecttobusinessmenu"><a class="anchor" href="#_function_redirecttobusinessmenu"></a>10.4.1. Function redirectToBusinessMenu</h4>
<div class="paragraph">
<p>It’s possible to redirect the user from a card to a business application declared in ui-menu.json.</p>
</div>
<div class="paragraph">
<p>This can be done by calling the following function from the template :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.navigate.redirectToBusinessMenu(idMenu);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>idMenu is the id of the menu entry defined in ui-menu.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to append a url extension (sub paths and/or parameters) to the url that will be called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.navigate.redirectToBusinessMenu('myMenu','/extension?param1=aParam&amp;param2=anotherParam');</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be useful to pass context from the card to the business application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_showcarddetail"><a class="anchor" href="#_function_showcarddetail"></a>10.4.2. Function showCardDetail</h4>
<div class="paragraph">
<p>It is possible from the template to redirect the user to another "card detail" in feed page</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> opfab.navigation.showCardDetail('cardId');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currentcard_api"><a class="anchor" href="#_currentcard_api"></a>10.5. CurrentCard API</h3>
<div class="sect3">
<h4 id="_function_displayloadingspinner"><a class="anchor" href="#_function_displayloadingspinner"></a>10.5.1. Function displayLoadingSpinner</h4>
<div class="paragraph">
<p>Once the card is loaded, there may be some processing that is time-consuming. In this case, it is possible to show a spinner using the method displayLoadingSpinner and hideLoadingSpinner in the card template .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.displayLoadingSpinner();
        // Time consumming code
        ....
        opfab.currentCard.hideLoadingSpinner();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_hideloadingspinner"><a class="anchor" href="#_function_hideloadingspinner"></a>10.5.2. Function hideLoadingSpinner</h4>
<div class="paragraph">
<p>Hide loading spinner previously open with displayLoadingSpinner()</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.hideLoadingSpinner()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getchildcards"><a class="anchor" href="#_function_getchildcards"></a>10.5.3. Function getChildCards</h4>
<div class="literalblock">
<div class="content">
<pre>Returns an array of the child cards. The structure of a child card is the same as the structure of a classic card.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const childCards =  opfab.currentCard.getChildCards();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getcard"><a class="anchor" href="#_function_getcard"></a>10.5.4. Function getCard()</h4>
<div class="paragraph">
<p>You can access the current selected card as a js object using the getCard() method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const currentCard = opfab.currentCard.getCard();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isuserallowedtoedit"><a class="anchor" href="#_function_isuserallowedtoedit"></a>10.5.5. Function isUserAllowedToEdit</h4>
<div class="paragraph">
<p>To check if current user has the permission to edit the current card, you can call the isUserAllowedToEdit() method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>   const editAllowed = opfab.currentCard.isUserAllowedToEdit()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_editcard"><a class="anchor" href="#_function_editcard"></a>10.5.6. Function editCard</h4>
<div class="paragraph">
<p>It is possible to open current card edition modal, if current user has the permission, by calling the editCard() method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.editCard()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getdisplaycontext"><a class="anchor" href="#_function_getdisplaycontext"></a>10.5.7. Function getDisplayContext</h4>
<div class="paragraph">
<p>To adapt the template content to the display context it is possible to get from OperatorFabric the page context where the template will be rendered by calling the javascript function getDisplayContext(). The function returns a string with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'realtime' : realtime page context (feed, monitoring)</p>
</li>
<li>
<p>'archive' : archive page context</p>
</li>
<li>
<p>'preview': preview context (user card)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const displayContext =  opfab.currentCard.getDisplayContext();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getentitiesallowedtorespond"><a class="anchor" href="#_function_getentitiesallowedtorespond"></a>10.5.8. Function getEntitiesAllowedToRespond</h4>
<div class="paragraph">
<p>If inside your template, you want to get the ids of the entities allowed to send a response, you can call the method getEntitiesAllowedToRespond. This method returns an array containing the ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const entities = opfab.currentCard.getEntitiesAllowedToRespond();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getentitiesusableforuserresponse"><a class="anchor" href="#_function_getentitiesusableforuserresponse"></a>10.5.9. Function  getEntitiesUsableForUserResponse</h4>
<div class="paragraph">
<p>If inside your template, you want to get the ids of the entities the user can answer on behalf of, you can call the method getEntitiesUsableForUserResponse. This method will return an array containing the entities' ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const entities = opfab.currentCard.getEntitiesUsableForUserResponse()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isresponselocked"><a class="anchor" href="#_function_isresponselocked"></a>10.5.10. Function isResponseLocked</h4>
<div class="paragraph">
<p>To know if template is locked (i.e. user can not respond unless he unlocks the card)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isResponseLocked =  opfab.currentCard.isResponseLocked()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isuserallowedtorespond"><a class="anchor" href="#_function_isuserallowedtorespond"></a>10.5.11. Function isUserAllowedToRespond</h4>
<div class="paragraph">
<p>The template can know if the current user has the permission to send a response to the current card by calling the isUserAllowedToRespond() function.
An example of usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars">src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isUserAllowed = opfab.currentCard.isUserAllowedToRespond();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_isusermemberofanentityrequiredtorespond"><a class="anchor" href="#_function_isusermemberofanentityrequiredtorespond"></a>10.5.12. Function isUserMemberOfAnEntityRequiredToRespond</h4>
<div class="paragraph">
<p>The template can know if the current user is member of an Entity required to respond by calling the isUserMemberOfAnEntityRequiredToRespond function.
An example of usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    const isUserRequired = opfab.currentCard.isUserMemberOfAnEntityRequiredToRespond()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoresponselock"><a class="anchor" href="#_function_listentoresponselock"></a>10.5.13. Function listenToResponseLock</h4>
<div class="paragraph">
<p>Register a function to be informed when template is locked (i.e. user has responded to the current card)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToResponseLock( () =&gt; {// do some stuff});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoresponseunlock"><a class="anchor" href="#_function_listentoresponseunlock"></a>10.5.14. Function listenToResponseUnlock</h4>
<div class="paragraph">
<p>Register a function to be informed when template is unlocked (i.e. user has clicked the modify button to prepare a new response)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToResponseUnlock( () =&gt; {// do some stuff}))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentochildcards"><a class="anchor" href="#_function_listentochildcards"></a>10.5.15. Function listenToChildCards</h4>
<div class="paragraph">
<p>Register a function to receive the child cards on card loading and when the childCards list changes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.currentCard.listenToChildCards( (childCards) =&gt; { // process child cards });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentolttdexpired"><a class="anchor" href="#_function_listentolttdexpired"></a>10.5.16. Function listenToLttdExpired</h4>
<div class="paragraph">
<p>If the card has a last time to decide (lttd) configured, when the time is expired this information can be received by the template by registering a listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToLttdExpired( () =&gt; { // do some stuff });</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentostylechange"><a class="anchor" href="#_function_listentostylechange"></a>10.5.17. Function listenToStyleChange</h4>
<div class="paragraph">
<p>Card template can be informed when switching day/night mode by registering a listener as follows :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentCard.listenToStyleChange( () =&gt; { // do some stuff });</code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used by a template to refresh styles and reload embedded charts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoscreensize"><a class="anchor" href="#_function_listentoscreensize"></a>10.5.18. Function listenToScreenSize</h4>
<div class="paragraph">
<p>To adapt the template content on screen size it is possible to receive from OperatorFabric information on the size of the window where the template will be rendered. To receive screen size information you need to implement a listener function which will receive as input a string parameter with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'md' : medium size window</p>
</li>
<li>
<p>'lg' : large size window</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.listenToScreenSize( (screenSize) =&gt; {
            if (screenSize == 'lg') // do some stuff
            else // do some other stuff
        })</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentotemplaterenderingcomplete"><a class="anchor" href="#_function_listentotemplaterenderingcomplete"></a>10.5.19. Function listenToTemplateRenderingComplete</h4>
<div class="paragraph">
<p>It is possible to be informed when opfab has finished all tasks regarding rendering template by registering a listener function .The function will be called after the call of the other listener (applyChildCard, lockAnswer ,lttdExpired and screenSize)</p>
</div>
<div class="paragraph">
<p>It can be used by a template to launch some processing when loading is complete</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.listenToTemplateRenderingComplete(() =&gt; {// do some stuff})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_registerfunctiontogetuserresponse"><a class="anchor" href="#_function_registerfunctiontogetuserresponse"></a>10.5.20. Function registerFunctionToGetUserResponse</h4>
<div class="paragraph">
<p>Register the template function to call to get user response. This function will be called by opfab when user clicks on the "send response" button. More explanation can be found in the <a href="#response_cards">response card chapter</a>.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.registerFunctionToGetUserResponse ( () =&gt;
          {
                const question = document.getElementById('question').value;

                if (question.length &lt;1) return {
                    valid: false,
                    errorMsg : &quot;You must provide a question&quot;
                }

                const card = {
                    summary: { key: &quot;question.summary&quot; },
                    title: { key: &quot;question.title&quot; },
                    severity: &quot;ACTION&quot;,
                    data: {
                        question: question,
                    }
                };
                return {
                    valid: true,
                    card: card,
                    viewCardInCalendar: false
                };

            })</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currentusercard_api"><a class="anchor" href="#_currentusercard_api"></a>10.6. CurrentUserCard API</h3>
<div class="sect3">
<h4 id="_function_geteditionmode"><a class="anchor" href="#_function_geteditionmode"></a>10.6.1. Function getEditionMode</h4>
<div class="paragraph">
<p>The template can know if the user is creating a new card or editing an existing card by calling the <em>opfab.currentUserCard.getEditionMode()</em> function. The function will return one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'CREATE'</p>
</li>
<li>
<p>'EDITION'</p>
</li>
<li>
<p>'COPY'</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const mode = opfab.currentUserCard.getEditionMode();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getenddate"><a class="anchor" href="#_function_getenddate"></a>10.6.2. Function getEndDate</h4>
<div class="paragraph">
<p>The template can know the current endDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getEndDate()</em> function. The function will return a number corresponding to the endDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const endDate = opfab.currentUserCard.getEndDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getexpirationdate"><a class="anchor" href="#_function_getexpirationdate"></a>10.6.3. Function getExpirationDate</h4>
<div class="paragraph">
<p>The template can know the current expirationDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getExpirationDate()</em> function. The function will return a number corresponding to the expirationDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const expirationDate = opfab.currentUserCard.getExpirationDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getlttd"><a class="anchor" href="#_function_getlttd"></a>10.6.4. Function getLttd</h4>
<div class="paragraph">
<p>The template can know the current lttd of the card in creation or edition by calling the <em>opfab.currentUserCard.getLttd()</em> function. The function will return a number corresponding to the lttd as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const lttd = opfab.currentUserCard.getLttd();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getprocessid"><a class="anchor" href="#_function_getprocessid"></a>10.6.5. Function getProcessId</h4>
<div class="paragraph">
<p>The template can know the process id of the card by calling the <em>opfab.currentUserCard.getProcessId()</em>  function. The function will return a string corresponding to the process id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const id = opfab.currentUserCard.getProcessId();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getselectedentityrecipients"><a class="anchor" href="#_function_getselectedentityrecipients"></a>10.6.6. Function getSelectedEntityRecipients</h4>
<div class="paragraph">
<p>The template can know the list of entities selected by the user as recipients of the card by calling the <em>opfab.currentUserCard.getSelectedEntityRecipients()</em> function. The function will return an array of entity ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const recipients = opfab.currentUserCard.getSelectedEntityRecipients();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getselectedentityforinformationrecipients"><a class="anchor" href="#_function_getselectedentityforinformationrecipients"></a>10.6.7. Function getSelectedEntityForInformationRecipients</h4>
<div class="paragraph">
<p>The template can know the list of entities selected by the users as recipients of the card by calling the <em>opfab.currentUserCard.getSelectedEntityForInformationRecipients()</em> function.  The function will return an array of entity ids.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const recipients = opfab.currentUserCard.getSelectedEntityForInformationRecipients();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getstartdate"><a class="anchor" href="#_function_getstartdate"></a>10.6.8. Function getStartDate</h4>
<div class="paragraph">
<p>The template can know the current startDate of the card in creation or edition by calling the <em>opfab.currentUserCard.getStartDate()</em> function.The function will return a number corresponding to the startDate as epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const startDate = opfab.currentUserCard.getStartDate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getstate"><a class="anchor" href="#_function_getstate"></a>10.6.9. Function getState</h4>
<div class="paragraph">
<p>The template can know the state of the card by calling the <em>opfab.currentUserCard.getState()</em> function. The function will return a string corresponding to the state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const state = opfab.currentUserCard.getState();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_getuserentitychildcard"><a class="anchor" href="#_function_getuserentitychildcard"></a>10.6.10. Function getUserEntityChildCard</h4>
<div class="paragraph">
<p>When editing a user card, the template can get the response sent by the entity of the current user by calling the <em>opfab.currentUserCard.getUserEntityChildCard()</em> function. The function will return the response child card sent by current user entity or null if there is no response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const card = opfab.currentUserCard.getUserEntityChildCard();</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The method returns only one child card and is therefore not compatible with the fact that the user is in more than one activity area authorized to send the card. In this case, if there is more than one child card, only one will be returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_function_listentoentityusedforsendingcard"><a class="anchor" href="#_function_listentoentityusedforsendingcard"></a>10.6.11. Function listenToEntityUsedForSendingCard</h4>
<div class="paragraph">
<p>The template can receive the emitter entity of the card by registering a listener function. The function will be called by OperatorFabric after loading the template and every time the card emitter changes (if the user can choose from multiple entities).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentUserCard.listenToEntityUsedForSendingCard((entityId) =&gt; {// do some stuff with the entity id})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_registerfunctiontobecalledbeforecardsending"><a class="anchor" href="#_function_registerfunctiontobecalledbeforecardsending"></a>10.6.12. Function  registerFunctionToBeCalledBeforeCardSending</h4>
<div class="paragraph">
<p>Before sending the card and after the preview, you can define a method to be called. This method is blocking (i.e., it is an async method awaited by the opfab code).</p>
</div>
<div class="paragraph">
<p>The card to be sent is provided as a parameter.</p>
</div>
<div class="paragraph">
<p>If the method throws an error, the error message will be shown to the user on the top screen banner and the card will not be sent.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>    opfab.currentUserCard.registerFunctionToBeCalledBeforeCardSending( async(cardToBeSent) =&gt; {

      // do some stuff

      // throws error if needed

    })</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_registerfunctiontogetspecificcardinformation"><a class="anchor" href="#_function_registerfunctiontogetspecificcardinformation"></a>10.6.13. Function registerFunctionToGetSpecificCardInformation</h4>
<div class="paragraph">
<p>Register the template function to call to get user card specific information. This function will be called by opfab when user clicks on the "preview" button. More explanation can be found in the <a href="#user_cards">user card chapter</a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        opfab.currentCard.registerFunctionToGetSpecificCardInformation( () =&gt; {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : &quot;message.summary&quot;},
          title : {key : &quot;message.title&quot;},
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setdropdownentityrecipientlist"><a class="anchor" href="#_function_setdropdownentityrecipientlist"></a>10.6.14. Function setDropdownEntityRecipientList</h4>
<div class="paragraph">
<p>When sending a user card, by default it is possible to choose the recipients from all the available entities. To limit the list of available recipients it is possible to configure the list of possible recipients via javascript in the user template.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setDropdownEntityRecipientList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available recipients will contain: "ENTITY_FR" (level 0), all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setdropdownentityrecipientforinformationlist"><a class="anchor" href="#_function_setdropdownentityrecipientforinformationlist"></a>10.6.15. Function setDropdownEntityRecipientForInformationList</h4>
<div class="paragraph">
<p>When sending a user card, by default it is possible to choose the recipients for information from all the available entities. To limit the list of available recipients it is possible to configure the list of possible recipients via javascript in the user template.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setDropdownEntityRecipientForInformationList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available recipients for information will contain: "ENTITY_FR" (level 0), all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialenddate"><a class="anchor" href="#_function_setinitialenddate"></a>10.6.16. Function setInitialEndDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>endDate</code> by calling  <em>opfab.currentUserCard.setInitialEndDate(endDate)</em> . The endDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const endDate = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialEndDate(endDate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialexpirationdate"><a class="anchor" href="#_function_setinitialexpirationdate"></a>10.6.17. Function setInitialExpirationDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>expirationDate</code> by calling  <em>opfab.currentUserCard.setInitialExpirationDate(expirationDate)</em> . The expirationDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const expirationDate = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialExpirationDate(expirationDate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitiallttd"><a class="anchor" href="#_function_setinitiallttd"></a>10.6.18. Function setInitialLttd</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for <code>lttd</code> by calling  <em>opfab.currentUserCard.setInitialLttd(lttd)</em> . The lttd is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const lttd = new Date().valueOf() + 10000;
        opfab.currentUserCard.setInitialLttd(lttd);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialselectedrecipients"><a class="anchor" href="#_function_setinitialselectedrecipients"></a>10.6.19. Function setInitialSelectedRecipients</h4>
<div class="paragraph">
<p>It is possible to configure the list of initially selected recipients via javascript in the user template by calling the setInitialSelectedRecipients method. The method takes as input the list of Entity ids to be preselected. The method will work only at template loading time, cannot be used to modify the selected recipients after the template is loaded or in card edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setInitialSelectedRecipients([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialselectedrecipientsforinformation"><a class="anchor" href="#_function_setinitialselectedrecipientsforinformation"></a>10.6.20. Function setInitialSelectedRecipientsForInformation</h4>
<div class="paragraph">
<p>It is possible to configure the list of initially selected recipients for information via javascript in the user template by calling the setInitialSelectedRecipientsForInformation method. The method takes as input the list of Entity ids to be preselected. The method will work only at template loading time, cannot be used to modify the selected recipients after the template is loaded or in card edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setInitialSelectedRecipientsForInformation([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients for information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setselectedrecipients"><a class="anchor" href="#_function_setselectedrecipients"></a>10.6.21. Function setSelectedRecipients</h4>
<div class="paragraph">
<p>It is possible to configure the list of selected recipients via javascript in the user template by calling the setInitialSelectedRecipients method. The method takes as input the list of Entity ids to be preselected. This method can be called at any time and also in edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setSelectedRecipients([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setselectedrecipientsforinformation"><a class="anchor" href="#_function_setselectedrecipientsforinformation"></a>10.6.22. Function setSelectedRecipientsForInformation</h4>
<div class="paragraph">
<p>It is possible to configure the list of selected recipients for information via javascript in the user template by calling the setSelectedRecipientsForInformation method. The method takes as input the list of Entity ids to be selected.  This method can be called at any time and also in edition mode.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    opfab.currentUserCard.setSelectedRecipientsForInformation([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients for information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialseverity"><a class="anchor" href="#_function_setinitialseverity"></a>10.6.23. Function setInitialSeverity</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value for card severity choice by calling the function <em>setInitialSeverity(severity)</em></p>
</div>
<div class="paragraph">
<p>Allowed severity values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'ALARM'</p>
</li>
<li>
<p>'ACTION'</p>
</li>
<li>
<p>'INFORMATION'</p>
</li>
<li>
<p>'COMPLIANT'</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>       opfab.currentUserCard.setInitialSeverity('ACTION');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialkeepchildcards"><a class="anchor" href="#_function_setinitialkeepchildcards"></a>10.6.24. Function setInitialKeepChildCards</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial value to keep child cards or not by calling the function <em>setInitialKeepChildCards(keepChildCards)</em></p>
</div>
<div class="paragraph">
<p>'keepChildCards' is expected to be a boolean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>       opfab.currentUserCard.setInitialKeepChildCards(true);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_setinitialstartdate"><a class="anchor" href="#_function_setinitialstartdate"></a>10.6.25. Function setInitialStartDate</h4>
<div class="paragraph">
<p>From the template it is possible to set the initial values for <code>startDate</code> by calling  <em>opfab.currentUserCard.setInitialStartDate(startDate)</em> . The startDate is a number representing an epoch date value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>        const startDate = new Date().valueOf();
        opfab.currentUserCard.setInitialStartDate(startDate);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_utils_api"><a class="anchor" href="#_utils_api"></a>10.7. Utils API</h3>
<div class="sect3">
<h4 id="_function_escapehtml"><a class="anchor" href="#_function_escapehtml"></a>10.7.1. Function escapeHtml</h4>
<div class="paragraph">
<p>To avoid script injection, OperatorFabric provides a utility function 'opfab.utils.escapeHtml()' to sanitize input content by escaping HTML specific characters. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;input id=&quot;input-message&quot; type=&quot;text&quot; name=&quot;message&quot;&gt;
&lt;button onClick=&quot;showMessage()&quot;&gt;

&lt;span id=&quot;safe-message&quot;&gt;&lt;/span&gt;


&lt;script&gt;
  showMessage : function() {
    let msg = document.getElementById(&quot;input-message&quot;);
    document.getElementById(&quot;safe-message&quot;).innerHTML = opfab.utils.escapeHtml(msg.value);
  }

&lt;/script&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alertmessage_api"><a class="anchor" href="#_alertmessage_api"></a>10.8. AlertMessage API</h3>
<div class="sect3">
<h4 id="_function_show"><a class="anchor" href="#_function_show"></a>10.8.1. Function show</h4>
<div class="paragraph">
<p>It’s possible to show an alert message as a popover by calling the following function from the template :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.alertMessage.show('message', opfab.alertMessage.messageLevel.INFO);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The popover will have a different background color based on the message level specified.
The available message levels are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DEBUG (blue)</p>
</li>
<li>
<p>INFO (green)</p>
</li>
<li>
<p>ERROR (orange)</p>
</li>
<li>
<p>ALARM (red)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ui_api"><a class="anchor" href="#_ui_api"></a>10.9. UI API</h3>
<div class="sect3">
<h4 id="_function_getcurrentvisibleperiod"><a class="anchor" href="#_function_getcurrentvisibleperiod"></a>10.9.1. Function getCurrentVisiblePeriod</h4>
<div class="paragraph">
<p>You can use this function to get the current visible period on the timeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>const currentVisiblePeriod = opfab.ui.getCurrentVisiblePeriod();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This function returns 3 fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>domain : RT / D / 7D / W / M / Y</p>
</li>
<li>
<p>startPeriod : epochDate</p>
</li>
<li>
<p>endPeriod : epochDate</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cards_api"><a class="anchor" href="#_cards_api"></a>10.10. Cards API</h3>
<div class="sect3">
<h4 id="_function_getcards"><a class="anchor" href="#_function_getcards"></a>10.10.1. Function getCards</h4>
<div class="paragraph">
<p>You can use this function to get a list of cards filtered on the specified filter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.cards.getCards(cardsFilter).then(...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function returns a Promise&lt;Page&gt; object with the result of the query.</p>
</div>
<div class="paragraph">
<p>Page object contains the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>totalPages: total number of pages</p>
</li>
<li>
<p>totalElements: total number of results</p>
</li>
<li>
<p>size: size of the page</p>
</li>
<li>
<p>number: page number</p>
</li>
<li>
<p>first: true if it is the first page</p>
</li>
<li>
<p>last: true if it is the last page</p>
</li>
<li>
<p>numberOfElements: number of cards in this page</p>
</li>
<li>
<p>content: array of returned cards</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Card filter object has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>page: page number</p>
</li>
<li>
<p>size: page size,</p>
</li>
<li>
<p>adminMode: set to true to retrieve cards in admin mode (only if user has the permission)</p>
</li>
<li>
<p>includeChildCards: set to true to retrieve also child cards</p>
</li>
<li>
<p>filters: array of FilterModel</p>
</li>
<li>
<p>selectedFields: array of cards fields as string to be returned</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>FilterModel object has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>columnName: card field to be tested</p>
</li>
<li>
<p>matchType: one of BLANK,CONTAINS,ENDSWITH,EQUALS,GREATERTHAN,IN,LESSTHAN,NOTBLANK,NOTCONTAINS,NOTEQUAL,STARTSWITH</p>
</li>
<li>
<p>filter: list of string values to be matched, for match types that need a single argument pass an array with one value</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_function_sendresponsecard"><a class="anchor" href="#_function_sendresponsecard"></a>10.10.2. Function sendResponseCard</h4>
<div class="paragraph">
<p>It is possible to respond to a card from the template by calling the following function (instead of using the "send response" button) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>opfab.cards.sendResponseCard(parentCard,responseCard).then(...);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function returns a <code>Promise&lt;void&gt;</code>. The promise will be resolved when the response is sent and rejected with an error message if an error occurs.</p>
</div>
<div class="paragraph">
<p>The <code>parentCard</code> parameter is the parent card object (can be obtained from the current card object).</p>
</div>
<div class="paragraph">
<p>The <code>responseCard</code> object has the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>data</code>: The data field to include in the response card.</p>
</li>
<li>
<p><code>actions</code>: The actions field value for the response card. This field is optional.</p>
</li>
<li>
<p><code>state</code>: The state field value for the response card. This field is optional (default value is defined in the state process definition).</p>
</li>
<li>
<p><code>publisher</code>: The publisher field value for the response card. This field is optional (default value is the first current user entity that is allowed to respond).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archived_cards"><a class="anchor" href="#_archived_cards"></a>11. Archived Cards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_key_concepts"><a class="anchor" href="#_key_concepts"></a>11.1. Key concepts</h3>
<div class="paragraph">
<p>Every time a card is published, in addition to being delivered to the users
and persisted as a "current" card in MongoDB, it is also immediately
persisted in the archived cards.</p>
</div>
<div class="paragraph">
<p>Archived cards are similar in structure to current cards, but they are managed differently.
Current cards are uniquely identified by their id (made up of the publisher and the process id).
That is because if a new card is published with id as an existing card, it will replace it in the
card collection. This way, the current card reflects the current state of a process instance.
In the archived cards collection however, both cards will be kept, so that the archived cards
show all the states that a given process instance went through.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archives_screen_in_the_ui"><a class="anchor" href="#_archives_screen_in_the_ui"></a>11.2. Archives screen in the UI</h3>
<div class="paragraph">
<p>The Archives screen in the UI allows the users to query these archives with different filters.
The layout of this screen is very similar to the Feed screen: the results are displayed in a
(paginated) card list, and the user can display the associated card details by clicking a card in the list.</p>
</div>
<div class="paragraph">
<p>The results of these queries are limited to cards that the user is allowed to see, either :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because this user is direct recipient of the card,</p>
</li>
<li>
<p>because he belongs to a group (or entity) that is a recipient,</p>
</li>
<li>
<p>or because he belongs to a group that has the right to receive the card (via definition of perimeters)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a card is sent to an entity and a group, then this user must be part of both the group and the entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, child cards are not shown in the Archives, only the parent card is shown.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the user is a member of a group that has the <code>VIEW_ALL_CARDS</code> permission, the user can
see all archives, whether he is part of the recipients or not, whether he has the right to receive the card or not.
If the user is a member of a group that has the <code>VIEW_ALL_CARDS_FOR_USER_PERIMETERS</code> permission, the user
can see all archives for which he has the right to receive it, whether he is part of the recipients or not.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="geomap"><a class="anchor" href="#geomap"></a>12. Geographical map</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The geographical map is a feature that allows you to display the geographical location of cards on a map on the feed screen.</p>
</div>
<div class="paragraph">
<p>To activate the geographical map feature, set the <code>feed.enableMap</code> property to <code>true</code> in the <code>web-ui.json</code> configuration file.</p>
</div>
<div class="paragraph">
<p>The geographical location of the cards is determined by the <code>wktGeometry</code> and <code>wktProjection</code> fields in the card&#8217;s metadata. If a card has a defined <code>wktGeometry</code>, its location will be highlighted on the card. The system supports two geometrical shapes: <code>POINT</code> and <code>POLYGON</code>. A <code>POINT</code> will display as a circle on the map, while a <code>POLYGON</code> will outline the specified area.</p>
</div>
<div class="paragraph">
<p>For instance, to display a circle at a specific location, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POINT (5.8946407 51.9848624)&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>To outline a polygonal area, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POLYGON ((5.5339097 52.0233042,  5.7162495 51.7603784, 5.0036701 51.573684, 4.8339214 52.3547498, 5.5339097 52.0233042))&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specifications of the Well-known Text Representation of coordinate reference systems
can be found at <a href="https://www.ogc.org/standards/wkt-crs">WKT Specification</a>.</p>
</div>
<div class="paragraph">
<p>You can customize the map by setting parameters in the <code>web-ui.json</code> configuration file. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The map uses OpenStreetMap tiles by default, but you can specify different tiles using the <code>feed.geomap.bglayer.xyz</code> parameters.</p>
</li>
<li>
<p>You can add GeoJSON layers to the map using the <code>feed.geomap.layer.geojson</code> parameter in web-ui.json. For each layer it is possible to specify the url and an optional style. The style object can have styling properties for stroke, fill, image, and text styles as defined in OpenLayer flat style (<a href="https://openlayers.org/en/latest/apidoc/module-ol_style_flat.html" class="bare">openlayers.org/en/latest/apidoc/module-ol_style_flat.html</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to the
<a href="/documentation/current/reference_doc/index.html#ui_properties">web-ui configuration</a>
section for more information and additional customization options.</p>
</div>
<div class="paragraph">
<p>The example configuration references a GeoJSON layer from  Opendata Réseau Énergies (<a href="https://odre.opendatasoft.com/" class="bare">odre.opendatasoft.com/</a>) published under open licence v2.0 <a href="https://www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf" class="bare">www.etalab.gouv.fr/wp-content/uploads/2017/04/ETALAB-Licence-Ouverte-v2.0.pdf</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>13. Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The monitoring screen is a realtime view of processes based on current cards received by the user (i.e. the last version of cards visible by the user). It can be seen as another view of the feed.</p>
</div>
<div class="paragraph">
<p>Not all the cards are visible, it depends on the business process they are part of. For a card to be visible in this screen, the parameter <code>uiVisibility.monitoring</code> must be set to <code>true</code> in the config.json file of its process.</p>
</div>
<div class="sect2">
<h3 id="_export_configuration"><a class="anchor" href="#_export_configuration"></a>13.1. Export configuration</h3>
<div class="paragraph">
<p>An Excel export function is available in the monitoring screen, the content of the export can be configured.
To do so, a json file describing the expected output can be sent to the businessconfig service through the /businessconfig/monitoring endpoint.</p>
</div>
<div class="paragraph">
<p>In opfab git repository, you can find in directory <a href="https://github.com/opfab/operatorfabric-core/blob//src/test/resources/monitoringConfig">src/test/resources/monitoringConfig</a>  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a script to load a monitoring configuration <code>loadMonitoringConfig.sh</code></p>
</li>
<li>
<p>an example of configuration in <code>monitoringConfig.json</code> (for the response fields to be filled , you need to respond to a card question in process messageOrQuestionExample )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A description of the structure of the configuration can be found in
<a href="/documentation/current/api/businessconfig/">the businessconfig api documentation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_process_monitoring"><a class="anchor" href="#_process_monitoring"></a>13.2. Process monitoring</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is experimental
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The process monitoring screen has the following similarities with the monitoring screen :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it is a realtime view of processes based on current cards received by the user
(i.e. the last version of cards visible by the user)</p>
</li>
<li>
<p>not all the cards are visible, it depends on the business process they are part of. For a card to be visible on
this screen, the parameter <code>uiVisibility.processmonitoring</code> must be set to <code>true</code> in the <code>config.json</code> file of its
process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The columns displayed on this screen can be configured. To do that, you have to define a JSON file and load the file by sending an HTTP POST request to the <code>/processmonitoring</code> API of businessconfig service or using CLI command <code>opfab process-monitoring load &lt;file&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of processMonitoring configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
  &quot;fields&quot;: [
    { &quot;field&quot;: &quot;startDate&quot;, &quot;type&quot;: &quot;date&quot;, &quot;colName&quot;: &quot;Start Date&quot;, &quot;size&quot;: 200},
    { &quot;field&quot;: &quot;titleTranslated&quot;, &quot;colName&quot;: &quot;Title&quot;, &quot;size&quot;: 250},
    { &quot;field&quot;: &quot;entityRecipients&quot;, &quot;type&quot;: &quot;array&quot;, &quot;colName&quot;: &quot;Entity Recipients&quot;, &quot;size&quot;: 400},
    { &quot;field&quot;: &quot;data.stateName&quot;, &quot;colName&quot;: &quot;My field&quot;, &quot;size&quot;: 300},
    { &quot;field&quot;: &quot;summaryTranslated&quot;, &quot;colName&quot;: &quot;Summary&quot;, &quot;size&quot;: 250},
    { &quot;field&quot;: &quot;data.error&quot;, &quot;colName&quot;: &quot;My second field&quot;, &quot;size&quot;: 100}
  ],
  &quot;fieldsForProcesses&quot;: [
    {
      &quot;process&quot;: &quot;process1&quot;,
      &quot;fields&quot; : [
        { &quot;field&quot;: &quot;startDate&quot;, &quot;type&quot;: &quot;date&quot;, &quot;colName&quot;: &quot;Start Date&quot;, &quot;size&quot;: 200},
        { &quot;field&quot;: &quot;titleTranslated&quot;, &quot;colName&quot;: &quot;Title&quot;, &quot;size&quot;: 250},
        { &quot;field&quot;: &quot;entityRecipients&quot;, &quot;type&quot;: &quot;array&quot;, &quot;colName&quot;: &quot;Entity Recipients&quot;, &quot;size&quot;: 400}
      ]
    },
    {
      &quot;process&quot;: &quot;process2&quot;,
      &quot;fields&quot; : [
        { &quot;field&quot;: &quot;startDate&quot;, &quot;type&quot;: &quot;date&quot;, &quot;colName&quot;: &quot;Start Date&quot;, &quot;size&quot;: 200},
        { &quot;field&quot;: &quot;endDate&quot;, &quot;type&quot;: &quot;date&quot;, &quot;colName&quot;: &quot;End Date&quot;, &quot;size&quot;: 200},
        { &quot;field&quot;: &quot;titleTranslated&quot;, &quot;colName&quot;: &quot;Title&quot;, &quot;size&quot;: 250},
        { &quot;field&quot;: &quot;entityRecipients&quot;, &quot;type&quot;: &quot;array&quot;, &quot;colName&quot;: &quot;Entity Recipients&quot;, &quot;size&quot;: 400}
      ]
    }
  ],
  &quot;filters&quot;: {
    &quot;tags&quot;: [
        {
          &quot;label&quot;: &quot;Label for tag 1&quot;,
          &quot;value&quot;: &quot;tag1&quot;
        },
        {
          &quot;label&quot;: &quot;Label for tag 2&quot;,
          &quot;value&quot;: &quot;tag2&quot;
        }
      ]
    &quot;pageSize&quot;: 10
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fields</code> field in the process monitoring configuration file defines the list of the fields you want to see in the array.</p>
</div>
<div class="paragraph">
<p>You also have the possibility to define the columns displayed per process. To do that, you have to configure the field <code>fieldsForProcesses</code>.</p>
</div>
<div class="paragraph">
<p>If more than one process is selected by the user or if a process has no configuration, the columns displayed will be those of the default config (<code>fields</code>).
Depending on the permissions of the groups to which the user is attached, he can also see the cards he is not the recipient of.</p>
</div>
<div class="paragraph">
<p>In the process monitoring config file it is possible to configure the page size <code>filters.pageSize</code> and the list of available tags used in the UI to filter the results <code>filters.tags</code>.</p>
</div>
<div class="paragraph">
<p>If geographical map view is enabled ('feed.geomap.enableMap' set to 'true' in web-ui.json) it is possible to view the cards on the map by checking the "View Results on a Geographical Map" checkbox.</p>
</div>
<div class="paragraph">
<p>Here is the description of the fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"field" : the name of the field in the card (or in the database) you want to display</p>
</li>
<li>
<p>"type" : field type to be used for formatting. Possible values : <code>date</code>, <code>array</code>. Set to <code>date</code> if you want to display a date/time field, set it to <code>array</code> to display an array as a comma separated list.</p>
</li>
<li>
<p>"colName" : name of the column on the UI</p>
</li>
<li>
<p>"size" : size of the column on the UI, proportionally to each other</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="users_management"><a class="anchor" href="#users_management"></a>14. User management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The User service manages users, groups, entities and perimeters (linked to groups).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Users</dt>
<dd>
<p>represent account information for a person destined to receive cards in the OperatorFabric instance.</p>
</dd>
<dt class="hdlist1">Entities</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>can be used to model organizations, for examples : control center, company , department&#8230;&#8203;</p>
</li>
<li>
<p>can be used in a way to handle rights on card reception in OperatorFabric.</p>
</li>
<li>
<p>can be part of another entity (or even several entities). This relationship is modeled using the "parent entity" property</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Groups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>has a set of perimeters to define rights for card reception in OperatorFabric (group type 'PERMISSION').</p>
</li>
<li>
<p>can be used to model roles in organizations (group type 'ROLE'), for examples : supervisor, dispatcher &#8230;&#8203;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The user define here is an internal representation of the individual card recipient in <code>OperatorFabric</code> the authentication is leave to specific OAuth2 external service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is an authentication token currently valid for the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> system.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_users_groups_entities_and_perimeters"><a class="anchor" href="#_users_groups_entities_and_perimeters"></a>14.1. Users, groups, entities and perimeters</h3>
<div class="paragraph">
<p>User service manages users, groups, entities and perimeters.</p>
</div>
<div class="sect3">
<h4 id="_users"><a class="anchor" href="#_users"></a>14.1.1. Users</h4>
<div class="paragraph">
<p>Users are the individuals and mainly physical person who can log in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The access to this service has to be authorized, in the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> instance, at least to access User information and to manage Users. The membership of groups and entities are stored in the user information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User login must be lowercase. Otherwise, it will be converted to lowercase before saving to the database.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Resource identifiers such as login, group id, entity id and perimeter id must only contain the following characters: letters, _, - or digits.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, a user cannot have several sessions at the same time. If you want to enable it, set <code>operatorfabric.checkIfUserIsAlreadyConnected</code> to false in the configuration file of the card consultation service ( cards-consultation-XXX.yml ). However, this is not recommended as it may cause synchronization problems between the sessions using the same login
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_automated_user_creation"><a class="anchor" href="#_automated_user_creation"></a>14.1.1.1. Automated user creation</h5>
<div class="paragraph">
<p>In case of a user does exist in a provided authentication service but he does not exist in the <code>OperatorFabric</code>
instance, when he is authenticated and connected for the first time in the <code>OperatorFabric</code> instance, the user is
automatically created in the system without attached group or entity.
The administration of the groups, entities and perimeters is dealt by the administrator manually.
More details about automated user creation
<a href="/documentation/current/deployment/index.html#opfab_spec_conf">here</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entities_2"><a class="anchor" href="#_entities_2"></a>14.1.2. Entities</h4>
<div class="paragraph">
<p>The notion of entity is loose and can be used to model organizations structures(examples : control center, company , department&#8230;&#8203; ).
Entities are used to send cards to several users without a name specifically. The information about membership to an
entity is stored in the user&#8217;s data (<code>entities</code> field of the <code>user</code> object). In Entity objects, the <code>parents</code> property (array) expresses the fact that this entity is a part of one or several other entities. This feature allows cards to be sent to a group of entities without having to repeat the detailed list of entities for each card.
The roles attribute allows to set the utility of an entity. It determines if an entity can send or receive cards and if it&#8217;s part of an activity area. This can be useful for a group of entities where only child entities should be used as card publishers while the parent is just a logical group usable as a card recipient. The <code>labels</code> property (array) allows to associate string labels to an Entity object.</p>
</div>
<div class="paragraph">
<p>Examples using entities can be found
<a href="/documentation/current/reference_doc/index.html#_send_to_several_users">here</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_permissions"><a class="anchor" href="#_permissions"></a>14.1.3. Permissions</h4>
<div class="paragraph">
<p>Permissions in <code>OperatorFabric</code> are used to configure user&#8217;s permission on the UI and control the access to the APIs.
The information about permissions is stored in the data of the user&#8217;s groups (<code>Permissions</code> field of the <code>group</code> object).
The available permissions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ADMIN</code>: Administrator permission</p>
</li>
<li>
<p><code>ADMIN_BUSINESS_PROCESS</code>: Permission to administer process bundles (add, update, delete bundles)</p>
</li>
<li>
<p><code>VIEW_ALL_CARDS</code>: Permission to access all cards and archived cards</p>
</li>
<li>
<p><code>VIEW_ALL_CARDS_FOR_USER_PERIMETERS</code>: Permission to access all cards and archived cards which are in the perimeter of the user</p>
</li>
<li>
<p><code>READONLY</code>: Readonly permission. User cannot send user cards, cannot respond to a card, when acknowledges a card he does not acknowledge it for his entities.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_groups"><a class="anchor" href="#_groups"></a>14.1.4. Groups</h4>
<div class="paragraph">
<p>The notion of group is loose and can be used to simulate business role in <code>OperatorFabric</code> (examples : supervisor, dispatcher &#8230;&#8203; ) by setting group type to 'ROLE' or to define permissions on processes/states by setting the group type to 'PERMISSION'.
Groups are used to send cards to several users without a name specifically. The information about membership to a
group is stored in the user information. A group contains a list of perimeters which define the rights of reception/writing for a couple process/state. The rules used to send cards are described in the
<a href="/documentation/current/reference_doc/index.html#reception_rules">recipients section</a>
.
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_perimeters"><a class="anchor" href="#_perimeters"></a>14.1.5. Perimeters</h4>
<div class="paragraph">
<p>Perimeters are used to define rights for reading/writing cards. A perimeter is composed of an identifier (unique), a process name and a list of state/rights couple.
Possible rights for receiving/writing cards are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receive : the rights for receiving a card</p>
</li>
<li>
<p>Write : the rights for writing a card, that is to say respond to a card or create a new card</p>
</li>
<li>
<p>ReceiveAndWrite : the rights for receiving and writing a card</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_way_to_manage_groups_and_entities"><a class="anchor" href="#_alternative_way_to_manage_groups_and_entities"></a>14.1.6. Alternative way to manage groups and entities</h4>
<div class="paragraph">
<p>The standard way to handle groups and entities in <code>OperatorFabric</code> instance is dealt on the user information.
There is an alternative way to manage groups and entities through the authentication token, the groups and entities are defined by the administrator of the authentication service.
See
<a href="/documentation/current/deployment/index.html#jwt_mode">here</a>
for more details to use this feature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currently_connected_users"><a class="anchor" href="#_currently_connected_users"></a>14.2. Currently connected users</h3>
<div class="paragraph">
<p>The endPoint <code>/cards/connections</code> gives the list of connected users in real time. It is accessible by all users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_real_time_users"><a class="anchor" href="#_real_time_users"></a>14.3. Real time users</h3>
<div class="paragraph">
<p>OperatorFabric allows you to see which entities/groups are logged in and not logged in. To have this information, you must upload a configuration file, using the endpoint /businessconfig/realtimescreens, via a POST request. In this file, you can configure several screens, each one containing the list of entities/groups you want to see.</p>
</div>
<div class="paragraph">
<p>This interface is accessible via the user menu (top right of the screen).</p>
</div>
<div class="paragraph">
<p>Here is an example of the configuration file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">realTimeScreens</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">All Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_FR</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_IT</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_NL</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">French Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_FR</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Italian Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_IT</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dutch Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY_NL</span><span class="delimiter">&quot;</span></span>]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">EUROPEAN_SUPERVISION_CENTERS</span><span class="delimiter">&quot;</span></span>]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration file, 4 different screens will be available : "All Control Centers", "French Control Centers", "Italian Control Centers" and "Dutch Control Centers". To associate the entities under each entity group, it is required to label the entity group as a parent of the entities.</p>
</div>
<div class="paragraph">
<p>For example, in the UI, "All Control Centers" will look like :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/realtimescreen_screenshot.png" alt="Real Time Screens screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_activity_area"><a class="anchor" href="#_activity_area"></a>14.4. Activity area</h3>
<div class="paragraph">
<p>OperatorFabric allows you to connect/disconnect to/from one or several entity/ies. By default, the user is connected to
all the entities to which he belongs.
By choosing to disconnect from an entity, the user will still be a member of this entity, but he will no longer have
access to the cards intended for this entity, until he reconnects to it.</p>
</div>
<div class="paragraph">
<p>If set visible in ui-menu.json, this interface is accessible via the user menu (top right of the screen).</p>
</div>
<div class="paragraph">
<p>The choice of activity area may be done during user logging phase if you set selectActivityAreaOnLogin to true in web-ui.json.</p>
</div>
<div class="paragraph">
<p>If the user is a member of one (or more) real-time group(s), then he will see on the screen the members of these groups, currently connected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_actions_logs"><a class="anchor" href="#_user_actions_logs"></a>14.5. User actions logs</h3>
<div class="paragraph">
<p>OperatorFabric allows you to view most relevant user actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OPEN_SUBSCRIPTION</p>
</li>
<li>
<p>CLOSE_SUBSCRIPTION</p>
</li>
<li>
<p>ACK_CARD</p>
</li>
<li>
<p>UNACK_CARD</p>
</li>
<li>
<p>READ_CARD</p>
</li>
<li>
<p>UNREAD_CARD</p>
</li>
<li>
<p>SEND_CARD</p>
</li>
<li>
<p>SEND_RESPONSE</p>
</li>
<li>
<p>NOTIFICATION_CONFIG</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each action the following information are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>date</code>: date and time of the action</p>
</li>
<li>
<p><code>action</code>: type of action</p>
</li>
<li>
<p><code>login</code>: username of te user who performed the action</p>
</li>
<li>
<p><code>entities</code>: list of user entities</p>
</li>
<li>
<p><code>cardUid</code>: card Uid</p>
</li>
<li>
<p><code>comment</code>: textual information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, logs older than 61 days are automatically deleted.</p>
</div>
<div class="paragraph">
<p>If set visible in ui-menu.json and user is admin, this interface is accessible via the user menu (top right of the screen).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_customization"><a class="anchor" href="#_ui_customization"></a>15. UI Customization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ui_configuration"><a class="anchor" href="#_ui_configuration"></a>15.1. UI configuration</h3>
<div class="paragraph">
<p>To customize the UI, declare specific parameters in the <code>web-ui.json</code> file as <a href="../deployment/index.html#ui_properties">listed here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="menu_entries"><a class="anchor" href="#menu_entries"></a>15.2. Menu Entries</h3>
<div class="paragraph">
<p>The <code>ui-menu.json</code> file is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To manage the visibility of core OperatorFabric menus (feed, monitoring, etc.)</p>
</li>
<li>
<p>To declare specific business menus to be displayed in the navigation bar of OperatorFabric</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This file contains 4 fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>navigationBar</code> : contains the navigation bar mixing core menus and custom menus</p>
</li>
<li>
<p><code>topRightIconMenus</code> : contains only the two menu icons <code>agenda</code> and <code>usercard</code> on the top right of the screen</p>
</li>
<li>
<p><code>topRightMenus</code> : contains core menus you want to see when you click the user, on the top right of the screen</p>
</li>
<li>
<p><code>locales</code> : contains the translations for the custom menus</p>
</li>
<li>
<p><code>showDropdownMenuEvenIfOnlyOneEntry</code> : indicates if the name of the menu and a dropdown menu are displayed if it
contains only one submenu entry. If false, the submenu entry will be displayed directly in the navigation bar. This field is
optional, the default value is false.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="core_menu_config"><a class="anchor" href="#core_menu_config"></a>15.2.1. Core menus</h4>
<div class="paragraph">
<p>Core menus are objects containing the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>opfabCoreMenuId</code>: Id of the core menu (string)</p>
</li>
<li>
<p><code>visible</code>: Whether this menu should be visible for this OperatorFabric instance (boolean). This field is not
needed in <code>navigationBar</code> field but it is needed in <code>topRightIconMenus</code> and <code>topRightMenus</code>.</p>
</li>
<li>
<p><code>showOnlyForGroups</code> : List of groups for which this menu should be visible (array, optional)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Menu visibility summary</div>
<ul>
<li>
<p>For a core menu with <code>"visible": true</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>showOnlyForGroups</code> is not present, null or an empty array : the menu is visible for all users.</p>
</li>
<li>
<p>If <code>showOnlyForGroups</code> is present and with a non-empty array as a value: menu is visible only for users from the
listed groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. List of core menus and corresponding ids</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Location of menu</th>
<th class="tableblock halign-left valign-top">Menu</th>
<th class="tableblock halign-left valign-top">Id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">Navigation bar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dashboard</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dashboard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Navigation bar (icon)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User card</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="11"><p class="tableblock">Top-right menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External devices configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">externaldevicesconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real time users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtimeusers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activity area</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">activityarea</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feedconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User action logs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">useractionlogs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">About</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">about</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Night/Day toggle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nightdaymode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changepassword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <code>/config/docker/ui-menu.json</code> for an example containing all core menus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you decide not to make the night/day toggle visible (globally or for certain users), you should consider
setting the <code>settings.styleWhenNightDayModeDesactivated</code> property in <code>web-ui.json</code> to specify which mode should be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_business_menus"><a class="anchor" href="#_custom_business_menus"></a>15.2.2. Custom business menus</h4>
<div class="paragraph">
<p>A menu can target directly a link or give access to several sub-menus when clicked.
Those sub-menus can target a link or an opfab core menu.
A targeted link can be open in an iframe or in a new tab.</p>
</div>
<div class="paragraph">
<p>Menus support i18n following the i18n OperatorFabric rules.
The ui-menu.json file contains directly the i18n dictionary for the menus.</p>
</div>
<div class="paragraph">
<p>In case of a single menu, the navigation bar displays the l10n of the <code>label</code> of the entry menu.
In this case, the <code>label</code> declared at the root level of the menu is useless and can be omitted (see example below).</p>
</div>
<div class="paragraph">
<p>A single menu or a menu with sub-menus has at least attributes named <code>id</code> and <code>entries</code>.
The <code>entries</code> attribute is an array of <code>menu entry</code>. It is possible to restrict the visibility of one menu entry
to one or more user groups by setting the <code>showOnlyForGroups</code> parameter.
Note that menus with sub-menus need a <code>label</code> declaring an i18n key.</p>
</div>
<div class="paragraph">
<p>A menu entry can target a core menu id or a link. If it targets a link, it must declare the attributes listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>customMenuId</code>: identifier of the entry menu in the UI;</p>
</li>
<li>
<p><code>url</code>: url opening a new page in a tab in the browser;</p>
</li>
<li>
<p><code>label</code>: it&#8217;s an i18n key used to l10n the entry in the UI.</p>
</li>
<li>
<p><code>linkType</code>: Defines how to display business menu links in the navigation bar and how to open them. Possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>TAB</code>: displays only a text link. Clicking it opens the link in a new tab.</p>
</li>
<li>
<p><code>IFRAME</code>: displays only a text link. Clicking it opens the link in an iframe in the main content zone below the navigation bar.</p>
</li>
<li>
<p><code>BOTH</code>: default value. Displays a text link plus a little arrow icon. Clicking the text link opens the link in an iframe while clicking the icon opens in a new tab.
**</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>showOnlyForGroups</code>: Defines the list of user groups entitled to see the menu entry, if not defined or empty it will be visible to every user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, the configuration file declares two additional business menus.
The first has only one entry, which targets a link. The second business menu has three entries, one which targets the
core menu <code>Dashboard</code> and two others which target links.
The sample also contains the 2 top right icons (<code>usercard</code> and <code>calendar</code>), the composition of the top right menu and
the i18n translations in English and French.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">navigationBar</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feed</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">archives</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_0</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.single</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title.multi</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dashboard</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Maintainer,Dispatcher</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.wikipedia.org/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">topRightIconMenus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">usercard</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">topRightMenus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">settings</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">activityarea</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feedconfiguration</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">realtimeusers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">externaldevicesconfiguration</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">useractionlogs</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nightdaymode</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">about</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">changepassword</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">logout</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">visible</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">locales</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Single menu entry</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First menu entry</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu entry</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu</span><span class="delimiter">&quot;</span></span>
        }
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier élément</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier élément</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxième élément</span><span class="delimiter">&quot;</span></span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Deuxième menu</span><span class="delimiter">&quot;</span></span>
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For iframes opened from menu, the associated request uses an extra parameter containing the current theme information.
Named <code>opfab_theme</code>, this parameter has a value corresponding to the current theme: <code>DAY</code> or <code>NIGHT</code>. For example:
<code><a href="http://mysite.com/index.htm?opfab_theme=NIGHT" class="bare">mysite.com/index.htm?opfab_theme=NIGHT</a></code>. Switching theme will trigger reload of open iframes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_screen_menus"><a class="anchor" href="#_custom_screen_menus"></a>15.2.3. Custom screen menus</h4>
<div class="paragraph">
<p>It is possible to add menus linked to custom screens of the application. See custom screen definition <a href="./single_page_doc.html#card_list_custom_screen">here</a>. To set up such a menu, it&#8217;s important to give it a customMenuId and a customScreenId. See example below :</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">navigationBar</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabCoreMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feed</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_0</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">customScreenId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">testId</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.custom</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">customMenuId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.single</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  ],
  [<span class="error">.</span><span class="error">.</span><span class="error">.</span>]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="card_list_custom_screen"><a class="anchor" href="#card_list_custom_screen"></a>15.3. Card List Custom Screen</h3>
<div class="paragraph">
<p>You can define a custom screen containing a search header and a list of cards.</p>
</div>
<div class="paragraph">
<p>To do this, register the custom screen via a JavaScript script loaded on startup (To be loaded on startup, add your script to the <code>customJsToLoad</code> array in the <code>web-ui.json</code> file).</p>
</div>
<div class="paragraph">
<p>Here is an example of a custom screen registration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>const customScreenExample = {
    id: 'testId',
    name: 'testName',
    statesToExclude: [{processId: 'processId0', stateIds: ['stateId0', 'stateId1']}],
    headerFilters: ['PROCESS', 'TYPE_OF_STATE'],
    showAcknowledgmentButton: false,
    results: {
        columns: [
            {
                field: 'severity',
                cardField: 'severity',
                fieldType: 'SEVERITY',
            },
            {
                field: 'TIME',
                cardField: 'publishDate',
                fieldType: 'DATE_AND_TIME'
            },
            {
                fieldType: 'RESPONSE_FROM_MY_ENTITIES'
            },
            {
                fieldType: 'ACKNOWLEDGMENT'
            },
            {
                field: 'testField',
                headerName: 'TITLE',
                cardField: 'titleTranslated',
                fieldType: 'STRING',
                flex: 1
            },
            {
                field: 'testField2',
                headerName: 'SUMMARY',
                cardField: 'summaryTranslated',
                fieldType: 'STRING',
                flex: 2,
                showTooltips: true
            },
            {
                fieldType: 'TYPE_OF_STATE',
                headerName: 'STATUS'
            },
            {
                field: 'publisher',
                headerName: 'EMITTER',
                cardField: 'publisher',
                fieldType: 'PUBLISHER'
            },
            {
                field: 'urgency',
                headerName: 'URGENCY',
                fieldType: 'COLORED_CIRCLE',
                getValue: (card) =&gt; {
                    if (card.severity === 'ALARM') return {color: 'red', numericalValue: 20};
                    return {color: 'green', numericalValue: 10};
                },
                flex: 0.5
            },
            {
                headerName: 'ANSWERS',
                fieldType: 'RESPONSES',
                minWidth: 150,
                flex: 2
            }
        ]
    }
}

opfab.businessconfig.registerCustomScreen(customScreenExample);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the custom screen is accessible via the URL <code>#/customscreen/testId</code>.</p>
</div>
<div class="paragraph">
<p>It is possible to exclude specific states from being display by adding them to the <code>statesToExclude</code> array. State ids are not unique and should be associated to their process id.</p>
</div>
<div class="paragraph">
<p>You can define the filters to be displayed in the header of the screen by adding them to the <code>headerFilters</code> array. The following filters are available: <code>PROCESS</code>, <code>TYPE_OF_STATE</code>, <code>READ_ACK</code>, <code>RESPONSE_FROM_MY_ENTITIES</code> and <code>RESPONSE_FROM_ALL_ENTITIES</code>.</p>
</div>
<div class="paragraph">
<p>For each field you want to display in the result table, define a column object. The following field types are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COLORED_CIRCLE</code>: Displays a colored circle. The value is to be defined with a custom method <code>getValue</code> that shall contain two fields:</p>
<div class="ulist">
<ul>
<li>
<p><code>color</code>: The color of the circle.</p>
</li>
<li>
<p><code>numericalValue</code>: The numerical value of the circle that will be used for sorting and filtering.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>DATE_AND_TIME</code>: Displays the date and time formatted according to the user&#8217;s locale.</p>
</li>
<li>
<p><code>INPUT</code>: Displays an input field. The value of the input field will be used for response cards if the custom screen has response buttons (see below).</p>
</li>
<li>
<p><code>PUBLISHER</code>: Displays the publisher entity if the card is published by an entity, otherwise displays the user who published the card.</p>
</li>
<li>
<p><code>RESPONSES</code>: Displays the list of entities that must respond, with the color indicating the severity of the response if the entity has responded. It uses the <code>entitiesRequiredToRespond</code> field of the card. If this field is empty, it will use the <code>entitiesAllowedToRespond</code> field of the card.</p>
</li>
<li>
<p><code>RESPONSE_FROM_MY_ENTITIES</code>: Displays a blue arrow if one of the user&#8217;s entity has responded to the card.</p>
</li>
<li>
<p><code>ACKNOWLEDGMENT</code>: Displays a blue check if the card has been acknowledged.</p>
</li>
<li>
<p><code>STATE_NAME</code>: Displays the name of the card&#8217;s state.</p>
</li>
<li>
<p><code>PROCESS_NAME</code>: Displays the name of the card&#8217;s process.</p>
</li>
<li>
<p><code>SEVERITY</code>: Displays the severity as a color rectangle.</p>
</li>
<li>
<p><code>STRING</code>: Displays a string value.</p>
</li>
<li>
<p><code>HTML</code>: Renders the HTML contained in the <code>getValue</code> method.</p>
</li>
<li>
<p><code>TYPE_OF_STATE</code>: Displays the name of the type of state (<code>INPROGRESS</code>, <code>FINISHED</code>, <code>CANCELLED</code>) with a corresponding color. The color is defined as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>INPROGRESS</code>: orange</p>
</li>
<li>
<p><code>FINISHED</code>:</p>
<div class="ulist">
<ul>
<li>
<p>orange if not all entities required to respond have responded</p>
</li>
<li>
<p>red if one or more entities responded with a severity of <code>ALARM</code></p>
</li>
<li>
<p>green otherwise</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>CANCELLED</code>: red</p>
</li>
<li>
<p>none: grey</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can define the column header text using the <code>headerName</code> field.</p>
</div>
<div class="paragraph">
<p><code>cardField</code> is the field of the card that will be displayed in the result. It is not used for the following field types: <code>COLORED_CIRCLE</code>, <code>SEVERITY</code>, <code>TYPE_OF_STATE</code>,<code>RESPONSES</code> and <code>RESPONSE_FROM_MY_ENTITIES</code>.</p>
</div>
<div class="paragraph">
<p>For <code>STRING</code> field type if the method <code>getValue</code> is defined, the value of the field will be the result of this method instead of the value of the cardField.</p>
</div>
<div class="paragraph">
<p>For <code>HTML</code> field type, the HTML tags need to be injected by the <code>getHTMLValue</code> method of the column. The value for sorting and filtering the column will be the content of the field <code>cardField</code> or the result of the <code>getValue</code> method if defined. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>{
    field: 'testField',
    headerName: 'TITLE',
    cardField: 'titleTranslated',
    fieldType: 'HTML',
    getHTMLValue: (card) =&gt; {
        return `&lt;span style=&quot;color:red&quot;&gt;${card.titleTranslated}&lt;/span&gt;`;
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_cell_size"><a class="anchor" href="#_cell_size"></a>15.3.1. Cell size</h4>
<div class="paragraph">
<p>To better control cell size, you can use the following fields in the column definition:
- <code>flex</code>: Specifies the CSS flex property for the cell.
- <code>minWidth</code>: Defines the minimum width of the column in pixels.
- <code>multiLinesInCell</code>: Allows the cell to display multiple lines of text if set to <code>true</code>. The default value is <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tooltips"><a class="anchor" href="#_tooltips"></a>15.3.2. Tooltips</h4>
<div class="paragraph">
<p>Sometimes columns are not wide enough to display all the content. In this case, you can enable tooltips for the column by setting the <code>showTooltips</code> field to <code>true</code> in the column definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment"><a class="anchor" href="#_acknowledgment"></a>15.3.3. Acknowledgment</h4>
<div class="paragraph">
<p>It is possible to define a custom screen with an acknowledgment button allowing the user to acknowledge multiple cards at once. This is possible by setting the <code>showAcknowledgmentButton</code> field to <code>true</code> in the custom screen object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_response_buttons"><a class="anchor" href="#_response_buttons"></a>15.3.4. Response buttons</h4>
<div class="paragraph">
<p>It is possible to define custom response buttons for the custom screen allowing the user to send multiple responses at once.</p>
</div>
<div class="paragraph">
<p>To do this, add a <code>responseButtons</code> array to the custom screen object. Each button object must contain the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: The button identifier.</p>
</li>
<li>
<p><code>label</code>: The button label.</p>
</li>
<li>
<p><code>getUserResponses</code>: a function that retrieves data for response cards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The getUserResponses function takes two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an array of cards</p>
</li>
<li>
<p>a map of responseInput indexed by card id. The responseInput is an object containing the response input fields and their values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The method shall return an object containing the following fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>valid</code>: A boolean indicating if the action is valid.</p>
</li>
<li>
<p><code>errorMsg</code>: An error message to display if the action is not valid.</p>
</li>
<li>
<p><code>responseCards</code>: An array of response cards to send, each containing a <code>data</code> field containing a response card data .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of a custom screen configuration with response buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>const customScreenExample = {
        id: 'testId2',
        name: 'testName',
        responseOnlyAllowedForEntitiesRequiredToRespond: false,

        .....

        responseButtons: [
            {
                id: 'button1',
                label: 'ACCEPT PROPOSALS',
                getUserResponses: (cards, userInputs) =&gt; {
                    const responseCards = [];

                    cards.forEach((card) =&gt; {

                        const userInput = responsesData.get(card.id);
                        const comment = userInput?.comment ?? '';
                        const responseData = { "choice1": "on", "choice2": "on", "choice3": "on", "comment": comment }
                        responseCards.push({ data: responseData });
                    });
                    return { valid: true, errorMsg: '', responseCards: responseCards };
                }
            },
            {
                id: 'button2',
                label: 'REFUSE PROPOSALS',
                getUserResponses: (cards, userInputs) =&gt; {
                    const responseCards = [];
                    let hasAlwaysComment = true;
                    cards.forEach((card) =&gt; {
                        const userInput = responsesData.get(card.id);
                        const comment = userInput?.comment ?? '';
                        if (comment === '') {
                            hasAlwaysComment = false;
                        }
                        const responseData = { "comment": comment }
                        responseCards.push({ data: responseData });
                    });
                    if (!hasAlwaysComment) {
                        return { valid: false, errorMsg: 'Please fill in the comment field for all cards' };
                    }
                    return { valid: true, errorMsg: '', responseCards: responseCards };
                }
            }
        ]</pre>
</div>
</div>
<div class="paragraph">
<p>The input fields are to be defined in the columns definition with fieldType set to <code>INPUT</code> , for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    field: 'comment',
    headerName: 'Comment',
    fieldType: 'INPUT',
    flex: 1
}</pre>
</div>
</div>
<div class="paragraph">
<p>If you want the input to be restricted to a certain number of characters, you can set the <code>maxInputLength</code> field in the column definition.</p>
</div>
<div class="paragraph">
<p>It is possible instead of using an input field to use a select field by setting the fieldType to <code>SELECT</code> and defining the options in the column definition, for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{
    field: 'choice',
    headerName: 'Choice',
    fieldType: 'SELECT',
    possibleValues: [
        { value: 'on', label: 'Accept' },
        { value: 'off', label: 'Refuse' }
    ],
    flex: 1
}</pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to restrict the possibility to respond to entities that are defined as required (field <code>entitiesRequiredToRespond</code> in the card). To do this, you need to set <code>responseOnlyAllowedForEntitiesRequiredToRespond</code> to <code>true</code> in the custom screen definition.</p>
</div>
</div>
<div class="sect3">
<h4 id="_card_data_fields"><a class="anchor" href="#_card_data_fields"></a>15.3.5. Card data fields</h4>
<div class="paragraph">
<p>It is possible to define data fields you want to display in the custom screen. To do this, you have to define the data
fields in the configuration file shared by all the services (for example <code>/config/docker/common.yml</code>), the variable is
<code>operatorfabric.customscreen.dataFields</code> and it must be a list of string values, for example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>operatorfabric:
  customscreen:
    dataFields: ["keywords", "nested.field"]</pre>
</div>
</div>
<div class="paragraph">
<p>Then you have to add the fields in the <code>results.columns</code> field in the custom screen configuration file. For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                ...
                {
                    field: 'keywords',
                    headerName: 'keywords field',
                    cardField: 'data.keywords',
                    fieldType: 'STRING',
                    flex: 1
                },
                {
                    field: 'nestedField',
                    headerName: 'nested field',
                    cardField: 'data.nested.field',
                    fieldType: 'STRING',
                    flex: 1
                },
                ...</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be cautious when adding too many data fields in the configuration files. If there are numerous cards with many data fields (or fields containing large amounts of data) in the service configuration file, it may slow down the application due to the volume of data to be loaded. The fields are loaded even if the user does not navigate to the custom screen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_current_user_child_card_field"><a class="anchor" href="#_current_user_child_card_field"></a>15.3.6. Current user child card field</h4>
<div class="paragraph">
<p>It is possible to define a field in the custom screen that will display the field value of the child card of the current user if any.
To do this, you have to set the value <code>isFieldFromCurrentUserChildCard</code> to true in the column definition. For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                {
                    fieldType: 'INPUT',
                    field: 'comment',
                    cardField: 'data.comment',
                    isFieldFromCurrentUserChildCard: true,
                    headerName: 'COMMENT'
                }</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This feature is not yet taking into account the fact that the user may be member of several entities allowed to respond to the card. In this case the field will display the value of the first child card found.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supervisor"><a class="anchor" href="#_supervisor"></a>16. Supervisor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Supervisor service can monitor users connections and card acknowledgements to send alert cards when specified conditions are met. To configure the module see <a href="https://github.com/opfab/operatorfabric-core/blob/master/config/docker/node-services.yml">config/docker/node-services.yml</a></p>
</div>
<div class="sect2">
<h3 id="_entities_connection"><a class="anchor" href="#_entities_connection"></a>16.1. Entities connection</h3>
<div class="paragraph">
<p>It is possible to configure supervisor module for monitoring users connections to Opfab to ensure that there is at least one user connected to Opfab for each configured entity. When no user of an entity connects to Opfab for a specified period, supervisor module will send an alert card to the configured recipient entity.</p>
</div>
<div class="paragraph">
<p>The database stores a comprehensive list of supervised entities and their corresponding supervisors. The 'Supervised Entities' admin page offers functionalities to view, modify, add, or delete these entities. Within the supervisor service configuration section, there exists an option to define a default configuration for initial supervised entities. This default configuration applies only when the database&#8217;s supervised entities collection is empty. In such a scenario, the defined configuration will be saved into the database for subsequent use.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgement"><a class="anchor" href="#_card_acknowledgement"></a>16.2. Card acknowledgement</h3>
<div class="paragraph">
<p>It is possible to configure supervisor module to monitor card acknowledgements for specific processes/states. When a card of a configured process and state remains not acknowledged for a configured period, supervisor module will send an alert to the card publisher with the list of recipients that did not acknowledge the card.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_devices_service"><a class="anchor" href="#_external_devices_service"></a>17. External Devices Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The external devices service is an optional service allowing OperatorFabric to relay notifications to external
physical devices.</p>
</div>
<div class="sect2">
<h3 id="_specification"><a class="anchor" href="#_specification"></a>17.1. Specification</h3>
<div class="paragraph">
<p>The aim of this section is to describe the initial business need that led to the creation of this service and what use
cases are currently supported.</p>
</div>
<div class="paragraph">
<p>OperatorFabric users already have the option to be notified of a card&#8217;s arrival by a sound played by their browser.
There is a different sound for each severity, and they are configurable for a given instance. The users can decide to
opt out of sound notifications for certain severities.
We also added an option for the sounds to be repeated until the operator interacted with the application (i.e. clicked
anywhere on the page) so as to make them harder to miss.</p>
</div>
<div class="paragraph">
<p>This can be enough for some use cases, but it was not ideal for operators working in control rooms. Indeed, control
rooms each have an external sound system that is shared for the whole room, and existing applications currently
trigger sound alerts on these sound systems rather than on each operator&#8217;s computer.</p>
</div>
<div class="paragraph">
<p>This has several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The sound can be heard by all operators</p>
</li>
<li>
<p>It can be heard even if the operator is not at their desk</p>
</li>
<li>
<p>The sound system can warn that the connection with an application has been lost if it hasn&#8217;t received a "watchdog"
signal for a given period of time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, external devices support in OperatorFabric aims to allow sound notifications to be passed on to external
sound systems. The sound system on which the sound will be played can depend on the user receiving the notification.
For example, all operators working in control room A will have their sounds played on the control room&#8217;s central sound
system, while operators from control room B will use theirs.
Each user can have several external devices configured.</p>
</div>
<div class="paragraph">
<p>So far, only sound systems using the Modbus protocol are supported, but we would like to be able to support other
protocols (and ultimately allow people to supply their own drivers) in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation"><a class="anchor" href="#_implementation"></a>17.2. Implementation</h3>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a>17.2.1. Architecture</h4>
<div class="paragraph">
<p>Given the use case described above, a new service was necessary to act as a link between the OperatorFabric UI and
the external devices. This service is in charge of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing the configuration relative to external devices (see below for details)</p>
</li>
<li>
<p>Process requests from the UI (e.g. "play the sound for ALARM for user operator1_fr") and translate them as requests to
the appropriate device in their supported protocol, based on the above configuration</p>
</li>
<li>
<p>Allow the pool of devices to be managed (connection, disconnection)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This translates as three APIs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ExtDevArchitecture.drawio.png" alt="Architecture diagram">
</div>
</div>
<div class="paragraph">
<p>Here is what happens when user operator1_fr receives a card with severity ALARM:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Angular code, the reception of the card triggers a sound notification.</p>
</li>
<li>
<p>If the external devices feature is enabled and the user has chosen to play sounds on external devices
(instead of the browser), the UI code sends a POST request on the <code>external-devices/notifications</code> endpoint on the
NGINX gateway, with the following payload:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabSignalId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>The NGINX server, acting as a gateway, forwards it to the <code>/notifications</code> endpoint on the External Devices service.</p>
</li>
<li>
<p>The External Devices service queries the configuration repositories to find out which external devices are configured
for operator1_fr, how to connect to them and what signal "ALARM" translates to on these particular devices.</p>
</li>
<li>
<p>It then creates the appropriate connections if they don&#8217;t exist yet, and sends the signal.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>17.2.2. Configuration</h4>
<div class="paragraph">
<p>The following elements need to be configurable:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each user, which devices to use:</p>
<div class="listingblock">
<div class="title">userConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">userLogin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operator1_fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">externalDeviceIds</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</li>
<li>
<p>How to connect to a given external device (host, port)</p>
<div class="listingblock">
<div class="title">deviceConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "isEnabled" field is optional and allows the user to activate or deactivate an external device.
When a device is disabled (isEnabled = false) , OperatorFabric will not send any signal and watchdog to the device.</p>
</div>
<div class="paragraph">
<p>The default value of the "isEnabled" field is true.</p>
</div>
</li>
<li>
<p>How to map an OperatorFabric signal key <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> to a signal (sound, light) on the external system</p>
<div class="listingblock">
<div class="title">signalMapping</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This means that a single physical device allowing 2 different sets of sounds to be played (for example one set for desk
A and another set for desk B) would be represented as two different device configurations, with different ids.</p>
</div>
<div class="listingblock">
<div class="title">Device configurations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">isEnabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
}]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Signal mappings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>
  }
}]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The signalMapping object is built as a Map with String keys (rather than the Severity enum or any otherwise
constrained type) because there is a strong possibility that in the future we might want to map something other than
severities.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the <a href="https://opfab.github.io/documentation/current/api/external-devices/">API documentation</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a <code>Device</code> object distinct from <code>DeviceConfiguration</code> because the latter represents static information
about how to reach a device, while the former contains information about the actual connection.
For example, this is why the device configuration contains a <code>host</code> (which can be a hostname) while the device
has a <code>resolvedAddress</code>.
As a result, they are managed through separate endpoints, which might also make things easier if we need to secure
them differently.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>17.3. Configuration</h3>

</div>
<div class="sect2">
<h3 id="_connection_management"><a class="anchor" href="#_connection_management"></a>17.4. Connection Management</h3>
<div class="paragraph">
<p>OperatorFabric does automatically attempt to connect to enabled configured external devices at startup. If several external devices share the same host and port, only one connection will be open for the external devices and only one watchdog will be sent for the external devices.</p>
</div>
<div class="paragraph">
<p>If an external driver is disconnected, OperatorFabric will try to reconnect it every 10 seconds (default value).</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_management"><a class="anchor" href="#_configuration_management"></a>17.5. Configuration Management</h3>
<div class="paragraph">
<p>In coherence with the way Entities, Perimeters, Users and Groups are managed, SignalMapping, UserConfiguration and
DeviceConfiguration resources can be deleted even if other resources link to them.
For example, if a device configuration lists <code>someMapping</code> as its <code>signalMappingId</code> and a DELETE request is sent
on <code>someMapping</code>, the deletion will be performed and return a 200 Success, and the device will have a <code>null</code>
<code>signalMappingId</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_drivers"><a class="anchor" href="#_drivers"></a>17.6. Drivers</h3>
<div class="paragraph">
<p>This section contains information that is specific to each type of driver. Currently, the only supported driver uses
the <a href="https://en.wikipedia.org/wiki/Modbus">Modbus protocol</a>.</p>
</div>
<div class="sect3">
<h4 id="_modbus_driver"><a class="anchor" href="#_modbus_driver"></a>17.6.1. Modbus Driver</h4>
<div class="paragraph">
<p>The Modbus driver is based on the <a href="https://github.com/kochedykov/jlibmodbus">jlibmodbus</a> library to create a
<code>ModbusMaster</code> for each device and then send requests through it using the
<a href="https://github.com/kochedykov/jlibmodbus/blob/master/src/com/intelligt/modbus/jlibmodbus/msg/request/WriteSingleRegisterRequest.java">WriteSingleRegisterRequest</a>
object.</p>
</div>
<div class="paragraph">
<p>We are currently using the "BROADCAST" mode, which (at least in the jlibmodbus implementation) means that the Modbus
master doesn&#8217;t expect any response to its requests (which makes sense because if there really are several clients
responding to the broadcast, )
This is mitigated by the fact that if watchdog signals are enabled, the external devices will be able to detect that
they are not receiving signals correctly.
In the future, it could be interesting to switch to the TCP default so OperatorFabric can be informed of any exception
in the processing of the request, allowing for example to give a more meaningful connection status
(see <a href="https://github.com/opfab/operatorfabric-core/issues/2294">#2294</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_drivers"><a class="anchor" href="#_adding_new_drivers"></a>17.6.2. Adding new drivers</h4>
<div class="paragraph">
<p>New drivers should implement the <code>ExternalDeviceDriver</code> interface, and a corresponding factory implementing the
<code>ExternalDeviceDriverFactory</code> interface should be created with it.</p>
</div>
<div class="paragraph">
<p>The idea is that in the future, using dependency injection, Spring should be able to pick up any factory on the classpath implementing
the correct interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ExternalDeviceDriver</code>, <code>ExternalDeviceDriverFactory</code> and the accompanying custom exceptions should be made
available as a jar on Maven Central if we want to allow project users to provide their own drivers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If several drivers need to be used on a given OperatorFabric instance at the same time, we will need to introduce
a device type in the deviceConfiguration object.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_applications_integration"><a class="anchor" href="#_external_applications_integration"></a>18. External Applications Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The external web applications can take advantage of OperatorFabric shared stylesheet to style pages and specific components.
The available css classes are detailed in
<a href="/documentation/current/reference_doc/index.html#copfab_template_style">OperatorFabric css styles</a></p>
</div>
<div class="paragraph">
<p>To use the shared stylesheet the web application should link the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/shared/css/opfab-application.css</code> : css classes</p>
</li>
<li>
<p><code>/shared/css/opfab-application.js</code> : javascript objects to hande day/night themes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your can find an example of a web page using these resources in the OperatorFabric core repository (<a href="https://github.com/opfab/operatorfabric-core/blob//src/test/externalWebAppExample/index.html">src/test/externalWebAppExample/index.html</a>).</p>
</div>
<div class="paragraph">
<p>The example test page can be accessed from OperatorFabric directly at the following url  <code><a href="http://localhost:2002/external/appExample/" class="bare">localhost:2002/external/appExample/</a></code> and also using one of the example business menu entries.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. currently, that means a severity, but in the future it could also be a process id, or anything identifying the signal to be played
</div>
</div>
</body>
</html>