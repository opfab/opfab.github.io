<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>OperatorFabric Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OperatorFabric Reference Documentation</h1>
<div class="details">
<span id="revnumber">version 3.8.1.RELEASE,</span>
<span id="revdate">01 July 2022</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_sending_cards">2. Sending cards</a>
<ul class="sectlevel2">
<li><a href="#card_structure">2.1. Card Structure</a>
<ul class="sectlevel3">
<li><a href="#_technical_information_of_the_card">2.1.1. Technical Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_mandatory_information">2.1.1.1. Mandatory information</a></li>
<li><a href="#_optional_information">2.1.1.2. Optional information</a></li>
<li><a href="#_business_period">2.1.1.3. Business period</a></li>
<li><a href="#_store_information">2.1.1.4. Store information</a></li>
</ul>
</li>
<li><a href="#_user_destined_information_of_the_card">2.1.2. User destined Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_in_card_format">2.1.2.1. in Card Format</a></li>
<li><a href="#_custom_part">2.1.2.2. Custom part</a></li>
</ul>
</li>
<li><a href="#_presentation_information_of_the_card">2.1.3. Presentation Information of the card</a>
<ul class="sectlevel4">
<li><a href="#_timespans_timespans">2.1.3.1. TimeSpans (<code>timeSpans</code>)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cards_examples">2.2. Cards Examples</a>
<ul class="sectlevel3">
<li><a href="#minimal_card">2.2.1. Minimal Card</a>
<ul class="sectlevel4">
<li><a href="#reception_rules">2.2.1.1. Rules for receiving cards</a></li>
<li><a href="#_send_to_one_user">2.2.1.2. Send to One User</a></li>
<li><a href="#_send_to_several_users">2.2.1.3. Send to several users</a></li>
</ul>
</li>
<li><a href="#_regular_card">2.2.2. Regular Card</a>
<ul class="sectlevel4">
<li><a href="#_full_of_hidden_data">2.2.2.1. Full of Hidden data</a></li>
<li><a href="#_fully_useful">2.2.2.2. Fully useful</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_rendering">3. Card rendering</a>
<ul class="sectlevel2">
<li><a href="#_process_declaration_and_configuration">3.1. Process: Declaration and Configuration</a>
<ul class="sectlevel3">
<li><a href="#_bundle_as_process_declaration">3.1.1. Bundle as Process declaration</a></li>
<li><a href="#_the_config_json_file">3.1.2. The config.json file</a></li>
<li><a href="#_the_i18n_json_file">3.1.3. The i18n.json file</a>
<ul class="sectlevel4">
<li><a href="#_template_folder">3.1.3.1. Template folder</a></li>
<li><a href="#_processes_and_states">3.1.3.2. Processes and States</a></li>
<li><a href="#_upload">3.1.3.3. Upload</a></li>
</ul>
</li>
<li><a href="#_processes_groups">3.1.4. Processes groups</a></li>
</ul>
</li>
<li><a href="#template_description">3.2. Templates</a>
<ul class="sectlevel3">
<li><a href="#_operatorfabric_specific_handlebars_helpers">3.2.1. OperatorFabric specific handlebars helpers</a>
<ul class="sectlevel4">
<li><a href="#arrayContains">3.2.1.1. arrayContains</a></li>
<li><a href="#arrayContainsOneOf">3.2.1.2. arrayContainsOneOf</a></li>
<li><a href="#bool">3.2.1.3. bool</a></li>
<li><a href="#conditionalAttribute">3.2.1.4. conditionalAttribute</a></li>
<li><a href="#replace">3.2.1.5. replace</a></li>
<li><a href="#dateformat">3.2.1.6. dateFormat</a></li>
<li><a href="#i18n">3.2.1.7. i18n</a></li>
<li><a href="#json">3.2.1.8. json</a></li>
<li><a href="#_keepspacesandendofline">3.2.1.9. keepSpacesAndEndOfLine</a></li>
<li><a href="#keyValue">3.2.1.10. keyValue</a></li>
<li><a href="#math">3.2.1.11. math</a></li>
<li><a href="#mergeArrays">3.2.1.12. mergeArrays</a></li>
<li><a href="#now">3.2.1.13. now</a></li>
<li><a href="#numberformat">3.2.1.14. numberFormat</a></li>
<li><a href="#preservespace">3.2.1.15. preserveSpace</a></li>
<li><a href="#slice">3.2.1.16. slice</a></li>
<li><a href="#sort">3.2.1.17. sort</a></li>
<li><a href="#split">3.2.1.18. split</a></li>
<li><a href="#svg">3.2.1.19. svg</a></li>
<li><a href="#times">3.2.1.20. times</a></li>
<li><a href="#toBreakage">3.2.1.21. toBreakage</a></li>
<li><a href="#objectContainsKey">3.2.1.22. objectContainsKey</a></li>
</ul>
</li>
<li><a href="#_naming_convention">3.2.2. Naming convention</a></li>
<li><a href="#opfab_template_style">3.2.3. OperatorFabric css styles</a>
<ul class="sectlevel4">
<li><a href="#_opfab_input">3.2.3.1. opfab-input</a></li>
<li><a href="#_opfab_textarea">3.2.3.2. opfab-textarea</a></li>
<li><a href="#_opfab_select">3.2.3.3. opfab-select</a></li>
<li><a href="#_opfab_radio_button">3.2.3.4. opfab-radio-button</a></li>
<li><a href="#_opfab_checkbox">3.2.3.5. opfab-checkbox</a></li>
<li><a href="#_opfab_table">3.2.3.6. opfab-table</a></li>
<li><a href="#_opfab_border_box">3.2.3.7. opfab-border-box</a></li>
<li><a href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success">3.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</a></li>
</ul>
</li>
<li><a href="#_multi_select">3.2.4. Multi Select</a></li>
<li><a href="#_charts">3.2.5. Charts</a></li>
<li><a href="#_operatorfabric_specific_functions">3.2.6. OperatorFabric specific functions</a>
<ul class="sectlevel4">
<li><a href="#_set_screen_size">3.2.6.1. Set screen size</a></li>
<li><a href="#_get_display_context">3.2.6.2. Get display context</a></li>
<li><a href="#_redirect_to_business_application_from_a_card">3.2.6.3. Redirect to business application from a card</a></li>
<li><a href="#_get_list_of_all_entities">3.2.6.4. Get list of all entities</a></li>
<li><a href="#_get_information_about_an_entity">3.2.6.5. Get information about an entity</a></li>
<li><a href="#_method_ontemplaterenderingcomplete">3.2.6.6. Method onTemplateRenderingComplete()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_card_notification">4. Card notification</a>
<ul class="sectlevel2">
<li><a href="#_notification_configuration">4.1. Notification configuration</a></li>
<li><a href="#_sound_notification">4.2. Sound notification</a></li>
<li><a href="#_card_read">4.3. Card read</a></li>
<li><a href="#_card_acknowledgment">4.4. Card acknowledgment</a>
<ul class="sectlevel3">
<li><a href="#_acknowledgment_done_by_the_user">4.4.1. Acknowledgment done by the user</a></li>
<li><a href="#_acknowledgment_done_by_entityies">4.4.2. Acknowledgment done by entity(ies)</a></li>
</ul>
</li>
<li><a href="#_pin_cards">4.5. Pin cards</a></li>
<li><a href="#card_reminder">4.6. Card reminder</a>
<ul class="sectlevel3">
<li><a href="#_simple_reminder">4.6.1. Simple reminder</a></li>
<li><a href="#_recurrent_reminder">4.6.2. Recurrent reminder</a>
<ul class="sectlevel4">
<li><a href="#_recurrent_reminder_example">4.6.2.1. Recurrent reminder example</a></li>
</ul>
</li>
<li><a href="#_last_time_for_reminding">4.6.3. Last time for reminding</a></li>
<li><a href="#_debugging">4.6.4. Debugging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#response_cards">5. Response cards</a>
<ul class="sectlevel2">
<li><a href="#_steps_needed_to_use_a_response_card">5.1. Steps needed to use a response card</a>
<ul class="sectlevel3">
<li><a href="#define_a_third_party_tool">5.1.1. Define a third party tool</a></li>
<li><a href="#_configure_the_response_in_config_json">5.1.2. Configure the response in config.json</a></li>
<li><a href="#_design_the_question_form_in_the_template">5.1.3. Design the question form in the template</a></li>
<li><a href="#_define_permissions">5.1.4. Define permissions</a></li>
</ul>
</li>
<li><a href="#_send_a_question_card">5.2. Send a question card</a></li>
<li><a href="#_integrate_child_cards">5.3. Integrate child cards</a>
<ul class="sectlevel3">
<li><a href="#_entity_name">5.3.1. Entity name</a></li>
<li><a href="#_example">5.3.2. Example</a></li>
</ul>
</li>
<li><a href="#_lock_mechanism">5.4. Lock mechanism</a></li>
<li><a href="#_response_enabled">5.5. Response enabled</a></li>
<li><a href="#_response_required">5.6. Response required</a></li>
<li><a href="#_last_time_to_decide_lttd_2">5.7. Last Time to Decide (<code>lttd</code>)</a></li>
<li><a href="#_entities_allowed_to_respond">5.8. Entities allowed to respond</a></li>
<li><a href="#_entity_used_for_user_to_respond">5.9. Entity used for user to respond</a></li>
</ul>
</li>
<li><a href="#user_cards">6. User cards</a>
<ul class="sectlevel2">
<li><a href="#_configure_the_bundle">6.1. Configure the bundle</a></li>
<li><a href="#_method_getspecificcardinformation">6.2. Method getSpecificCardInformation</a></li>
<li><a href="#_define_permissions_2">6.3. Define permissions</a></li>
<li><a href="#restrict_possible_recipients">6.4. Restrict the list of possible recipients</a></li>
<li><a href="#preselect_initial_recipients">6.5. Configure the list of initially selected recipients</a></li>
<li><a href="#set_recipients_via_code">6.6. Set the list of recipients via the template and not via user choice</a></li>
<li><a href="#_setting_card_dates">6.7. Setting card dates</a></li>
<li><a href="#_setting_initial_card_severity">6.8. Setting initial card severity</a></li>
<li><a href="#_card_editing">6.9. Card editing</a></li>
<li><a href="#_get_edition_mode">6.10. Get edition mode</a></li>
<li><a href="#_get_current_process_and_current_state_of_the_card">6.11. Get current process and current state of the card</a></li>
<li><a href="#_receiving_emitter_entity_of_the_card">6.12. Receiving emitter entity of the card</a></li>
<li><a href="#_send_response_automatically_experimental_feature">6.13. Send response automatically (experimental feature)</a></li>
<li><a href="#_misc">6.14. Misc</a></li>
</ul>
</li>
<li><a href="#_archived_cards">7. Archived Cards</a>
<ul class="sectlevel2">
<li><a href="#_key_concepts">7.1. Key concepts</a></li>
<li><a href="#_archives_screen_in_the_ui">7.2. Archives screen in the UI</a></li>
</ul>
</li>
<li><a href="#_monitoring">8. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#_export_configuration">8.1. Export configuration</a></li>
</ul>
</li>
<li><a href="#users_management">9. User management</a>
<ul class="sectlevel2">
<li><a href="#_users_groups_entities_and_perimeters">9.1. Users, groups, entities and perimeters</a>
<ul class="sectlevel3">
<li><a href="#_users">9.1.1. Users</a>
<ul class="sectlevel4">
<li><a href="#_automated_user_creation">9.1.1.1. Automated user creation</a></li>
</ul>
</li>
<li><a href="#_entities">9.1.2. Entities</a></li>
<li><a href="#_groups">9.1.3. Groups</a></li>
<li><a href="#_perimeters">9.1.4. Perimeters</a></li>
<li><a href="#_alternative_way_to_manage_groups_and_entities">9.1.5. Alternative way to manage groups and entities</a></li>
</ul>
</li>
<li><a href="#_currently_connected_users">9.2. Currently connected users</a></li>
<li><a href="#_real_time_users">9.3. Real time users</a></li>
</ul>
</li>
<li><a href="#_ui_customization">10. UI Customization</a>
<ul class="sectlevel2">
<li><a href="#_ui_configuration">10.1. UI configuration</a></li>
<li><a href="#menu_entries">10.2. Menu Entries</a>
<ul class="sectlevel3">
<li><a href="#core_menu_config">10.2.1. Core menus</a></li>
<li><a href="#_custom_business_menus">10.2.2. Custom business menus</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_external_devices_service">11. External Devices Service</a>
<ul class="sectlevel2">
<li><a href="#_specification">11.1. Specification</a></li>
<li><a href="#_implementation">11.2. Implementation</a>
<ul class="sectlevel3">
<li><a href="#_architecture">11.2.1. Architecture</a></li>
<li><a href="#_configuration_2">11.2.2. Configuration</a></li>
</ul>
</li>
<li><a href="#_configuration_3">11.3. Configuration</a></li>
<li><a href="#_connexion_management">11.4. Connexion Management</a></li>
<li><a href="#_configuration_management">11.5. Configuration Management</a></li>
<li><a href="#_drivers">11.6. Drivers</a>
<ul class="sectlevel3">
<li><a href="#_modbus_driver">11.6.1. Modbus Driver</a></li>
<li><a href="#_adding_new_drivers">11.6.2. Adding new drivers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The aim of this document is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Explain what OperatorFabric is about and define the concepts it relies on</p>
</li>
<li>
<p>Give a basic tour of its features from a user perspective</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To perform their duties, an operator has to interact with multiple applications
(perform actions, watch for alerts, etc.), which can prove difficult if
there are too many of them.</p>
</div>
<div class="paragraph">
<p>The idea is to aggregate all the notifications from all these applications
into a single screen, and to allow the operator to act on them if needed.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/feed_screenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>These notifications are materialized by <strong>cards</strong> sorted in a <strong>feed</strong> according
to their period of relevance and their severity.
When a card is selected in the feed, the right-hand pane displays the <strong>details</strong>
of the card.</p>
</div>
<div class="paragraph">
<p>In addition, the cards will also translate as events displayed on a <strong>timeline</strong>
 at the top of the screen.</p>
</div>
<div class="paragraph">
<p>Part of the value of OperatorFabric is that it makes the integration very
simple on the part of the third-party applications.
To start publishing cards to users in an OperatorFabric instance, all they
have to do is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register as a publisher through the "Businessconfig" service and provide a "bundle"
containing handlebars templates defining how cards should be rendered,
i18n info etc.</p>
</li>
<li>
<p>Publish cards as json containing card data through the card publication API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OperatorFabric will then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dispatch the cards to the appropriate users (by computing the actual users
who should receive the card from the recipients rules defined in the card)</p>
</li>
<li>
<p>Take care of the rendering of the cards</p>
</li>
<li>
<p>Display relevant information from the cards in the timeline</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A card is not only information, it could be question(s) the operator has to answer.
When the operator is responding, a  card is emitted to the sender of the initial card
and the response could be seen by other operators.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot.png" alt="Feed screen layout">
</div>
</div>
<div class="paragraph">
<p>It is also possible for users to directly send card to other users using predefined card templates.</p>
</div>
<div class="paragraph">
<p>OperatorFabric user interface is running on a browser (recent version of chrome, firefox and edge are supported). The minimum screen resolution is 1680x1050.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sending_cards"><a class="anchor" href="#_sending_cards"></a>2. Sending cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cards Publication Service exposes a REST API through which third-party applications, or "publishers" can post cards
to OperatorFabric. It then handles those cards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Time-stamping them with a "publishDate"</p>
</li>
<li>
<p>Sending them to the message broker (RabbitMQ) to be delivered in real time to the appropriate operators</p>
</li>
<li>
<p>Persisting them to the database (MongoDB) for later consultation</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="card_structure"><a class="anchor" href="#card_structure"></a>2.1. Card Structure</h3>
<div class="paragraph">
<p>Cards are represented as <code>Json</code>Â objects. The technical design of cards is described in
<a href="/documentation/current/api/cards/">the cards api documentation</a>
. A card correspond to the state of a Process in OperatorFabric.</p>
</div>
<div class="sect3">
<h4 id="_technical_information_of_the_card"><a class="anchor" href="#_technical_information_of_the_card"></a>2.1.1. Technical Information of the card</h4>
<div class="paragraph">
<p>Those attributes are used by OperatorFabric to manage how cards are stored, to whom and when they&#8217;re sent.</p>
</div>
<div class="sect4">
<h5 id="_mandatory_information"><a class="anchor" href="#_mandatory_information"></a>2.1.1.1. Mandatory information</h5>
<div class="paragraph">
<p>Below, the <code>json</code> technical key is in the '()' following the title.</p>
</div>
<div class="sect5">
<h6 id="_publisher_publisher"><a class="anchor" href="#_publisher_publisher"></a>Publisher (<code>publisher</code>)</h6>
<div class="paragraph">
<p>The publisher field bears the identifier of the emitter of the card, be it an entity or an external service.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process"><a class="anchor" href="#card_process"></a>Process (<code>process</code>)</h6>
<div class="paragraph">
<p>This field indicates which process the card is attached to. This information is used to resolve the presentation
resources (bundle) used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_process_version"><a class="anchor" href="#card_process_version"></a>Process Version (<code>processVersion</code>)</h6>
<div class="paragraph">
<p>The rendering of cards of a given process can evolve over time. To allow for this while making sure previous cards
remain correctly handled, OperatorFabric can manage several versions of the same process.
The <code>processVersion</code> field indicate which version of the process should be used to retrieve the presentation resources
(i18n, templates, etc.) to render this card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_process_instance_identifier_processinstanceid"><a class="anchor" href="#_process_instance_identifier_processinstanceid"></a>Process Instance Identifier (<code>processInstanceId</code>)</h6>
<div class="paragraph">
<p>A card is associated to a given process, which defines how it is rendered, but it is also more precisely associated to
a <strong>specific instance</strong> of this process. The <code>processInstanceId</code> field contains the unique identifier of the process instance.</p>
</div>
</div>
<div class="sect5">
<h6 id="_state_in_the_process_state"><a class="anchor" href="#_state_in_the_process_state"></a>State in the process (<code>state</code>)</h6>
<div class="paragraph">
<p>The card represents a specific state in the process. In addition to the process, this information is used to resolve the presentation
resources used to render the card and card details.</p>
</div>
</div>
<div class="sect5">
<h6 id="start_date"><a class="anchor" href="#start_date"></a>Start Date (<code>startDate</code>)</h6>
<div class="paragraph">
<p>Start date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_severity_severity"><a class="anchor" href="#_severity_severity"></a>Severity (<code>severity</code>)</h6>
<div class="paragraph">
<p>The severity is a core principe of the OperatorFabric Card system. There are 4 severities available.
A color is associated in the GUI to each severity. Here the details about severity and their meaning for OperatorFabric:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ALARM: represents a critical state of the associated process, need an action from the operator. In the UI, the card is red;</p>
</li>
<li>
<p>ACTION: the associated process need an action form operators in order to evolve correctly. In the UI, the card is orange;</p>
</li>
<li>
<p>COMPLIANT: the process related to the card is in a compliant status. In the UI, the card is green.;</p>
</li>
<li>
<p>INFORMATION: give information to the operator. In the UI, the card is blue.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="card_title"><a class="anchor" href="#card_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>This attribute is display as header of a card in the feed of the GUI. It&#8217;s the main User destined Information of a card. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
<div class="sect5">
<h6 id="card_summary"><a class="anchor" href="#card_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>This attribute is display as a description of a card in the feed of the GUI, when the card is selected by the operator. It&#8217;s completing the information of the card title. The value refer to an <code>i18n</code> value used to localize this information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_information"><a class="anchor" href="#_optional_information"></a>2.1.1.2. Optional information</h5>
<div class="sect5">
<h6 id="end_date"><a class="anchor" href="#end_date"></a>End Date (<code>endDate</code>)</h6>
<div class="paragraph">
<p>End date of the active period of the card (process business time).</p>
</div>
</div>
<div class="sect5">
<h6 id="_tags_tag"><a class="anchor" href="#_tags_tag"></a>Tags (<code>tag</code>)</h6>
<div class="paragraph">
<p>Tags are intended as an additional way to filter cards in the feed of the GUI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Grouping cards is an experimental feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tags can also be used to group cards together in the card feed. When <code>feed.enableGroupedCards</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file, cards that have the same tags are grouped together. In the feed window, only the top card will be visible and can be clicked to show  cards with the same tags.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/grouped-cards.png" alt="Closed grouped cards"></span>
<span class="image"><img src="../images/grouped-cards2.png" alt="Open grouped cards"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_entityrecipients_entityrecipients"><a class="anchor" href="#_entityrecipients_entityrecipients"></a>EntityRecipients (<code>entityRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to entity : all users members of the listed entities who have the right for the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_grouprecipients_grouprecipients"><a class="anchor" href="#_grouprecipients_grouprecipients"></a>GroupRecipients (<code>groupRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards to groups : all users members of the groups will receive it. If this field is used in conjunction with entityRecipients, to receive the cards :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND one of the groups to receive the cards.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="ulist">
<ul>
<li>
<p>users must be members of one of the entities AND have the right for the process/state of the card.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_userrecipients_userrecipients"><a class="anchor" href="#_userrecipients_userrecipients"></a>UserRecipients (<code>userRecipients</code>)</h6>
<div class="paragraph">
<p>Used to send cards directly to users without using groups or entities for card routing.</p>
</div>
</div>
<div class="sect5">
<h6 id="_last_time_to_decide_lttd"><a class="anchor" href="#_last_time_to_decide_lttd"></a>Last Time to Decide (<code>lttd</code>)</h6>
<div class="paragraph">
<p>Fixes the moment until when a <code>response</code> is possible for the card. After this moment, the response button won&#8217;t be useable. When lttd time is approaching, a clock is visible on the card in the feed with the residual time.  The lttd time can be set for cards that don&#8217;t expect any response</p>
</div>
</div>
<div class="sect5">
<h6 id="_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"><a class="anchor" href="#_secondsbeforetimespanforreminder_secondsbeforetimespanforreminder"></a>SecondsBeforeTimeSpanForReminder (<code>secondsBeforeTimeSpanForReminder</code>)</h6>
<div class="paragraph">
<p>Fixes the time for remind before the event define by the card see
<a href="/documentation/current/reference_doc/index.html#card_reminder">Card reminder</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_tonotify_tonotify"><a class="anchor" href="#_tonotify_tonotify"></a>ToNotify (<code>toNotify</code>)</h6>
<div class="paragraph">
<p>Boolean attribute. If the card must not be displayed in the feed and in monitoring screen, this field must be set to false.
In that case, it means the card is stored only in archivedCards collection and not in cards collection.</p>
</div>
</div>
<div class="sect5">
<h6 id="_publisher_type_publishertype"><a class="anchor" href="#_publisher_type_publishertype"></a>Publisher type (<code>publisherType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The sender is an external service</p>
</li>
<li>
<p>ENTITY - The sender of the card is the user on behalf of the entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_representative_representative"><a class="anchor" href="#_representative_representative"></a>Representative (<code>representative</code>)</h6>
<div class="paragraph">
<p>Used in case of sending card as a representative of an entity or a publisher (unique ID of the entity or publisher)</p>
</div>
</div>
<div class="sect5">
<h6 id="_representative_type_representativetype"><a class="anchor" href="#_representative_type_representativetype"></a>Representative Type (<code>representativeType</code>)</h6>
<div class="ulist">
<ul>
<li>
<p>EXTERNAL - The representative is an external service</p>
</li>
<li>
<p>ENTITY - The representative is an entity</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_geographical_information_wktgeometry_and_wktprojection"><a class="anchor" href="#_geographical_information_wktgeometry_and_wktprojection"></a>Geographical information (<code>wktGeometry</code> and <code>wktProjection</code>)</h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Geographical information  is an experimental feature
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can add geographical location in  <code>wktGeometry</code> and the projection in <code>wktProjection</code>  fields.</p>
</div>
<div class="paragraph">
<p>When <code>feed.enableGeoMapFeature</code> is enabled in the <code>web&#8288;-ui.json</code> configuration file and the card is visible in the line feed, a geographical map will be drawn with a circle at the point as specified by the wkt settings. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&quot;wktGeometry&quot;: &quot;POINT (5.8946407 51.9848624)&quot;,
&quot;wktProjection&quot;: &quot;EPSG:4326&quot;,</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specifications of the Well-known Text Representation of coordinate reference systems
can be found at <a href="https://www.ogc.org/standards/wkt-crs">WKT Specification</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the POINT is supported at the moment. POLYGON and other figures are to be included later.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_business_period"><a class="anchor" href="#_business_period"></a>2.1.1.3. Business period</h5>
<div class="paragraph">
<p>We define the business period as starting form startDate to endDate.  The card will be visible on the UI if the business period overlap the user chosen period (i.e the period selected on  the timeline). If endDate is not set, the card will be visible as soon as the startDate is between start and end date of the chosen period.</p>
</div>
</div>
<div class="sect4">
<h5 id="_store_information"><a class="anchor" href="#_store_information"></a>2.1.1.4. Store information</h5>
<div class="sect5">
<h6 id="_uid_uid"><a class="anchor" href="#_uid_uid"></a>uid (<code>uid</code>)</h6>
<div class="paragraph">
<p>Unique identifier of the card in the OperatorFabric system. This attribute can be sent with card, but by default it&#8217;s managed by OperatorFabric.</p>
</div>
</div>
<div class="sect5">
<h6 id="_id_id"><a class="anchor" href="#_id_id"></a>id (<code>id</code>)</h6>
<div class="paragraph">
<p>State id of the associated process, determined by <code>OperatorFabric</code> can be set arbitrarily by the <code>publisher</code>. The id is determined by 'OperatorFabric' as follow : process.processIntanceId</p>
</div>
</div>
<div class="sect5">
<h6 id="_publish_date_publishdate"><a class="anchor" href="#_publish_date_publishdate"></a>Publish Date (<code>publishDate</code>)</h6>
<div class="paragraph">
<p>Indicates when the card has been registered in <code>OperatorFabric</code> system. This is a technical information exclusively managed by <code>OperatorFabric</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_user_destined_information_of_the_card"><a class="anchor" href="#_user_destined_information_of_the_card"></a>2.1.2. User destined Information of the card</h4>
<div class="paragraph">
<p>There are two kind of User destined information in a card. Some are restricted to the card format, others are defined by the publisher as long as there are encoded in <code>json</code>Â format.</p>
</div>
<div class="sect4">
<h5 id="_in_card_format"><a class="anchor" href="#_in_card_format"></a>2.1.2.1. in Card Format</h5>
<div class="sect5">
<h6 id="_title_title"><a class="anchor" href="#_title_title"></a>Title (<code>title</code>)</h6>
<div class="paragraph">
<p>See
<a href="/documentation/current/reference_doc/index.html#card_title">Title</a>
.</p>
</div>
</div>
<div class="sect5">
<h6 id="_summary_summary"><a class="anchor" href="#_summary_summary"></a>Summary (<code>summary</code>)</h6>
<div class="paragraph">
<p>See
<a href="/documentation/current/reference_doc/index.html#card_summary">Summary</a>
.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_part"><a class="anchor" href="#_custom_part"></a>2.1.2.2. Custom part</h5>
<div class="sect5">
<h6 id="_data_data"><a class="anchor" href="#_data_data"></a>Data (<code>data</code>)</h6>
<div class="paragraph">
<p>Determines where custom information is store. The content in this attribute, is purely <code>publisher</code> choice.
This content, as long as it&#8217;s in <code>json</code> format can be used to display details. For the way the details are
displayed, see below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must not use dot in json field names. In this case, the card will be refused with following message :
"Error, unable to handle pushed Cards: Map key xxx.xxx contains dots but no replacement was configured!""
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_presentation_information_of_the_card"><a class="anchor" href="#_presentation_information_of_the_card"></a>2.1.3. Presentation Information of the card</h4>
<div class="sect4">
<h5 id="_timespans_timespans"><a class="anchor" href="#_timespans_timespans"></a>2.1.3.1. TimeSpans (<code>timeSpans</code>)</h5>
<div class="paragraph">
<p>When the simple startDate and endDate are not enough to characterize your
process business times, you can add a list of TimeSpan to your card. TimeSpans
are rendered in the timeline component as cluster bubbles. This has no effect on the feed
content.</p>
</div>
<div class="paragraph">
<p><strong>example :</strong></p>
</div>
<div class="paragraph">
<p>to display the card two times in the timeline you can add two TimeSpan to your
card:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"Dispatcher",
	"publisherVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	...
	"timeSpans" : [
        {"start" : 1546297200000},
        {"start" : 1546297500000}
    ]

}</pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, the card will be displayed twice in the time line. The card
start date will be ignored.</p>
</div>
<div class="paragraph">
<p>For timeSpans, you can specify an end date but it is not implemented in OperatorFabric (it was intended for future uses but it will be deprecated).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cards_examples"><a class="anchor" href="#_cards_examples"></a>2.2. Cards Examples</h3>
<div class="paragraph">
<p>Before detailing the content of cards, let&#8217;s show you what cards look like through few examples of json.</p>
</div>
<div class="sect3">
<h4 id="minimal_card"><a class="anchor" href="#minimal_card"></a>2.2.1. Minimal Card</h4>
<div class="paragraph">
<p>The OperatorFabric Card specification defines mandatory attributes, but some optional attributes are needed for cards to be useful in OperatorFabric. Let&#8217;s clarify those point through few examples of minimal cards and what happens when they&#8217;re used as if.</p>
</div>
<div class="sect4">
<h5 id="reception_rules"><a class="anchor" href="#reception_rules"></a>2.2.1.1. Rules for receiving cards</h5>
<div class="paragraph">
<p>Whatever the recipient(s) of the card (user directly, group and/or entity), the user must have the receive right on the process/state of the card to receive it (<code>Receive</code> or <code>ReceiveAndWrite</code>).
So the rules for receiving cards are :</p>
</div>
<div class="paragraph">
<p>1) If the card is sent to user1, the card is received and visible for user1 if he has the receive right for the corresponding process/state</p>
</div>
<div class="paragraph">
<p>2) If the card is sent to GROUP1 (or ENTITY1_FR), the card is received and visible for user if <strong>all</strong> of the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of GROUP1 (or ENTITY1_FR)</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>3) If the card is sent to ENTITY1_FR and GROUP1, the card is received and visible for user if <strong>all</strong> of the following is true :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>he&#8217;s a member of ENTITY1_FR (either directly or through one of its children entities)</p>
</li>
<li>
<p>he&#8217;s a member of GROUP1</p>
</li>
<li>
<p>he has the receive right for the corresponding process/state</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this chapter, when we talk about receive right, it means <code>Receive</code> or <code>ReceiveAndWrite</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_one_user"><a class="anchor" href="#_send_to_one_user"></a>2.2.1.2. Send to One User</h5>
<div class="paragraph">
<p>The following card contains only the mandatory attributes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"]

}</pre>
</div>
</div>
<div class="paragraph">
<p>This an information about the process instance <code>process-000</code> of process <code>process</code>, sent by <code>TEST_PUBLISHER</code>. The title and the summary refer to <code>i18n</code> keys
defined in the associated <code>i18n</code> file of the process. This card is displayable since the first january 2019 and
should only be received by the user using the <code>operator1_fr</code> login (provided that this user has receive right on this process/state).</p>
</div>
</div>
<div class="sect4">
<h5 id="_send_to_several_users"><a class="anchor" href="#_send_to_several_users"></a>2.2.1.3. Send to several users</h5>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group"><a class="anchor" href="#_simple_case_sending_to_a_group"></a>Simple case (sending to a group)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is a group, the <code>Dispatcher</code>. So all users who are members of this group and who have receive right on the process/state of the card will receive it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_an_entity"><a class="anchor" href="#_simple_case_sending_to_an_entity"></a>Simple case (sending to an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipient is an entity, <code>ENTITY1_FR</code>, and there is no group recipient anymore. So all users who are members of this entity and who have a receive right for the process/state of the card will receive it. More information on perimeters can be found in
<a href="/documentation/current/reference_doc/index.html#users_management">user documentation</a></p>
</div>
<div class="paragraph">
<p>Example :
Given this perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id" : "perimeter1",
    "process" : "process",
    "stateRights" : [
        {
            "state" : "myState",
            "right" : "Receive"
        },
        {
            "state" : "myState2",
            "right" : "Write"
        }
    ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Given this group :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Perimeters can only be linked to groups, so let&#8217;s link the perimeter <code>perimeter1</code> to the group <code>group1</code>. You can do this with this command line for example ($token is your access token) :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -X PUT http://localhost:2103/perimeters/perimeter1/groups -H "Content-type:application/json" -H "Authorization:Bearer $token" --data "[\"group1\"]"</pre>
</div>
</div>
<div class="paragraph">
<p>Then you can see <code>group1</code> is now :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    "id": "group1",
    "name": "group number 1",
    "description": "group number 1 for documentation example",
    "perimeters": ["perimeter1"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the connected user is a member of <code>group1</code>, then he has a <code>Receive</code> right on process/state <code>process/myState</code>. So if the user is also a member of <code>ENTITY1_FR</code> then he will receive the card.</p>
</div>
</div>
<div class="sect5">
<h6 id="_simple_case_sending_to_a_group_and_an_entity"><a class="anchor" href="#_simple_case_sending_to_a_group_and_an_entity"></a>Simple case (sending to a group and an entity)</h6>
<div class="paragraph">
<p>The following example is nearly the same as the previous one except for the recipient.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"groupRecipients": ["Dispatcher"],
	"entityRecipients" : ["ENTITY1_FR"]
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the recipients are a group and an entity, the <code>Dispatcher</code> group and <code>ENTITY1_FR</code> entity. To receive the card, the user must be a member of both ENTITY1_FR and GROUP1 and must have the receive right for the corresponding process/state.</p>
</div>
</div>
<div class="sect5">
<h6 id="_complex_case"><a class="anchor" href="#_complex_case"></a>Complex case</h6>
<div class="paragraph">
<p>If this card need to be viewed by a user who is not in the <code>Dispatcher</code> group, it&#8217;s possible to tune more precisely the
definition of the recipient. If the <code>operator2_fr</code> needs to see also this card, the recipient definition could be(the following code details only the recipient part):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher"],
"userRecipients": ["operator2_fr"]</pre>
</div>
</div>
<div class="paragraph">
<p>So here, all the users of the <code>Dispatcher</code> group will receive the <code>INFORMATION</code> as should the <code>tos2-operator</code> user.</p>
</div>
<div class="paragraph">
<p>Another example, if a card is destined to the operators of <code>Dispatcher</code> and <code>Planner</code> and needs to be also seen by the <code>admin</code>, the recipient configuration looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"groupRecipients": ["Dispatcher", "Planner"],
"userRecipients": ["admin"]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_card"><a class="anchor" href="#_regular_card"></a>2.2.2. Regular Card</h4>
<div class="paragraph">
<p>The previous cards were nearly empty regarding information carrying. In fact, cards are intended to contain more information than a title and a summary. The optional attribute <code>data</code> is here for that. This attribute is destined to contain any <code>json</code> object. The creator of the card is free to put any information needed as long as it&#8217;s in a <code>json</code> format.</p>
</div>
<div class="sect4">
<h5 id="_full_of_hidden_data"><a class="anchor" href="#_full_of_hidden_data"></a>2.2.2.1. Full of Hidden data</h5>
<div class="paragraph">
<p>For this example we will use our previous example for the <code>Dispatcher</code> group with a <code>data</code> attribute containing the definition of a <code>json</code> object containing two attributes: <code>stringExample</code> and <code>numberExample</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"0.1",
	"process":"process",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"card.title.key"},
	"summary":{"key":"card.summary.key"},
	"userRecipients": ["operator1_fr"],
	"data":{
		"stringExample":"This is a not so random string of characters.",
		"numberExample":123
		}

}</pre>
</div>
</div>
<div class="paragraph">
<p>This card contains some data but when selected in the feed nothing more than the previous example of card happen because
there is no rendering configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fully_useful"><a class="anchor" href="#_fully_useful"></a>2.2.2.2. Fully useful</h5>
<div class="paragraph">
<p>When a card is selected in the feed (of the GUI), the data is displayed in the detail panel.
The way details are formatted depends on the template contained in the bundle associated with the process as
<a href="/documentation/current/reference_doc/index.html#template_description">described here</a>
. To have an effective example without to many actions to performed, the following example will use an already existing
configuration.The one presents in the development version of OperatorFabric, for test purpose(<code>TEST</code> bundle).</p>
</div>
<div class="paragraph">
<p>At the card level, the attributes in the card telling OperatorFabric which template to use are the <code>process</code> and <code>state</code> attributes, the <code>templateName</code> can be retrieved from the definition of the bundle.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
	"publisher":"TEST_PUBLISHER",
	"processVersion":"1",
	"process":"TEST",
	"processInstanceId":"process-000",
	"state":"myState",
	"startDate":1546297200000,
	"severity":"INFORMATION",
	"title":{"key":"process.title"},
	"summary":{"key":"process.summary"},
	"userRecipients": ["operator1_fr"],
	"data":{"rootProp":"Data displayed in the detail panel"},

}</pre>
</div>
</div>
<div class="paragraph">
<p>So here a single custom data is defined and it&#8217;s <code>rootProp</code>. This attribute is used by the template called by the <code>templateName</code> attribute.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_rendering"><a class="anchor" href="#_card_rendering"></a>3. Card rendering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As stated above, third applications interact with OperatorFabric by sending cards.</p>
</div>
<div class="paragraph">
<p>The Businessconfig service allows them to tell OperatorFabric for each process how these cards should be rendered including translation if
several languages are supported.  Configuration is done via files zipped in a "bundle", these files are send to OperatorFabric via a REST end point.</p>
</div>
<div class="paragraph">
<p>In addition, it lets third-party applications define additional menu entries for the navbar (for example linking back
to the third-party application) that can be integrated either as iframe or external links.</p>
</div>
<div class="sect2">
<h3 id="_process_declaration_and_configuration"><a class="anchor" href="#_process_declaration_and_configuration"></a>3.1. Process: Declaration and Configuration</h3>
<div class="paragraph">
<p>To declare and configure a <code>Process</code>, OperatorFabric uses <code>bundles</code>.
This section describes their content and how to use them.
An <code>OperatorFabric Process</code> is a way to define a business configuration.
Once this bundle fully created, it must be uploaded to the server through the <code>Businessconfig service</code>.</p>
</div>
<div class="paragraph">
<p>Some examples show how to configure a <code>process</code> using a <code>bundle</code> before diving in more technical details of the configuration.
The following instructions describe tests to perform on OperatorFabric to understand how customizations are possible.</p>
</div>
<div class="sect3">
<h4 id="_bundle_as_process_declaration"><a class="anchor" href="#_bundle_as_process_declaration"></a>3.1.1. Bundle as Process declaration</h4>
<div class="paragraph">
<p>A bundle contains all the configuration regarding a given business process, describing for example the various steps of the process but also how the associated cards and card details should be displayed.</p>
</div>
<div class="paragraph">
<p>Bundle are technically <code>tar.gz</code> archives containing at least a descriptor file named <code>config.json</code>.
To display the card date, some <code>css files</code>, <code>i18n file</code> and <code>handlebars templates</code> must be added.</p>
</div>
<div class="paragraph">
<p>For didactic purposes, in this section, the businessconfig bundle name is <code>BUNDLE_TEST</code> (to match the parameters used by the script).
The l10n (localization) configurations is English.</p>
</div>
<div class="paragraph">
<p>As detailed in the <code>Businessconfig core service README</code> the bundle contains at least a metadata file called <code>config.json</code>, a file <code>i18n.json</code>, a <code>css</code> folder and a <code>template</code> folder.</p>
</div>
<div class="paragraph">
<p>Except for the <code>config.json file</code>, all elements are optional.</p>
</div>
<div class="paragraph">
<p>The file organization within a bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bundle
âââ config.json
âââ i18n.json
âââ css
â   âââ bundleTest.css
âââ template
    âââ template1.handlebars
    âââ template2.handlebars</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_config_json_file"><a class="anchor" href="#_the_config_json_file"></a>3.1.2. The config.json file</h4>
<div class="paragraph">
<p>It&#8217;s a description file in <code>json</code> format.
It lists the content of the bundle.</p>
</div>
<div class="paragraph">
<p><strong>example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">uiVisibility</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">monitoring</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">logging</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">calendar</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">process.label</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">firstState</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:  <span class="string"><span class="delimiter">&quot;</span><span class="content">state.label</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">acknowledgmentAllowed</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Never</span><span class="delimiter">&quot;</span></span>
    }
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: id of the process;</p>
</li>
<li>
<p><code>name</code>: process name;</p>
</li>
<li>
<p><code>version</code>: enables the correct display of the card data, even for the old ones.
The server store the previous versions in its file system.
This field value should match a businessconfig configuration for a correct rendering;</p>
</li>
<li>
<p><code>states</code>: lists the available states which each declares associated actions, associated templates and if cards could be acknowledged by users;</p>
</li>
<li>
<p><code>uiVisibility</code>: in the monitoring, logging and calendar screens, not all the cards are visible, it depends on the business process they are part of. For a card to be visible in these screens, the corresponding parameter must be set to true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mandatory field are <code>id</code>,<code>name</code> and <code>version</code>.</p>
</div>
<div class="paragraph">
<p>See the
<a href="/documentation/current/api/businessconfig/index.html">Businessconfig API documentation</a>
for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_i18n_json_file"><a class="anchor" href="#_the_i18n_json_file"></a>3.1.3. The i18n.json file</h4>
<div class="paragraph">
<p>This file contains internationalization information, in particular the translation for title and summary fields
If there is no i18n file or key is missing, OperatorFabric displays i18n key, such as <code>BUNDLE_TEST.1.missing-i18n-key</code>.
In the case where the bundle declares no i18n key corresponds to <code>missing-i18n-key</code>.</p>
</div>
<div class="paragraph">
<p>The choice of i18n keys is up to the maintainer of the Businessconfig process.</p>
</div>
<div class="sect4">
<h5 id="_template_folder"><a class="anchor" href="#_template_folder"></a>3.1.3.1. Template folder</h5>
<div class="paragraph">
<p>The <code>template</code> folder contains one template file for each process/state. They will be used for the card details rendering.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>For this example, the name of the process is  <code>Bundle Test</code> and its technical name is <code>BUNDLE_TEST</code>.
The bundle provides an english l10n.</p>
</div>
<div class="paragraph">
<p>Title and summary have to be localized.</p>
</div>
<div class="paragraph">
<p>Here is the content of <code>i18n.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check the i18n, after the upload of the bundle, use a <code>GET</code> request against the <code>businessconfig</code> service.
The simpler is to ask for the i18n file, as described
<a href="/documentation/current/api/businessconfig/index.html#/businessconfig/getI18n">here</a>
.</p>
</div>
<div class="paragraph">
<p>Set the <code>version</code> of the bundle and the <code>technical name</code> of the businessconfig party to get json in the response.</p>
</div>
<div class="paragraph">
<p>For example, to check if the french l10n data of the version 1 of the <code>BUNDLE_TEST</code> businessconfig party use the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl "http://localhost:2100/businessconfig/processes/BUNDLE_TEST/i18n?version=1" \
-H  "Authorization: Bearer ${token}"</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>${token}</code> is a valid token for OperatorFabric use.</p>
</div>
<div class="paragraph">
<p>The <code>businessconfig</code> service should answer with a 200 status associated with the following json:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="JSON">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">TEST</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test: Process {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">summary</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">This sums up the content of the card: {{value}}</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">detail</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">card title</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test Process</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Test State</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">template</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Asset details</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processes_and_states"><a class="anchor" href="#_processes_and_states"></a>3.1.3.2. Processes and States</h5>
<div class="paragraph">
<p>Each Process declares associated states.
Each state declares specific templates for card details and specific actions.</p>
</div>
<div class="paragraph">
<p>The purpose of this section is to display elements of businessconfig card data in a custom format.</p>
</div>
<div class="sect5">
<h6 id="_configuration"><a class="anchor" href="#_configuration"></a>configuration</h6>
<div class="paragraph">
<p>The process entry in the configuration file is a dictionary of processes, each key maps to a process definition.
A process definition is itself a dictionary of states, each key maps to a state definition.</p>
</div>
</div>
<div class="sect5">
<h6 id="_templates"><a class="anchor" href="#_templates"></a>Templates</h6>
<div class="paragraph">
<p>For demonstration purposes, there will be two simple templates.
For more advance feature go to the section detailing the handlebars templates and associated helpers available in OperatorFabric.
As the card used in this example are created above, the bundle template folder needs to contain 2 templates: <code>template1.handlebars</code> and <code>template2.handlebars</code>.</p>
</div>
<div class="paragraph">
<p><strong>Examples of template (i18n versions)</strong></p>
</div>
<div class="paragraph">
<p>The following template displays a title and a line containing the value of the scope property <code>card.level1.level1Prop</code>.
The value of this key is '<em>This is a root property</em>'.</p>
</div>
<div class="paragraph">
<p><code>/template/template1.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Template Number One<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following template example displays also a title and a list of numeric values from 1 to 3.</p>
</div>
<div class="paragraph">
<p><code>/template/template2.handlebars</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;h2&gt;</span>Second Template<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;ul</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test-list</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        {{#each card.data.level1.level1Array}}
                <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bunle-test-list-item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{this.level1ArrayProp}}<span class="tag">&lt;/li&gt;</span>
        {{/each}}
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_css"><a class="anchor" href="#_css"></a>CSS</h6>
<div class="paragraph">
<p>This folder contains regular css files.
The file name must be declared in the <code>config.json</code> file in order to be used in the templates and applied to them.</p>
</div>
<div class="sect6">
<h7 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h7>
<div class="paragraph">
<p>As above, all parts of files irrelevant for our example are symbolised by a <code>â¦</code> character.</p>
</div>
<div class="paragraph">
<p><strong>Declaration of css files in <code>config.json</code> file</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
        <span class="error">â¦</span>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">state1</span><span class="delimiter">&quot;</span></span> : {
                  <span class="error">â¦</span>
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span>:[<span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest</span><span class="delimiter">&quot;</span></span>]
                  }
              }
        <span class="error">â¦</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>CSS Class used in <code>./template/template1.handlebars</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html">        â¦
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle-test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>'{{card.data.level1.level1Prop}}'<span class="tag">&lt;/div&gt;</span>
        â¦</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, the value of <code>{{card.data.level1.level1Prop}}</code> of a test card is <code>This is a level1 property</code></p>
</div>
<div class="paragraph">
<p><strong>Style declaration in <code>./css/bundleTest.css</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.h2</span>{
        <span class="key">color</span>:<span class="color">#fd9312</span>;
        <span class="key">font-weight</span>: <span class="value">bold</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Expected result</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/expected-result.png" alt="Formatted root property">
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_upload"><a class="anchor" href="#_upload"></a>3.1.3.3. Upload</h5>
<div class="paragraph">
<p>To upload a bundle to the OperatorFabric server use a <code>POST</code> http request as described in the
<a href="/documentation/current/api/businessconfig/.html#/businessconfig/uploadBundle">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${BUNDLE_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processes&quot;\
        -H  &quot;accept: application/json&quot;\
        -H  &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@bundle-test.tar.gz;type=application/gzip&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${BUNDLE_FOLDER}</code> is the folder containing the bundle archive to be uploaded.</p>
</li>
<li>
<p><code>bundle-test.tar.gz</code> is the name of the uploaded bundle.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These command line should return a <code>200 http status</code> response with the details of the bundle in the response body such as :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>
  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BUNDLE_TEST</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">states</span><span class="delimiter">&quot;</span></span> : {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template1</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">end</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templateName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">template2</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">styles</span><span class="delimiter">&quot;</span></span> : [ <span class="string"><span class="delimiter">&quot;</span><span class="content">bundleTest.css</span><span class="delimiter">&quot;</span></span> ]
          }
      }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For further help check the
<a href="/documentation/current/getting_started/index.html#troubleshooting_bundle">Troubleshooting</a>
section which resumes how to resolve common problems.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_processes_groups"><a class="anchor" href="#_processes_groups"></a>3.1.4. Processes groups</h4>
<div class="paragraph">
<p>OperatorFabric offers the possibility of defining process groups. These groups have an impact only on the UI, for
example on the notification configuration screen, by offering a more organized view of all the processes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A process can only belong to one process group.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To define processes groups, you have to upload a file via a <code>POST</code> http request as described in the</p>
</div>
<div class="paragraph">
<p><a href="/documentation/current/api/businessconfig/index.html#/default/uploadProcessgroups">Businessconfig Service API documentation</a>
.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ${PROCESSES_GROUPS_FOLDER}
curl -X POST &quot;http://localhost:2100/businessconfig/processgroups&quot;\
        -H &quot;accept: application/json&quot;\
        -H &quot;Content-Type: multipart/form-data&quot;\
        -F &quot;file=@processesGroups.json&quot;\
        -H &quot;Authorization: Bearer ${token}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${PROCESSES_GROUPS_FOLDER}</code> is the folder containing the processes groups file to upload.</p>
</li>
<li>
<p><code>processesGroups.json</code> is the name of the uploaded file.</p>
</li>
<li>
<p><code>${token}</code> is a valid token for OperatorFabric use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example of content for uploaded file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process1</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process2</span><span class="delimiter">&quot;</span></span>
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processgroup2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Process Group 2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">processes</span><span class="delimiter">&quot;</span></span>: [
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process3</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">process4</span><span class="delimiter">&quot;</span></span>
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These command line should return a <code>201 http status</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="template_description"><a class="anchor" href="#template_description"></a>3.2. Templates</h3>
<div class="paragraph">
<p>Templates are <a href="https://handlebarsjs.com/">Handlebars</a> template files. Templates
are then filled with data coming from two sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>card</strong> property (See
<a href="/documentation/current/api/cards/index.html">card data model</a>
for more information)</p>
</li>
<li>
<p>a <strong>userContext</strong> :</p>
<div class="ulist">
<ul>
<li>
<p><strong>login</strong>: user login</p>
</li>
<li>
<p><strong>token</strong>: user jwt token</p>
</li>
<li>
<p><strong>firstName</strong>: user first name</p>
</li>
<li>
<p><strong>lastName</strong>: user last name</p>
</li>
<li>
<p><strong>groups</strong> : user groups as an array of groups ID</p>
</li>
<li>
<p><strong>entities</strong> : user entities as an array of entities ID</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use these data in the template , you need to reference them inside double braces. For example if you want to display the user login:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Your login is : {{userContext.login}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To display specific business data from the card, write for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>My data : {{card.data.mydataField}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Have a look to  <a href="https://handlebarsjs.com/" class="bare">handlebarsjs.com/</a> for more information on the templating mechanism.</p>
</div>
<div class="paragraph">
<p>In addition to Handlebars basic syntax and helpers, OperatorFabric defines the
following helpers :</p>
</div>
<div class="sect3">
<h4 id="_operatorfabric_specific_handlebars_helpers"><a class="anchor" href="#_operatorfabric_specific_handlebars_helpers"></a>3.2.1. OperatorFabric specific handlebars helpers</h4>
<div class="sect4">
<h5 id="arrayContains"><a class="anchor" href="#arrayContains"></a>3.2.1.1. arrayContains</h5>
<div class="paragraph">
<p>Verify if an array contains a specified element. If the array does contain the element, it returns true. Otherwise, it returns false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p {{#if (arrayContains colors 'red')}}class="text-danger"{{/if}}&gt;test&lt;/p&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>If the colors array contains 'red', the output is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p class="text-danger"&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="arrayContainsOneOf"><a class="anchor" href="#arrayContainsOneOf"></a>3.2.1.2. arrayContainsOneOf</h5>
<div class="paragraph">
<p>If the first array contains at least one element of the second array, return true. Otherwise, return false.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (arrayContainsOneOf arr1 arr2)}}
  &lt;p&gt;Arr1 contains at least one element of arr2&lt;/p&gt;
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="bool"><a class="anchor" href="#bool"></a>3.2.1.3. bool</h5>
<div class="paragraph">
<p>returns a boolean result value on an arithmetical operation (including object
equality) or boolean operation.</p>
</div>
<div class="paragraph">
<p>Arguments: - v1: left value operand - op: operator (string value) - v2: right
value operand</p>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>==</p>
</li>
<li>
<p>===</p>
</li>
<li>
<p>!=</p>
</li>
<li>
<p>!==</p>
</li>
<li>
<p>&lt;</p>
</li>
<li>
<p>&#8656;</p>
</li>
<li>
<p>&gt;</p>
</li>
<li>
<p>&gt;=</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>boolean operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&amp;&amp;</p>
</li>
<li>
<p>||</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#if (bool v1 '&lt;' v2)}}
  v1 is strictly lower than v2
{{else}}
 V2 is lower or equal to v1
{{/if}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="conditionalAttribute"><a class="anchor" href="#conditionalAttribute"></a>3.2.1.4. conditionalAttribute</h5>
<div class="paragraph">
<p>Adds the specified attribute to an HTML element if the given condition is truthy.
This is useful for attributes such as <code>checked</code> where it is the presence or absence of the attribute that matters (i.e.
an checkbox with <code>checked=false</code> will still be checked).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;input type="checkbox" id="optionA" {{conditionalAttribute card.data.optionA 'checked'}}&gt;&lt;/input&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="replace"><a class="anchor" href="#replace"></a>3.2.1.5. replace</h5>
<div class="paragraph">
<p>Replaces all the occurrences in a given string
You should specify the substring to find, what to replace it with and the input string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{replace "&amp;lt;p&amp;gt;" "&lt;p&gt;"  this.value}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dateformat"><a class="anchor" href="#dateformat"></a>3.2.1.6. dateFormat</h5>
<div class="paragraph">
<p>formats the submitted parameters (millisecond since epoch) using
<a href="https://momentjs.com/">mement.format</a>. The locale used is the current user
selected one, the format is "format" hash parameter
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthday format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
<div class="paragraph">
<p><em>Note</em><br>
You can also pass a milliseconds value as a string.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{dateFormat card.data.birthdayAsString format="MMMM Do YYYY, h:mm:ss a"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="i18n"><a class="anchor" href="#i18n"></a>3.2.1.7. i18n</h5>
<div class="paragraph">
<p>outputs a i18n result from a key and some parameters. There are two ways of
configurationÂ :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass an object as sole argument. The object must contain a key field (string)
and an optional parameter field (map of parameterKey &#8658; value)</p>
<div class="literalblock">
<div class="content">
<pre>{{i18n card.data.i18nTitle}}</pre>
</div>
</div>
</li>
<li>
<p>Pass a string key as sole argument and use hash parameters
(<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>) for i18n string
parameters.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
emergency.title=Emergency situation happened on {{date}}. Cause : {{cause}}.
--&gt;
{{i18n "emergency.title" date="2018-06-14" cause="Broken Coffee Machine"}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Emergency situation happened on 2018-06-14. Cause : Broken Cofee Machine</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="json"><a class="anchor" href="#json"></a>3.2.1.8. json</h5>
<div class="paragraph">
<p>Convert the element in json, this can be useful to use the element as a javascript object in the template. For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>var myAttribute = {{json data.myAttribute}};</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_keepspacesandendofline"><a class="anchor" href="#_keepspacesandendofline"></a>3.2.1.9. keepSpacesAndEndOfLine</h5>
<div class="paragraph">
<p>Convert a string to a light HTML by replacing :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>each new line character with &lt;br/&gt;</p>
</li>
<li>
<p>spaces with &amp;nbsp; when there is at least two consecutive spaces.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="keyValue"><a class="anchor" href="#keyValue"></a>3.2.1.10. keyValue</h5>
<div class="paragraph">
<p>This allows to traverse a map.</p>
</div>
<div class="paragraph">
<p>Notice that this should normally be feasible by using the built-in each helper, but a client was having some troubles using it so we added this custom helper.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#keyValue studentGrades}}
  &lt;p&gt; {{index}} - {{key}}: {{value}} &lt;/p&gt;
{{/keyValue}}</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the studentGrades map is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  'student1': 15,
  'student2': 12,
  'student3': 9
}</pre>
</div>
</div>
<div class="paragraph">
<p>The output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt; 0 - student1: 15&lt;/p&gt;
&lt;p&gt; 1 - student2: 12&lt;/p&gt;
&lt;p&gt; 2 - student3: 9&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="math"><a class="anchor" href="#math"></a>3.2.1.11. math</h5>
<div class="paragraph">
<p>returns the result of a mathematical operation.</p>
</div>
<div class="paragraph">
<p>arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>v1: left value operand</p>
</li>
<li>
<p>op: operator (string value)</p>
</li>
<li>
<p>v2: right value operand</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>arithmetical operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>+</p>
</li>
<li>
<p>-</p>
</li>
<li>
<p>*</p>
</li>
<li>
<p>/</p>
</li>
<li>
<p>%</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{math 1 '+' 2}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mergeArrays"><a class="anchor" href="#mergeArrays"></a>3.2.1.12. mergeArrays</h5>
<div class="paragraph">
<p>Return an array that is a merge of the two arrays.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#each (mergeArrays arr1 arr2)}}
  &lt;p&gt;{{@index}} element: {{this}}&lt;/p&gt;
{{/each}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="now"><a class="anchor" href="#now"></a>3.2.1.13. now</h5>
<div class="paragraph">
<p>outputs the current date in millisecond from epoch. The date is computed from
application internal time service and thus may be different from the date that
one can compute from javascript api which relies on the browsers' system time.</p>
</div>
<div class="paragraph">
<p>NB: Due to Handlebars limitation you must provide at least one argument to
helpers otherwise, Handlebars will confuse a helper and a variable. In the
bellow example, we simply pass an empty string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;{{now ""}}&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;{{dateFormat (now "") format="MMMM Do YYYY, h:mm:ss a"}}&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div&gt;1551454795179&lt;/div&gt;
&lt;br&gt;
&lt;div&gt;mars 1er 2019, 4:39:55 pm&lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>for a local set to <code>FR_fr</code></p>
</div>
</div>
<div class="sect4">
<h5 id="numberformat"><a class="anchor" href="#numberformat"></a>3.2.1.14. numberFormat</h5>
<div class="paragraph">
<p>formats a number parameter using
<a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu" class="bare">developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Objets_globaux/Nu</a>
mberFormat[Intl.NumberFormat].
The locale used is the current user selected one, and options are passed as hash
parameters (<a href="https://handlebarsjs.com/">see Handlebars doc Literals section</a>).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{numberFormat card.data.price style="currency" currency="EUR"}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="preservespace"><a class="anchor" href="#preservespace"></a>3.2.1.15. preserveSpace</h5>
<div class="paragraph">
<p>preserves space in parameter string to avoid html standard space trimming.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{preserveSpace card.data.businessId}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="slice"><a class="anchor" href="#slice"></a>3.2.1.16. slice</h5>
<div class="paragraph">
<p>extracts a sub array from ann array</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 0 2)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;foo&lt;/li&gt;
  &lt;li&gt;bar&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
{"array": ["foo","bar","baz"]}
--&gt;
&lt;ul&gt;
{{#each (slice array 1)}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;bar&lt;/li&gt;
  &lt;li&gt;baz&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sort"><a class="anchor" href="#sort"></a>3.2.1.17. sort</h5>
<div class="paragraph">
<p>sorts an array or some object&#8217;s properties (first argument) using an optional
field name (second argument) to sort the collection on this fields natural
order.</p>
</div>
<div class="paragraph">
<p>If there is no field argument provided :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an array, the original order of the array is kept ;</p>
</li>
<li>
<p>for an object, the structure is sorted by the object field name.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;!--
users :

{"john": { "firstName": "John", "lastName": "Cleese"},
"graham": { "firstName": "Graham", "lastName": "Chapman"},
"terry": { "firstName": "Terry", "lastName": "Gilliam"},
"eric": { "firstName": "Eric", "lastName": "Idle"},
"terry": { "firstName": "Terry", "lastName": "Jones"},
"michael": { "firstName": "Michael", "lastName": "Palin"},
--&gt;

&lt;ul&gt;
{{#each (sort users)}}
    &lt;li&gt;{{this.firstName}} {{this.lastName}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (sort users "lastName")}}
    &lt;li&gt;{{this.firstName}} {{this.lastName&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;Graham Chapman&lt;/li&gt;
  &lt;li&gt;John Cleese&lt;/li&gt;
  &lt;li&gt;Terry Gilliam&lt;/li&gt;
  &lt;li&gt;Eric Idle&lt;/li&gt;
  &lt;li&gt;Terry Jones&lt;/li&gt;
  &lt;li&gt;Michael Pallin&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="split"><a class="anchor" href="#split"></a>3.2.1.18. split</h5>
<div class="paragraph">
<p>splits a string into an array based on a split string.</p>
</div>
<div class="paragraph">
<p>example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
{{#each (split 'my.example.string' '.')}}
  &lt;li&gt;{{this}}&lt;/li&gt;
{{/each}}
&lt;/ul&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>outputs</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ul&gt;
  &lt;li&gt;my&lt;/li&gt;
  &lt;li&gt;example&lt;/li&gt;
  &lt;li&gt;string&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="svg"><a class="anchor" href="#svg"></a>3.2.1.19. svg</h5>
<div class="paragraph">
<p>outputs a svg tag with lazy loading, and missing image replacement message. The
image url is the concatenation of an arbitrary number of helper arguments</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{{svg baseUri scheduledOpId "/" substation "/before/"
computationPhaseOrdinal}}}</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="times"><a class="anchor" href="#times"></a>3.2.1.20. times</h5>
<div class="paragraph">
<p>Allows to perform the same action a certain number of times. Internally, this uses a for loop.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{#times 3}}
  &lt;p&gt;test&lt;/p&gt;
{{/times}}</pre>
</div>
</div>
<div class="paragraph">
<p>outputs :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;
&lt;p&gt;test&lt;/p&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="toBreakage"><a class="anchor" href="#toBreakage"></a>3.2.1.21. toBreakage</h5>
<div class="paragraph">
<p>Change the breakage of a string. The arguments that you can specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lowercase &#8658; The string will be lowercased</p>
</li>
<li>
<p>uppercase &#8658; The string will be uppercased</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>{{toBreakage key 'lowercase'}}s</pre>
</div>
</div>
<div class="paragraph">
<p>If the value of the key variable is "TEST", the output will be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tests</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="objectContainsKey"><a class="anchor" href="#objectContainsKey"></a>3.2.1.22. objectContainsKey</h5>
<div class="paragraph">
<p>Verify if a JavaScript object contains the specified key. It returns true if it contains it, false otherwise.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{{objectContainsKey card.data.myObject 'myKey' }}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_naming_convention"><a class="anchor" href="#_naming_convention"></a>3.2.2. Naming convention</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please do not prefix <code>id</code> attributes of DOM elements or css class names of your templates with "opfab". Indeed, so that there is no confusion between the elements of OperatorFabric and those of your templates, we have prefixed all our <code>id</code> attributes and css classes with "opfab".
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="opfab_template_style"><a class="anchor" href="#opfab_template_style"></a>3.2.3. OperatorFabric css styles</h4>
<div class="paragraph">
<p>OperatorFabric defines several css classes that you should use so your templates don&#8217;t clash with the rest of the OperatorFabric look and feel. These styles are especially useful for templates used in user card or card with responses.</p>
</div>
<div class="paragraph">
<p>Your can find example using these classes in the OperatorFabric core repository (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles">src/test/resources/bundles</a>).</p>
</div>
<div class="paragraph">
<p>The following css styles are available.</p>
</div>
<div class="sect4">
<h5 id="_opfab_input"><a class="anchor" href="#_opfab_input"></a>3.2.3.1. opfab-input</h5>
<div class="paragraph">
<p>An input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-input"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;input id="my_input" name="my_input"&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_textarea"><a class="anchor" href="#_opfab_textarea"></a>3.2.3.2. opfab-textarea</h5>
<div class="paragraph">
<p>A text area input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-textarea"&gt;
      &lt;label&gt; My input name &lt;/label&gt;
      &lt;textarea id="my_textearea_input" name="my_textearea_input"&gt; &lt;/textarea&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_select"><a class="anchor" href="#_opfab_select"></a>3.2.3.3. opfab-select</h5>
<div class="paragraph">
<p>A select input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-select" style="position:relative"&gt;
      &lt;label&gt; My select label &lt;/label&gt;
      &lt;select id="my_select" name="my_select"&gt;
          &lt;option  value="option1"&gt; Option 1 &lt;/option&gt;
          &lt;option  value="option2"&gt; Option 2&lt;/option&gt;
      &lt;/select&gt;
  &lt;/div&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The use of <code>position:relative</code> is important here to avoid strange positioning of the label.</p>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_radio_button"><a class="anchor" href="#_opfab_radio_button"></a>3.2.3.4. opfab-radio-button</h5>
<div class="paragraph">
<p>A radio button input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-radio-button"&gt;
      &lt;span&gt; My radio choice &lt;/span&gt;
      &lt;input type="radio" id="my_radio_button"&gt;
      &lt;span class="opfab-radio-button-checkmark"&gt;&lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_checkbox"><a class="anchor" href="#_opfab_checkbox"></a>3.2.3.5. opfab-checkbox</h5>
<div class="paragraph">
<p>A checkbox input field, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;label class="opfab-checkbox"&gt;
    My checkbox text
    &lt;input type="checkbox" id="my_checkbox" name="my_checkbox" &gt;
    &lt;span class="opfab-checkbox-checkmark"&gt; &lt;/span&gt;
  &lt;/label&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_table"><a class="anchor" href="#_opfab_table"></a>3.2.3.6. opfab-table</h5>
<div class="paragraph">
<p>An HTML table, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-table"&gt;
    &lt;table&gt;
        .....
    &lt;/table&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_border_box"><a class="anchor" href="#_opfab_border_box"></a>3.2.3.7. opfab-border-box</h5>
<div class="paragraph">
<p>A box with a label, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-border-box"&gt;
    &lt;label&gt;  My box name  &lt;/label&gt;
    &lt;div&gt; My box text &lt;/div&gt;
  &lt;/div&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_opfab_color_danger_opfab_color_warning_and_opfab_color_success"><a class="anchor" href="#_opfab_color_danger_opfab_color_warning_and_opfab_color_success"></a>3.2.3.8. opfab-color-danger, opfab-color-warning and opfab-color-success</h5>
<div class="paragraph">
<p>Some styles for text standard colors, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;span class="opfab-color-danger"&gt; my text in color &lt;/span&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_select"><a class="anchor" href="#_multi_select"></a>3.2.4. Multi Select</h4>
<div class="paragraph">
<p>OperatorFabric provides a multiselect component based on <a href="https://sa-si-dev.github.io/virtual-select/#/">Virtual Select</a>. To use it, one must use the OperatorFabric style and provide javascript to initialize the component:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY MULTI SELECT   &lt;/label&gt;
        &lt;div id="my-multiselect"&gt;&lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;
  myMultiSelect = opfab.multiSelect.init({
                id: "my-multiselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: true,
                search: true
            });


  usercardTemplateGateway.getSpecificCardInformation = function () {

        const selectedValues = myMultiSelect.getSelectedValues();

      ....</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It strongly advice to NOT use directly virtual select (always use OperatorFabric js object and css) otherwise you will not be guaranteed compatibility when upgrading.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to use the component also as single value select. The advantage over a standard select is the possibility to benefit of the serching feature. To use the component as single select, initialize it with the <code>multiple</code> property set to false:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;div class="opfab-multiselect"&gt;
        &lt;label&gt;  MY SINGLE SELECT   &lt;/label&gt;
        &lt;div id="my-singleselect"&gt;
        &lt;/div&gt;
  &lt;/div&gt;

 &lt;script&gt;
  mySingleSelect = opfab.multiSelect.init({
                id: "my-singleselect",
                options: [
                { label: 'Choice A', value: 'A' },
                { label: 'Choice B', value: 'B' },
                { label: 'Choice C', value: 'C' }
                { label: 'Choice D', value: 'D' },
                { label: 'Choice E', value: 'E' },
                { label: 'Choice F', value: 'F' }
                ],
                multiple: false,
                search: true
            });


  usercardTemplateGateway.getSpecificCardInformation = function () {

        const selectedValues = document.getElementById('my-singleselect').value;

      ....</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_charts"><a class="anchor" href="#_charts"></a>3.2.5. Charts</h4>
<div class="paragraph">
<p>The library <a href="https://www.chartjs.org/">charts.js</a> is integrated in OperatorFabric, it means it&#8217;s possible to show charts in cards, you can find a bundle example in the operator fabric git (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles/defaultProcess_V1">src/test/resources/bundle/defaultProcess_V1</a>).</p>
</div>
<div class="paragraph">
<p>The version of chartjs integrated in OperatorFabric is v3.7.1.</p>
</div>
</div>
<div class="sect3">
<h4 id="_operatorfabric_specific_functions"><a class="anchor" href="#_operatorfabric_specific_functions"></a>3.2.6. OperatorFabric specific functions</h4>
<div class="sect4">
<h5 id="_set_screen_size"><a class="anchor" href="#_set_screen_size"></a>3.2.6.1. Set screen size</h5>
<div class="paragraph">
<p>To adapt the template content on screen size it is possible to receive from OperatorFabric information on the size of the window where the template will be rendered. To receive screen size information you need to implement a javascript function in your template called templateGateway.setScreenSize(size) which receives as input a string parameter with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'md' : medium size window</p>
</li>
<li>
<p>'lg' : large size window</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_get_display_context"><a class="anchor" href="#_get_display_context"></a>3.2.6.2. Get display context</h5>
<div class="paragraph">
<p>To adapt the template content to the display context it is possible to get from OperatorFabric the page context where the template will be rendered by calling the javascript function <em>templateGateway.getDisplayContext()</em>.
The function returns a string with one of the following values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'realtime' : realtime page context (feed, monitoring)</p>
</li>
<li>
<p>'archive' : archive page context</p>
</li>
<li>
<p>'preview': preview context (user card)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of usage can be found in operator fabric git: (<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars">src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_redirect_to_business_application_from_a_card"><a class="anchor" href="#_redirect_to_business_application_from_a_card"></a>3.2.6.3. Redirect to business application from a card</h5>
<div class="paragraph">
<p>It&#8217;s possible to redirect from a card to a business application declared in <code>ui-menu.json</code>.</p>
</div>
<div class="paragraph">
<p>This can be done by calling the following function from the template :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>templateGateway.redirectToBusinessMenu(idMenu,idEntry)</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>idMenu is the id of the menu defined in ui-menu.json</p>
</li>
<li>
<p>idEntry is the id of the entry defined in ui-menu.json</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to append url extension (sub paths and/or parameters) to the url that will be called:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>templateGateway.redirectToBusinessMenu('myMenu','myEntry','/extension?param1=aParam&amp;param2=anotherParam')</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/bundles/defaultProcess_V1/template/chart.handlebars</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javascript:templateGateway.redirectToBusinessMenu('menu1','uid_test_0','?search=chart</span><span class="content">&amp;</span><span class="content">fulltext=1')</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> Want more information about charts ? <span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be useful to pass context from the card to the business application.</p>
</div>
</div>
<div class="sect4">
<h5 id="_get_list_of_all_entities"><a class="anchor" href="#_get_list_of_all_entities"></a>3.2.6.4. Get list of all entities</h5>
<div class="paragraph">
<p>To have the list of all entities in OperatorFabric, you can call the javascript function <em>templateGateway.getAllEntities()</em>.
The function returns an array of entity object :</p>
</div>
<div class="paragraph">
<p>Entity object has the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'id' : id of the entity</p>
</li>
<li>
<p>'name' : name of the entity</p>
</li>
<li>
<p>'description' : description of the entity</p>
</li>
<li>
<p>'entityAllowedToSendCard' : boolean indicating whether the entity is allowed to send card or not</p>
</li>
<li>
<p>'parents' : list of parent entities</p>
</li>
<li>
<p>'labels' : list of labels associated to the entity</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_get_information_about_an_entity"><a class="anchor" href="#_get_information_about_an_entity"></a>3.2.6.5. Get information about an entity</h5>
<div class="paragraph">
<p>To have information about an entity in particular, you can call the javascript function <em>templateGateway.getEntity(entityId)</em>.
The function returns an entity object whose fields are mentioned above.</p>
</div>
</div>
<div class="sect4">
<h5 id="_method_ontemplaterenderingcomplete"><a class="anchor" href="#_method_ontemplaterenderingcomplete"></a>3.2.6.6. Method onTemplateRenderingComplete()</h5>
<div class="paragraph">
<p>OpFab calls this method when it has finished all tasks regarding rendering template :
it is called after applyChildCard(), lockAnswer(), setLttdExpired() and setScreenSize()</p>
</div>
<div class="paragraph">
<p>It can be used by a template to launch some processing when loading is complete</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_card_notification"><a class="anchor" href="#_card_notification"></a>4. Card notification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a user receives a card, he is notified via a resume of the card on the left panel of the UI, what is called the "feed".</p>
</div>
<div class="sect2">
<h3 id="_notification_configuration"><a class="anchor" href="#_notification_configuration"></a>4.1. Notification configuration</h3>
<div class="paragraph">
<p>For each process/state, the user can choose to be notified or not when receiving a card. If he chooses not to be
notified then the card will not be visible:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the feed or the timeline</p>
</li>
<li>
<p>in the monitoring screen</p>
</li>
<li>
<p>in the calendar screen</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, it will be visible in the archives screen.</p>
</div>
<div class="paragraph">
<p>In order to have a better visual organization of the processes in the UI, you can define processes groups.
You can find more information
<a href="/documentation/current/reference_doc/index.html#_processes_groups">here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_sound_notification"><a class="anchor" href="#_sound_notification"></a>4.2. Sound notification</h3>
<div class="paragraph">
<p>If the option is activated in the general configuration file web-ui.json, the user can choose to have a sound played
when they receive a card (either by the browser or by an external device if configured).
This can be managed by the user in the settings screen.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To customize the sounds played by the browser, see <code>config/docker/custom-sounds/README.adoc</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_card_read"><a class="anchor" href="#_card_read"></a>4.3. Card read</h3>
<div class="paragraph">
<p>When the user receives a new card, he can see it in the feed with a bold title and card resume. Once the card is opened, the text is not bold anymore and becomes grey.</p>
</div>
</div>
<div class="sect2">
<h3 id="_card_acknowledgment"><a class="anchor" href="#_card_acknowledgment"></a>4.4. Card acknowledgment</h3>
<div class="sect3">
<h4 id="_acknowledgment_done_by_the_user"><a class="anchor" href="#_acknowledgment_done_by_the_user"></a>4.4.1. Acknowledgment done by the user</h4>
<div class="paragraph">
<p>The user can set a card as "acknowledged" so he will not see it anymore by default in the feed. It is as well possible to cancel it and set a card to "unacknowledged" (a filter permit to see acknowledged cards).</p>
</div>
<div class="paragraph">
<p>To offer the possibility for the user to acknowledge card, it has to be configured in process definition.
The configuration is done on a state by setting the <code>acknowledgmentAllowed</code> field. Allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Never": acknowledgement not allowed</p>
</li>
<li>
<p>"Always": acknowledgement allowed (default value)</p>
</li>
<li>
<p>"OnlyWhenResponseDisabledForUser": acknowledgement allowed only when
the response is disabled for the user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is possible to cancel a card aknowledgment unless process state configuration has the <code>cancelAcknowledgmentAllowed</code> field set to false.</p>
</div>
<div class="paragraph">
<p>You can see examples in src/test/resources/bundles/defaultProcess_V1/config.json</p>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgment_done_by_entityies"><a class="anchor" href="#_acknowledgment_done_by_entityies"></a>4.4.2. Acknowledgment done by entity(ies)</h4>
<div class="paragraph">
<p>A card can also be set as acknowledged if a member (or several) of the entity of the user has acknowledged it.
A user can be member of several entities, so you can configure if acknowledgment done by only one entity
(of the user) suffices for the card to appear as acknowledged or if all entities must acknowledge the card.</p>
</div>
<div class="paragraph">
<p>To configure how a card is considered as acknowledged for the user, it has to be configured in process definition.
The configuration is done on a state by setting the <code>consideredAcknowledgedForUserWhen</code> field. Allowed values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"UserHasAcknowledged": the card is set as acknowledged if the user acknowledges it</p>
</li>
<li>
<p>"OneEntityOfUserHasAcknowledged": the card is set as acknowledged if one (or more) entity(ies) of the user acknowledges it</p>
</li>
<li>
<p>"AllEntitiesOfUserHaveAcknowledged": the card is set as acknowledged if all the entities of the user acknowledge it</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pin_cards"><a class="anchor" href="#_pin_cards"></a>4.5. Pin cards</h3>
<div class="paragraph">
<p>It is possible to configure the state of a process so that cards are automatically "pinned" when acknowledged. Pinned cards are displayed in Feed page as small boxes with the title of the card just under the timeline Pinned cards are still visible even if the card is no more visible in the feed. A pinned card remains visible until card end date. If no end date, card will always be visible unless it is updated or deleted.</p>
</div>
<div class="paragraph">
<p>To configure a process state to automatically pin cards set the <code>automaticPinWhenAcknowledged</code> property to true in state definition.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"pinnedState": {
      "name": "â ï¸ Network Contingencies â ï¸",
      "description": "Contingencies state",
      "templateName": "contingencies",
      "styles": [
        "contingencies"
      ],
      "acknowledgmentAllowed": "Always",
      "type" : "INPROGRESS",
      "automaticPinWhenAcknowledged" : true
    }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="card_reminder"><a class="anchor" href="#card_reminder"></a>4.6. Card reminder</h3>
<div class="paragraph">
<p>For certain process and state, it is possible to configure a reminder. The reminder "reactivate" the card in the feed at a certain time. "Reactivate" means setting the card to the status "unread" and "unacknowledged".</p>
</div>
<div class="paragraph">
<p>The time for "reactivation" is defined with the parameter "secondsBeforeTimeSpanForReminder" in the card.</p>
</div>
<div class="paragraph">
<p>The remind is done related to the timespans values :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the startDate</p>
</li>
<li>
<p>or recurrently if a recurrence objet is defined.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_simple_reminder"><a class="anchor" href="#_simple_reminder"></a>4.6.1. Simple reminder</h4>
<div class="paragraph">
<p>If a timespan is present without a recurrence object, a reminder will arise at <code>startDate - secondsBeforeTimeSpanForReminder</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recurrent_reminder"><a class="anchor" href="#_recurrent_reminder"></a>4.6.2. Recurrent reminder</h4>
<div class="paragraph">
<p>It is possible to set a recurrent reminder via the structure recurrence which define a regular event in the timespan structure. It is defined with the following fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HoursAndMinutes : hours and minutes of day when the event arise</p>
</li>
<li>
<p>DaysOfWeek : a list of day of the week when the event arise. The day of week is a number with 1 being Monday and 7 being Sunday as defined in <a href="https://en.wikipedia.org/wiki/ISO_8601#Week_dates">the ISO Standard 8601 (weekday number) </a></p>
</li>
<li>
<p>TimeZone : the time zone of reference for the recurrence definition (default value is Europe/Paris)</p>
</li>
<li>
<p>DurationInMinutes : the duration in minutes of the event</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The reminder will arise for each <code>recurrent date of event - secondsBeforeTimeSpanForReminder</code> starting from startDate.</p>
</div>
<div class="sect4">
<h5 id="_recurrent_reminder_example"><a class="anchor" href="#_recurrent_reminder_example"></a>4.6.2.1. Recurrent reminder example</h5>
<div class="paragraph">
<p>If timespan is defined as follow :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>startDate : 1231135161
recurrence : {
    hoursAndMinutes : { hours:10 ,minutes:30},
    daysOfWeek : [6,7],
    durationInMinutes : 15
}</pre>
</div>
</div>
<div class="paragraph">
<p>If secondsBeforeTimeSpanForReminder is set to 600 seconds, the reminder will arise every saturday and sunday at 10:20 starting from startDate</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_last_time_for_reminding"><a class="anchor" href="#_last_time_for_reminding"></a>4.6.3. Last time for reminding</h4>
<div class="paragraph">
<p>If the user is not connected at the time of the remind,  when he connects if current time is superior to 15 minutes from the event date, no  remind will arise.</p>
</div>
</div>
<div class="sect3">
<h4 id="_debugging"><a class="anchor" href="#_debugging"></a>4.6.4. Debugging</h4>
<div class="paragraph">
<p>When the user receives a card with a reminder to set, the log (console) of the browser contains a line with the date when the remind will arise . For example :</p>
</div>
<div class="paragraph">
<p><code>2020-11-22T21:00:36.011Z Reminder Will remind card conferenceAndITIncidentExample.0cf5537b-f0df-4314-f17f-2797ccd8e4e9 at
                         Sun Nov 22 2020 22:55:00 GMT+0100 (heure normale dâEurope centrale)</code></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="response_cards"><a class="anchor" href="#response_cards"></a>5. Response cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within your template, you can allow the user to perform some actions (respond to a form, answer a question, &#8230;&#8203;).
The user fills these information and then clicks on a submit button. When he submits this action, a new card is created
and emitted to a third-party tool.</p>
</div>
<div class="paragraph">
<p>This card is called "a child card" as it is attached to the card where the question came from : "the parent card". This
child card is also sent to the users that have received the parent card. From the ui point of view, the information of
the child cards can be integrated in real time in the parent card if configured.</p>
</div>
<div class="paragraph">
<p>The process can be represented as follows :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardSequence.jpg" alt="ResponseCardSequence">
</div>
</div>
<div class="paragraph">
<p>Notice that the response will be associated to the entity and not to the user, i.e the user responds on behalf of his
entity. A user can respond more than one time to a card (a future evolution could add the possibility to limit to one
response per entity).</p>
</div>
<div class="paragraph">
<p>You can view a screenshot of an example of card with responses :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/ResponseCardScreenshot2.png" alt="ResponseCardScreenshot2">
</div>
</div>
<div class="sect2">
<h3 id="_steps_needed_to_use_a_response_card"><a class="anchor" href="#_steps_needed_to_use_a_response_card"></a>5.1. Steps needed to use a response card</h3>
<div class="sect3">
<h4 id="define_a_third_party_tool"><a class="anchor" href="#define_a_third_party_tool"></a>5.1.1. Define a third party tool</h4>
<div class="paragraph">
<p>The response card is to be received by a third party application for business processing. The third-party application
will receive the card as an HTTP POST request. The card is in json format (the same format as when we send a card).
The field data in the json contains the user response.</p>
</div>
<div class="paragraph">
<p>The url of the third party receiving the response card is to be set in the .yml of the publication service. It is also possible to configure wether he user token shall be propagated to the third party or not by setting the "propagateUserToken" boolean property. Here is an example with two third parties configured.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>external-recipients:
  recipients:
    - id: "third-party1"
      url: "http://thirdparty1/test1"
      propagateUserToken: true
    - id: "third-party2"
      url: "http://thirdparty2:8090/test2"
      propagateUserToken: false</pre>
</div>
</div>
<div class="paragraph">
<p>The name to use for the third-party is the publisherId of the parent card.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For the url, do not use localhost if you run OperatorFabric in a docker, as the publication-service will not be able to
join your third party.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configure_the_response_in_config_json"><a class="anchor" href="#_configure_the_response_in_config_json"></a>5.1.2. Configure the response in config.json</h4>
<div class="paragraph">
<p>A card can have a response only if it&#8217;s in a process/state that is configured for. To do that you need to define the
appropriate configuration in the config.json of the concerned process. Here is an example of configuration:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id": "defaultProcess",
  "name": "Test",
  "version": "1",
  "states": {
    "questionState": {
      "name": "question.title",
      "color": "#8bcdcd",
      "response": {
        "state": "responseState",
        "externalRecipients":["externalRecipient1", "externalRecipient2"]
      },
      "templateName": "question",
      "styles": [
        "style"
      ],
      "acknowledgmentAllowed": "Never",
      "showDetailCardHeader" : true
    },
    "responseState": {
      "name" : "response.title",
      "isOnlyAChildState" : true
    }
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>We define here a state name "questionState" with a response field. Now, if we send a card with process "defaultProcess"
and state "questionState", the user will have the possibility to respond if he has the required privileges.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The field "state" in the response field is used to define the state to use for the response (the child card).</p>
</li>
<li>
<p>The field "externalRecipients" define the recipients of the response card. These recipients are the ids of the objects referenced in
the config file of cards-publication service, in "external-recipients" element. This field is optional.</p>
</li>
<li>
<p>The field "emittingEntityAllowedToRespond" in the response field is used to allow the emitting entity to respond to a card. To be able to respond, however, the emitting entity has to be one of the recipients of the card. Default value is false.</p>
</li>
<li>
<p>The field "showDetailCardHeader" permits to display the card header or not. This header contains the list of entities
that have already responded or not, and a countdown indicating the time remaining to respond, if necessary.</p>
</li>
<li>
<p>The field "isOnlyAChildState" indicates whether the state is only used for child cards or not. If yes, the state
is displayed neither in the feed notification configuration screen nor in archives screen filters.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The state to be used for the response can also be set dynamically based on the contents of the card or the
response by returning it in the <code>templateGateway.getUserResponse</code> method (see below for details).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_design_the_question_form_in_the_template"><a class="anchor" href="#_design_the_question_form_in_the_template"></a>5.1.3. Design the question form in the template</h4>
<div class="paragraph">
<p>For the user to response you need to define the response form in the template with standard HTML syntax</p>
</div>
<div class="paragraph">
<p>To enable operator fabric to send the response, you need to implement a javascript function in your template called
<code>templateGateway.getUserResponse</code> which returns an object containing four fields :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>valid (<em>boolean</em>) : true if the user input is valid</p>
</li>
<li>
<p>errorMsg (<em>string</em>) : message in case of invalid user input. If valid is true this field is not necessary.</p>
</li>
<li>
<p>responseCardData (<em>any</em>) : the user input to send in the data field of the child card. If valid is false this field is not necessary.</p>
</li>
<li>
<p>responseState : name of the response state to use. This field is not mandatory, if it is not set the state defined in
<code>config.json</code> will be used for the response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method will be called by OperatorFabric when the user clicks on the button to send the response.</p>
</div>
<div class="paragraph">
<p>In the example below, the <code>getUserResponse</code> creates a <code>responseCardData</code> object by retrieving the user&#8217;s inputs from the HTML.
In addition, if the user chose several options, it overrides the response state defined in the <code>config.json</code> with another
state.</p>
</div>
<div class="listingblock">
<div class="title">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">  templateGateway.<span class="function">getUserResponse</span> = <span class="keyword">function</span>() {

    const responseCardData = {};
    const formElement = document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">question-form</span><span class="delimiter">'</span></span>);
    <span class="keyword">for</span> (const [key, value] of [... <span class="keyword">new</span> FormData(formElement)]) {
        (key <span class="keyword">in</span> responseCardData) ? responseCardData[key].push(value) : responseCardData[key] = [value];
    }

    const result = {
        <span class="key">valid</span>: <span class="predefined-constant">true</span>,
        <span class="key">responseCardData</span>: responseCardData
    };

      <span class="comment">// If the user chose several options, we decide to move the process to a specific state, for example to ask a follow-up question (what's their preferred option).</span>
    const choiceRequiresFollowUp = Object.entries(responseCardData).length&gt;<span class="integer">1</span>;
    <span class="keyword">if</span>(choiceRequiresFollowUp) result[<span class="string"><span class="delimiter">'</span><span class="content">responseState</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">multipleOptionsResponseState</span><span class="delimiter">'</span></span>;

    <span class="keyword">return</span> result;

    };</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_define_permissions"><a class="anchor" href="#_define_permissions"></a>5.1.4. Define permissions</h4>
<div class="paragraph">
<p>To respond to a card a user must have the right privileges, it is done using "perimeters". The user must be in a group
that is attached to a perimeter with  a right "ReceiveAndWrite" for the concerned process/state, the state being the response
state defined in the config.json.</p>
</div>
<div class="paragraph">
<p>Here is an example of definition of a perimeter :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterQuestion",
  "process" : "defaultProcess",
  "stateRights" : [
    {
      "state" : "responseState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="paragraph">
<p>To configure it in OperatorFabric , you need to make a POST of this json file to the end point /users/perimeters.</p>
</div>
<div class="paragraph">
<p>To add it to a group name for example "mygroup", you need to make a PATCH request  to endpoint
'users/groups/mygroup/perimeters' with payload ["perimeterQuestion"]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_send_a_question_card"><a class="anchor" href="#_send_a_question_card"></a>5.2. Send a question card</h3>
<div class="paragraph">
<p>The question card is like a usual card except that you have the field "entitiesAllowedToRespond" to set with the
entities allowed to respond to the card. If the user is not in the entity, he will not be able to respond.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, OperatorFabric considers that if the parent card (question card) is modified, then the child cards
are deleted. If you want to keep the child cards when the parent card is changed, then you must add in the parent
card the field "keepChildCards" and set it to true.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The header in the card details will list the entities from which a response is expected, color-coding them depending
on whether they&#8217;ve already responded (green) or not (orange).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also set the property <code>entitiesRequiredToRespond</code> to differentiate between entities can respond
(<code>entitiesAllowedToRespond</code>) and those who must respond (<code>entitiesRequiredToRespond</code>).
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>...
"process"  :"defaultProcess",
"processInstanceId" : "process4",
"state": "questionState",
"entitiesAllowedToRespond": ["ENTITY1_FR","ENTITY2_FR","ENTITY3_FR"],
"entitiesRequiredToRespond": ["ENTITY1_FR","ENTITY2_FR"],
"severity" : "ACTION",
...</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>entitiesRequiredToRespond</code> is set and not empty, the card detail header will use this list instead of
<code>entitiesAllowedToRespond</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If set, <code>entitiesRequiredToRespond</code> does not have to be a subset of <code>entitiesAllowedToRespond</code>. To determine
if a user has the right to respond, OperatorFabric consider the union of the two lists.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If several entities are allowed/required to respond and if the user is part of several of these entities, so
the ability for the user to respond to this card is desactivated.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_integrate_child_cards"><a class="anchor" href="#_integrate_child_cards"></a>5.3. Integrate child cards</h3>
<div class="paragraph">
<p>For each user response, a child card containing the response is emitted and stored in OperatorFabric like a normal card. It is not directly visible on the ui but this child card can be integrated in real time to the parent card of all the users watching the card. To do that, you need  some code in the template to process child data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can access child cards via the javascript method templateGateway.childCards() which returns an array of the child
cards. The structure of a child card is the same as the structure of a classic card.</p>
</li>
<li>
<p>You need to define a method called templateGateway.applyChildCards() which implements the processing of  child cards.
This method will be called by OperatorFabric when loading the card and every time the list of child cards changes.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_entity_name"><a class="anchor" href="#_entity_name"></a>5.3.1. Entity name</h4>
<div class="paragraph">
<p>If you want to show the name of an entity that send the response, you need to get the id of the entity via the publisher
field of the child card and then you  can get the name of the entity by calling <em>templateGateway.getEntityName(entityId)</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_example"><a class="anchor" href="#_example"></a>5.3.2. Example</h4>
<div class="paragraph">
<p>You can find an example in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lock_mechanism"><a class="anchor" href="#_lock_mechanism"></a>5.4. Lock mechanism</h3>
<div class="paragraph">
<p>When a user has never answered to a response card, the button will be marked as "VALIDATE ANSWER" and the card will be
unlocked.
When the user responds for the first time (and the response succeeds), the button will then be marked as "MODIFY ANSWER"
and the information that the card has been locked will be sent to the third template (by calling the <em>templateGateway.lockAnswer()</em> function).</p>
</div>
<div class="paragraph">
<p>Once a user has responded to a response card, its entity status will be considered as "already answered" for this card.
Then all the users having the same entity will be in this status for this card.</p>
</div>
<div class="paragraph">
<p>From there, as soon as they will open this card the button will be marked as "MODIFY ANSWER" and this information (i.e. that this entity has already responded) will be send to the third template (via the <em>templateGateway.isLocked</em> variable).</p>
</div>
<div class="paragraph">
<p>The user can then click on "MODIFY ANSWER" and the button will come back to its initial state ("VALIDATE ANSWER") and the information that the user wants to modify its initial answer will be sent to the third template (by calling the <em>templateGateway.unlockAnswer()</em> function).</p>
</div>
<div class="paragraph">
<p>Once again, after validating its answer, the information will be sent to the third template that the card has been locked (by calling the templateGateway.lockAnswer() function).</p>
</div>
</div>
<div class="sect2">
<h3 id="_response_enabled"><a class="anchor" href="#_response_enabled"></a>5.5. Response enabled</h3>
<div class="paragraph">
<p>The template can know if the current user has the permission to answer by calling the <em>templateGateway.isUserAllowedToRespond()</em> function.
An example of <em>templateGateway.isUserAllowedToRespond()</em> usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars">src/test/resources/bundles/conferenceAndITIncidentExample/template/incidentInProgress.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_response_required"><a class="anchor" href="#_response_required"></a>5.6. Response required</h3>
<div class="paragraph">
<p>The template can know if the current user is member of an Entity required to respond by calling the <em>templateGateway.isUserMemberOfAnEntityRequiredToRespond()</em> function.
An example of <em>templateGateway.isUserMemberOfAnEntityRequiredToRespond()</em> usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_last_time_to_decide_lttd_2"><a class="anchor" href="#_last_time_to_decide_lttd_2"></a>5.7. Last Time to Decide (<code>lttd</code>)</h3>
<div class="paragraph">
<p>If the card has a last time to decide (lttd) configured, when the time is expired this information will be sent to the third template (by calling the <em>templateGateway.setLttdExpired(true)</em> function).
An example of <em>templateGateway.setLttdExpired(true)</em> usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/question.handlebars">src/test/resources/bundles/defaultProcess_V1/template/question.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entities_allowed_to_respond"><a class="anchor" href="#_entities_allowed_to_respond"></a>5.8. Entities allowed to respond</h3>
<div class="paragraph">
<p>If inside your template, you want to get the ids of the entities allowed to send a response, you can call the method <em>templateGateway.getEntitiesAllowedToRespond()</em> . This method returns an array containing the ids. An example of <em>templateGateway.getEntitiesAllowedToRespond()</em> usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars">src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_used_for_user_to_respond"><a class="anchor" href="#_entity_used_for_user_to_respond"></a>5.9. Entity used for user to respond</h3>
<div class="paragraph">
<p>If inside your template, you want to get the id of the entity used by the user to send a response, you can call the method <em>templateGateway.getEntityUsedForUserResponse()</em> .
An example of usage can be found in the file <a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars">src/test/resources/bundles/messageOrQuestionExample/template/question.handlebars</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user_cards"><a class="anchor" href="#user_cards"></a>6. User cards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the <code>Create card</code> menu, the user can send cards to entities. This feature needs to be configured.</p>
</div>
<div class="sect2">
<h3 id="_configure_the_bundle"><a class="anchor" href="#_configure_the_bundle"></a>6.1. Configure the bundle</h3>
<div class="paragraph">
<p>A card is related to a process and a state, if you want users to be able to emit a card for a specific process and state,
you need to define it in the bundle for this process.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"id": "conferenceAndITIncidentExample",
"name": "conferenceAndITIncidentExample.label",
"version": "1",
"states": {
  "messageState": {
    "name": "message.title",
    "userCard" : {
      "template" : "usercard_message",
      "severityVisible" : true,
      "startDateVisible" : true,
      "endDateVisible" : true,
      "lttdVisible" : false,
      "recipientList" : [{"id": "ENTITY_FR", "levels": [0,1]}, {"id": "IT_SUPERVISOR_ENTITY"}]
    },
    "templateName": "message",
    "styles": [],
    "acknowledgmentAllowed": "Always"
  }
}</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the field userCard states that we have a template called <code>usercard_message</code> that defines how
the specific business input fields for this user card will be displayed in the card sending form that will be
presented to the user (through the <code>Create Card</code> menu).</p>
</div>
<div class="paragraph">
<p>This template works the same as templates for card presentation. Here is an example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="opfab-textarea"&gt;
    &lt;label&gt; MESSAGE &lt;/label&gt;
    &lt;textarea id="message" name="message" placeholder="Write something.."
        style="width:100%"&gt; {{card.data.message}} &lt;/textarea&gt;
&lt;/div&gt;


&lt;script&gt;
    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };

    }
&lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The first part defines the HTML for the business-specific input fields. It should only include the form
fields specific to your process, because the generic fields (like startDate , endDate , severity &#8230;&#8203; ) are presented
by default. It is possible to hide certain generic fields, by setting their visibility to false in the config.json
(for example field <code>severityVisible</code>).</p>
</div>
<div class="paragraph">
<p>Please note that you should use an OpFab css class so the "business-specific" part of the form has the same look and
feel (See
<a href="/documentation/current/reference_doc/index.html#opfab_template_style">OperatorFabric Style</a>
for more information)</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be aware that as we have a preview of the card, the application loads the html related to the usercard (build with the usercard template) and the html related to the card in preview (build with the card template) into the browser at the same time. This implies that you MUST NOT name the elements with the same names in both templates. This rule applies to HTML elements identifiers(id), global JavaScript variables and JavaScript function names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the card has been sent, users with the appropriate rights can edit it. If they choose to do so, they&#8217;re presented
with the same input form as for the card creation, but the fields are pre-filled with the current data of the card.
This way, they can only change what they need without having to re-create the card from scratch.
That&#8217;s what the reference to <code>{{card.data.message}}</code> is for. It means that this text-area input field should be filled
with the value of the field <code>message</code> from the card&#8217;s data.</p>
</div>
<div class="paragraph">
<p>The second part is a javascript method you need to implement to allow OperatorFabric to get your specific data .</p>
</div>
<div class="paragraph">
<p>To have a better understanding of this feature, we encourage you to have a look at the examples in the OperatorFabric
core repository under (<a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/bundles/conferenceAndITIncidentExample">src/test/resources/bundles/conferenceAndITIncidentExample</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_getspecificcardinformation"><a class="anchor" href="#_method_getspecificcardinformation"></a>6.2. Method getSpecificCardInformation</h3>
<div class="paragraph">
<p>The following card fields can be set via the object <code>card</code> in the object returned by method <code>getSpecificCardInformation</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>title</p>
</li>
<li>
<p>summary</p>
</li>
<li>
<p>startDate (epoch date in ms)</p>
</li>
<li>
<p>endDate (epoch date in ms)</p>
</li>
<li>
<p>lttd (epoch date in ms)</p>
</li>
<li>
<p>keepChildCards</p>
</li>
<li>
<p>secondsBeforeTimeSpanForReminder</p>
</li>
<li>
<p>severity (in case it is not visible from the user , when <code>severityVisible</code> set to false in <code>config.json</code>)</p>
</li>
<li>
<p>data</p>
</li>
<li>
<p>entityRecipients (in case recipient list is not visible from the user)</p>
</li>
<li>
<p>entitiesAllowedToEdit</p>
</li>
<li>
<p>entitiesAllowedToRespond</p>
</li>
<li>
<p>entitiesRequiredToRespond</p>
</li>
<li>
<p>externalRecipients (use to send cards to third party , see
<a href="/documentation/current/reference_doc/index.html#define_a_third_party_tool">Define a third party tool</a>
for more information) .</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you send a card to an ExternalRecipient, when the user delete it, the external recipient will receive the information via an HTTP DELETE request with the id of the deleted card at the end of the request (example : <a href="http://myexternal_app/myendpoint/ID_CARD" class="bare">myexternal_app/myendpoint/ID_CARD</a>).</p>
</div>
<div class="paragraph">
<p>If you want the card to be visible in the agenda feature, you need to set 'timeSpans' field (as array of TimeSpans objects) in the object returned by the method.
You can find an example in the file:
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/taskExample/template/usercard_task.handlebars">src/test/resources/bundles/taskExample/template/usercard_task.handlebars</a>.</p>
</div>
<div class="paragraph">
<p>If not using 'timeSpans' it&#8217;s possible to set the 'viewCardInAgenda' field to true, the card will be visible using card&#8217;s startDate and endDate as default timeSpan.</p>
</div>
<div class="paragraph">
<p>The 'recurrence' field is deprecated and could be removed in the future.</p>
</div>
<div class="paragraph">
<p>If the form is not filled correctly by the user, you can provide an error message (see example above).
Again, have a look to the examples provided.</p>
</div>
</div>
<div class="sect2">
<h3 id="_define_permissions_2"><a class="anchor" href="#_define_permissions_2"></a>6.3. Define permissions</h3>
<div class="paragraph">
<p>To send a user card, the user must be member of a group that has a perimeter defining the right <code>ReceiveAndWrite</code>
or <code>Write</code> for the chosen process and state. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
  "id" : "perimeterUserCard",
  "process" : "conferenceAndITIncidentExample",
  "stateRights" : [
    {
      "state" : "messageState",
      "right" : "ReceiveAndWrite"
    }
  ]
}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using the <code>ReceiveAndWrite</code> right instead of the <code>Write</code> right allows the user to receive the card they sent and
edit or delete it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="restrict_possible_recipients"><a class="anchor" href="#restrict_possible_recipients"></a>6.4. Restrict the list of possible recipients</h3>
<div class="paragraph">
<p>When sending a user card, by default it is possible to choose the recipients from all the available entities. To limit the list of available recipients it is possible to configure the list of possible recipients via javascript in the user template</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.setDropdownEntityRecipientList([
            {"id": "ENTITY_FR", "levels": [0,1]},
            {"id": "IT_SUPERVISOR_ENTITY"}
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the list of available recipients will contain: "ENTITY_FR" (level 0), all the first level children of "ENTITY_FR" (level 1) and "IT_SUPERVISOR_ENTITY".</p>
</div>
</div>
<div class="sect2">
<h3 id="preselect_initial_recipients"><a class="anchor" href="#preselect_initial_recipients"></a>6.5. Configure the list of initially selected recipients</h3>
<div class="paragraph">
<p>It is possible to configure the list of initially selected recipients via javascript in the user template by implementing the <code>usercardTemplateGateway.setInitialSelectedRecipients(selectedEntities)</code> method. The method takes as input the list of Entity ids to be preselected.</p>
</div>
<div class="paragraph">
<p>For example :</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.setInitialSelectedRecipients([
            "ENTITY_FR",
            "IT_SUPERVISOR_ENTITY"
        ]);</pre>
</div>
</div>
<div class="paragraph">
<p>In this example the dropdown list of available recipients will have "ENTITY_FR" and "IT_SUPERVISOR_ENTITY" preselected. The user can anyway change the selected recipients.</p>
</div>
</div>
<div class="sect2">
<h3 id="set_recipients_via_code"><a class="anchor" href="#set_recipients_via_code"></a>6.6. Set the list of recipients via the template and not via user choice</h3>
<div class="paragraph">
<p>To do that , you have to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hide the recipient dropdown using the attribute <code>recipientVisible</code> in state definition in config.json</p>
</li>
<li>
<p>provide the list of recipients when returning the card object in usercardTemplateGateway.getSpecificCardInformation() in the field entityRecipients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    usercardTemplateGateway.getSpecificCardInformation = function () {
        const message = document.getElementById('message').value;
        const card = {
          summary : {key : "message.summary"},
          title : {key : "message.title"},
          entityRecipients: ["ENTITY_FR","IT_SUPERVISOR_ENTITY"],
          data : {message: message}
        };
        if (message.length&lt;1) return { valid:false , errorMsg:'You must provide a message'}
        return {
            valid: true,
            card: card
        };</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_card_dates"><a class="anchor" href="#_setting_card_dates"></a>6.7. Setting card dates</h3>
<div class="paragraph">
<p>From the template it is possible to set the initial values for <code>startDate</code>, <code>endDate</code> and <code>lttd</code> fields of the card by calling the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>usercardTemplateGateway.setInitialStartDate(epochMs)</em></p>
</li>
<li>
<p><em>usercardTemplateGateway.setInitialEndDate(epochMs)</em></p>
</li>
<li>
<p><em>usercardTemplateGateway.setInitialLttd(epochMs)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to get the values of  <code>startDate</code>, <code>endDate</code> and <code>lttd</code> by calling the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>usercardTemplateGateway.getStartDate()</em></p>
</li>
<li>
<p><em>usercardTemplateGateway.getEndDate()</em></p>
</li>
<li>
<p><em>usercardTemplateGateway.getLttd()</em></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setting_initial_card_severity"><a class="anchor" href="#_setting_initial_card_severity"></a>6.8. Setting initial card severity</h3>
<div class="paragraph">
<p>From the template it is possible to set the initial value for card severity choice by calling the following function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>usercardTemplateGateway.setInitialSeverity(severity)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allowed severity values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'ALARM'</p>
</li>
<li>
<p>'ACTION'</p>
</li>
<li>
<p>'INFORMATION'</p>
</li>
<li>
<p>'COMPLIANT'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_card_editing"><a class="anchor" href="#_card_editing"></a>6.9. Card editing</h3>
<div class="paragraph">
<p>Once a user card has been sent it can be edited by a user member of the publisher entity.
It is possible to allow other entities to edit the card by specifying the 'entitiesAllowedToEdit' card field.</p>
</div>
</div>
<div class="sect2">
<h3 id="_get_edition_mode"><a class="anchor" href="#_get_edition_mode"></a>6.10. Get edition mode</h3>
<div class="paragraph">
<p>The template can know if the user is creating a new card or editing an existing card by calling the <em>usercardTemplateGateway.getEditionMode()</em> function. The function will return one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'CREATE'</p>
</li>
<li>
<p>'EDITION'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of <em>usercardTemplateGateway.getEditionMode()</em> usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/messageOrQuestionExample/template/usercard_question.handlebars">src/test/resources/bundles/messageOrQuestionExample/template/usercard_question.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_get_current_process_and_current_state_of_the_card"><a class="anchor" href="#_get_current_process_and_current_state_of_the_card"></a>6.11. Get current process and current state of the card</h3>
<div class="paragraph">
<p>The template can know the process and the state of the card by calling the <em>usercardTemplateGateway.getCurrentProcess()</em> and <em>usercardTemplateGateway.getCurrentState()</em> functions. These functions will return a string corresponding to the process id (or state id).</p>
</div>
</div>
<div class="sect2">
<h3 id="_receiving_emitter_entity_of_the_card"><a class="anchor" href="#_receiving_emitter_entity_of_the_card"></a>6.12. Receiving emitter entity of the card</h3>
<div class="paragraph">
<p>The template can receive the emitter entity of the card by implementing the <em>usercardTemplateGateway.setEntityUsedForSendingCard()</em>  function.
This function will be called by OperatorFabric after loading the template and every time the card emitter changes (if the user can choose from multiple entities).</p>
</div>
<div class="paragraph">
<p>An example of <em>usercardTemplateGateway.setEntityUsedForSendingCard()</em> usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/defaultProcess_V1/template/usercard_message.handlebars">src/test/resources/bundles/defaultProcess_V1/template/usercard_message.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_send_response_automatically_experimental_feature"><a class="anchor" href="#_send_response_automatically_experimental_feature"></a>6.13. Send response automatically (experimental feature)</h3>
<div class="paragraph">
<p>It is possible to configure a template to automatically send a response when sending a user card expecting an answers from one of the entities of the emitting user.
The response card will be sent only if the user is enabled to respond to the card.</p>
</div>
<div class="paragraph">
<p>To enable the automated response the template should add a <code>childCard</code> field to the object returned by
 <code>getSpecificCardInformation</code> method. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> &lt;script&gt;
    usercardTemplateGateway.getSpecificCardInformation = function () {
        const card = {...}

        childCard : {
          summary : {key : "exampe.summary"},
          title : {key : "example.title"},
          state : "mystateForResponse"
          data : {
                  // specific child  card date
                  }
          };
        ...
        return {
            valid: true,
            card: card,
            childCard: childCard
        };

    }
  &lt;/script&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The card preview will display the card detail with the automated response as it will be displayed in Feed page.</p>
</div>
<div class="paragraph">
<p>When editing a user card, the template can get the response sent by current user by calling the <em>usercardTemplateGateway.getUserEntityChildCardFromCurrentCard()</em> function. The function will return the response child card sent by current user or null if there is no response from current user.</p>
</div>
<div class="paragraph">
<p>An example of <em>usercardTemplateGateway.getUserEntityChildCardFromCurrentCard()</em> usage can be found in the file
<a href="https://github.com/opfab/operatorfabric-core/tree/master/src/test/resources/bundles/messageOrQuestionExample/template/usercard_confirmation.handlebars">src/test/resources/bundles/messageOrQuestionExample/template/usercard_confirmation.handlebars</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_misc"><a class="anchor" href="#_misc"></a>6.14. Misc</h3>
<div class="paragraph">
<p>When a user send a card, it is always sent to himself whatever he chooses in the recipient list.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archived_cards"><a class="anchor" href="#_archived_cards"></a>7. Archived Cards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_key_concepts"><a class="anchor" href="#_key_concepts"></a>7.1. Key concepts</h3>
<div class="paragraph">
<p>Every time a card is published, in addition to being delivered to the users
and persisted as a "current" card in MongoDB, it is also immediately
persisted in the archived cards.</p>
</div>
<div class="paragraph">
<p>Archived cards are similar in structure to current cards, but they are managed differently.
Current cards are uniquely identified by their id (made up of the publisher and the process id).
That is because if a new card is published with id as an existing card, it will replace it in the
card collection. This way, the current card reflects the current state of a process instance.
In the archived cards collection however, both cards will be kept, so that the archived cards
show all the states that a given process instance went through.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archives_screen_in_the_ui"><a class="anchor" href="#_archives_screen_in_the_ui"></a>7.2. Archives screen in the UI</h3>
<div class="paragraph">
<p>The Archives screen in the UI allows the users to query these archives with different filters.
The layout of this screen is very similar to the Feed screen: the results are displayed in a
(paginated) card list, and the user can display the associated card details by clicking a card in the list.</p>
</div>
<div class="paragraph">
<p>The results of these queries are limited to cards that the user is allowed to see, either :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>because this user is direct recipient of the card,</p>
</li>
<li>
<p>because he belongs to a group (or entity) that is a recipient,</p>
</li>
<li>
<p>or because he belongs to a group that has the right to receive the card (via definition of perimeters)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a card is sent to an entity and a group, then this user must be part of both the group and the entity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, child cards are not shown in the Archives, only the parent card is shown.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>8. Monitoring</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature is experimental
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The monitoring screen is a realtime view of processes based on current cards received by the user (i.e the last version of cards visible by the user). It can be seen as an another view of the feed.</p>
</div>
<div class="paragraph">
<p>Not all the cards are visible, it depends on the business process they are part of. For a card to be visible in this screen, the parameter <code>uiVisibility.monitoring</code> must be set to <code>true</code> in the config.json file of its process.</p>
</div>
<div class="sect2">
<h3 id="_export_configuration"><a class="anchor" href="#_export_configuration"></a>8.1. Export configuration</h3>
<div class="paragraph">
<p>An Excel export function is available in the monitoring screen, the content of the export can be configured.
To do so, a json file describing the expected output can be sent to the businessconfig service through the /businessconfig/monitoring endpoint.</p>
</div>
<div class="paragraph">
<p>In opfab git repository, you can find in directory <a href="https://github.com/opfab/operatorfabric-core/tree/develop/src/test/resources/monitoringConfig">src/test/resources/monitoringConfig</a>  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a script to load a monitoring configuration <code>loadMonitoringConfig.sh</code></p>
</li>
<li>
<p>an example of configuration in <code>monitoringConfig.json</code> (for the response fields to be filled , you need to need to respond to a card question in process messageOrQuestionExample )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A description of the structure of the configuration can be found in
<a href="/documentation/current/api/businessconfig/">the businessconfig api documentation</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="users_management"><a class="anchor" href="#users_management"></a>9. User management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The User service manages users, groups, entities and perimeters (linked to groups).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Users</dt>
<dd>
<p>represent account information for a person destined to receive cards in the OperatorFabric instance.</p>
</dd>
<dt class="hdlist1">Entities</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>can be used to model organizations, for examples : control center, company , department&#8230;&#8203;</p>
</li>
<li>
<p>can be used in a way to handle rights on card reception in OperatorFabric.</p>
</li>
<li>
<p>can be part of another entity (or even several entities). This relationship is modeled using the "parent entity" property</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Groups</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>represent set of users destined to receive collectively some cards.</p>
</li>
<li>
<p>has a set of perimeters to define rights for card reception in OperatorFabric.</p>
</li>
<li>
<p>can be used to model roles in organizations, for examples : supervisor, dispatcher &#8230;&#8203;</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The user define here is an internal representation of the individual card recipient in <code>OperatorFabric</code> the authentication is leave to specific OAuth2 external service.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following commands the <code>$token</code> is an authentication token currently valid for the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> system.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_users_groups_entities_and_perimeters"><a class="anchor" href="#_users_groups_entities_and_perimeters"></a>9.1. Users, groups, entities and perimeters</h3>
<div class="paragraph">
<p>User service manages users, groups, entities and perimeters.</p>
</div>
<div class="sect3">
<h4 id="_users"><a class="anchor" href="#_users"></a>9.1.1. Users</h4>
<div class="paragraph">
<p>Users are the individuals and mainly physical person who can log in OperatorFabric.</p>
</div>
<div class="paragraph">
<p>The access to this service has to be authorized, in the <code>OAuth2</code> service used by the current <code>OperatorFabric</code> instance, at least to access User information and to manage Users. The membership of groups and entities are stored in the user information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User login must be lowercase. Otherwise, it will be converted to lowercase before saving to the database.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Resource identifiers such as login, group id, entity id and perimeter id must only contain the following characters: letters, _, - or digits.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, a user cannot have several sessions at the same time. If you want to enable it, set checkIfUserIsAlreadyConnected to false in the configuration file of the card consultation service ( cards-consultation-XXX.yml ). However, this is not recommended as it may cause synchronization problems between the sessions using the same login
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_automated_user_creation"><a class="anchor" href="#_automated_user_creation"></a>9.1.1.1. Automated user creation</h5>
<div class="paragraph">
<p>In case of a user does exist in a provided authentication service but he does not exist in the <code>OperatorFabric</code>
instance, when he is authenticated and connected for the first time in the <code>OperatorFabric</code> instance, the user is
automatically created in the system without attached group or entity.
The administration of the groups, entities and perimeters is dealt by the administrator manually.
More details about automated user creation
<a href="/documentation/current/deployment/index.html#opfab_spec_conf">here</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_entities"><a class="anchor" href="#_entities"></a>9.1.2. Entities</h4>
<div class="paragraph">
<p>The notion of entity is loose and can be used to model organizations structures(examples : control center, company , department&#8230;&#8203; ).
Entities are used to send cards to several users without a name specifically. The information about membership to an
entity is stored in the user&#8217;s data (<code>entities</code> field of the <code>user</code> object). In Entity objects, the <code>parents</code> property (array) expresses the fact that this entity is a part of one or several other entities. This feature allows cards to be sent to a group of entities without having to repeat the detailed list of entities for each card.
The boolean property <code>entityAllowedToSendCard</code> (default value <code>true</code>) can be used to mark an Entity as not eligible as card publisher. This can be useful for a group of entities where only child entities should be used as card publishers while the parent is just a logical group usable as card recipient. The <code>labels</code> property (array) allows to associate string labels to an Entity object.</p>
</div>
<div class="paragraph">
<p>Examples using entities can be found
<a href="/documentation/current/reference_doc/index.html#_send_to_several_users">here</a>
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_groups"><a class="anchor" href="#_groups"></a>9.1.3. Groups</h4>
<div class="paragraph">
<p>The notion of group is loose and can be used to simulate role in <code>OperatorFabric</code> (examples : supervisor, dispatcher &#8230;&#8203; ).
Groups are used to send cards to several users without a name specifically. The information about membership to a
group is stored in the user information. A group contains a list of perimeters which define the rights of reception/writing for a couple process/state. The rules used to send cards are described in the
<a href="/documentation/current/reference_doc/index.html#reception_rules">recipients section</a>
.
.</p>
</div>
</div>
<div class="sect3">
<h4 id="_perimeters"><a class="anchor" href="#_perimeters"></a>9.1.4. Perimeters</h4>
<div class="paragraph">
<p>Perimeters are used to define rights for reading/writing cards. A perimeter is composed of an identifier (unique), a process name and a list of state/rights couple.
Possible rights for receiving/writing cards are :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receive : the rights for receiving a card</p>
</li>
<li>
<p>Write : the rights for writing a card, that is to say respond to a card or create a new card</p>
</li>
<li>
<p>ReceiveAndWrite : the rights for receiving and writing a card</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_alternative_way_to_manage_groups_and_entities"><a class="anchor" href="#_alternative_way_to_manage_groups_and_entities"></a>9.1.5. Alternative way to manage groups and entities</h4>
<div class="paragraph">
<p>The standard way to handle groups and entities in <code>OperatorFabric</code> instance is dealt on the user information.
There is an alternative way to manage groups and entities through the authentication token, the groups and entities are defined by the administrator of the authentication service.
See
<a href="/documentation/current/deployment/index.html#jwt_mode">here</a>
for more details to use this feature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_currently_connected_users"><a class="anchor" href="#_currently_connected_users"></a>9.2. Currently connected users</h3>
<div class="paragraph">
<p>The endPoint <code>/cards/connections</code> gives the list of connected user in real time. It is only accessible by users with administrator privileges.</p>
</div>
</div>
<div class="sect2">
<h3 id="_real_time_users"><a class="anchor" href="#_real_time_users"></a>9.3. Real time users</h3>
<div class="paragraph">
<p>OperatorFabric allows you to see which entities/groups are logged in and not logged in. To have this information, you must upload a configuration file, using the endpoint /businessconfig/realtimescreens, via a POST request. In this file, you can configure several screens, each one containing the list of entities/groups you want to see.</p>
</div>
<div class="paragraph">
<p>This interface is accessible via the user menu (top right of the screen).</p>
</div>
<div class="paragraph">
<p>Here is an example of the configuration file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">realTimeScreens</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">All Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">French Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY3_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY4_FR</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            },
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Italian Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_IT</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_IT</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY3_IT</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            },
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dutch Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_NL</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_NL</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Central Supervision Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">IT_SUPERVISOR_ENTITY</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">French Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">French Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY3_FR</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY4_FR</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Central Supervision Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">IT_SUPERVISOR_ENTITY</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Italian Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Italian Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_IT</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_IT</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY3_IT</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Central Supervision Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">IT_SUPERVISOR_ENTITY</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dutch Control Centers</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">screenColumns</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Dutch Control Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY1_NL</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ENTITY2_NL</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Dispatcher</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entitiesGroups</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Central Supervision Centers</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">entities</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">IT_SUPERVISOR_ENTITY</span><span class="delimiter">&quot;</span></span>
              ],
              <span class="key"><span class="delimiter">&quot;</span><span class="content">groups</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Supervisor</span><span class="delimiter">&quot;</span></span>
              ]
            }
          ]
        }
      ]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration file, 4 different screens will be available : "All Control Centers", "French Control Centers", "Italian Control Centers" and "Dutch Control Centers".</p>
</div>
<div class="paragraph">
<p>For example, in the UI, "All Control Centers" will look like :</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../images/realtimescreens_screenshot.png" alt="Real Time Screens screenshot">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_customization"><a class="anchor" href="#_ui_customization"></a>10. UI Customization</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ui_configuration"><a class="anchor" href="#_ui_configuration"></a>10.1. UI configuration</h3>
<div class="paragraph">
<p>To customize the UI, declare specific parameters in the <code>web-ui.json</code> file as <a href="../deployment/index.html#ui_properties">listed here</a></p>
</div>
</div>
<div class="sect2">
<h3 id="menu_entries"><a class="anchor" href="#menu_entries"></a>10.2. Menu Entries</h3>
<div class="paragraph">
<p>The <code>ui-menu.json</code> file is used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To manage the visibility of core OperatorFabric menus (feed, monitoring, etc.)</p>
</li>
<li>
<p>To declare specific business menus to be displayed in the navigation bar of OperatorFabric</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="core_menu_config"><a class="anchor" href="#core_menu_config"></a>10.2.1. Core menus</h4>
<div class="paragraph">
<p>The <code>coreMenusConfiguration</code> property of the <code>ui-menu.json</code> files should contain one object with the following properties
for each core menu:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: Id of the core menu (string)</p>
</li>
<li>
<p><code>visible</code>: Whether this menu should be visible for this OperatorFabric instance (boolean)</p>
</li>
<li>
<p><code>showOnlyForGroups</code> : List of groups for which this menu should be visible (array, optional)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Menu visibility summary</div>
<ul>
<li>
<p>If a core menu is not present in <code>coreMenusVisibility</code>, it won&#8217;t be visible.</p>
</li>
<li>
<p>If a core menu doesn&#8217;t have a <code>visible</code> property, or it is set to null or false, it won&#8217;t be visible.</p>
</li>
<li>
<p>For a core menu with <code>"visible": true</code>:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>showOnlyForGroups</code> is not present, null or an empty array : the menu is visible for all users.</p>
</li>
<li>
<p>If <code>showOnlyForGroups</code> is present and with a non-empty array as a value: menu is visible only for users from the
listed groups.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. List of core menus and corresponding ids</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Location of menu</th>
<th class="tableblock halign-left valign-top">Menu</th>
<th class="tableblock halign-left valign-top">Id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Navigation bar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">archives</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Navigation bar (icon)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User card</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usercard</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock">Top-right menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notification Reception Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">feedconfiguration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real time users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">realtimeusers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Night/Day toggle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nightdaymode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">About</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">about</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changepassword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logout</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <code>/config/docker/ui-menu.json</code> for an example containing all core menus.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This property only manages menu visibility, not resource access rights. For example, if visibility of the
Administration menu is granted to groups other than the <code>ADMIN</code> group, users will be able to see the administration
screen but not to perform administration tasks, as they require administrator privileges.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you decide not to make the night/day toggle visible (globally or for certain users), you should consider
setting the <code>settings.styleWhenNightDayModeDesactivated</code> property in <code>web-ui.json</code> to specify which mode should be used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_business_menus"><a class="anchor" href="#_custom_business_menus"></a>10.2.2. Custom business menus</h4>
<div class="paragraph">
<p>A menu can target directly a link or give access to several sub-menus when clicked.
Those sub-menus can only target a link.
A targeted link can be open in an iframe or in a new tab.</p>
</div>
<div class="paragraph">
<p>Menus support i18n following the i18n OperatorFabric rules.
The ui-menu.json file contains directly the i18n dictionary for the menus.</p>
</div>
<div class="paragraph">
<p>In case of a single menu, the navigation bar displays the l10n of the <code>label</code> of the entry menu.
In this case, the <code>label</code> declared at the root level of the menu is useless and can be omitted (see example below).</p>
</div>
<div class="paragraph">
<p>A single menu or a menu with sub-menus has at least attributes named <code>id</code> and <code>entries</code>.
The <code>entries</code> attribute is an array of <code>menu entry</code>. It is possible to restrict the visibility of one menu entry the one
or more user groups by setting the <code>showOnlyForGroups</code> parameter.
Note that menus with sub-menus need a <code>label</code> declaring an i18n key.</p>
</div>
<div class="paragraph">
<p>Each <code>menu entry</code> declares the attributes listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code>: identifier of the entry menu in the UI;</p>
</li>
<li>
<p><code>url</code>: url opening a new page in a tab in the browser;</p>
</li>
<li>
<p><code>label</code>: it&#8217;s an i18n key used to l10n the entry in the UI.</p>
</li>
<li>
<p><code>linkType</code>: Defines how to display business menu links in the navigation bar and how to open them. Possible values:</p>
<div class="ulist">
<ul>
<li>
<p><code>TAB</code>: displays only a text link. Clicking it opens the link in a new tab.</p>
</li>
<li>
<p><code>IFRAME</code>: displays only a text link. Clicking it opens the link in an iframe in the main content zone below the navigation bar.</p>
</li>
<li>
<p><code>BOTH</code>: default value. Displays a text link plus a little arrow icon. Clicking the text link opens the link in an iframe while clicking the icon opens in a new tab.
**</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>showOnlyForGroups</code>: Defines the list of user groups entitled to see the menu entry, if not defined or empty it will be visible to every user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, the configuration file declares two additional business menus.
The first has only one entry, the second has two entries.
The sample also contains the i18n translations in English and in French.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">menus</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_0</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.single</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>
        }
      ]
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title.multi</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">entries</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://opfab.github.io/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry1</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ReadOnly,Dispatcher</span><span class="delimiter">&quot;</span></span>
        },
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uid_test_2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://www.wikipedia.org/</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">entry.entry2</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">linkType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOTH</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">showOnlyForGroups</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Planner</span><span class="delimiter">&quot;</span></span>
        }
      ]
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">locales</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Single menu entry</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">First menu entry</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Second menu entry</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">i18n</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu1</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">single</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier Ã©lÃ©ment</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">menu2</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">multi</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DeuxiÃ¨me menu</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Premier Ã©lÃ©ment</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">entry2</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DeuxiÃ¨me Ã©lÃ©ment</span><span class="delimiter">&quot;</span></span>
          }
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For iframes opened from menu, the associated request uses an extra parameter containing the current theme information.
Named <code>opfab_theme</code>, this parameter has a value corresponding to the current theme: <code>DAY</code> or <code>NIGHT</code>. For example:
<code><a href="http://mysite.com/index.htm?opfab_theme=NIGHT" class="bare">mysite.com/index.htm?opfab_theme=NIGHT</a></code>. Switching theme will trigger reload of open iframes.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_devices_service"><a class="anchor" href="#_external_devices_service"></a>11. External Devices Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The external devices service is an optional service allowing OperatorFabric to relay notifications to external
physical devices.</p>
</div>
<div class="sect2">
<h3 id="_specification"><a class="anchor" href="#_specification"></a>11.1. Specification</h3>
<div class="paragraph">
<p>The aim of this section is to describe the initial business need that led to the creation of this service and what use
cases are currently supported.</p>
</div>
<div class="paragraph">
<p>OperatorFabric users already have the option to be notified of a card&#8217;s arrival by a sound played by their browser.
There is a different sound for each severity, and they are configurable for a given instance. The users can decide to
opt out of sound notifications for certain severities.
We also added an option for the sounds to be repeated until the operator interacted with the application (i.e. clicked
anywhere on the page) so as to make them harder to miss.</p>
</div>
<div class="paragraph">
<p>This can be enough for some use cases, but it was not ideal for operators working in control rooms. Indeed, control
rooms each have an external sound system that is shared for the whole room, and existing applications currently
trigger sound alerts on these sound systems rather than on each operator&#8217;s computer.</p>
</div>
<div class="paragraph">
<p>This has several advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The sound can be heard by all operators</p>
</li>
<li>
<p>It can be heard even if the operator is not at their desk</p>
</li>
<li>
<p>The sound system can warn that the connexion with an application has been lost if it hasn&#8217;t received a "watchdog"
signal for a given period of time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a result, external devices support in OperatorFabric aims to allow sound notifications to be passed on to external
sound systems. The sound system on which the sound will be played can depend on the user receiving the notification.
For example, all operators working in control room A will have their sounds played on the control room&#8217;s central sound
system, while operators from control room B will use theirs.
Each user can have several external devices configured.</p>
</div>
<div class="paragraph">
<p>So far, only sound systems using the Modbus protocol are supported, but we would like to be able to support other
protocols (and ultimately allow people to supply their own drivers) in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation"><a class="anchor" href="#_implementation"></a>11.2. Implementation</h3>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a>11.2.1. Architecture</h4>
<div class="paragraph">
<p>Given the use case described above, a new service was necessary to act as a link between the OperatorFabric UI and
the external devices. This service is in charge of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing the configuration relative to external devices (see below for details)</p>
</li>
<li>
<p>Process requests from the UI (e.g. "play the sound for ALARM for user operator1_fr") and translate them as requests to
the appropriate device in their supported protocol, based on the above configuration</p>
</li>
<li>
<p>Allow the pool of devices to be managed (connection, disconnection)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This translates as three APIs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/ExtDevArchitecture.drawio.png" alt="Architecture diagram">
</div>
</div>
<div class="paragraph">
<p>Here is what happens when user operator1_fr receives a card with severity ALARM:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Angular code, the reception of the card triggers a sound notification.</p>
</li>
<li>
<p>If the external devices feature is enabled and the user has chosen to play sounds on external devices
(instead of the browser), the UI code sends a POST request on the <code>external-devices/notifications</code> endpoint on the
NGINX gateway, with the following payload:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">opfabSignalId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>The NGINX server, acting as a gateway, forwards it to the <code>/notifications</code> endpoint on the External Devices service.</p>
</li>
<li>
<p>The External Devices service queries the configuration repositories to find out which external devices are configured
for operator1_fr, how to connect to them and what signal "ALARM" translates to on these particular devices.</p>
</li>
<li>
<p>It then creates the appropriate connections if they don&#8217;t exist yet, and sends the signal.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>11.2.2. Configuration</h4>
<div class="paragraph">
<p>The following elements need to be configurable:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each user, which devices to use:</p>
<div class="listingblock">
<div class="title">userConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">userLogin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">operator1_fr</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">externalDeviceIds</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
</li>
<li>
<p>How to connect to a given external device (host, port)</p>
<div class="listingblock">
<div class="title">deviceConfiguration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>How to map an OperatorFabric signal key <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> to a signal (sound, light) on the external system</p>
<div class="listingblock">
<div class="title">signalMapping</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default_CDS_mapping</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This means that a single physical device allowing 2 different sets of sounds to be played (for example one set for desk
A and another set for desk B) would be represented as two different device configurations, with different ids.</p>
</div>
<div class="listingblock">
<div class="title">Device configurations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CDS_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>: <span class="integer">4300</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">signalMappingId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>
}]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Signal mappings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_A</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>
  }
},
{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">mapping_B</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">supportedSignals</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ALARM</span><span class="delimiter">&quot;</span></span>: <span class="integer">5</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ACTION</span><span class="delimiter">&quot;</span></span>: <span class="integer">6</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">COMPLIANT</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">INFORMATION</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>
  }
}]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The signalMapping object is built as a Map with String keys (rather than the Severity enum or any otherwise
constrained type) because there is a strong possibility that in the future we might want to map something other than
severities.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the <a href="https://opfab.github.io/documentation/current/api/external-devices/">API documentation</a> for details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a <code>Device</code> object distinct from <code>DeviceConfiguration</code> because the latter represents static information
about how to reach a device, while the former contains information about the actual connexion and its status.
For example, this is why the device configuration contains a <code>host</code> (which can be a hostname) while the device
has a <code>resolvedAddress</code>.
As a result, they are managed through separate endpoints, which might also make things easier if we need to secure
them differently (some people might be allowed to connect/disconnect devices but not change their configuration).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>11.3. Configuration</h3>

</div>
<div class="sect2">
<h3 id="_connexion_management"><a class="anchor" href="#_connexion_management"></a>11.4. Connexion Management</h3>
<div class="paragraph">
<p>OperatorFabric doesn&#8217;t automatically attempt to connect to configured external devices on start up as they might not
be available when the OperatorFabric instance starts. Similarly, posting a new device configuration to the external
devices service doesn&#8217;t cause it to attempt to connect immediately, as the configuration setup might be done in advance
of the actual activation.</p>
</div>
<div class="paragraph">
<p>However, if a notification is received by the external devices service that needs to be passed on to a device that is
configured but not connected yet, the connection will be performed automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_management"><a class="anchor" href="#_configuration_management"></a>11.5. Configuration Management</h3>
<div class="paragraph">
<p>In coherence with the way Entities, Perimeters, Users and Groups are managed, SignalMapping, UserConfiguration and
DeviceConfiguration resources can be deleted even if other resources link to them.
For example, if a device configuration lists <code>someMapping</code> as its <code>signalMappingId</code> and a DELETE request is sent
on <code>someMapping</code>, the deletion will be performed and return a 200 Success, and the device will have a <code>null</code>
<code>signalMappingId</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_drivers"><a class="anchor" href="#_drivers"></a>11.6. Drivers</h3>
<div class="paragraph">
<p>This section contains information that is specific to each type of driver. Currently, the only supported driver uses
the <a href="https://en.wikipedia.org/wiki/Modbus">Modbus protocol</a>.</p>
</div>
<div class="sect3">
<h4 id="_modbus_driver"><a class="anchor" href="#_modbus_driver"></a>11.6.1. Modbus Driver</h4>
<div class="paragraph">
<p>The Modbus driver is based on the <a href="https://github.com/kochedykov/jlibmodbus">jlibmodbus</a> library to create a
<code>ModbusMaster</code> for each device and then send requests through it using the
<a href="https://github.com/kochedykov/jlibmodbus/blob/master/src/com/intelligt/modbus/jlibmodbus/msg/request/WriteSingleRegisterRequest.java">WriteSingleRegisterRequest</a>
object.</p>
</div>
<div class="paragraph">
<p>We are currently using the "BROADCAST" mode, which (at least in the jlibmodbus implementation) means that the Modbus
master doesn&#8217;t expect any response to its requests (which makes sense because if there really are several clients
responding to the broadcast, )
This is mitigated by the fact that if watchdog signals are enabled, the external devices will be able to detect that
they are not receiving signals correctly.
In the future, it could be interesting to switch to the TCP default so OperatorFabric can be informed of any exception
in the processing of the request, allowing for example to give a more meaningful connection status
(see <a href="https://github.com/opfab/operatorfabric-core/issues/2294">#2294</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_new_drivers"><a class="anchor" href="#_adding_new_drivers"></a>11.6.2. Adding new drivers</h4>
<div class="paragraph">
<p>New drivers should implement the <code>ExternalDeviceDriver</code> interface, and a corresponding factory implementing the
<code>ExternalDeviceDriverFactory</code> interface should be created with it.</p>
</div>
<div class="paragraph">
<p>The idea is that in the future, using dependency injection, Spring should be able to pick up any factory on the classpath implementing
the correct interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ExternalDeviceDriver</code>, <code>ExternalDeviceDriverFactory</code> and the accompanying custom exceptions should be made
available as a jar on Maven Central if we want to allow project users to provide their own drivers.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If several drivers need to be used on a given OperatorFabric instance at the same time, we will need to introduce
a device type in the deviceConfiguration object.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. currently, that means a severity, but in the future it could also be a process id, or anything identifying the signal to be played
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>